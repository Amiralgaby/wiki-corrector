<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>tutoriel:restrictions_horaires [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="securite,tutoriel,pam"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/tutoriel/restrictions_horaires?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns=tutoriel"/>
<link rel="edit" title="Modifier cette page" href="/tutoriel/restrictions_horaires?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/tutoriel/restrictions_horaires"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/tutoriel/restrictions_horaires"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/tutoriel/restrictions_horaires"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='tutoriel';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"tutoriel:restrictions_horaires","namespace":"tutoriel","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="tutoriel:restrictions_horaires">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/tutoriel/restrictions_horaires?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/tutoriel/restrictions_horaires?do=media&amp;ns=tutoriel"  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/tutoriel/restrictions_horaires?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/tutoriel/restrictions_horaires?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/tutoriel/restrictions_horaires?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/tutoriel/restrictions_horaires?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/tutoriel/restrictions_horaires?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">tutoriel:restrictions_horaires</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/tutoriel/restrictions_horaires?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/tutoriel/restrictions_horaires?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/tutoriel/restrictions_horaires?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#utilisation_d_une_interface_graphique","title":"Utilisation d'une interface graphique","level":1},{"link":"#configuration_semi-automatique_par_script","title":"Configuration semi-automatique par script","level":1},{"link":"#configuration_manuelle","title":"Configuration manuelle","level":1},{"link":"#comprendre_ce_que_vous_allez_faire","title":"Comprendre ce que vous allez faire","level":2},{"link":"#activer_les_restrictions_horaires_via_le_module_pam","title":"Activer les Restrictions Horaires via le Module PAM","level":2},{"link":"#configurer_les_horaires_d_acces","title":"Configurer les Horaires d'Acc\u00e8s","level":2},{"link":"#expiration_d_une_session","title":"Expiration d'une Session","level":2},{"link":"#voir_aussi","title":"Voir aussi","level":1}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level1"><a href="#utilisation_d_une_interface_graphique">Utilisation d&#039;une interface graphique</a></li>
<li class="level1"><a href="#configuration_semi-automatique_par_script">Configuration semi-automatique par script</a></li>
<li class="level1"><a href="#configuration_manuelle">Configuration manuelle</a>
<ul class="nav toc">
<li class="level2"><a href="#comprendre_ce_que_vous_allez_faire">Comprendre ce que vous allez faire</a></li>
<li class="level2"><a href="#activer_les_restrictions_horaires_via_le_module_pam">Activer les Restrictions Horaires via le Module PAM</a></li>
<li class="level2"><a href="#configurer_les_horaires_d_acces">Configurer les Horaires d&#039;Accès</a></li>
<li class="level2"><a href="#expiration_d_une_session">Expiration d&#039;une Session</a></li>
</ul>
</li>
<li class="level1"><a href="#voir_aussi">Voir aussi</a></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content"><div class="tags"><span>
	<a href="/securite" class="wikilink1" title="securite" rel="tag">sécurité</a>,
	<a href="/tutoriel" class="wikilink1" title="tutoriel" rel="tag">tutoriel</a>,
	<a href="/pam?do=showtag&amp;tag=pam" class="wikilink1" title="pam" rel="tag">pam</a>
</span></div>
<hr />

<h1 class="sectionedit1 page-header" id="les_restrictions_horaires_sous_linux">Les restrictions horaires sous Linux</h1>
<div class="level1">

<p>
Avec Ubuntu Linux, il est possible d&#039;affecter à votre ordinateur des <strong>restrictions horaires</strong>, afin d&#039;empêcher la connexion d&#039;un ou plusieurs utilisateurs à votre système.
Grâce aux restrictions horaires, vous pourrez, par exemple, limiter l&#039;accès à l&#039;ordinateur pour vos enfants (une sorte de <a href="/tutoriel/comment_mettre_en_place_un_controle_parental" class="wikilink1" title="tutoriel:comment_mettre_en_place_un_controle_parental">Contrôle Parental</a>, en somme), ou bien encore protéger la connexion à votre serveur durant certaines heures.
</p>

<p>
2 grandes orientations s&#039;offrent à vous:
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> utiliser une interface graphique (utilisateur normal)</div>
</li>
<li class="level1"><div class="li"> configurer manuellement des fichiers textes (utilisateur avancé)</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/restrictions_horaires"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1525970905" /><input type="hidden" name="summary" value="[Les restrictions horaires sous Linux] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="les_restrictions_horaires_sous_linux" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="39-735" /><button type="submit" title="Les restrictions horaires sous Linux" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit2 page-header" id="utilisation_d_une_interface_graphique">Utilisation d&#039;une interface graphique</h2>
<div class="level2">

<p>
Pour utiliser une interface graphique, consulter la page sur le logiciel <a href="/timekpr" class="wikilink1" title="timekpr">timekpr</a>.
</p>

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/restrictions_horaires"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1525970905" /><input type="hidden" name="summary" value="[Utilisation d&#039;une interface graphique] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="utilisation_d_une_interface_graphique" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="736-874" /><button type="submit" title="Utilisation d&#039;une interface graphique" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit3 page-header" id="configuration_semi-automatique_par_script">Configuration semi-automatique par script</h2>
<div class="level2">

<p>
Le script <strong>CTparental</strong> que l&#039;on retrouve dans la page de documentation <a href="/tutoriel/comment_mettre_en_place_un_controle_parental#dnsmasq_et_blackliste_de_l_universite_de_toulouse" class="wikilink1" title="tutoriel:comment_mettre_en_place_un_controle_parental">comment mettre en place un contrôle parental</a>
se base sur les principes décrits dans la partie <strong>Configuration manuelle</strong>, mais automatise toutes les étapes.
</p>

<p>
Une fois le script installé il vous suffira de lancer :
</p>
<pre class="code">sudo CTparental -off  # si vous ne voulez pas du filtrage sur Internet.</pre>

<p>
puis :
</p>
<pre class="code">sudo CTparental -tlo  # pour paramétrer les plages horaires de connexion de chaque usager. Attention à bien se laisser un compte en accès H24 7/7</pre>

</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/restrictions_horaires"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1525970905" /><input type="hidden" name="summary" value="[Configuration semi-automatique par script] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration_semi-automatique_par_script" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="875-1566" /><button type="submit" title="Configuration semi-automatique par script" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit4 page-header" id="configuration_manuelle">Configuration manuelle</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/restrictions_horaires"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1525970905" /><input type="hidden" name="summary" value="[Configuration manuelle] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration_manuelle" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="1567-1602" /><button type="submit" title="Configuration manuelle" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit5" id="comprendre_ce_que_vous_allez_faire">Comprendre ce que vous allez faire</h3>
<div class="level3">

<p>
Tout au long de ce tutoriel, nous allons nous servir du <strong>Module PAM</strong> (Pluggable Authentication Modules, en anglais <em>modules d&#039;authentification enfichables</em>). Il permet de contrôler l&#039;authentification des utilisateurs lorsqu&#039;ils se connectent. Puis, nous utiliserons les fichiers de configuration de sécurité afin de définir les heures de connexion autorisées.<br/>

Ces manipulations peuvent être exécutées sur <strong>n&#039;importe quelle version d&#039;Ubuntu</strong>, et ne nécessitent qu&#039;un simple éditeur de texte (<a href="/vim" class="wikilink1" title="vim">vim</a>, <a href="/emacs" class="wikilink1" title="emacs">emacs</a>, <a href="/nano" class="wikilink1" title="nano">nano</a>, <a href="/gedit" class="wikilink1" title="gedit">gedit</a>, <a href="/kate" class="wikilink1" title="kate">kate</a>, pour ne citer qu&#039;eux).<br/>

</p>

</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/restrictions_horaires"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1525970905" /><input type="hidden" name="summary" value="[Comprendre ce que vous allez faire] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="comprendre_ce_que_vous_allez_faire" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="1603-2240" /><button type="submit" title="Comprendre ce que vous allez faire" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit6" id="activer_les_restrictions_horaires_via_le_module_pam">Activer les Restrictions Horaires via le Module PAM</h3>
<div class="level3">

<p>
Tout d&#039;abord, commencez par vous rendre dans le répertoire <code>/etc/pam.d/</code>, où se situe l&#039;ensemble des services configurables :
</p>
<pre class="code">$ ls /etc/pam.d/
atd   common-account   common-session  gdm                login   ppp    sudo
chfn  common-auth      cron            gdm-autologin      other   samba
chsh  common-password  cupsys          gnome-screensaver  passwd  su</pre>

<p>
Si nous souhaitons bloquer la connexion à l&#039;ordinateur, nous allons devoir modifier le service <a href="/lightdm" class="wikilink1" title="lightdm">lightdm</a>. <a href="/tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">Editez donc le fichier</a>  <code>lightdm</code> et ajoutez-y cette ligne de code (à la fin du fichier) :
</p>
<pre class="file">account required pam_time.so</pre>

<p>
Si vous utilisez <strong>kdm</strong>, ce sera donc ce fichier qu&#039;il faudra ouvrir.<br/>

Et voilà, c&#039;est terminé pour la configuration du module PAM ! Cela aura pour effet d&#039;activer le contrôle des heures sur ce service .
</p>
<div class="noteimportant">Si vous possédez un serveur, vous ne disposez sûrement pas d&#039;interface graphique. Auquel cas, Lightdm n&#039;est pas installé et la connexion ne sera pas bloquée. Pour empêcher la connexion aux <a href="/tty" class="wikilink2" title="tty" rel="nofollow">TTY</a>, il faut modifier le fichier <code>login</code> du même dossier, et y ajouter la même ligne de code que celle précédemment citée.
Cette manipulation est également valable pour les personnes qui ont installé une interface graphique et qui souhaitent bloquer l&#039;accès à l&#039;écran de connexion ainsi qu&#039;aux terminaux.
</div>
</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/restrictions_horaires"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1525970905" /><input type="hidden" name="summary" value="[Activer les Restrictions Horaires via le Module PAM] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="activer_les_restrictions_horaires_via_le_module_pam" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="2241-3725" /><button type="submit" title="Activer les Restrictions Horaires via le Module PAM" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit7" id="configurer_les_horaires_d_acces">Configurer les Horaires d&#039;Accès</h3>
<div class="level3">

<p>
Maintenant que le service PAM a été activé, nous n&#039;avons plus qu&#039;à configurer les heures d&#039;accès. Ouvrez le répertoire <code>/etc/security</code>. Plusieurs fichiers de configuration s&#039;offrent à vous :
</p>
<pre class="code">$ ls /etc/security/
access.conf  namespace.conf  pam_env.conf
group.conf   namespace.init  time.conf
limits.conf  opasswd         time.conf.bak</pre>

<p>
<a href="/tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">Editez le fichier</a> <code>time.conf</code>. Quelques explications accompagnées d&#039;exemples (en anglais) introduisent le fichier. Pour définir les horaires d&#039;accès, copiez-collez la ligne de code suivante (à la fin du fichier, comme toujours) :
</p>
<pre class="code">*;*;utilisateurs;horaires</pre>

<p>
A la place du champ <code>utilisateur</code>, écrivez le <strong>login</strong> du compte que vous souhaitez bloquer. 
</p>
<div class="notetip">Si vous souhaitez bloquer plusieurs utilisateurs, écrivez leurs login à la suite, séparés par l&#039;opérateur <strong>|</strong>.
Par exemple, si je souhaite bloquer les comptes de <code>patrick</code>, <code>jean</code> et <code>emilie</code> :
<pre class="code">*;*;patrick|jean|emilie;horaires</pre>

<p>
Par contre, si vous désirez bloquer l&#039;accès au système pour tous les utilisateurs sauf un en particulier, il faut utiliser l&#039;opérateur <strong>!</strong> devant la personne concernée.<br/>
Par exemple, si je souhaite que l&#039;accès à l&#039;ordinateur soit refusé à tous les utilisateurs, excepté <code>nicolas</code> et <code>xavier</code> :
</p>
<pre class="code">*;*;!nicolas|xavier;horaires</pre>

</div>
<p>
Intéressons-nous maintenant au champ <code>horaires</code>. C&#039;est dans ce champ que la sélection du <strong>jour</strong> et des <strong>horaires</strong> de connexion autorisées sera possible.<br/>
Vous devez tout d&#039;abord spécifier le jour de la semaine, au moyen des abréviations suivantes :
</p>
<pre class="code">Mo : Lundi		Fr : Vendredi		Wd : Samedi/Dimanche
Tu : Mardi		Sa : Samedi		Wk : Lundi/Mardi/Mercredi/Jeudi/Vendredi
We : Mercredi		Su : Dimanche
Th : Jeudi		Al : Tous les Jours</pre>
<div class="noteimportant">Attention de ne pas confondre les abréviations Wk et Wd qui sont trompeuses ! et surtout mal identifiées sur internet : on trouve facilement des informations contradictoires !
</div>
<p>
Puis, on spécifie les heures limites. Celles-ci doivent être au format 24H, composée de 4 chiffres. Par exemple, pour limiter de 15H17 à 18H34, on écrira : <code>1517-1834</code>.<br/>

Pour autoriser <code>marie</code> à se connecter seulement le Mardi, de 15H17 à 18H34, on obtient le résultat :
</p>
<pre class="code">*;*;marie;Tu1517-1834</pre>

<p>
Les connexions en dehors de cette plage horaire seront interdites.<br/>
Tout comme pour les utilisateurs, il est possible d&#039;utiliser les opérateurs <strong>|</strong> et <strong>!</strong> pour indiquer plusieurs horaires (l&#039;opérateur <strong>!</strong> indiquera alors que toutes les heures de connexion seront autorisées, sauf celles qui seront indiquées).
</p>
<div class="notetip">Les deux étoiles (<strong>jokers</strong>) au début de la ligne de code remplissent respectivement les champs <code>services</code> et <code>tty</code>. Etant donné que l&#039;on souhaite bloquer tout accès au système, il est inutile de spécifier quel service ou quel tty vous souhaitez bloquer.<br/>

Si toutefois vous souhaitez empêcher l&#039;utilisation d&#039;un service particulier, il suffit de le spécifier, comme l&#039;exemple qui suit :
<pre class="code">login;tty1|tty4|tty5;marie;!Wd0000-2400</pre>

<p>
Ainsi, l&#039;utilisateur <code>marie</code> ne pourra pas se connecter aux <abbr title="Terminal Texte">TTY</abbr> 1, 4 et 5 durant le week-end.
</p>

</div>
</div>

<h4 id="quelques_exemples_de_restrictions_horaires">Quelques Exemples de Restrictions Horaires</h4>
<div class="level4">

<p>
<code>mathilde</code> est autorisée à se connecter tous les jours de 13H20 à 15H20, puis de 16H00 à 20H30 :
</p>
<pre class="code">*;*;mathilde;Al1320-1520|Al1600-2030</pre>

<p>
<code>pierre</code>, <code>franck</code> et <code>florian</code> sont autorisés à se connecter de 14H00 à 18H45 pendant les jours de semaine, et de 14H00 à 22H15 pendant le week-end :
</p>
<pre class="code">*;*;pierre|franck|florian;Wk1400-1845|Wd1400-2215</pre>

<p>
<code>olivier</code> n&#039;est jamais autorisé à se connecter. <code>jessica</code> peut se connecter le Mercredi de 13H00 à 16H00 :
</p>
<pre class="code">*;*;olivier;!Al0000-2400
*;*;jessica;We1300-1600
# 2 lignes différentes, car deux horaires différentes pour chacun des utilisateurs</pre>

</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/restrictions_horaires"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1525970905" /><input type="hidden" name="summary" value="[Configurer les Horaires d&#039;Accès] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configurer_les_horaires_d_acces" /><input type="hidden" name="codeblockOffset" value="2" /><input type="hidden" name="range" value="3726-7736" /><button type="submit" title="Configurer les Horaires d&#039;Accès" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit8" id="expiration_d_une_session">Expiration d&#039;une Session</h3>
<div class="level3">

<p>
Lorsqu&#039;une Session arrive à expiration (qu&#039;elle dépasse la limite horaire alors que l&#039;utilisateur est déjà connecté), le module PAM ne peut atteindre l&#039;utilisateur concerné. En effet, si <code>mathilde</code> se connecte pendant les horaires de temps autorisées, elle est tout à fait libre de dépasser ces plages horaires ! Pour cela, nous allons utiliser un nouveau programme : <a href="/cron" class="wikilink1" title="cron">cron</a>. Cette application exécute des commandes à des intervalles de temps données. Dans notre cas, nous allons faire usage de la commande <code>skill -KILL -u</code> <img src="/lib/images/smileys/fixme.gif" class="icon" alt="FIXME" /> (man skill sous <a href="/xenial" class="wikilink1" title="xenial">xenial</a>: &quot;These tools are obsolete and unportable&quot; ⇒ kill) pour déconnecter l&#039;utilisateur lorsque la Session expire. <br/>

La Manipulation est très simple. <a href="/tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">Editez simplement le fichier</a> <code>/etc/crontab</code>. Ajoutez-y alors la ligne de code suivante :
</p>
<pre class="code">Minute Heure    * * Jour(s)   root    skill -KILL -u Utilisateur</pre>

<p>
Comme précédemment, remplacez les champs <code>Minute</code> et <code>Heure</code> aux horaires désirées. Puis, remplissez le champ <code>Jour(s)</code> par le(s) jour(s) interdit(s), ou tapez simplement une étoile (*) pour indiquer tous les jours de la semaine.
Enfin, remplacez le champ <code>Utilisateur</code> par le login du compte à bloquer, et voilà !
</p>
<div class="notewarning">Les Jours ne se notent pas de la même façon avec les tâches cron ! Voici la liste des abréviations à utiliser avec ce programme :
<pre class="code">mon : Lundi	fri : Vendredi
tue : Mardi	sat : Samedi
wed : Mercredi	sun : Dimanche
thu : Jeudi	 *  : Tous les Jours</pre>

</div>
</div>

<h4 id="quelques_exemples_de_taches_cron_avec_les_exemples_d_horaires_de_la_partie_precedente">Quelques Exemples de tâches cron (avec les exemples d&#039;horaires de la partie précédente)</h4>
<div class="level4">

<p>
<code>jessica</code> peut se connecter le Mercredi de 13H00 à 16H00<br/>

<em>–&gt; Déconnexion : Mercredi, à 16H00.</em>
</p>
<pre class="code">00 16    * * wed   root    skill -KILL -u jessica</pre>

<p>
<code>mathilde</code> est autorisée à se connecter tous les jours de 13H20 à 15H20, puis de 16H00 à 20H30.<br/>

<em>–&gt; Déconnexion : Tous les Jours, à 15H20 et 20H30.</em>
</p>
<pre class="code">20 15    * * *   root    skill -KILL -u mathilde
30 20    * * *   root    skill -KILL -u mathilde</pre>

<p>
<code>pierre</code>, <code>franck</code> et <code>florian</code> sont autorisés à se connecter de 14H00 à 18H45 pendant les jours de semaine, et de 14H00 à 22H15 pendant le week-end<br/>

<em>–&gt; Déconnexion (1) : Lundi, Mardi, Mercredi, Jeudi et Vendredi, à 18H45.<br/>

–&gt; Déconnexion (2) : Samedi et Dimanche, à 22H15.</em>
</p>
<pre class="code">45 18    * * mon,tue,wed,thu,fri   root    skill -KILL -u pierre &amp;&amp; skill -KILL -u franck &amp;&amp; skill -KILL -u florian
15 22    * * sat,sun               root    skill -KILL -u pierre &amp;&amp; skill -KILL -u franck &amp;&amp; skill -KILL -u florian</pre>
<div class="noteclassic">La commande <code>skill -KILL -u</code> déconnecte l&#039;utilisateur de l&#039;interface graphique, mais aussi des <abbr title="Terminal Texte">TTY</abbr>. Elle est donc parfaitement utilisable pour les administrateurs de serveur.<br/>
Cependant, cette commande est immédiate et la déconnexion sera faite sans avertissement. Il serait donc préférable de prévenir de l&#039;installation de ce dispositif les utilisateurs de l&#039;ordinateur ou du réseau en question !
</div>
<p>
Il est possible de prévenir les utilisateurs avec une commande wall lancée par cron quelques minutes avant la fin de la plage horaire, qui sera affichée dans les terminaux de tous les utilisateurs.
</p>
<pre class="code">40 18    * * mon,tue,wed,thu,fri   root echo &quot;fin de session dans 5 minutes&quot; | wall</pre>

<p>
Pour prévenir les utilisateurs d&#039;interface graphique, on peut utiliser à la place de wall la commande notify-send qui est dans le paquet <a href="apt://libnotify-bin" class="interwiki iw_apt" title="apt://libnotify-bin">libnotify-bin</a>.
</p>
<pre class="code">40 18    * * mon,tue,wed,thu,fri   pierre DISPLAY=:0 notify-send &quot;fin de session dans 5 minutes&quot;</pre>

</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/restrictions_horaires"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1525970905" /><input type="hidden" name="summary" value="[Expiration d&#039;une Session] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="expiration_d_une_session" /><input type="hidden" name="codeblockOffset" value="12" /><input type="hidden" name="range" value="7737-11428" /><button type="submit" title="Expiration d&#039;une Session" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit9 page-header" id="voir_aussi">Voir aussi</h2>
<div class="level2">

<p>
<img src="/lib/images/smileys/fixme.gif" class="icon" alt="FIXME" />
</p>
<hr />

<p>
<em>Contributeurs principaux : </em>
</p>

</div>
<div class='secedit editbutton_section editbutton_9'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/restrictions_horaires"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1525970905" /><input type="hidden" name="summary" value="[Voir aussi] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="voir_aussi" /><input type="hidden" name="codeblockOffset" value="19" /><input type="hidden" name="range" value="11429-" /><button type="submit" title="Voir aussi" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="tutoriel/restrictions_horaires.txt">tutoriel/restrictions_horaires.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 10/05/2018, 18:48">Le 10/05/2018, 18:48</span></li><li class="text-muted">par bcag2</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=tutoriel%3Arestrictions_horaires&amp;1635532643" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
