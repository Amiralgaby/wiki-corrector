<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>tutoriel:comment_installer_un_relais_mail_securise [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="serveur,securite,courrier,tutoriel,vetuste"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/tutoriel/comment_installer_un_relais_mail_securise?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns=tutoriel"/>
<link rel="edit" title="Modifier cette page" href="/tutoriel/comment_installer_un_relais_mail_securise?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/tutoriel/comment_installer_un_relais_mail_securise"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/tutoriel/comment_installer_un_relais_mail_securise"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/tutoriel/comment_installer_un_relais_mail_securise"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='tutoriel';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"tutoriel:comment_installer_un_relais_mail_securise","namespace":"tutoriel","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="tutoriel:comment_installer_un_relais_mail_securise">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/tutoriel/comment_installer_un_relais_mail_securise?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/tutoriel/comment_installer_un_relais_mail_securise?do=media&amp;ns=tutoriel"  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/tutoriel/comment_installer_un_relais_mail_securise?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/tutoriel/comment_installer_un_relais_mail_securise?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/tutoriel/comment_installer_un_relais_mail_securise?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/tutoriel/comment_installer_un_relais_mail_securise?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/tutoriel/comment_installer_un_relais_mail_securise?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">tutoriel:comment_installer_un_relais_mail_securise</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/tutoriel/comment_installer_un_relais_mail_securise?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/tutoriel/comment_installer_un_relais_mail_securise?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/tutoriel/comment_installer_un_relais_mail_securise?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#introduction","title":"Introduction","level":1},{"link":"#pre-requis","title":"Pr\u00e9-requis","level":1},{"link":"#installation_et_configuration_de_base","title":"Installation et configuration de base","level":1},{"link":"#creation_des_certificats_ssl","title":"Cr\u00e9ation des certificats SSL","level":2},{"link":"#installation_et_configuration_de_perdition","title":"Installation et configuration de Perdition","level":2},{"link":"#installation_et_configuration_de_postfix_avec_sasl","title":"Installation et configuration de Postfix avec SASL","level":2},{"link":"#gestion_des_utilisateurs","title":"Gestion des utilisateurs","level":1},{"link":"#configuration_des_clients","title":"Configuration des clients","level":1},{"link":"#thunderbird_sur_windowslinux","title":"Thunderbird sur Windows\/Linux","level":2},{"link":"#snappermail_sur_palm","title":"SnapperMail sur Palm","level":2}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level1"><a href="#introduction">Introduction</a></li>
<li class="level1"><a href="#pre-requis">Pré-requis</a></li>
<li class="level1"><a href="#installation_et_configuration_de_base">Installation et configuration de base</a>
<ul class="nav toc">
<li class="level2"><a href="#creation_des_certificats_ssl">Création des certificats SSL</a></li>
<li class="level2"><a href="#installation_et_configuration_de_perdition">Installation et configuration de Perdition</a></li>
<li class="level2"><a href="#installation_et_configuration_de_postfix_avec_sasl">Installation et configuration de Postfix avec SASL</a></li>
</ul>
</li>
<li class="level1"><a href="#gestion_des_utilisateurs">Gestion des utilisateurs</a></li>
<li class="level1"><a href="#configuration_des_clients">Configuration des clients</a>
<ul class="nav toc">
<li class="level2"><a href="#thunderbird_sur_windowslinux">Thunderbird sur Windows/Linux</a></li>
<li class="level2"><a href="#snappermail_sur_palm">SnapperMail sur Palm</a></li>
</ul></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content"><div class="notetag">Cette page est considérée comme <a href="/vetuste">vétuste</a> et ne contient plus d'informations utiles.<br />
<a href="/wiki/participer_wiki">Apportez votre aide…</a>
</div>
<div class="tags"><span>
	<a href="/serveur" class="wikilink1" title="serveur" rel="tag">serveur</a>,
	<a href="/securite" class="wikilink1" title="securite" rel="tag">sécurité</a>,
	<a href="/courrier" class="wikilink1" title="courrier" rel="tag">courrier</a>,
	<a href="/tutoriel" class="wikilink1" title="tutoriel" rel="tag">tutoriel</a>,
	<a href="/vetuste" class="wikilink1" title="vetuste" rel="tag">VÉTUSTE</a>
</span></div>
<hr />

<h1 class="sectionedit1 page-header" id="comment_installer_un_relais_mail_securise">Comment installer un relais mail sécurisé ?</h1>
<div class="level1">

</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_installer_un_relais_mail_securise"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605262" /><input type="hidden" name="summary" value="[Comment installer un relais mail sécurisé ?] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="comment_installer_un_relais_mail_securise" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="62-124" /><button type="submit" title="Comment installer un relais mail sécurisé ?" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit2 page-header" id="introduction">Introduction</h2>
<div class="level2">

<p>
L&#039;utilisation nomade du courriel (sous entendu IMAP et SMTP) est devenue une pratique courante. Les utilisateurs souhaitent accéder à tous leurs dossiers et veulent envoyer et recevoir des courriels où qu&#039;ils soient.
</p>

<p>
Ce concept de plus en plus désiré (il suffit de voir les systèmes BlackBerry, Palm, …) pose un problème relativement délicat à gérer pour l&#039;administrateur du serveur de courriel. 
</p>

<p>
Dans une utilisation normale (c&#039;est-à-dire les utilisateurs sont dans les murs sur le même réseau que le serveur de courriel), la sécurisation du serveur est simple; on limite les relais SMTP aux seuls réseaux connus. C&#039;est la politique employée par les fournisseurs d&#039;accès Internet.
</p>

<p>
Lorsque les utilisateurs se connectent sur n&#039;importe quel réseau en dehors des murs de la société (WiFi, UMTS, hôtel, …), il faut assurer un minimum de sécurité.
</p>

<p>
Dans ce document, je vous présenterai comment mettre en place un relais IMAP et SMTP avec authentification et sécurisation SSL. En fin de document, je mentionnerai la configuration client à utiliser dans le cadre d&#039;un usage avec Thunderbird installé sur un portable et la configuration d&#039;un Palm avec SnapperMail.
</p>

<p>
<em> Remarque : il existe un moyen simple pour un utilisateur distant d&#039;accéder à <em class="u">toutes</em> les ressources d&#039;un réseau d&#039;entreprise, la tunnellisation. Je suis assez contre cette solution si c&#039;est pour ouvrir uniquement un accès courriel car, premièrement, une connexion sous tunnel avec un client Microsoft Windows va envoyer une quantité inconsidérée de paquet pour les accès aux disques réseaux. Et deuxièmement, les accès avec des systèmes GSM, BlackBerry, Palm ou autres sont plus difficiles à mettre en œuvre avec un tunnel. </em>
</p>

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_installer_un_relais_mail_securise"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605262" /><input type="hidden" name="summary" value="[Introduction] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="introduction" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="125-1893" /><button type="submit" title="Introduction" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit3 page-header" id="pre-requis">Pré-requis</h2>
<div class="level2">

<p>
En rédigeant cette documentation, je pars des principes suivants :
</p>
<ol class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Vous avez une machine fonctionnelle et à jour sous Dapper.</div>
</li>
<li class="level1"><div class="li"> Vous avez accès à un serveur IMAP ou POP3.</div>
</li>
<li class="level1"><div class="li"> Vous avez accès à un serveur SMTP.</div>
</li>
</ol>

<p>
<em> Remarque : ces serveurs peuvent être ceux de votre fournisseurs d&#039;accès Internet. </em>
</p>

</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_installer_un_relais_mail_securise"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605262" /><input type="hidden" name="summary" value="[Pré-requis] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="pre-requis" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="1894-2233" /><button type="submit" title="Pré-requis" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit4 page-header" id="installation_et_configuration_de_base">Installation et configuration de base</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_installer_un_relais_mail_securise"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605262" /><input type="hidden" name="summary" value="[Installation et configuration de base] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation_et_configuration_de_base" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="2234-2286" /><button type="submit" title="Installation et configuration de base" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit5" id="creation_des_certificats_ssl">Création des certificats SSL</h3>
<div class="level3">

<p>
Il existe beaucoup de site expliquant comment créer un certificat SSL personnel. <a href="/tutoriel/comment_creer_un_certificat_ssl" class="wikilink1" title="tutoriel:comment_creer_un_certificat_ssl">Voici une technique détaillée dans le wiki.</a>
</p>

<p>
<em>Remarque : ce certificat n&#039;est authentifié par aucune autorité, vous aurez donc un message d&#039;avertissement quand vous vous connectez au serveur. Thunderbird prévoit une option : &quot;Toujours faire confiance à…&quot; qu&#039;il convient d&#039;utiliser. </em>
</p>

</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_installer_un_relais_mail_securise"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605262" /><input type="hidden" name="summary" value="[Création des certificats SSL] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="creation_des_certificats_ssl" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="2287-2748" /><button type="submit" title="Création des certificats SSL" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit6" id="installation_et_configuration_de_perdition">Installation et configuration de Perdition</h3>
<div class="level3">

<p>
Pour le relais de courrier au niveau IMAP et du POP3, j&#039;utilise <a href="/perdition" class="wikilink1" title="perdition">perdition</a>. <a href="/perdition" class="wikilink1" title="perdition">Perdition</a> sert de relais pour les connexions sécurisées vers un serveur qui, à priori, ne l&#039;est pas.
</p>

<p>
Pour installer <a href="/perdition" class="wikilink1" title="perdition">perdition</a> :
</p>
<pre class="code">sudo apt-get install perdition</pre>

</div>

<h4 id="imaps">IMAPS</h4>
<div class="level4">

<p>
Voici les quelques configurations que j&#039;ai utilisé pour effectuer le relais sécurisé IMAP. C&#039;est-à-dire que j&#039;ai un serveur IMAP en interne (simple, non sécurisé, les utilisateurs s&#039;identifient avec login/mot de passe) et de l&#039;extérieur, j&#039;ai un serveur IMAPS (sécurisé en SSL, les utilisateurs s&#039;identifient avec le même login/mot de passe).
</p>

<p>
Pour la configuration, je crée un fichier <code>/etc/perdition/perdition.imap4s.conf</code> avec les informations suivantes :
</p>
<pre class="file">outgoing_server 192.168.0.5
outgoing_port 143
log_facility local5
no_lookup
timeout 40
imap_capability &quot;IMAP4rev1 UIDPLUS CHILDREN NAMESPACE THREAD=ORDEREDSUBJECT THREAD=REFERENCES SORT QUOTA IDLE STARTTLS&quot;
listen_port 993
ssl_mode ssl_listen
ssl_cert_file /etc/ssl/server.crt
ssl_key_file /etc/ssl/server.key</pre>

<p>
Mon serveur IMAP en interne est accédé à l&#039;adresse <code>192.168.0.5</code> et sur le port <code>143</code>.
</p>

</div>

<h4 id="pop3s">POP3S</h4>
<div class="level4">

<p>
Voici la configuration utilisée pour effectuer le relais vers un serveur POP3.
</p>

<p>
Pour la configuration, je crée un fichier <code>/etc/perdition/perdition.pop3s.conf</code> avec les informations suivantes :
</p>
<pre class="file">outgoing_server 192.168.0.4
outgoing_port 110
log_facility local5
no_lookup
timeout 40
ssl_mode ssl_listen
ssl_cert_file /etc/ssl/server.crt
ssl_key_file /etc/ssl/server.key</pre>

<p>
Mon serveur POP3 en interne est accédé à l&#039;adresse <code>192.168.0.4</code> et sur le port <code>110</code>.
</p>

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_installer_un_relais_mail_securise"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605262" /><input type="hidden" name="summary" value="[Installation et configuration de Perdition] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation_et_configuration_de_perdition" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="2749-4481" /><button type="submit" title="Installation et configuration de Perdition" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit7" id="installation_et_configuration_de_postfix_avec_sasl">Installation et configuration de Postfix avec SASL</h3>
<div class="level3">

<p>
Cette partie est la partie la plus délicate… En fait, j&#039;ai passé plusieurs jours pour configurer mon accès SMTPS avec authentification SASL car aucun des tutoriels trouvés sur Internet n&#039;ont fonctionné. Voici le résultat de mes recherches, certains parties ne sont pas idéales mais tout fonctionne.
</p>

</div>

<h4 id="postfix_de_base">Postfix de base</h4>
<div class="level4">

<p>
Premièrement, installons Postfix si ce n&#039;est déjà fait :
</p>
<pre class="code">sudo apt-get install postfix</pre>

<p>
Ensuite, nous allons configurer Postfix en tant que relais simple (avant de rajouter l&#039;authentification et le SSL). Pour ce faire, on modifie le fichier de configuration <code>/etc/postfix/main.cf</code> de la manière suivante :
</p>
<pre class="file"># See /usr/share/postfix/main.cf.dist for a commented, more complete version

smtpd_banner = $myhostname ESMTP $mail_name (Ubuntu)
biff = no

# appending .domain is the MUA&#039;s job.
append_dot_mydomain = no

# Uncomment the next line to generate &quot;delayed mail&quot; warnings
#delay_warning_time = 4h

mydomain = ubuntu-fr.org
myhostname = ubuntu-fr.org
alias_maps = hash:/etc/aliases
alias_database = hash:/etc/aliases
mydestination = mailer, localhost.localdomain, localhost
relayhost = 192.168.0.3
mynetworks = 127.0.0.0/8
mailbox_size_limit = 0
recipient_delimiter = +
inet_interfaces = all</pre>

<p>
Dans notre exemple, on travailler pour le domaine <code>ubuntu-fr.org</code> et le serveur SMTP réel est <code>192.168.0.3</code>.
</p>

<p>
Rechargez la configuration de Postfix et faites un essai d&#039;envoi pour être sûr que tout fonctionne :
</p>
<pre class="code">sudo /etc/init.d/postfix reload</pre>

</div>

<h4 id="sasl">SASL</h4>
<div class="level4">

<p>
Si les envois fonctionnent par le relais, on va ajouter l&#039;authentification. On commence par installer SASL par la commande suivante :
</p>
<pre class="code">sudo apt-get install libsasl2 libsasl2-modules sasl2-bin</pre>

<p>
On configure SASL en éditant le fichier <code>/etc/default/saslauthd</code> afin qu&#039;il ressemble à ceci :
</p>
<pre class="file">START=yes
MECHANISMS=&quot;sasldb&quot;</pre>

<p>
On configure le répertoire de travail de SASL en éditant le fichier <code>/etc/init.d/saslauthd</code>. Trouvez une ligne commençant par <code>PARAMS=&quot;…&quot;</code> et ajoutez avant les guillemets de fermeture : 
</p>
<pre class="file">-m /var/spool/postfix/var/run/saslauthd</pre>

<p>
On crée les différents répertoires nécessaires à SASL :
</p>
<pre class="code">sudo mkdir /var/spool/postfix/var
sudo mkdir /var/spool/postfix/var/run
sudo mkdir /var/spool/postfix/var/run/saslauthd
sudo chown -R root:sasl /var/spool/postfix/var/run/saslauthd</pre>

<p>
Et enfin, on désactives une bibliothèque d&#039;authentification qui pose problème (je n&#039;ai pas trouver d&#039;autre solution pour le moment) :
</p>
<pre class="code">cd /usr/lib/sasl2
sudo mkdir deactived
sudo mv *otp* deactived/</pre>

<p>
On peut maintenant démarrer le démon d&#039;authentification :
</p>
<pre class="code">sudo /etc/init.d/saslauthd start</pre>

</div>

<h4 id="postfix_avec_authentification">Postfix avec authentification</h4>
<div class="level4">

<p>
Créez le fichier <code>/etc/postfix/sasl/smtpd.conf</code> et indiquez : 
</p>
<pre class="file">pwcheck_method: saslauthd
mech_list: plain login</pre>

<p>
Modifiez le contenu du fichier <code>/etc/postfix/main.cf</code> en ajoutant les lignes suivantes :
</p>
<pre class="file">smtpd_tls_cert_file=/etc/ssl/server.crt
smtpd_tls_key_file=/etc/ssl/server.key
smtpd_use_tls=yes
smtpd_tls_session_cache_database = btree:${queue_directory}/smtpd_scache
smtp_tls_session_cache_database = btree:${queue_directory}/smtp_scache

smtpd_sasl_auth_enable = yes
smtpd_sasl_security_options = noanonymous
smtpd_sasl_local_domain = $mydomain
smtpd_sasl_application_name = smtpd
broken_sasl_auth_clients = yes

smtpd_recipient_restrictions = permit_sasl_authenticated, reject</pre>

<p>
Redémarrez Postfix, vous devriez pouvoir vous connecter sur le port SMTP standard (25) en identification <abbr title="Transport Layer Security">TLS</abbr> (lisez la section concernant les mots de passe au préalable, car sans login, la connexion ne fonctionnera pas).
</p>
<pre class="code">sudo /etc/init.d/postfix restart</pre>

</div>

<h4 id="postfix_uniquement_via_ssl_avec_authentification">Postfix uniquement via SSL avec authentification</h4>
<div class="level4">

<p>
Si tout fonctionne, il ne reste plus qu&#039;à autoriser les connexions uniquement en SMTPS. Pour ce faire, modifiez le fichier <code>/etc/postfix/master.cf</code> en commentant la ligne suivante :
</p>
<pre class="file">#smtp      inet  n       -       -       -       -       smtpd</pre>

<p>
et en décommentant les lignes suivantes :
</p>
<pre class="file">submission inet n      -       -       -       -       smtpd
        -o smtpd_etrn_restrictions=reject
        -o smtpd_client_restrictions=permit_sasl_authenticated,reject
smtps    inet  n       -       -       -       -       smtpd
        -o smtpd_tls_wrappermode=yes -o smtpd_sasl_auth_enable=yes</pre>

<p>
Rechargez la configuration de Postfix :
</p>
<pre class="code">sudo /etc/init.d/postfix restart</pre>

</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_installer_un_relais_mail_securise"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605262" /><input type="hidden" name="summary" value="[Installation et configuration de Postfix avec SASL] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation_et_configuration_de_postfix_avec_sasl" /><input type="hidden" name="codeblockOffset" value="3" /><input type="hidden" name="range" value="4482-9092" /><button type="submit" title="Installation et configuration de Postfix avec SASL" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit8 page-header" id="gestion_des_utilisateurs">Gestion des utilisateurs</h2>
<div class="level2">

<p>
Pour ce qui est de l&#039;IMAP ou du POP3, l&#039;authentification est déléguée au serveur sous-jacent. 
</p>

<p>
Pour ce qui est du SMTP, l&#039;authentification est gérée à partir de SASL (démon <code>saslauthd</code>). Le fichier des mots de passe se trouve en <code>/etc/sasldb2</code>.
</p>

<p>
Pour ajouter un utilisateur, modifier un mot de passe ou supprimer un utilisateur;  vous pouvez utiliser la commande <code>saslpasswd2</code> (voir la manpage pour plus de détail). Par exemple : 
</p>
<pre class="code">sudo saslpasswd2 -c ostaquet -u ubuntu-fr.org</pre>

<p>
Une seule restriction, le mot de passe d&#039;un utilisateur ne peut pas être <code>userPassword</code>.
</p>

<p>
Pour lister les utilisateurs :
</p>
<pre class="code">sudo sasldblistusers2</pre>

</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_installer_un_relais_mail_securise"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605262" /><input type="hidden" name="summary" value="[Gestion des utilisateurs] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="gestion_des_utilisateurs" /><input type="hidden" name="codeblockOffset" value="18" /><input type="hidden" name="range" value="9093-9802" /><button type="submit" title="Gestion des utilisateurs" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit9 page-header" id="configuration_des_clients">Configuration des clients</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_9'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_installer_un_relais_mail_securise"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605262" /><input type="hidden" name="summary" value="[Configuration des clients] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration_des_clients" /><input type="hidden" name="codeblockOffset" value="20" /><input type="hidden" name="range" value="9803-9842" /><button type="submit" title="Configuration des clients" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit10" id="thunderbird_sur_windowslinux">Thunderbird sur Windows/Linux</h3>
<div class="level3">

<p>
Sous Thunderbird, vous devez créer un nouveau compte. 
</p>

<p>
Dans les paramètres des comptes, onglet &quot;Paramètres serveur&quot;. Indiquez serveur IMAP et sélectionnez &quot;SSL&quot; pour les paramètres de sécurité. La procédure est semblable pour le POP3.
</p>

<p>
Pour les envois de courrier, allez dans &quot;Serveur sortant (SMTP)&quot;. Dans la partie &quot;Sécurité et authentification&quot;, sélectionnez &quot;SSL&quot; et &quot;Utiliser un nom d&#039;utilisateur et un mot de passe&quot;.
</p>

</div>
<div class='secedit editbutton_section editbutton_10'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_installer_un_relais_mail_securise"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605262" /><input type="hidden" name="summary" value="[Thunderbird sur Windows/Linux] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="thunderbird_sur_windowslinux" /><input type="hidden" name="codeblockOffset" value="20" /><input type="hidden" name="range" value="9843-10320" /><button type="submit" title="Thunderbird sur Windows/Linux" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit11" id="snappermail_sur_palm">SnapperMail sur Palm</h3>
<div class="level3">

<p>
Après avoir longtemps chercher un bon client de messagerie pour Palm (avec l&#039;IMAPS), je me suis arrêté sur <a href="http://www.snappermail.com" class="urlextern" title="http://www.snappermail.com" rel="nofollow">SnapperMail</a> qui fonctionne à merveille pour un usage en entreprise. Il est vrai qu&#039;il est payant mais il fonctionne très bien. Pour ceux qui n&#039;ont besoin que du POP3, le client VersaMail fournit par Palm fonctionne très bien.
</p>

<p>
Pour configurer <a href="http://www.snappermail.com" class="urlextern" title="http://www.snappermail.com" rel="nofollow">SnapperMail</a>, allez dans la configuration des comptes. Lorsque vous avez les adresses des serveurs sous les yeux, cliquez sur &quot;Advanced option&quot; et sélectionnez &quot;Always secure (wrapped port)&quot;. Les ports utilisés sont : 465 pour le SMTPS, 995 pour le POP3S et 993 pour l&#039;IMAP4S.
</p>
<hr />

<p>
<em> Contributeur : <a href="/utilisateurs/ostaquet" class="wikilink2" title="utilisateurs:ostaquet" rel="nofollow">ostaquet</a> </em>
</p>

</div>
<div class='secedit editbutton_section editbutton_11'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_installer_un_relais_mail_securise"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605262" /><input type="hidden" name="summary" value="[SnapperMail sur Palm] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="snappermail_sur_palm" /><input type="hidden" name="codeblockOffset" value="20" /><input type="hidden" name="range" value="10321-" /><button type="submit" title="SnapperMail sur Palm" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="tutoriel/comment_installer_un_relais_mail_securise.txt">tutoriel/comment_installer_un_relais_mail_securise.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 20/02/2017, 16:41">Le 20/02/2017, 16:41</span></li><li class="text-muted">par L&#039;Africain</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=tutoriel%3Acomment_installer_un_relais_mail_securise&amp;1635531218" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
