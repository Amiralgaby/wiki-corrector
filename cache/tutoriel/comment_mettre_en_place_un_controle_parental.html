<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>tutoriel:comment_mettre_en_place_un_controle_parental [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="education,securite,internet,tutoriel,controle parental"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/tutoriel/comment_mettre_en_place_un_controle_parental?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns=tutoriel"/>
<link rel="edit" title="Modifier cette page" href="/tutoriel/comment_mettre_en_place_un_controle_parental?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/tutoriel/comment_mettre_en_place_un_controle_parental"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/tutoriel/comment_mettre_en_place_un_controle_parental"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/tutoriel/comment_mettre_en_place_un_controle_parental"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='tutoriel';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"tutoriel:comment_mettre_en_place_un_controle_parental","namespace":"tutoriel","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="tutoriel:comment_mettre_en_place_un_controle_parental">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/tutoriel/comment_mettre_en_place_un_controle_parental?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/tutoriel/comment_mettre_en_place_un_controle_parental?do=media&amp;ns=tutoriel"  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/tutoriel/comment_mettre_en_place_un_controle_parental?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/tutoriel/comment_mettre_en_place_un_controle_parental?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/tutoriel/comment_mettre_en_place_un_controle_parental?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/tutoriel/comment_mettre_en_place_un_controle_parental?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/tutoriel/comment_mettre_en_place_un_controle_parental?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">tutoriel:comment_mettre_en_place_un_controle_parental</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/tutoriel/comment_mettre_en_place_un_controle_parental?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/tutoriel/comment_mettre_en_place_un_controle_parental?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/tutoriel/comment_mettre_en_place_un_controle_parental?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#session_et_internet","title":"Session et internet","level":1},{"link":"#la_session_invite","title":"La Session Invit\u00e9","level":2},{"link":"#ctparental","title":"ctparental","level":2},{"link":"#session_seulement","title":"Session seulement","level":1},{"link":"#timekpr","title":"Timekpr","level":2},{"link":"#configuration_manuelle","title":"Configuration manuelle","level":2},{"link":"#internet_seulement","title":"Internet seulement","level":1},{"link":"#solution_radicale","title":"Solution radicale","level":2},{"link":"#opendns_familyshield","title":"OpenDNS FamilyShield","level":2},{"link":"#procon_latte","title":"Procon latte","level":2},{"link":"#squidguard","title":"Squidguard","level":2},{"link":"#dansguardian","title":"DansGuardian","level":2},{"link":"#opendns","title":"OpenDNS","level":2},{"link":"#voir_aussi","title":"Voir aussi","level":1}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level1"><a href="#session_et_internet">Session et internet</a>
<ul class="nav toc">
<li class="level2"><a href="#la_session_invite">La Session Invité</a></li>
<li class="level2"><a href="#ctparental">ctparental</a></li>
</ul>
</li>
<li class="level1"><a href="#session_seulement">Session seulement</a>
<ul class="nav toc">
<li class="level2"><a href="#timekpr">Timekpr</a></li>
<li class="level2"><a href="#configuration_manuelle">Configuration manuelle</a></li>
</ul>
</li>
<li class="level1"><a href="#internet_seulement">Internet seulement</a>
<ul class="nav toc">
<li class="level2"><a href="#solution_radicale">Solution radicale</a></li>
<li class="level2"><a href="#opendns_familyshield">OpenDNS FamilyShield</a></li>
<li class="level2"><a href="#procon_latte">Procon latte</a></li>
<li class="level2"><a href="#squidguard">Squidguard</a></li>
<li class="level2"><a href="#dansguardian">DansGuardian</a></li>
<li class="level2"><a href="#opendns">OpenDNS</a></li>
</ul>
</li>
<li class="level1"><a href="#voir_aussi">Voir aussi</a></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content"><div class="tags"><span>
	<a href="/education" class="wikilink1" title="education" rel="tag">éducation</a>,
	<a href="/securite" class="wikilink1" title="securite" rel="tag">sécurité</a>,
	<a href="/internet" class="wikilink1" title="internet" rel="tag">internet</a>,
	<a href="/tutoriel" class="wikilink1" title="tutoriel" rel="tag">tutoriel</a>,
	<a href="/controle_parental?do=showtag&amp;tag=contr%C3%B4le_parental" class="wikilink1" title="controle_parental" rel="tag">contrôle parental</a>
</span></div>
<hr />

<h1 class="sectionedit1 page-header" id="controle_parental">Contrôle parental</h1>
<div class="level1">

<p>
Cette page recense les solutions de contrôle parental sur Ubuntu.
</p>
<div class="noteimportant">Attention : si le besoin (mettre en place un contrôle parental) est simple, les méthodes proposées ici sont particulièrement techniques et s&#039;adressent à un public expert.
</div>
<p>
Le contrôle parental comporte au moins deux aspects :
</p>
<ol class=" fix-media-list-overlap">
<li class="level1"><div class="li"> accès aux sessions et temps d&#039;utilisation ;</div>
</li>
<li class="level1"><div class="li"> accès à l&#039;internet.</div>
</li>
</ol>

<p>
Les solutions évoquées ci-après peuvent concerner ces deux aspects ou seulement l&#039;un des deux. 
</p>

</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_mettre_en_place_un_controle_parental"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1632642233" /><input type="hidden" name="summary" value="[Contrôle parental] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="controle_parental" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="76-608" /><button type="submit" title="Contrôle parental" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit2 page-header" id="session_et_internet">Session et internet</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_mettre_en_place_un_controle_parental"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1632642233" /><input type="hidden" name="summary" value="[Session et internet] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="session_et_internet" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="609-639" /><button type="submit" title="Session et internet" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit3" id="la_session_invite">La Session Invité</h3>
<div class="level3">

<p>
La session invité a des droits limité mais permet de passer au dessus de contrôles parentaux appliqués sur votre navigateur comme par exemple ProCon Latte qui sera étudié ci-dessous.
En effet à chaque redémarrage du système la session invité efface tout ce qui a pu être installé lors de la session précédente, y compris les contrôles parentaux pourtant paramétrés avec votre compte administrateur.
</p>

<p>
Pour désactiver la session Invité, reportez-vous à la <a href="/lightdm#supprimer_la_session_invite" class="wikilink1" title="lightdm">section dédiée</a> sur la page lightdm.
</p>

</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_mettre_en_place_un_controle_parental"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1632642233" /><input type="hidden" name="summary" value="[La Session Invité] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="la_session_invite" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="640-1224" /><button type="submit" title="La Session Invité" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit4" id="ctparental">ctparental</h3>
<div class="level3">

<p>
CTparental est un Contrôle parental permettant à des utilisateurs ayant juste assimilé les bases des lignes de commandes  .
</p>

<p>
Basé sur dnsmasq ,  <a href="http://e2guardian.org/cms/" class="urlextern" title="http://e2guardian.org/cms/" rel="nofollow">e2guardian</a> , privoxy , iptables-persistent et la <a href="http://dsi.ut-capitole.fr/blacklists/" class="urlextern" title="http://dsi.ut-capitole.fr/blacklists/" rel="nofollow">blackliste de l’université de Toulouse</a>.
</p>

<p>
Bien sûr il faut créer des comptes sans droit d&#039;administration pour vos enfants.
</p>

<p>
Si vos enfants ont passé les 10 ans il est conseillé de mettre un mot de passe bios et de désactiver le boot sur support <abbr title="Universal Serial Bus">USB</abbr> ou CDROM et un mot de passe sur grub aussi.
</p>

<p>
Mais ne comptez pas les arrêter au-delà de 16 ans, ils sauront comment passer outre tout ça, bien que ça les ennuiera un petit moment donc autant les faire réfléchir un peu.
</p>

<p>
Dans tous les cas ce n&#039;est qu&#039;une sécurité pour éviter qu&#039;ils ne grandissent trop vite, mais elle ne remplace pas l’accompagnement des parents, le petit coup d’œil de temps en temps et le dialogue.
</p>

</div>

<h4 id="installation">Installation</h4>
<div class="level4">

<p>
Il est maintenant disponible sous forme de fichier deb.
</p>

<p>
il faut <strong>installer</strong> avec  <a href="/gdebi" class="wikilink1" title="gdebi">gdebi</a> en ligne de commande !!.
</p>

<p>
<a href="https://gitlab.com/marsat/CTparental/uploads/6fe05d78f6daab865f6cece30b060091/ctparental_ubuntu18.04_lighttpd_4.45.09-1.0_all.deb" class="urlextern" title="https://gitlab.com/marsat/CTparental/uploads/6fe05d78f6daab865f6cece30b060091/ctparental_ubuntu18.04_lighttpd_4.45.09-1.0_all.deb" rel="nofollow">v-4.45.09-1.0 pour ubuntu 18.04</a>
</p>

<p>
<a href="https://gitlab.com/marsat/CTparental/uploads/cb727f1ee73a728668b0b5b0530166d2/ctparental_ubuntu20.04_lighttpd_4.45.09-1.0_all.deb" class="urlextern" title="https://gitlab.com/marsat/CTparental/uploads/cb727f1ee73a728668b0b5b0530166d2/ctparental_ubuntu20.04_lighttpd_4.45.09-1.0_all.deb" rel="nofollow">v-4.45.09-1.0 pour ubuntu 20.04</a>
</p>

<p>
les identifiants et mots de passe seront définis pendant cette procédure sauf pour l’installe par <a href="/gnome-software" class="wikilink1" title="gnome-software">GNOME Logiciels</a>   ceux ci sont réciproquement <strong>admin</strong> et <strong>admin</strong>.
</p>
<div class="noteimportant">Si vous n&#039;entrez pas un mot de passe respectant ces critères du premier coup, l&#039;interface plantera et le formulaire sera inactif.
<p>
6 a 20 caractères au total,1 Majuscule,1 minuscule,1 nombre et 1 caractère spécial parmi les suivants. &amp;éè~#{}()ç_@à?.;:/!,$&lt;&gt;=£%
</p>

</div><div class="noteclassic">Par la suite on pourra les redéfinir en lançant la commande<strong> sudo CTparental -uhtml</strong> dans un terminal. On pourra aussi activer le mot de passe grub2 pour les menus sensibles avec la commande <strong> sudo CTparental -grubPon</strong>

</div><div class="noteimportant">Il faut désinstaller les versions précédentes avant installation de nouvelle versions ,
<p>
pour ubuntu 16.04 et 14.04:
</p>
<pre class="code">sudo apt-get autoremove --purge ctparental clamav-*  privoxy lighttpd dnsmasq dansguardian
sudo rm -rf /etc/CTparental
sudo rm -rf /etc/lighttpd/
sudo rm -rf /etc/nginx/</pre>

<p>
pour ubuntu 17.04 et plus:
</p>
<pre class="code">sudo apt-get autoremove --purge ctparental clamav-*  privoxy lighttp* ngin* dnsmasq e2guardian
sudo rm -rf /etc/CTparental
sudo rm -rf /etc/lighttpd/
sudo rm -rf /etc/nginx/</pre>



</div><div class="noteimportant">penser a activer la nouvelle catégorie suivante cryptojacking,
Le cryptojacking est défini comme l&#039;utilisation secrète de votre périphérique informatique pour extraire la crypto-monnaie.

</div><div class="noteimportant">Pour UBUNTU 16.04 : Dans le cas ou lighttpd n&#039;arrive pas à démarrer en fin d&#039;installation et où la commande <pre class="code"> journalctl -xe</pre>

<p>
renvoie:
</p>
<pre class="code">&quot;symbol lookup error: /usr/sbin/lighttpd: undefined symbol: FAMNoExists&quot;</pre>

<p>
 Installer alors gamin:
</p>
<pre class="code">sudo apt-get install gamin</pre>



</div>
</div>

<h5 id="utilisation">Utilisation</h5>
<div class="level5">

<p>
Il possède  une <a href="https://gitlab.com/marsat/CTparental/wikis/Interface-WEB." class="urlextern" title="https://gitlab.com/marsat/CTparental/wikis/Interface-WEB." rel="nofollow">interface web</a> accessible via l&#039;adresse suivante <a href="https://admin.ct.local/" class="urlextern" title="https://admin.ct.local/" rel="nofollow">https://admin.ct.local/</a> pour les versions a partir de 4.20.26 et <a href="http://127.0.0.1/CTadmin/" class="urlextern" title="http://127.0.0.1/CTadmin/" rel="nofollow">http://127.0.0.1/CTadmin/</a> pour les anciennes versions , qui facilite son paramétrage.
</p>

<p>
Une liste complémentaire à la blackliste de Toulouse se nommant ctparental est à ajouter dans les catégories, pour limiter encore un peu plus les publicités et la pornographie.
à ajouter aux catégories adult,agressif,<a href="https://cryptoactuel.com/" class="urlextern" title="https://cryptoactuel.com/" rel="nofollow">bitcoin</a>,dangerous_material,dating,ddos,drogue,gambling,hacking,malware,marketingware,mixed_adult,phishing,publicite,redirector,sect,strict_redirector et strong_redirector pour être efficace.
</p>

<p>
Principales fonctions :
</p>
<ol class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Filtrage par Blackliste ou par Whiteliste .</div>
</li>
<li class="level1"><div class="li"> Filtre par Catégories.</div>
</li>
<li class="level1"><div class="li"> Filtre personnalisé de sites.</div>
</li>
<li class="level1"><div class="li"> Filtre Personnalisé de sites à laisser accessibles même s&#039;ils sont présents dans une des catégories que l&#039;on veut bloquer. </div>
</li>
<li class="level1"><div class="li"> Réglages des heures de connexions autorisées par utilisateur.</div>
</li>
<li class="level1"><div class="li"> Réglage du temps max de navigation des utilisateurs.</div>
</li>
<li class="level1"><div class="li"> Nombres de minutes de connexions max par jours autorisées.</div>
</li>
<li class="level1"><div class="li"> Groupe de personnes privilégiées ne subissant pas de filtrage web.</div>
</li>
<li class="level1"><div class="li"> Notifications des Utilisateurs toutes les minutes durant les 5 dernières minutes avant déconnexion.</div>
</li>
<li class="level1"><div class="li"> Dansguardian (extentions + type mime paramétrable via l&#039;interface.)</div>
</li>
<li class="level1"><div class="li"> Privoxy (paramètre non disponible via l&#039;interface.)</div>
</li>
<li class="level1"><div class="li"> Force SafeSearch google</div>
</li>
<li class="level1"><div class="li"> Force safesearch youtube.com ( très restrictifs conviens au jeune enfants , pas a des adolescents.)</div>
</li>
<li class="level1"><div class="li"> Force SafeSearch duckduckgo</div>
</li>
<li class="level1"><div class="li"> Force SafeSearch bing (en http seulement) https supporter depuis la version 4.20.27</div>
</li>
<li class="level1"><div class="li"> Force SafeSearch Qwant  supporter depuis la version 4.20.27</div>
</li>
<li class="level1"><div class="li"> Blocage de moteurs de recherches jugés non sûr comme search.yahoo.com.</div>
</li>
<li class="level1"><div class="li"> Ajout du mot de passe grub2, le mot de passe est persistants, après un update-grub ou une mise à jour grub2. Le clavier bascule en qwerty pour le paramétrage du login mots de passe grub2 cela évite les problèmes de caractère impossible a faire avec le clavier qwerty du menu grub2.</div>
</li>
<li class="level1"><div class="li"> Fonctionne avec firefox, midori, chromium … </div>
</li>
<li class="level1"><div class="li"> Gestion de règles personnalisées pour iptables. Activé avec CTparental  -ipton</div>
</li>
<li class="level1"><div class="li"> export de configuration à partir de la version 4.20.13<pre class="code">CTparental -exp /rep/export</pre>
</div>
</li>
<li class="level1"><div class="li"> import de configuration à partir de la version 4.20.13<pre class="code">CTparental -imp /chemin/absolut/CTparental.conf.xx.xx.xx.tar.gz</pre>
</div>
</li>
<li class="level1"><div class="li"> Multi-langues, actuellement supporte en_US , fr_FR , es_ES , par défaut prend les paramètre systèmes ou en_US si le système est dans une langue non supportée, mais la langue peut être forcée, en ajoutant ou modifiant le paramètre LANG=fr_FR.UTF-8  dans /etc/CTparental/CTparental.conf. a condition d&#039;avoir installer les locales voulus sur le système <pre class="code">sudo dpkg-reconfigure locales</pre>

<p>
.
</p>
</div>
</li>
<li class="level1"><div class="li"> à partir de la version 4.22.05 une synchronisation et possible entre des postes dit clients et un poste dit serveur. voir <a href="https://gitlab.com/marsat/CTparental/issues/55" class="urlextern" title="https://gitlab.com/marsat/CTparental/issues/55" rel="nofollow">ici</a> .</div>
</li>
<li class="level1"><div class="li"> à partir le la version 4.20.23 la session invité est aussi filtré.</div>
</li>
</ol>
<div class="noteclassic">les services suivants sont automatiquement acceptés pour avoir une navigation correcte sur internet : http,https,dns,ntp,dhcp,
ping (sortant uniquement),ftp (client ftp seulement pas serveur).
Pour le reste on peut ajouter ses propres règles dans le fichier /etc/CTparental/iptables qui en possède certaines mais qui sont commentées et relancer la commande CTparental  -ipton pour les activer.
La version 4.40.00 ajoute la gestion du filtrage par <a href="https://en.wikipedia.org/wiki/IP_address" class="urlextern" title="https://en.wikipedia.org/wiki/IP_address" rel="nofollow">ip</a> ou réseaux, directement dans l’interface web pour les utilisateurs filtrée, l&#039;ajout de règles plus complexes ce faisant toujours par l&#039;édition du fichier /etc/CTparental/iptables.
</div><div class="noteclassic"> <a href="http://e2guardian.org/cms/" class="urlextern" title="http://e2guardian.org/cms/" rel="nofollow">e2guardian</a> sera utilisé dans un futur proche car dansguardian est au poins mort plus depuis 2012, solution par défaut sous debian 9 et supérieure et a partir d&#039;Ubuntu 17.04  
</div><div class="noteclassic"> <a href="https://wiki.nftables.org/wiki-nftables/index.php/Main_Page" class="urlextern" title="https://wiki.nftables.org/wiki-nftables/index.php/Main_Page" rel="nofollow">nftables</a> le remplacent d&#039;iptables est utilisé a partir de ubuntu18.10
</div>
<p>
Pour l&#039;installer manuellement et les dernières infos c&#039;est par <a href="https://gitlab.com/marsat/CTparental/wikis/installation-fr" class="urlextern" title="https://gitlab.com/marsat/CTparental/wikis/installation-fr" rel="nofollow">ici</a>
</p>

<p>
Dépôt GIT : <a href="https://gitlab.com/marsat/CTparental" class="urlextern" title="https://gitlab.com/marsat/CTparental" rel="nofollow">https://gitlab.com/marsat/CTparental</a>
</p>

<p>
<strong>Explication des différents paramètres pour une utilisation en ligne de commandes. </strong>
une fois installé, lancer cette commande :
</p>
<pre class="code"> sudo CTparental</pre>

<p>
Exemple d’intersection Dansguardian / Dnsmasq pour les version v-4-xx et supérieur : <a href="/_detail/tutoriel/ctparental_e2guardian_dansguardian.png?id=tutoriel%3Acomment_mettre_en_place_un_controle_parental" class="media" title="tutoriel:ctparental_e2guardian_dansguardian.png"><img src="/_media/tutoriel/ctparental_e2guardian_dansguardian.png?w=100&amp;tok=89d2ca" class="media img-responsive" alt="" width="100" /></a>   <a href="/_detail/tutoriel/ctparental_dnsmasq.png?id=tutoriel%3Acomment_mettre_en_place_un_controle_parental" class="media" title="tutoriel:ctparental_dnsmasq.png"><img src="/_media/tutoriel/ctparental_dnsmasq.png?w=100&amp;tok=6245d5" class="media img-responsive" alt="" width="100" /></a>
</p>

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_mettre_en_place_un_controle_parental"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1632642233" /><input type="hidden" name="summary" value="[ctparental] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="ctparental" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="1225-9321" /><button type="submit" title="ctparental" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit5 page-header" id="session_seulement">Session seulement</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_mettre_en_place_un_controle_parental"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1632642233" /><input type="hidden" name="summary" value="[Session seulement] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="session_seulement" /><input type="hidden" name="codeblockOffset" value="3" /><input type="hidden" name="range" value="9322-9351" /><button type="submit" title="Session seulement" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit6" id="timekpr">Timekpr</h3>
<div class="level3">

<p>
<a href="/timekpr" class="wikilink1" title="timekpr">Timekpr</a> (une contraction de « time keeper » en anglais) est un logiciel pour contrôler l&#039;usage de l&#039;ordinateur par les différents comptes d&#039;utilisateurs d&#039;un ordinateur. Vous pouvez limiter l&#039;usage quotidien à partir de la durée d&#039;usage et les périodes de la journée où ils peuvent ou non se connecter.
</p>

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_mettre_en_place_un_controle_parental"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1632642233" /><input type="hidden" name="summary" value="[Timekpr] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="timekpr" /><input type="hidden" name="codeblockOffset" value="3" /><input type="hidden" name="range" value="9352-9686" /><button type="submit" title="Timekpr" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit7" id="configuration_manuelle">Configuration manuelle</h3>
<div class="level3">

<p>
Des <a href="/tutoriel/restrictions_horaires" class="wikilink1" title="tutoriel:restrictions_horaires">restrictions horaires</a> peuvent être mises en place par configuration manuelle.
</p>

</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_mettre_en_place_un_controle_parental"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1632642233" /><input type="hidden" name="summary" value="[Configuration manuelle] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration_manuelle" /><input type="hidden" name="codeblockOffset" value="3" /><input type="hidden" name="range" value="9687-9838" /><button type="submit" title="Configuration manuelle" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit8 page-header" id="internet_seulement">Internet seulement</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_mettre_en_place_un_controle_parental"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1632642233" /><input type="hidden" name="summary" value="[Internet seulement] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="internet_seulement" /><input type="hidden" name="codeblockOffset" value="3" /><input type="hidden" name="range" value="9839-9870" /><button type="submit" title="Internet seulement" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit9" id="solution_radicale">Solution radicale</h3>
<div class="level3">

<p>
Soit une machine sur laquelle sont existants un compte disposant des droits d&#039;administration, d&#039;autres comptes sans droits d&#039;administration et parmi ceux-ci au moins un pour lequel l&#039;accès à internet n&#039;a pas lieu d&#039;être contrôlé. Pour fixer les idées, mettons Adulte00, Adulte01, Progeniture00 et Progeniture01. Mettons que Adulte00 et 01 décident d&#039;un commun accord que le contrôle le plus simple et le plus efficace tout en étant le moins demandeur en ressource humaine consiste en la solution radicale d&#039;absence d&#039;accès au net tout court pour Progéniture00 et 01. Dans ce cas, l&#039;administrateur peut aller dans les propriétés de la connexion, qu&#039;elle soit filaire ou wifi, et décocher la case en bas à gauche &quot;Disponible pour tous les utilisateurs&quot;. Problème : le compte non-admin pour lequel l&#039;accès à internet n&#039;a pas lieu d&#039;être contrôlé (<em>i.e.</em> Adulte00 ou (<em>i.e.</em> xor) 01) se retrouve lui aussi sans connexion. Il faut alors se connecter avec ce compte et activer la connexion, ce qui devrait demander le mot de passe admin. A partir de ce moment, ce compte devrait avoir accès au réseau à chaque login. Mais là encore, tous les autres comptes auront accès à la connexion … Comme précédemment, il suffit de modifier les propriétés de la connexion en décochant la case en bas à gauche &quot;Disponible pour tous les utilisateurs&quot;. 
</p>

<p>
<strong>En résumé</strong> : activation de la connexion pour chacun des adultes et modification en décochant la case &quot;Disponible pour tous les utilisateurs&quot;. Rien du tout pour la progéniture.
</p>

</div>
<div class='secedit editbutton_section editbutton_9'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_mettre_en_place_un_controle_parental"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1632642233" /><input type="hidden" name="summary" value="[Solution radicale] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="solution_radicale" /><input type="hidden" name="codeblockOffset" value="3" /><input type="hidden" name="range" value="9871-11454" /><button type="submit" title="Solution radicale" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit10" id="opendns_familyshield">OpenDNS FamilyShield</h3>
<div class="level3">

<p>
Cette méthode est la plus simple de toutes ! 
</p>

<p>
Avec OpenDNS FamilyShield, les filtres appliqués sont les mêmes pour tous (pas de paramétrage possible). Il suffit d&#039;utiliser comme serveurs <abbr title="Domain Name System">DNS</abbr> 208.67.222.123 et 208.67.220.123 et le tour est joué. Ces <abbr title="Domain Name System">DNS</abbr> filtrent automatiquement les sites adultes. Il suffit donc de mettre cette connexion par défaut pour tout le monde, et rajouter éventuellement des connexions avec d&#039;autres serveurs <abbr title="Domain Name System">DNS</abbr> pour chacun des utilisateurs qui n&#039;ont pas besoin de filtrage;
</p>

<p>
Une petite note rapide pour dire que cette solution est pour le moins ambiguë, elle filtre effectivement les sites pour adultes, mais en renvoyant à une page appartenant à Opendns, qui fait de la pub… pour d&#039;autres sites pour adultes - sites de rencontre en l&#039;occurrence - comme edarling… Donc à éviter pour les enfants.
</p>

<p>
Pour plus de détails :
</p>

<p>
<a href="http://www.opendns.com/home-solutions/parental-controls" class="urlextern" title="http://www.opendns.com/home-solutions/parental-controls" rel="nofollow">Site officiel de OpenDNS</a> - (en français)
</p>

<p>
<a href="http://store.opendns.com/familyshield/setup/operatingsystem/ubuntu" class="urlextern" title="http://store.opendns.com/familyshield/setup/operatingsystem/ubuntu" rel="nofollow">Installation pour Ubuntu</a> - (en anglais)
</p>

</div>
<div class='secedit editbutton_section editbutton_10'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_mettre_en_place_un_controle_parental"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1632642233" /><input type="hidden" name="summary" value="[OpenDNS FamilyShield] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="opendns_familyshield" /><input type="hidden" name="codeblockOffset" value="3" /><input type="hidden" name="range" value="11455-12569" /><button type="submit" title="OpenDNS FamilyShield" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit11" id="procon_latte">Procon latte</h3>
<div class="level3">

<p>
Cette extension du navigateur Firefox est plutôt efficace et surtout très simple d&#039;installation. Bien sûr, elle ne convient qu&#039;aux utilisateurs de Firefox !
</p>
<div class="noteclassic"><strong>Inconvénients :</strong><ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Simple à contourner.</div>
</li>
<li class="level1"><div class="li"> Ne protège que Firefox.</div>
</li>
<li class="level1"><div class="li"> N&#039;est plus compatible avec les versions récentes (&quot;Quantum&quot;) de Firefox.</div>
</li>
</ul>

</div>
</div>

<h4 id="installation1">Installation</h4>
<div class="level4">

<p>
Rien de plus simple, il suffit de se rendre à <a href="https://addons.mozilla.org/fr/firefox/addon/1803" class="urlextern" title="https://addons.mozilla.org/fr/firefox/addon/1803" rel="nofollow">cette adresse avec Firefox</a> et de cliquer sur <em>Installer</em>.
</p>

<p>
Afin d&#039;empêcher la désactivation facile de Procon latte via le menu des modules complémentaires :
</p>
<ol class=" fix-media-list-overlap">
<li class="level1"><div class="li"> cliquer sur le bouton &quot;Choisir un mot de passe&quot; pour protéger l&#039;accès à la modification des Préférences</div>
</li>
<li class="level1"><div class="li"> cocher toutes les options des paramètres principaux, et notamment l&#039;option &quot;empêcher la désactivation ou la désinstallation&quot;</div>
</li>
</ol>

<p>
<em class="u">Deux remarques :</em>
</p>

<p>
Le blocage d&#039;accès via la liste blanche ne marche pas pour certains sites, par ex. fr.youtube.com. Dans ce cas, ajouter le nom du site (youtube) à la liste des données explicites du Filtre principal dans la colonne &quot;sites bloqués&quot;.
</p>

<p>
L&#039;extension Public Fox  disponible <a href="https://addons.mozilla.org/fr/firefox/addon/3911" class="urlextern" title="https://addons.mozilla.org/fr/firefox/addon/3911" rel="nofollow">cette adresse</a> permet d&#039;aller plus loin en bloquant l&#039;accès aux modules complémentaires, mais elle ne fonctionne pas avec l&#039;occurrence &quot;Modules complémentaires&quot; du menu Options de Firefox 3.0, ce qui oblige à installer un autre module de paramétrage du menu Options, comme par ex. Tools Menu Organiser disponible à <a href="https://addons.mozilla.org/fr/firefox/addon/1911" class="urlextern" title="https://addons.mozilla.org/fr/firefox/addon/1911" rel="nofollow">cette adresse</a>.
</p>

</div>
<div class='secedit editbutton_section editbutton_11'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_mettre_en_place_un_controle_parental"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1632642233" /><input type="hidden" name="summary" value="[Procon latte] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="procon_latte" /><input type="hidden" name="codeblockOffset" value="3" /><input type="hidden" name="range" value="12570-14190" /><button type="submit" title="Procon latte" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit12" id="squidguard">Squidguard</h3>
<div class="level3">

</div>

<h4 id="pre-requis">Pré-requis</h4>
<div class="level4">

<p>
Les logiciels utilisés pour mettre en œuvre ce contrôle parental sont :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <a href="/squid" class="wikilink1" title="squid">squid</a> :  </div>
</li>
<li class="level1"><div class="li"> Squidguard (Il faut activer le dépôt universe) (Voir Squidguard  dans la page Squid)</div>
</li>
</ul>
<div class="noteimportant">Ceci explique la mise en place d&#039;un contrôle parental sur un PC Ubuntu directement raccordé sur le net sans réseau local.
</div><div class="noteimportant">Pour Ubuntu 14.10 et 15.10, les packages de squid et squidguard ne sont pas compatibles entre eux.
<p>
En effet, squid 3.3.8 n&#039;est pas compatible avec squidguard 1.5-4  <a href="https://bugs.launchpad.net/ubuntu/+source/squidguard/+bug/1448149" class="urlextern" title="https://bugs.launchpad.net/ubuntu/+source/squidguard/+bug/1448149" rel="nofollow">https://bugs.launchpad.net/ubuntu/+source/squidguard/+bug/1448149</a>
</p>

</div>
</div>

<h4 id="configuration_de_squid">Configuration de Squid</h4>
<div class="level4">

<p>
Le fichier de configuration est : <strong>/etc/squid3/squid.conf</strong>
</p>

<p>
Tout d&#039;abord, il est recommandé de réaliser une sauvegarde de ce fichier avec la commande :
</p>
<pre class="code">sudo cp /etc/squid3/squid.conf /etc/squid3/squid.conf.back</pre>

<p>
Maintenant, <a href="/tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">éditez ce fichier</a> avec l&#039;éditeur de votre choix en ayant les droits administrateur. Remplacez-en le contenu par les lignes suivantes :
</p>
<dl class="file">
<dt><a href="/_export/code/tutoriel/comment_mettre_en_place_un_controle_parental?codeblock=3" title="Télécharger cet extrait" class="mediafile mf_conf">squid.conf</a></dt>
<dd><pre class="file"># -----------------------------------------------------------
cache_effective_user proxy
cache_effective_group proxy
# -----------------------------------------------------------
visible_hostname none
# -----------------------------------------------------------

# -----------------------------------------------------------
acl all src 0.0.0.0/0.0.0.0
acl localhost src 127.0.0.1/255.255.255.255
acl manager proto cache_object
acl serveur src 192.168.0.1
acl poste src 192.168.0.50
acl multipostes src 192.168.0.100-192.168.0.125
acl SSL_ports port 443 563
acl Safe_ports port 80 # http
acl Safe_ports port 20 # ftp-data
acl Safe_ports port 21 # ftp
acl Safe_ports port 443 563 # ssl
acl Safe_ports port 70 # gopher
acl Safe_ports port 210 # wais
acl Safe_ports port 1025-65535 # unregistered ports
acl Safe_ports port 280 # http-mgmt
acl Safe_ports port 488 # gss-http
acl Safe_ports port 591 # filemaker
acl Safe_ports port 777 # multiling http
acl Safe_ports port 631 # cups
acl Safe_ports port 873 # rsync
acl Safe_ports port 901 # SWAT
acl purge method PURGE
acl CONNECT method CONNECT

http_access allow all

url_rewrite_program /usr/bin/squidGuard -c /etc/squidguard/squidGuard.conf
url_rewrite_children 10

http_port 3128 transparent</pre>
</dd></dl>
<div class="noteimportant">Avant la version squid 2.6, la directive url_rewrite_program était remplacée par redirect_program et url_rewrite_children  était de même remplacée par redirect_children
</div>
</div>

<h4 id="configuration_d_un_filtre_uniquement_par_squid">Configuration d&#039;un filtre uniquement par Squid</h4>
<div class="level4">

<p>
Squid permet, à lui seul, de mettre en place toute une série de filtres.
</p>

<p>
Dans le cas qui nous intéresse, le contrôle parental, on peut utiliser les filtres suivants :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Autoriser l&#039;accès uniquement à une liste de sites (liste blanche).  </div>
</li>
<li class="level1"><div class="li"> Bloquer l&#039;accès à une série de domaines (liste noire).</div>
</li>
<li class="level1"><div class="li"> Bloquer les pages dont l&#039;<abbr title="Uniform Resource Locator">URL</abbr> contient un mot interdit.</div>
</li>
</ul>

<p>
La configuration a lieu en deux temps. On crée d&#039;abord les <abbr title="Access Control List">ACL</abbr> correspondants : 
</p>
<pre class="code">acl whitelist dstdomain &quot;/etc/squid3/whitelist&quot;
acl blacklist dstdomain &quot;/etc/squid3/blacklist&quot;
acl filtre_reg url_regex -i ^.*sex.*$ ^.*porn.*$ ^.*hack.*$ ^.*crack.*$ ^.*drug.*$ ^.*felation.*$</pre>

<p>
Puis on lui applique les filtres :
</p>
<pre class="code">http_access allow whitelist
http_access deny blacklist
http_access deny filtre_reg</pre>

<p>
Squid applique les filtres dans l&#039;ordre. Le premier filtre vérifié s&#039;applique et pas les suivants. 
Il faut donc prendre garde à l&#039;ordre dans lequel on les écrit.
</p>

<p>
Ici, le filtrage pour la whitelist est placé avant celui de la blacklist.
Ainsi, si un domaine se trouve dans les deux listes, le site ne sera pas bloqué 
car Squid appliquera le premier filtre.
</p>

<p>
Pour finir, si aucune des règles n&#039;est vérifiée on autorise l&#039;accès : 
</p>
<pre class="code">http_access allow localhost</pre>

<p>
(avec localhost un <abbr title="Access Control List">ACL</abbr> du type acl localhost src 127.0.0.1/32)
</p>

<p>
Pour une référence plus complète des règles que l&#039;on peut mettre en place dans Squid,
on peut se référer au document :
[www.visolve.com/uploads/resources/squid30.pdf]
</p>

</div>

<h4 id="configuration_de_squidguard">Configuration de SquidGuard</h4>
<div class="level4">

<p>
SquidGuard est une sorte de greffon à Squid qui joue le rôle de redirecteur. En fait si une requête du navigateur n&#039;est pas conforme à ce qui a été défini dans sa configuration il affiche une autre page web que celle demandée.
</p>

</div>

<h5 id="les_listes_noires">Les listes noires</h5>
<div class="level5">

<p>
Pour ce qui est du filtrage des sites, on ne va bien sûr pas entrer les adresses à la main, des listes noires existent sur le net. Voici une adresse de blacklist : <a href="ftp://ftp.univ-tlse1.fr/pub/reseau/cache/squidguard_contrib/blacklists.tar.gz" class="urlextern" title="ftp://ftp.univ-tlse1.fr/pub/reseau/cache/squidguard_contrib/blacklists.tar.gz" rel="nofollow">ftp://ftp.univ-tlse1.fr/pub/reseau/cache/squidguard_contrib/blacklists.tar.gz</a>
</p>

<p>
Voici les commandes à faire pour les installer :
</p>
<pre class="code">wget ftp://ftp.univ-tlse1.fr/pub/reseau/cache/squidguard_contrib/blacklists.tar.gz
sudo tar zxvf blacklists.tar.gz -C /var/lib/squidguard/db/
sudo su
cd /var/lib/squidguard/db
mv blacklists/* .
rm -rf blacklists</pre>

<p>
C&#039;est à partir de cette liste noire que la base de données va être créée pour SquidGuard. Si vous regardez le répertoire /var/lib/squidguard/db, vous verrez pleins de sous-répertoires de thèmes pour les listes noires (gambling, radio, webmail, porn, adult, etc.). Ce sont ces thèmes qu&#039;il faudra définir dans le fichier de configuration de Squidguard.
</p>

</div>

<h4 id="mise_a_jour_hebdomadaire_automatique_des_listes_noires">Mise à jour hebdomadaire automatique des listes noires</h4>
<div class="level4">

<p>
Pour mettre automatiquement à jour, chaque semaine, les listes noires de SquidGuard, il suffit de créer une tâche cron. Créez le fichier /etc/cron.weekly/squidguard_blacklists :
</p>
<pre class="code">sudo gedit /etc/cron.weekly/squidguard_blacklists</pre>

<p>
et inscrivez-y les lignes suivantes :
</p>
<pre class="code">#!/bin/sh
#
# Fichier /etc/cron.weekly/squidguard_blacklists
#
# Télécharge chaque semaine les listes noires pour SquidGuard
# et met à jour les bases de ce dernier.

if [ -d /var/lib/squidguard ]; then
	wget ftp://ftp.univ-tlse1.fr/pub/reseau/cache/squidguard_contrib/blacklists.tar.gz -O /var/lib/squidguard/blacklists.tar.gz
	tar zxvf /var/lib/squidguard/blacklists.tar.gz -C /var/lib/squidguard/
	rm -rf /var/lib/squidguard/db
	mkdir /var/lib/squidguard/db || true
	mv -f /var/lib/squidguard/blacklists/* /var/lib/squidguard/db/
	chmod 2770 /var/lib/squidguard/db
	rm -rf /var/lib/squidguard/blacklists /var/lib/squidguard/blacklists.tar.gz
	/usr/bin/squidGuard -C all
	chown -R proxy:proxy /etc/squid3 /var/log/squid3 /var/spool/squid3 /usr/lib/squid3 /usr/sbin/squid3 /var/lib/squidguard
	service squid3 restart
fi</pre>

<p>
Rendez ce fichier exécutable :
</p>
<pre class="code">sudo chmod +x /etc/cron.weekly/squidguard_blacklists</pre>

<p>
Si vous le désirez, vous pouvez le tester (attention, il est long à rendre la main, à cause de la mise à jour des bases de SquidGuard) :
</p>
<pre class="code">sudo /etc/cron.weekly/squidguard_blacklists</pre>

</div>

<h5 id="le_fichier_de_configuration">Le fichier de configuration</h5>
<div class="level5">

<p>
Le fichier de configuration est : <strong>/etc/squidguard/squidGuard.conf</strong>
</p>

<p>
De même réalisez une sauvegarde de ce fichier avec la commande :
</p>
<pre class="code">sudo cp /etc/squidguard/squidGuard.conf /etc/squidguard/squidGuard.conf.back</pre>

<p>
Maintenant, <a href="/tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">éditez ce fichier</a> avec l&#039;éditeur de votre choix en ayant les droits administrateur.
</p>

<p>
remplacer le ficher avec les lignes suivantes :
</p>
<dl class="file">
<dt><a href="/_export/code/tutoriel/comment_mettre_en_place_un_controle_parental?codeblock=9" title="Télécharger cet extrait" class="mediafile mf_conf">squidGuard.conf</a></dt>
<dd><pre class="file">#
# CONFIG FILE FOR SQUIDGUARD
#

dbhome /var/lib/squidguard/db
logdir /var/log/squid3

# ------------------------------------------------------------
# Définition de la base de données de filtrage utilisée
# ------------------------------------------------------------
dest adult {
        domainlist adult/domains
        urllist adult/urls
}

dest publicite {
        domainlist publicite/domains
        urllist publicite/urls
}

dest warez {
        domainlist warez/domains
        urllist warez/urls
}

dest porn {
        domainlist porn/domains
        urllist porn/urls
}

dest violence {
        domainlist violence/domains
        urllist violence/urls
}

# ajoutez ici les thèmes supplémentaires de votre choix présents dans la blacklist de la façon suivante :
# dest &lt;nom du thème&gt; {
#        domainlist &lt;nom du thème&gt;/domains
#        urllist &lt;nom du thème&gt;/urls
# }

# ------------------------------------------------------------
# Définition des ACL
# ------------------------------------------------------------

acl {
  default {
# les thèmes supplémentaires sont à ajouter avant le mot-clé all par !&lt;nom du thème&gt;
        pass !porn !adult !publicite !warez !violence all
        redirect  http://www.ovh.com/fr/images/hosting/astuce_htaccess/interdit.jpg
  }
}
# ------------------------------------------------------------</pre>
</dd></dl>
<div class="noteimportant">Si Squid ne démarre pas, et que /var/log/squid3/cache.log signale le problème &quot;The url_rewriter helpers are crashing too rapidly&quot;, c&#039;est que SquidGuard ne répond pas assez vite. Ceci est probablement dû à un thème contenant des expressions régulières (par exemple la base redirectors). Dans ce cas, essayer de mettre moins de thèmes dans l&#039;<abbr title="Access Control List">ACL</abbr>
</div>
<p>
Maintenant il faut générer la base de données avec la commande suivante : 
</p>
<pre class="code">sudo squidGuard -C all</pre>

<p>
Patientez un peu car ça peut être long.
</p>

<p>
Vous aurez compris ici que SquidGuard va rediriger toutes les pages qui sont non conformes à la règle <strong>pass</strong> vers la page web :  <a href="http://www.ovh.com/fr/images/hosting/astuce_htaccess/interdit.jpg" class="urlextern" title="http://www.ovh.com/fr/images/hosting/astuce_htaccess/interdit.jpg" rel="nofollow">http://www.ovh.com/fr/images/hosting/astuce_htaccess/interdit.jpg</a> (la page <a href="http://roozeec.free.fr/interdiction.html" class="urlextern" title="http://roozeec.free.fr/interdiction.html" rel="nofollow">http://roozeec.free.fr/interdiction.html</a> n&#039;est plus accessible, toute autre page affichant un logo d&#039;interdiction peut aussi bien faire l&#039;affaire)
</p>

</div>

<h4 id="configuration_de_iptables">Configuration de IPTABLES</h4>
<div class="level4">

<p>
Maintenant que tout est fait pour ce qui est du proxy, il faut aussi que les requêtes du navigateur soit redirigées vers le proxy Squid que nous venons de configurer, qui utilise l&#039;identifiant de l&#039;utilisateur proxy (UID).
</p>

<p>
Nous allons créer la règle iptables suivante (proxy est ici le nom du compte utilisé par Squid) :
</p>
<pre class="code">sudo iptables -t nat -A OUTPUT -m owner ! --uid-owner proxy -p tcp -m tcp --dport 80 -j REDIRECT --to-ports 3128</pre>

<p>
De façon à lancer cette commande au démarrage du PC, il suffit de la mettre dans le fichier <strong>/etc/rc.local</strong>, juste avant la commande exit 0 (13 est ici la valeur donnée précédemment) :
</p>
<pre class="file">#!/bin/sh -e
#
# rc.local
#
# This script is executed at the end of each multiuser runlevel.
# Make sure that the script will &quot;exit 0&quot; on success or any other
# value on error.
#
# In order to enable or disable this script just change the execution
# bits.
#
# By default this script does nothing.

iptables -t nat -A OUTPUT -m owner ! --uid-owner proxy -p tcp -m tcp --dport 80 -j REDIRECT --to-ports 3128

exit 0</pre>

</div>

<h4 id="demarrage_de_squid">Démarrage de Squid</h4>
<div class="level4">

<p>
Maintenant que tout est prêt, il suffit de lancer Squid, mais avant tout il va falloir lancer quelques commandes pour bien définir les droits des fichiers : 
</p>
<pre class="code">sudo chown -R proxy:proxy /etc/squid /var/log/squid /var/spool/squid /usr/lib/squid /usr/sbin/squid /var/lib/squidguard</pre>

<p>
Lancer maintenant la commande :
</p>
<pre class="code">sudo squid -z</pre>

<p>
Maintenant le démarrage proprement dit :
</p>
<pre class="code">sudo /etc/init.d/squid start</pre>

<p>
Et la réponse doit être : <em>Starting Squid HTTP proxy squid [ok]</em>
</p>

</div>
<div class='secedit editbutton_section editbutton_12'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_mettre_en_place_un_controle_parental"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1632642233" /><input type="hidden" name="summary" value="[Squidguard] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="squidguard" /><input type="hidden" name="codeblockOffset" value="3" /><input type="hidden" name="range" value="14191-25291" /><button type="submit" title="Squidguard" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit13" id="dansguardian">DansGuardian</h3>
<div class="level3">

<p>
Deux autres solutions sont d&#039;utiliser <a href="/dansguardian" class="wikilink1" title="dansguardian">DansGuardian via une passerelle tel qu&#039;expliqué sur cette page</a> ou d&#039;utiliser <a href="/dansguardian_sans_serveur" class="wikilink1" title="dansguardian_sans_serveur">DansGuardian directement sur le pc naviguant sur le net</a> (solution plus simple à mettre en place).
</p>

</div>
<div class='secedit editbutton_section editbutton_13'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_mettre_en_place_un_controle_parental"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1632642233" /><input type="hidden" name="summary" value="[DansGuardian] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="dansguardian" /><input type="hidden" name="codeblockOffset" value="12" /><input type="hidden" name="range" value="25292-25580" /><button type="submit" title="DansGuardian" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit14" id="opendns">OpenDNS</h3>
<div class="level3">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <a href="http://www.opendns.com" class="urlextern" title="http://www.opendns.com" rel="nofollow">www.opendns.com</a> - (en anglais)</div>
</li>
</ul>

<p>
La technique est différente, il s&#039;agit ici d&#039;utiliser le service <abbr title="Domain Name System">DNS</abbr> qui transforme une adresse ( ex &quot;<a href="http://ubuntu-fr.org" class="urlextern" title="http://ubuntu-fr.org" rel="nofollow">http://ubuntu-fr.org</a>&quot; en adresse machine : &quot;80.125.12.55&quot; ).
Du coup PAS DE LOGICIEL à installer sur l&#039;ordi, aucune baisse de performances. La démarche est simplement de rajouter ce <abbr title="Domain Name System">DNS</abbr> à votre configuration réseau. Il faut bien sûr que le compte de l&#039;enfant ne lui permette pas d&#039;aller modifier ce réglage.
</p>

<p>
<a href="https://www.opendns.com/start?device=ubuntu" class="urlextern" title="https://www.opendns.com/start?device=ubuntu" rel="nofollow">Tutoriel en anglais</a>
</p>

<p>
Ci-dessous la traduction en français
</p>

<p>
Ubuntu
</p>
<ol class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Faites un clic-droit sur l&#039; &quot;icône réseau&quot;(situé en haut à droite, par défaut) et cliquez sur &quot;Modification des Connexions&quot; pour ouvrir le Gestionnaire des connexions réseau.</div>
</li>
<li class="level1"><div class="li"> Choisissez le type de connexion dont vous disposez. Pour cet exemple, nous allons utiliser &quot;Filaire&quot;.</div>
</li>
<li class="level1"><div class="li"> Sous &quot;Filaire&quot;, sélectionnez &quot;Auto Etho &#039;et cliquez sur &quot; Modifier &quot;.</div>
</li>
<li class="level1"><div class="li"> Dans la fenêtre &#039;Modification Auto Etho&#039;, cliquez sur l&#039;onglet «Paramètres IPv4&quot;.</div>
</li>
<li class="level1"><div class="li"> Sous &quot;Paramètres IPv4&quot;, changer la méthode &#039;Adresses automatiques uniquement (<abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>)&quot;.</div>
</li>
<li class="level1"><div class="li"> Mettez ces adresses comme Serveurs <abbr title="Domain Name System">DNS</abbr> : 208.67.222.222, 208.67.220.220</div>
</li>
<li class="level1"><div class="li"> Cliquez sur &quot;OK&quot; et redémarrez votre machine. Vous pouvez ensuite visiter <a href="http://welcome.opendns.com" class="urlextern" title="http://welcome.opendns.com" rel="nofollow">http://welcome.opendns.com</a> pour confirmer que vous utilisez OpenDNS. ( Il faut créer un compte gratuit et suivre les opérations de validation. Ensuite il faut se connecter à son compte et régler le niveau de protection souhaité qui est à &quot;none&quot; par défaut; sans quoi il n&#039; y aucun filtrage). </div>
</li>
</ol>

<p>
Pour éviter que vos réglages soient révoqués après redémarrage, ou après
des périodes d&#039;inactivité, il peut être nécessaire de faire les
modifications suivantes par l&#039;intermédiaire de la ligne de commande :
</p>
<pre class="code bash">$ <span class="kw2">sudo</span> <span class="kw2">cp</span> <span class="sy0">/</span>etc<span class="sy0">/</span>resolv.conf <span class="sy0">/</span>etc<span class="sy0">/</span>resolv.conf.auto
$ gksudo gedit <span class="sy0">/</span>etc<span class="sy0">/</span>dhcp3<span class="sy0">/</span>dhclient.conf
<span class="co0"># Ajoutez la ligne suivante au document</span>
prepend domain-name-servers 208.67.222.222,208.67.220.220;
<span class="co0"># enregistrez et quittez</span>
$ <span class="kw2">sudo</span> <span class="kw2">ifdown</span> eth0 <span class="sy0">&amp;&amp;</span> <span class="kw2">sudo</span> <span class="kw2">ifup</span> eth0</pre>

<p>
Il peut être nécessaire de changer eth0 pour votre propre interface
réseau si elle utilise un nom non-standard.
</p>

</div>

<h4 id="opendns_et_adresse_ip_dynamique">OpenDNS et adresse IP dynamique</h4>
<div class="level4">

<p>
Une fois que vous avez créé un compte sur OpenDNS, il faut associer à ce compte votre adresse IP. Si vous avez une adresse IP dynamique la mise à jour automatique de cette association peut se faire :
</p>

</div>

<h5 id="via_une_simple_requete_web_lancee_automatiquement_toutes_les_10_minutes">via une simple requête WEB lancée automatiquement toutes les 10 minutes</h5>
<div class="level5">
<pre class="code bash">$ <span class="kw2">sudo</span> crontab <span class="re5">-e</span>
<span class="co0"># Ajoutez la ligne suivante au document (voir doc vi ou nano)</span>
<span class="sy0">*/</span><span class="nu0">10</span> <span class="sy0">*</span> <span class="sy0">*</span> <span class="sy0">*</span> <span class="sy0">*</span> <span class="kw2">wget</span> <span class="re5">-O</span> - <span class="re5">-q</span> <span class="re5">--http-user</span>=opendnslogin <span class="re5">--http-passwd</span>=opendnspassword https:<span class="sy0">//</span>updates.opendns.com<span class="sy0">/</span>nic<span class="sy0">/</span>update
<span class="co0"># enregistrez et quittez (voir doc vi ou nano)</span></pre>

<p>
« opendnslogin » est à remplacer par le login de votre compte OpenDNS
</p>

<p>
« opendnspassword » est à remplacer par le mot de passe de votre compte OpenDNS 
</p>

</div>

<h5 id="avec_ddclient">avec ddclient</h5>
<div class="level5">

<p>
<a href="http://www.opendns.com/support/article/192" class="urlextern" title="http://www.opendns.com/support/article/192" rel="nofollow">doc sur opendns</a>
</p>

<p>
<a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">Installez les paquets</a> <strong><a href="apt://ddclient" class="urlextern" title="apt://ddclient" rel="nofollow">ddclient</a></strong>.
</p>

<p>
<a href="/tutoriel/comment_modifier_un_fichier" class="wikilink1" title="tutoriel:comment_modifier_un_fichier">éditez le fichier</a> <strong>/etc/ddclient.conf</strong>
</p>
<pre class="file"># /etc/ddclient.conf
ssl=yes # use ssl-support
use=web, web=whatismyip.org
protocol=dyndns2
server=updates.opendns.com
login=opendnslogin
password=&#039;opendnspassword&#039;
home</pre>

<p>
« opendnslogin » est à remplacer par le login de votre compte OpenDNS
« opendnspassword » est à remplacer par le mot de passe de votre compte OpenDNS 
</p>

<p>
<a href="/tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">éditez le fichier</a> <strong>/etc/default/ddclient</strong>
</p>
<pre class="file"># Configuration for ddclient scripts
# generated from debconf on mardi 22 décembre 2009, 18:06:36 (UTC+0100)
#
# /etc/default/ddclient

# Set to &quot;true&quot; if ddclient should be run every time a new ppp connection is
# established. This might be useful, if you are using dial-on-demand
run_ipup=&quot;true&quot;

# Set to &quot;true&quot; if ddclient should run in daemon mode
run_daemon=&quot;true&quot;

# Set the time interval between the updates of the dynamic DNS name in seconds.
# This option only takes effect if the ddclient runs in daemon mode.
daemon_interval=&quot;600&quot;</pre>

<p>
Vérifiez que run_daemon est bien sur true
</p>

<p>
vous pouvez tester le client avec 
</p>
<pre class="code bash"><span class="kw2">sudo</span> ddclient <span class="re5">-v</span></pre>

<p>
et relancer le daemon 
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="sy0">/</span>etc<span class="sy0">/</span>init.d<span class="sy0">/</span>ddclient restart</pre>

</div>

<h4 id="opendns_et_session_utilisateur">OpenDNS et session utilisateur</h4>
<div class="level4">

<p>
Il est possible de faire en sorte que le filtrage ne s&#039;applique que si la session d&#039;un utilisateur bien défini est ouverte. 
</p>

<p>
Pour cela il faut créer un script bash et deux fichiers <abbr title="Domain Name System">DNS</abbr> (resolv), un pour les utilisateurs non restreints et un pour l&#039;utilisateur à restreindre.
</p>

<p>
Dans l&#039;exemple ci-dessous le script s&#039;appelle « opendns », le fichier <abbr title="Domain Name System">DNS</abbr> non restreint « resolv.adult » et restreint « resolv.child »
</p>

<p>
Créer le fichier /etc/resolv.child :
</p>
<pre class="code bash"><span class="co4">$ </span><span class="kw2">sudo</span> gedit <span class="sy0">/</span>etc<span class="sy0">/</span>resolv.child</pre>

<p>
avec les lignes suivantes :
</p>
<pre class="file"># generated by opendns - resolv.child

# /usr/sbin/opendns
# /etc/resolv.child
# /etc/resolv.adult
# link /etc/NetworkManager/dispatcher.d/opendns
# line opendns in crontab as root (sudo crontab -e)
# line ALL ALL=NOPASSWD:/usr/sbin/opendns in /etc/sudoers (sudo visudo)

nameserver 208.67.222.222
nameserver 208.67.220.220
</pre>

<p>
Propriétaire : root via chown ; Permissions : 644 via chmod
</p>
<pre class="code bash">$ <span class="kw2">sudo</span> <span class="kw2">chown</span> root:root <span class="sy0">/</span>etc<span class="sy0">/</span>resolv.child
$ <span class="kw2">sudo</span> <span class="kw2">chmod</span> <span class="nu0">644</span> <span class="sy0">/</span>etc<span class="sy0">/</span>resolv.child</pre>

<p>
Créer le fichier /etc/resolv.adult :
</p>
<pre class="code bash"><span class="co4">$ </span><span class="kw2">sudo</span> gedit <span class="sy0">/</span>etc<span class="sy0">/</span>resolv.adult</pre>

<p>
Avec les lignes suivantes :
</p>
<pre class="file"># generated by opendns - resolv.adult

# /usr/sbin/opendns
# /etc/resolv.child
# /etc/resolv.adult
# link /etc/NetworkManager/dispatcher.d/opendns
# line opendns in crontab as root (sudo crontab -e)
# line ALL ALL=NOPASSWD:/usr/sbin/opendns in /etc/sudoers (sudo visudo)

nameserver x.x.x.x
nameserver y.y.y.y
</pre>

<p>
x.x.x.x et y.y.y.y sont à remplacer par les <abbr title="Domain Name System">DNS</abbr> de votre <abbr title="Fournisseur d&#039;Accès à Internet">FAI</abbr>
</p>

<p>
Propriétaire : root via chown ; Permissions : 644 via chmod
</p>
<pre class="code bash">$ <span class="kw2">sudo</span> <span class="kw2">chown</span> root:root <span class="sy0">/</span>etc<span class="sy0">/</span>resolv.adult
$ <span class="kw2">sudo</span> <span class="kw2">chmod</span> <span class="nu0">644</span> <span class="sy0">/</span>etc<span class="sy0">/</span>resolv.adult</pre>

<p>
Créer le fichier /usr/sbin/opendns : 
</p>
<pre class="code bash"><span class="co4">$ </span><span class="kw2">sudo</span> gedit <span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>opendns</pre>

<p>
avec les lignes suivantes :
</p>
<pre class="file">#!/bin/bash

# /usr/sbin/opendns
# /etc/resolv.child
# /etc/resolv.adult
# link /etc/NetworkManager/dispatcher.d/opendns
# line opendns in crontab as root (sudo crontab -e)
# line ALL ALL=NOPASSWD:/usr/sbin/opendns in /etc/sudoers (sudo visudo)

if users | grep -c &quot;child&quot; &gt; /dev/null ; then
wget -O - -q --http-user=opendnslogin --http-passwd=opendnspassword https://updates.opendns.com/nic/update
cp /etc/resolv.child /etc/resolv.conf
else
cp /etc/resolv.adult /etc/resolv.conf
fi</pre>

<p>
A la ligne 
</p>

<p>
if users | grep -c &quot;child&quot; &gt; /dev/null ; then
</p>

<p>
&quot;child&quot; est a remplacer par le nom de l&#039;utilisateur que vous souhaitez restreindre (garder les guillemets)
</p>

<p>
« opendnslogin » est à remplacer par le login de votre compte OpenDNS
</p>

<p>
« opendnspassword » est à remplacer par le mot de passe de votre compte OpenDNS
</p>

<p>
Ce script remplacera les <abbr title="Domain Name System">DNS</abbr> normaux par les <abbr title="Domain Name System">DNS</abbr> de OpenDNS si la session « child » est ouverte et mettra à jour votre adresse IP (dynamique) sur OpenDNS. Si la session « child » est inactive les <abbr title="Domain Name System">DNS</abbr> seront ceux de votre <abbr title="Fournisseur d&#039;Accès à Internet">FAI</abbr> et il n&#039;y aura pas de mise à jour de votre adresse IP sur OpenDNS.
</p>

<p>
Propriétaire : root via chown ; Permissions : 755 via chmod
</p>
<pre class="code bash">$ <span class="kw2">sudo</span> <span class="kw2">chown</span> root:root <span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>opendns
$ <span class="kw2">sudo</span> <span class="kw2">chmod</span> <span class="nu0">755</span> <span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>opendns</pre>

<p>
Il faut ensuite permettre aux utilisateurs de lancer le script en tant que root sans avoir à taper le mot de passe :
</p>
<pre class="code bash">$ <span class="kw2">sudo</span> visudo 
<span class="co0"># Ajoutez la ligne suivante au document (voir doc vi ou nano) :</span>
ALL <span class="re2">ALL</span>=NOPASSWD:<span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>opendns
<span class="co0"># enregistrez et quittez (voir doc vi ou nano)</span></pre>

<p>
Ajouter un lien dans /etc/NetworkManager/dispatcher.d/ pour que le script s&#039;exécute à chaque changement d&#039;état du réseau avec la commande :
</p>
<pre class="code bash"><span class="co4">$ </span><span class="kw2">sudo</span> <span class="kw2">ln</span> <span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>opendns <span class="sy0">/</span>etc<span class="sy0">/</span>NetworkManager<span class="sy0">/</span>dispatcher.d<span class="sy0">/</span>opendns</pre>

<p>
Ajouter la ligne dans le cron pour que le script s&#039;exécute toute les 10 minutes :
</p>
<pre class="code bash">$ <span class="kw2">sudo</span> crontab <span class="re5">-e</span>
<span class="co0"># Ajoutez la ligne suivante au document (voir doc vi ou nano)</span>
<span class="sy0">*/</span><span class="nu0">10</span> <span class="sy0">*</span> <span class="sy0">*</span> <span class="sy0">*</span> <span class="sy0">*</span> <span class="sy0">/</span>usr<span class="sy0">/</span>sbin<span class="sy0">/</span>opendns
<span class="co0"># enregistrez et quittez (voir doc vi ou nano)</span></pre>

<p>
Dans ce cas, le script opendns effectuant lui-même la mise à jour de l&#039;adresse IP sur OpenDNS,  il n&#039;est plus nécessaire de mettre la ligne d&#039;update automatique dans le crontab décrite plus haut (OpenDNS et adresse IP dynamique).
</p>

<p>
Vous pouvez aussi mettre &quot;sudo opendns&quot; dans les programmes de démarrage de la session « child » (que « child » pourrait quand même désactiver, c&#039;est pour cela que l&#039;on utilise aussi le crontab)
</p>

</div>
<div class='secedit editbutton_section editbutton_14'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_mettre_en_place_un_controle_parental"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1632642233" /><input type="hidden" name="summary" value="[OpenDNS] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="opendns" /><input type="hidden" name="codeblockOffset" value="12" /><input type="hidden" name="range" value="25581-34348" /><button type="submit" title="OpenDNS" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit15 page-header" id="voir_aussi">Voir aussi</h2>
<div class="level2">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <a href="http://kb.mozillazine.org/Parental_controls" class="urlextern" title="http://kb.mozillazine.org/Parental_controls" rel="nofollow">Contrôle parental chez mozilla</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://addons.mozilla.org/fr/firefox/addon/11595" class="urlextern" title="https://addons.mozilla.org/fr/firefox/addon/11595" rel="nofollow">eXtension broozi</a></div>
</li>
</ul>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <a href="http://forum.ubuntu-fr.org/viewtopic.php?id=167998" class="urlextern" title="http://forum.ubuntu-fr.org/viewtopic.php?id=167998" rel="nofollow">Discussion &quot;Contròle parental et IPtables&quot; sur le forum ubuntu-fr</a></div>
</li>
<li class="level1"><div class="li"> <a href="/tutoriel/restrictions_horaires" class="wikilink1" title="tutoriel:restrictions_horaires">Restreindre les plages horaires autorisées pour chaque utilisateur</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://github.com/raf64flo/parental_control" class="urlextern" title="https://github.com/raf64flo/parental_control" rel="nofollow">Scripts shell sur Github pour installer et supprimer le contrôle parental (à adapter, il n&#039;y a pas de paramètres à ce jour)</a></div>
</li>
</ul>
<hr />

<p>
<em>Contributeurs : <a href="/utilisateurs/roozeec" class="wikilink1" title="utilisateurs:roozeec">Roozeec</a>, Boris Le Hachoir, <a href="/utilisateurs/fabien26" class="wikilink1" title="utilisateurs:fabien26">Fabien26</a>, <a href="/utilisateurs/furious-therapy" class="wikilink1" title="utilisateurs:furious-therapy">Furious-therapy</a>, sensouci.</em>
</p>

</div>
<div class='secedit editbutton_section editbutton_15'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/comment_mettre_en_place_un_controle_parental"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1632642233" /><input type="hidden" name="summary" value="[Voir aussi] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="voir_aussi" /><input type="hidden" name="codeblockOffset" value="30" /><input type="hidden" name="range" value="34349-" /><button type="submit" title="Voir aussi" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="tutoriel/comment_mettre_en_place_un_controle_parental.txt">tutoriel/comment_mettre_en_place_un_controle_parental.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 26/09/2021, 09:43">Le 26/09/2021, 09:43</span></li><li class="text-muted">par 86.215.34.61</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=tutoriel%3Acomment_mettre_en_place_un_controle_parental&amp;1635531241" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
