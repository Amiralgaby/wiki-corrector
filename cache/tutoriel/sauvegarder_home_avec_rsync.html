<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>tutoriel:sauvegarder_home_avec_rsync [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="sauvegarde,tutoriel,vetuste"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/tutoriel/sauvegarder_home_avec_rsync?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns=tutoriel"/>
<link rel="edit" title="Modifier cette page" href="/tutoriel/sauvegarder_home_avec_rsync?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/tutoriel/sauvegarder_home_avec_rsync"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/tutoriel/sauvegarder_home_avec_rsync"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/tutoriel/sauvegarder_home_avec_rsync"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='tutoriel';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"tutoriel:sauvegarder_home_avec_rsync","namespace":"tutoriel","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="tutoriel:sauvegarder_home_avec_rsync">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/tutoriel/sauvegarder_home_avec_rsync?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/tutoriel/sauvegarder_home_avec_rsync?do=media&amp;ns=tutoriel"  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/tutoriel/sauvegarder_home_avec_rsync?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/tutoriel/sauvegarder_home_avec_rsync?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/tutoriel/sauvegarder_home_avec_rsync?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/tutoriel/sauvegarder_home_avec_rsync?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/tutoriel/sauvegarder_home_avec_rsync?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">tutoriel:sauvegarder_home_avec_rsync</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/tutoriel/sauvegarder_home_avec_rsync?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/tutoriel/sauvegarder_home_avec_rsync?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/tutoriel/sauvegarder_home_avec_rsync?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#presentation_de_rsync","title":"Pr\u00e9sentation de rsync","level":2},{"link":"#conseils","title":"Conseils","level":2},{"link":"#points_de_repere_pour_faire_bon_usage_de_ce_tutoriel","title":"Points de rep\u00e8re pour faire bon usage de ce tutoriel","level":2},{"link":"#choisir_la_ligne_de_commande_a_utiliser","title":"Choisir la ligne de commande \u00e0 utiliser","level":1},{"link":"#plusieurs_exemples_de_lignes_de_commande_pour_la_sauvegarde_dehome","title":"Plusieurs exemples de lignes de commande pour la sauvegarde de \/home\/","level":2},{"link":"#les_filtres","title":"Les filtres","level":2},{"link":"#la_creation_du_script_de_sauvegarde_dehome","title":"La cr\u00e9ation du script de sauvegarde de \/home","level":1},{"link":"#sauvegarde_par_un_lanceur_sur_le_bureau_ou_dans_la_barre_des_taches","title":"Sauvegarde par un lanceur sur le bureau ou dans la barre des t\u00e2ches","level":1},{"link":"#sauvegarde_accessible_par_le_menu_applications","title":"Sauvegarde accessible par le menu \"Applications\"","level":1},{"link":"#sauvegarde_lancee_regulierement_avec_cron","title":"Sauvegarde lanc\u00e9e r\u00e9guli\u00e8rement avec cron","level":1},{"link":"#sauvegarde_automatique_a_l_arret_de_l_ordinateur","title":"Sauvegarde automatique \u00e0 l'arr\u00eat de l'ordinateur","level":1},{"link":"#ere_etapecreer_le_script_de_sauvegarde","title":"1\u00e8re \u00e9tape : cr\u00e9er le script de sauvegarde.","level":2},{"link":"#eme_etapecreer_le_lanceur","title":"2\u00e8me \u00e9tape : cr\u00e9er le lanceur","level":2},{"link":"#eme_etapepermettre_le_lancement_du_shutdown_sans_mot_de_passe","title":"3\u00e8me \u00e9tape : permettre le lancement du shutdown sans mot de passe","level":2},{"link":"#eme_etapecreer_un_script_nomme_signalement_erreurs","title":"4\u00e8me \u00e9tape : cr\u00e9er un script nomm\u00e9 \"signalement_erreurs\"","level":2},{"link":"#verifier_le_bon_deroulement_de_l_operation_de_sauvegarde","title":"V\u00e9rifier le bon d\u00e9roulement de l'op\u00e9ration de sauvegarde","level":1},{"link":"#se_resservir_de_la_sauvegarde_en_tant_quehome_en_cas_de_crash","title":"Se resservir de la sauvegarde en tant que \/home en cas de crash","level":1},{"link":"#autres_pages_de_la_documentation_francophone_ou_du_forum_sur_les_sauvegardes_applications_et_tutoriels","title":"Autres pages de la documentation francophone ou du forum sur les sauvegardes (applications et tutoriels)","level":1},{"link":"#references","title":"R\u00e9f\u00e9rences","level":1}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level2"><a href="#presentation_de_rsync">Présentation de rsync</a></li>
<li class="level2"><a href="#conseils">Conseils</a></li>
<li class="level2"><a href="#points_de_repere_pour_faire_bon_usage_de_ce_tutoriel">Points de repère pour faire bon usage de ce tutoriel</a></li>
<li class="level1"><a href="#choisir_la_ligne_de_commande_a_utiliser">Choisir la ligne de commande à utiliser</a></li>
<li class="level2"><a href="#plusieurs_exemples_de_lignes_de_commande_pour_la_sauvegarde_dehome">Plusieurs exemples de lignes de commande pour la sauvegarde de /home/</a></li>
<li class="level2"><a href="#les_filtres">Les filtres</a></li>
<li class="level1"><a href="#la_creation_du_script_de_sauvegarde_dehome">La création du script de sauvegarde de /home</a></li>
<li class="level1"><a href="#sauvegarde_par_un_lanceur_sur_le_bureau_ou_dans_la_barre_des_taches">Sauvegarde par un lanceur sur le bureau ou dans la barre des tâches</a></li>
<li class="level1"><a href="#sauvegarde_accessible_par_le_menu_applications">Sauvegarde accessible par le menu &quot;Applications&quot;</a></li>
<li class="level1"><a href="#sauvegarde_lancee_regulierement_avec_cron">Sauvegarde lancée régulièrement avec cron</a></li>
<li class="level1"><a href="#sauvegarde_automatique_a_l_arret_de_l_ordinateur">Sauvegarde automatique à l&#039;arrêt de l&#039;ordinateur</a></li>
<li class="level2"><a href="#ere_etapecreer_le_script_de_sauvegarde">1ère étape : créer le script de sauvegarde.</a></li>
<li class="level2"><a href="#eme_etapecreer_le_lanceur">2ème étape : créer le lanceur</a></li>
<li class="level2"><a href="#eme_etapepermettre_le_lancement_du_shutdown_sans_mot_de_passe">3ème étape : permettre le lancement du shutdown sans mot de passe</a></li>
<li class="level2"><a href="#eme_etapecreer_un_script_nomme_signalement_erreurs">4ème étape : créer un script nommé &quot;signalement_erreurs&quot;</a></li>
<li class="level1"><a href="#verifier_le_bon_deroulement_de_l_operation_de_sauvegarde">Vérifier le bon déroulement de l&#039;opération de sauvegarde</a></li>
<li class="level1"><a href="#se_resservir_de_la_sauvegarde_en_tant_quehome_en_cas_de_crash">Se resservir de la sauvegarde en tant que /home en cas de crash</a></li>
<li class="level1"><a href="#autres_pages_de_la_documentation_francophone_ou_du_forum_sur_les_sauvegardes_applications_et_tutoriels">Autres pages de la documentation francophone ou du forum sur les sauvegardes (applications et tutoriels)</a></li>
<li class="level1"><a href="#references">Références</a></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content"><div class="notetag">Cette page est considérée comme <a href="/vetuste">vétuste</a> et ne contient plus d'informations utiles.<br />
<a href="/wiki/participer_wiki">Apportez votre aide…</a>
</div>
<div class="tags"><span>
	<a href="/sauvegarde" class="wikilink1" title="sauvegarde" rel="tag">sauvegarde</a>,
	<a href="/tutoriel" class="wikilink1" title="tutoriel" rel="tag">tutoriel</a>,
	<a href="/vetuste" class="wikilink1" title="vetuste" rel="tag">VÉTUSTE</a>
</span></div>
<hr />

<h1 class="sectionedit1 page-header" id="sauvegarderhome_avec_rsync">Sauvegarder &quot;/home&quot; avec rsync</h1>
<div class="level1">

<p>
Si vous, ou un de vos agents, êtes capturés en  mission, le Département d’État nierait…
Heu non, ce n&#039;est pas ça. Recommençons.
Ces manipulations ne sont pas triviales, vous les faites donc à vos risques et périls. Si ça plante, ne vous en prenez qu&#039;à vous-même !!
</p>

<p>
Tout de suite ça met dans l&#039;ambiance, non ? <img src="/lib/images/smileys/icon_wink.gif" class="icon" alt=";-)" />
</p>

<p>
Autrement dit, il vous faut comprendre ce que vous faites avant de le réaliser ; il est recommandé de faire d&#039;abord des tests avec des dossiers artificiellement créés pour l&#039;occasion, avant de lancer la sauvegarde générale.
</p>

<p>
Allez hop, c&#039;est parti !!
</p>
<div class="notetip">Si vous voulez utiliser rsync avec une interface graphique, voir la documentation <a href="/tutoriel/sauvegarder_home_avec_grsync" class="wikilink1" title="tutoriel:sauvegarder_home_avec_grsync">Sauvegarder &quot;home&quot; avec grsync</a>
</div>
</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[Sauvegarder &quot;/home&quot; avec rsync] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="sauvegarderhome_avec_rsync" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="48-855" /><button type="submit" title="Sauvegarder &quot;/home&quot; avec rsync" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit2" id="presentation_de_rsync">Présentation de rsync</h3>
<div class="level3">

<p>
Inutile de revenir sur l&#039;importance de faire des sauvegardes régulières de ses données.
C&#039;est en général au moment d&#039;un crash que l&#039;on bénit le jour où l&#039;on a mis en place ses sauvegardes… Ou au contraire que l&#039;on se maudit de ne pas avoir pris le temps d&#039;en faire.
</p>

<p>
Voici donc un tutoriel pour vous éviter de vous auto-traiter de toutes les injures possibles si un jour, malheureusement, vous crashez votre disque dur.
</p>

<p>
Le programme <strong>rsync</strong> fonctionne en ligne de commande. Une interface graphique existe, <strong><a href="/tutoriel/sauvegarder_home_avec_grsync" class="wikilink1" title="tutoriel:sauvegarder_home_avec_grsync">Grsync</a></strong>, mais elle n&#039;offre pas les mêmes possibilités.
On peut dire que rsync convient tout à fait pour obtenir une sauvegarde intégrale de son &quot;Home&quot; que l&#039;on peut lancer lorsqu&#039;on le désire, et que l&#039;on peut aussi automatiser.
</p>

<p>
Ce tuto détaille donc toutes les étapes pour disposer d&#039;une bonne méthode de sauvegarde de /home. Plusieurs méthodes vous sont proposées. A chacun de choisir celle qui lui convient le mieux selon son usage.
</p>

<p>
<strong>Deux possibilités de sauvegarde &quot;manuelle&quot;</strong> avec un clic pour lancer une sauvegarde quand on l&#039;estime nécessaire :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <a href="/tutoriel/sauvegarder_home_avec_rsync#sauvegarde_par_un_lanceur_sur_le_bureau_ou_dans_la_barre_des_taches" class="wikilink1 curid" title="tutoriel:sauvegarder_home_avec_rsync" data-curid="true">Un lanceur dans la barre des tâches ou sur le bureau</a>.</div>
</li>
<li class="level1"><div class="li"> <a href="/tutoriel/sauvegarder_home_avec_rsync#sauvegarde_accessible_par_le_menu_applications" class="wikilink1 curid" title="tutoriel:sauvegarder_home_avec_rsync" data-curid="true">Une entrée dans le menu &quot;Applications&quot;</a>.</div>
</li>
</ul>

<p>
<strong>Deux possibilités de sauvegarde automatique :</strong>
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <a href="/tutoriel/sauvegarder_home_avec_rsync#sauvegarde_lancee_regulierement_avec_cron" class="wikilink1 curid" title="tutoriel:sauvegarder_home_avec_rsync" data-curid="true">Avec cron</a>, ce qui convient aux ordinateurs tournant 24h/24.</div>
</li>
<li class="level1"><div class="li"> <a href="/tutoriel/sauvegarder_home_avec_rsync#sauvegarde_automatique_a_l_arret_de_l_ordinateur" class="wikilink1 curid" title="tutoriel:sauvegarder_home_avec_rsync" data-curid="true">A l&#039;arrêt de l&#039;ordinateur</a>, ce qui convient aux ordinateurs qui sont éteints une ou plusieurs fois par jour.</div>
</li>
</ul>
<div class="noteclassic">Il existe une troisième possibilité, à mi-chemin entre les deux, c&#039;est <a href="/anacron" class="wikilink1" title="anacron">anacron</a> qui permet de mettre en place une sauvegarde lancée régulièrement comme pour cron
mais qui s&#039;exécute au démarrage si le PC était éteint lorsque la tâche devait être exécutée.
</div>
<p>
Avant de commencer voici quelques infos sur ce programme, en direct de Wikipédia :
</p>

<p>
rsync est un programme très similaire à rcp, mais possède bien plus d&#039;options et utilise un protocole de mise à jour à distance plus efficace afin d&#039;accélérer significativement le transfert de fichiers lorsque le fichier de destination existe déjà.
Le protocole de mise à jour à distance rsync lui permet de ne transférer que la différence entre deux jeux de fichiers à travers le réseau, en utilisant un algorithme de recherche de somme de contrôle.
</p>

<p>
En clair cela signifie que rsync transfère de la &quot;source&quot; vers la &quot;destination&quot; tous les fichiers lors de la première sauvegarde. Celle-ci prend donc un certain temps en fonction du volume de vos données.
Ensuite il ne sauvegarde sur la &quot;destination&quot; que les fichiers qui ont été modifiés sur la &quot;source&quot; depuis la sauvegarde précédente. En utilisant l&#039;option --<strong>del</strong>, il élimine également les fichiers sur la &quot;destination&quot; qui ne seraient plus présents sur la &quot;source&quot;.
En utilisant les bonnes options, tous les fichiers sont copiés en conservant leurs permissions respectives.
</p>

<p>
Au final, après chaque sauvegarde, on retrouve une copie conforme de son source.
</p>

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[Présentation de rsync] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="presentation_de_rsync" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="856-4269" /><button type="submit" title="Présentation de rsync" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit3" id="conseils">Conseils</h3>
<div class="level3">

<p>
Il est possible d&#039;effectuer une sauvegarde de /home sur une autre partition du même disque dur. Mais c&#039;est imprudent : si le disque grille, la sauvegarde est perdue en même temps que /home… et ne sert à rien. 
</p>

<p>
Il est donc recommandé d&#039;effectuer la sauvegarde sur un autre disque dur (interne ou externe).
</p>

<p>
D&#039;autre part, dans l&#039;installation de Ubuntu par défaut, le répertoire /home est installé sur une partition formatée en ext4.
Il est recommandé que la partition de sauvegarde soit aussi formatée en ext4, pour conserver correctement les permissions et les réattribuer lors de la restauration.
</p>
<div class="noteclassic"> Pour conserver les droits, il <strong>faut éviter</strong> les partitions formatées avec les systèmes de fichiers <em>fat, FAT32, ntfs, <abbr title="Network File System">NFS</abbr> (?)</em>. 
Cependant, il est possible d&#039;utiliser du <em>ext2, ext3, ext4, BtrFS, ReiserFS</em>.
<p>
<img src="/lib/images/smileys/fixme.gif" class="icon" alt="FIXME" />: Par contre, pas de certitude pour les compatibilités des fichiers avec des noms accentués entre ReiserFS et ext4, ext3 ou ext2
</p>

</div><div class="noteimportant">Pour réaliser une sauvegarde sans erreur vers une partition de sauvegarde formatée en ext3 ou ext4, il faut être propriétaire de cette partition. Voir la note intitulée &quot;Les problèmes de droits ou de permissions (disques de sauvegarde partitionnés en ext3)&quot; sur <a href="/tutoriel/sauvegarder_home_avec_grsync#problemes_de_droits_ou_de_permissions" class="wikilink1" title="tutoriel:sauvegarder_home_avec_grsync">cette page</a>.
</div>
</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[Conseils] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="conseils" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="4270-5661" /><button type="submit" title="Conseils" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit4" id="points_de_repere_pour_faire_bon_usage_de_ce_tutoriel">Points de repère pour faire bon usage de ce tutoriel</h3>
<div class="level3">

<p>
Dans tous les exemples et explications de ce tutoriel, pour faire usage de tel ou tel élément comportant le texte &quot;votre_identité&quot;, remplacez celui-ci par votre véritable identité sur votre ordinateur (le login que vous indiquez lors de l&#039;ouverture de votre session Ubuntu).
</p>

<p>
De même, en vous inspirant des exemples proposés, soyez particulièrement attentifs à adapter correctement les chemins des dossiers ou partitions &quot;source&quot; et &quot;destination&quot; à ce que vous voulez faire.
</p>

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[Points de repère pour faire bon usage de ce tutoriel] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="points_de_repere_pour_faire_bon_usage_de_ce_tutoriel" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="5662-6214" /><button type="submit" title="Points de repère pour faire bon usage de ce tutoriel" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit5 page-header" id="choisir_la_ligne_de_commande_a_utiliser">Choisir la ligne de commande à utiliser</h2>
<div class="level2">

<p>
Normalement, une sauvegarde avec rsync d&#039;une partition ext4 vers une partition ext4 ne nécessite pas de droits root. Nous n&#039;avons donc pas besoin de faire précéder &quot;rsync&quot; par &quot;sudo&quot; dans les lignes de commandes ; et donc, pas besoin de mot de passe.
</p>

</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[Choisir la ligne de commande à utiliser] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="choisir_la_ligne_de_commande_a_utiliser" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="6215-6526" /><button type="submit" title="Choisir la ligne de commande à utiliser" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit6" id="plusieurs_exemples_de_lignes_de_commande_pour_la_sauvegarde_dehome">Plusieurs exemples de lignes de commande pour la sauvegarde de /home/</h3>
<div class="level3">
<div class="noteimportant"><strong>Attention</strong> : l&#039;indication d&#039;un répertoire de destination nouveau, vide (ou ne contenant que la précédente sauvegarde de /home), dédié exclusivement à la sauvegarde de /home et ne contenant rien d&#039;autre, est indispensable si vous ne voulez pas effacer tout ce que contient la partition de destination.
<p>
Vous noterez donc dans les trois exemples ci-dessous que le répertoire de destination porte un nom qui évoque sa destination de sauvegarde &quot;/mnt/SAV/&quot; dans l&#039;exemple de soupaloignon, &quot;/media/Sauve_home/SauvHomeLieu/&quot; dans l&#039;exemple de Sorbus, &quot;/media/save_homes/&quot; dans l&#039;exemple de poupoul2.
</p>

<p>
L&#039;utilisation de l&#039;option --del ou de l&#039;option --delete, indispensable pour une sauvegarde de /home à l&#039;identique, efface en effet dans le répertoire de destination tout ce qui n&#039;est pas conforme au répertoire /home de la source.
</p>

</div>
</div>

<h5 id="proposition_soupaloignon">Proposition soupaloignon</h5>
<div class="level5">
<pre class="code">rsync -rltgoDv --del --ignore-errors --force /home/votre_identité/ /mnt/SAV/</pre>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li">rsync : appelle le programme rsync</div>
</li>
<li class="level1"><div class="li">-r : parcours le dossier indiqué et tous ses sous-dossiers</div>
</li>
<li class="level1"><div class="li">-l : copie les liens symboliques comme liens symboliques</div>
</li>
<li class="level1"><div class="li">-t : préserve les dates</div>
</li>
<li class="level1"><div class="li">-g : préserve le groupe</div>
</li>
<li class="level1"><div class="li">-o : mettre le propriétaire du fichier de destination identique à celui du fichier source</div>
</li>
<li class="level1"><div class="li">-D : préserve les périphériques</div>
</li>
<li class="level1"><div class="li">-v : plus loquace</div>
</li>
<li class="level1"><div class="li">--del : permet de supprimer les fichiers sur &quot;destination&quot; qui n&#039;existent plus sur &quot;source&quot;</div>
</li>
<li class="level1"><div class="li">--ignore-errors : efface même s&#039;il y a eu des erreurs E/S</div>
</li>
<li class="level1"><div class="li">--force : force la suppression de répertoires même non-vides</div>
</li>
<li class="level1"><div class="li">/home/votre_identité/ : répertoire source</div>
</li>
<li class="level1"><div class="li">/mnt/SAV/ : répertoire destination</div>
</li>
</ul>

<p>
Cette ligne de commande va donc transférer le contenu de &quot;votre_identité&quot; (qui est sur /home) vers le disque dur de destination, monté dans /mnt avec comme nom &quot;SAV&quot;.
</p>

</div>

<h5 id="proposition_sorbus">Proposition Sorbus</h5>
<div class="level5">
<pre class="code">rsync -av --del --stats /home/ /media/Sauve_home/SauvHomeLieu/</pre>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li">-a : équivalent à -rlptgoD. C&#039;est un moyen rapide de dire que vous voulez la récursion et de préserver pratiquement tout</div>
</li>
</ul>

<p>
Par rapport aux options choisies par soupaloignon, la proposition de Sorbus ajoute les options :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li">-p : provoque la mise à jour des permissions sur la destination pour qu&#039;elles soient identiques aux permissions sur la source.</div>
</li>
<li class="level1"><div class="li">--stats : affiche quelques statistiques de transfert de fichiers, ce qui permet de vérifier l&#039;efficacité de la sauvegarde.</div>
</li>
</ul>

<p>
Mais les options --ignore-errors  et  --force   ne sont pas utilisées.
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li">/home/ : répertoire source</div>
</li>
<li class="level1"><div class="li">/media/Sauve_home/SauvHomeLieu/ : répertoire destination</div>
</li>
</ul>

</div>

<h5 id="proposition_poupoul2">Proposition poupoul2</h5>
<div class="level5">
<pre class="code">rsync -a --stats --progress --delete /home/ /media/save_homes/</pre>

<p>
Proposition similaire à celle de Sorbus, avec cependant deux différences par rapport aux propositions de Sorbus et de soupaloignon :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li">le choix de l&#039;option --progress plutôt que de l&#039;option -v</div>
</li>
<li class="level1"><div class="li">le choix de l&#039;option --delete plutôt que de l&#039;option --del</div>
</li>
</ul>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li">--progress : montre l&#039;avancement pendant le transfert.</div>
</li>
<li class="level1"><div class="li">--delete : efface avant le transfert les fichiers qui n&#039;existent pas sur la source.</div>
</li>
<li class="level1"><div class="li">--del : efface au cours du transfert (pas avant) les fichiers qui n&#039;existent pas sur la source.</div>
</li>
</ul>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li">/home/ : répertoire source</div>
</li>
<li class="level1"><div class="li">/media/save_homes/ : répertoire destination</div>
</li>
</ul>

</div>

<h5 id="a_vous">À vous !</h5>
<div class="level5">

<p>
À vous d&#039;adapter les chemins des &quot;source&quot; et &quot;destination&quot; en fonction de votre configuration.
</p>

<p>
Il existe un grand nombre d&#039;options que l&#039;on peut passer dans rsync. Les propositions ci-dessus, éventuellement associées à des filtres, conviennent bien  pour une sauvegarde de /home. Mais si vous voulez creuser d&#039;avantage, vous pouvez choisir les options qui vous conviennent le mieux, en fonction de ce que vous voulez faire en consultant <a href="http://man.developpez.com/man1/rsync.1.php#L22" class="urlextern" title="http://man.developpez.com/man1/rsync.1.php#L22" rel="nofollow">la traduction du manuel de rsync en français</a> ou en lançant &quot;man rsync&quot; en console (en anglais, mais version du manuel plus récente que la traduction française actuellement disponible).
</p>

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[Plusieurs exemples de lignes de commande pour la sauvegarde de /home/] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="plusieurs_exemples_de_lignes_de_commande_pour_la_sauvegarde_dehome" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="6527-10654" /><button type="submit" title="Plusieurs exemples de lignes de commande pour la sauvegarde de /home/" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit7" id="les_filtres">Les filtres</h3>
<div class="level3">

<p>
Un certain nombre de fichiers ou répertoires sont inutiles pour une sauvegarde de /home/
Il s&#039;agit notamment des fichiers images .iso, des fichiers temporaires, des répertoires &quot;cache&quot;, des miniatures images &quot;thumbnails&quot;, de la corbeille (.Trash), du répertoire lost+found.
On peut utiliser l&#039;option --filter pour exclure ces fichiers de la sauvegarde, comme dans l&#039;exemple suivant :
</p>
<pre class="code">sudo rsync -av --del --stats --filter &quot;- .thumbnails/&quot; --filter &quot;- .Trash/&quot; --filter &quot;- *.tmp&quot; --filter &quot;- *.iso&quot; --filter &quot;- lost+found/&quot; --filter &quot;- .cache/&quot; --filter &quot;- .beagle/&quot; /home/ /sauvegarde/SauvHome/ </pre>

<p>
Ou encore comme dans cet autre exemple :
</p>
<pre class="code">rsync -a --stats --progress --filter &quot;- .iso&quot; --filter &quot;- .tmp&quot; --filter &quot;- klibido/&quot; --filter &quot;- lost+found/&quot; --filter &quot;- .Trash/&quot; --filter &quot;- .beagle/&quot; --filter &quot;- cache/&quot; --filter &quot;- CACHE/&quot; --filter &quot;- Cache/&quot; --filter &quot;- .thumbnails/&quot; --delete?? /home/ /media/save_homes/</pre>

<p>
Pour ceux qui se posent des questions sur la rédaction de leur commande Rsync, <a href="http://forum.ubuntu-fr.org/viewtopic.php?id=336213" class="urlextern" title="http://forum.ubuntu-fr.org/viewtopic.php?id=336213" rel="nofollow">ce post du forum</a> peut éventuellement apporter quelques réponses à leurs questions. 
</p>

<p>
Un peu long pour cette partie, mais nous avons préféré bien détailler ce qui se passait, et vous offrir plusieurs choix.
Pour la réalisation c&#039;est beaucoup plus rapide par contre : un simple copier/coller de la ligne de commande de votre choix dans la console (après avoir modifié vos chemins d&#039;accès).
</p>

<p>
Maintenant c&#039;est bien sympa, mais retaper cette ligne dans le terminal à chaque sauvegarde, cela risque d&#039;être un peu lourd.
Ça tombe bien, c&#039;est le but du paragraphe suivant…
</p>

</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[Les filtres] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="les_filtres" /><input type="hidden" name="codeblockOffset" value="3" /><input type="hidden" name="range" value="10655-12347" /><button type="submit" title="Les filtres" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit8 page-header" id="la_creation_du_script_de_sauvegarde_dehome">La création du script de sauvegarde de /home</h2>
<div class="level2">

<p>
Ce script va permettre de lancer la sauvegarde d&#039;un double-clic.
Créez un fichier où vous voulez, copiez/collez le contenu ci-dessous, enregistrez-le avec un nom du genre «sauvegarde-home.sh».
Une fois que c&#039;est fait, donnez les droits d&#039;exécution au propriétaire du fichier (soit en console, soit par un clic droit sur le fichier/propriétés/permissions).
L&#039;option «read»  permet de garder la console ouverte une fois que la sauvegarde est terminée. Toujours utile si on veut voir ce qui s&#039;est passé. Si vous voulez mieux comprendre comment fonctionne un script shell, vous pouvez consulter <a href="/tutoriel/script_shell" class="wikilink1" title="tutoriel:script_shell">la page de la documentation à ce sujet</a>.
</p>

<p>
Exemple de script avec la ligne de commande proposée par soupaloignon :
</p>
<pre class="code">#!/bin/bash
rsync -rltgoDv --del --ignore-errors --force /home/votre_identité/ /mnt/SAV/
read</pre>

<p>
Un script un peu plus développé permet la vérification préalable du montage du disque de sauvegarde, ce qui est utile si le disque de sauvegarde est un disque externe. Exemple avec la ligne de commande proposée par Sorbus (et les filtres) :
</p>
<pre class="code">#!/bin/bash
REPERTOIRE_SOURCE=&quot;/home/&quot;
REPERTOIRE_DESTINATION=&quot;/sauvegarde/SauvHomeLieu/&quot;
  
# Détecter la présence du volume de destination et interrompre l&#039;opération si nécessaire
if [ ! -e &quot;$REPERTOIRE_DESTINATION&quot; ]
then
echo &quot;Attention, le disque de sauvegarde n&#039;est pas présent&quot;
exit
fi
  
rsync -av --del --stats --filter &quot;- .thumbnails/&quot; --filter &quot;- .Trash/&quot; --filter &quot;- *.tmp&quot; --filter &quot;- *.iso&quot; --filter &quot;- lost+found/&quot; --filter &quot;- .cache/&quot; --filter &quot;- .beagle/&quot; $REPERTOIRE_SOURCE &quot;$REPERTOIRE_DESTINATION&quot;
  
echo &quot;La commande de sauvegarde a terminé son travail...&quot;
echo &quot;Vérifiez dans le terminal s&#039;il n&#039;y a pas eu d&#039;erreur !&quot;</pre>

<p>
Et voilà, d&#039;un simple double-clic (eh oui, facile le jeu de mots <img src="/lib/images/smileys/icon_wink.gif" class="icon" alt=";-)" />) vous avez réalisé votre sauvegarde.
</p>

<p>
Ok, c&#039;est bien joli, mais il y a une fenêtre qui s&#039;affiche, il faut valider par «Lancer dans un terminal», il n&#039;y aurait pas quelque chose de plus esthétique ?
</p>

<p>
Et bien c&#039;est justement le but des paragraphes qui suivent, ça tombe bien non ?
</p>
<div class="notetip">  Voici <a href="http://forum.ubuntu-fr.org/viewtopic.php?id=327586" class="urlextern" title="http://forum.ubuntu-fr.org/viewtopic.php?id=327586" rel="nofollow">une proposition commentée</a> de script de sauvegarde de /home sur le forum. Vous y trouverez de la sécurité (étant lancé par root), la possibilité de mettre des arguments afin de sauvegarder d&#039;autres répertoires et obtenir de l&#039;aide. Le disque de destination est monté et démonté automatiquement. Il permet de raccourcir le temps de la sauvegarde en se basant sur la dernière sauvegarde effectuée. Il est interactif et prévient en cas d&#039;erreurs. Cependant, malgré les différents tests effectués, il peut contenir quelques erreurs que vous pouvez signaler sur le topic du forum. Sur la page vous obtiendrez des explications, et un <pre class="code">/chemin/du/script/Nom_du_script -h</pre>

<p>
 vous donnera une explication détaillée. 
Concernant le lanceur sur le bureau, il faut y ajouter un argument pour la destination qui peut être un dossier, une partition nommé par son chemin (dans /dev/) ou par son label.
</p>

</div>
</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[La création du script de sauvegarde de /home] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="la_creation_du_script_de_sauvegarde_dehome" /><input type="hidden" name="codeblockOffset" value="5" /><input type="hidden" name="range" value="12348-15530" /><button type="submit" title="La création du script de sauvegarde de /home" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit9 page-header" id="sauvegarde_par_un_lanceur_sur_le_bureau_ou_dans_la_barre_des_taches">Sauvegarde par un lanceur sur le bureau ou dans la barre des tâches</h2>
<div class="level2">

<p>
Il faut d&#039;abord ranger votre fichier «sauvegarde-home.sh» à un endroit quelconque de votre disque dur ; par exemple dans un dossier «scripts» de votre «home».
</p>

<p>
<a href="/raccourci-lanceur#creation_d_un_lanceur_sur_le_bureau_de_facon_graphique" class="wikilink1" title="raccourci-lanceur">Créez un raccourci</a> pour lancer votre script de sauvegarde d&#039;un clic sur une icône de votre bureau.
</p>

<p>
Commande : utilisez le bouton &quot;parcourir&quot; pour indiquer le chemin exact de votre fichier de sauvegarde. Exemple :
</p>
<pre class="code">/home/scripts/sauvegarde-home.sh</pre>

<p>
Vous pouvez faire précéder ce chemin d&#039;une autre commande, par exemple :
</p>
<pre class="code">xterm -geometry 170x60 -sb -rightbar -hold -e</pre>

<p>
Cette commande ouvre une fenêtre de terminal permettant de visualiser la sauvegarde en cours et son résultat. <em>Vous pouvez régler la taille du terminal xterm &quot;-geometry 170x60&quot; en fonction de la taille de votre écran. Pour faire défiler les données avec l&#039;ascenseur : utiliser clic droit/clic gauche</em>.
</p>

<p>
Vous aurez alors dans la ligne &quot;Application&quot; du lanceur :
</p>
<pre class="file">xterm -geometry 170x60 -sb -rightbar -hold -e /home/scripts/sauvegarde-home.sh</pre>

<p>
De la même façon, vous pouvez créer un lanceur dans la barre des tâches.
</p>

</div>
<div class='secedit editbutton_section editbutton_9'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[Sauvegarde par un lanceur sur le bureau ou dans la barre des tâches] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="sauvegarde_par_un_lanceur_sur_le_bureau_ou_dans_la_barre_des_taches" /><input type="hidden" name="codeblockOffset" value="8" /><input type="hidden" name="range" value="15531-16796" /><button type="submit" title="Sauvegarde par un lanceur sur le bureau ou dans la barre des tâches" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit10 page-header" id="sauvegarde_accessible_par_le_menu_applications">Sauvegarde accessible par le menu &quot;Applications&quot;</h2>
<div class="level2">

<p>
<a href="/raccourci-lanceur#creation_d_un_lanceur_dans_le_menu_de_facon_graphique" class="wikilink1" title="raccourci-lanceur">Créez un raccourci</a> pour lancer votre script de sauvegarde d&#039;un clic dans le menu.
</p>

<p>
Bien choisir l&#039;endroit où vous voulez le  mettre : soit dans un dossier déjà existant, soit en créant un nouveau menu. On peut par exemple créer un menu &quot;Sauvegarde&quot;, dans lequel on rajoute un élément &quot;Sauvegarde home&quot;.
</p>

<p>
Menu principal/Nouvel élément.
Donner un nom significatif, un commentaire si vous le désirez. Et maintenant le plus important, dans le champ «Commande» entrez le chemin complet vers votre fichier. Par exemple : &quot;/home/votre_identité/03\ outils/00scripts/sav-home.sh&quot; ou bien &quot;/home/scripts/sauvegarde-home.sh&quot;).
Important : Si un ou plusieurs de vos noms de dossiers comportent des espaces, il faut mettre un «\ » devant l&#039;espace.
Pour éviter toute erreur dans la rédaction du chemin, utilisez le bouton &quot;parcourir&quot;.
Valider l&#039;option &quot;Exécuter dans un terminal&quot;.
Mettre une icône pour que cela fasse beau <img src="/lib/images/smileys/icon_wink.gif" class="icon" alt=";-)" />
Cliquer sur &quot;Fermer&quot;.
</p>

<p>
Et voilà, direction menu Applications maintenant. C&#039;est pas mignon ça ?
</p>

</div>
<div class='secedit editbutton_section editbutton_10'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[Sauvegarde accessible par le menu &quot;Applications&quot;] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="sauvegarde_accessible_par_le_menu_applications" /><input type="hidden" name="codeblockOffset" value="11" /><input type="hidden" name="range" value="16797-17969" /><button type="submit" title="Sauvegarde accessible par le menu &quot;Applications&quot;" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit11 page-header" id="sauvegarde_lancee_regulierement_avec_cron">Sauvegarde lancée régulièrement avec cron</h2>
<div class="level2">

</div>

<h4 id="sauvegarde_de_luxe">Sauvegarde de luxe</h4>
<div class="level4">

<p>
Par exemple pour sauver REPERTOIRE_A_SAUVER dans REPERTOIRE_DE_SAUVEGARDE avec  
</p>

<p>
* une sauvegarde chaque jour de la semaine qui n&#039;est écrasée que la semaine suivante et
</p>

<p>
* une sauvegarde chaque semaine qui est conservée un an. 
</p>

</div>

<h5 id="creer_les_dossiers_necessaires_aux_sauvegardes">Créer les dossiers nécessaires aux sauvegardes</h5>
<div class="level5">

<p>
Se placer dans REPERTOIRE_DE_SAUVEGARDE. On peut les créer à la main. Il est également possible d&#039;utiliser le petit script suivant qu&#039;il faut enregistrer dans REPERTOIRE_DE_SAUVEGARDE et exécuter :
</p>
<pre class="code">#!/bin/bash
for x in lundi mardi mercredi jeudi vendredi samedi dimanche {1..52}
do
mkdir $x
done</pre>

<p>
<strong>Remarque :</strong> ma configuration est en français c&#039;est pourquoi les dossiers sont lundi, mardi, etc. Pour savoir si vous êtes en français ou en anglais tapez <code>date +%A</code> dans un terminal est voyez si c&#039;est en français. Si vous avez installé linux en anglais remplacer le fichier ci-dessus par
</p>
<pre class="code">#!/bin/bash
for x in monday tuesday wednesday thursday friday saturday sunday {1..52}
do
mkdir $x
done</pre>

</div>

<h5 id="sauvegarde_quotidienne">Sauvegarde quotidienne</h5>
<div class="level5">

<p>
Maintenant enregistrez le script suivant dans /etc/cron.daily :
</p>
<pre class="code">#!/bin/bash
###################################
#  Jour
###################################
jour=$(date +%A)
source=&quot;REPERTOIRE_A_SAUVER&quot;
destination=&quot;REPERTOIRE_DE_SAUVEGARDE&quot;
###################################
#  Sauvegarde des fichiers de REPERTOIRE_A_SAUVER
###################################
rsync -aRbcxv --progress --delete --stats $source $destination/$jour</pre>

<p>
Ce script va sauver tous les jours votre REPERTOIRE_A_SAUVER dans REPERTOIRE_DE_SAUVEGARDE/nom_du_jour_de_la_semaine. La semaine suivante le fichier sera écrasé par le rsync suivant.
</p>

</div>

<h5 id="sauvegarde_hebdomadaire">Sauvegarde hebdomadaire</h5>
<div class="level5">

<p>
Maintenant enregistrez le script suivant dans /etc/cron.weekly :
</p>
<pre class="code">#!/bin/bash
###################################
#  Jour
###################################
semaine=$(date +%V)
source=&quot;REPERTOIRE_A_SAUVER&quot;
destination=&quot;REPERTOIRE_DE_SAUVEGARDE&quot;
###################################
#  Sauvegarde des fichiers de REPERTOIRE_A_SAUVER
###################################
rsync -aRbcxv --progress --delete --stats $source $destination/$semaine</pre>

<p>
Ce script va sauver <del>tous les jours</del> chaque semaine votre REPERTOIRE_A_SAUVER dans REPERTOIRE_DE_SAUVEGARDE/numero_de_la_semaine_de_l_annee.
</p>

</div>

<h5 id="automatiser_les_sauvegardes">Automatiser les sauvegardes</h5>
<div class="level5">

<p>
Dans un terminal lancer <code>sudo crontab -e</code> puis copier ces deux lignes :
</p>
<pre class="code">0 23 * * * sudo sh /root/script/sauvegarde_www_daily.sh &gt;/dev/null 2&gt;&amp;1 # JOB_ID_1
30 23 * * 5 sudo sh /root/script/sauvegarde_www_weekly.sh &gt;/dev/null 2&gt;&amp;1 #JOB_ID_2</pre>

</div>
<div class='secedit editbutton_section editbutton_11'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[Sauvegarde lancée régulièrement avec cron] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="sauvegarde_lancee_regulierement_avec_cron" /><input type="hidden" name="codeblockOffset" value="11" /><input type="hidden" name="range" value="17970-20665" /><button type="submit" title="Sauvegarde lancée régulièrement avec cron" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit12 page-header" id="sauvegarde_automatique_a_l_arret_de_l_ordinateur">Sauvegarde automatique à l&#039;arrêt de l&#039;ordinateur</h2>
<div class="level2">

<p>
Cette méthode présente l&#039;avantage de réaliser la sauvegarde juste avant l&#039;arrêt de l&#039;ordinateur… et non au redémarrage comme on pourrait le faire avec des outils comme <strong>at</strong> ou <strong>anacron</strong>. En cas d&#039;impossibilité de redémarrer, on dispose ainsi de la sauvegarde la plus récente.
</p>

<p>
La mise au point de cette méthode se fait en quatre étapes assez simples. Au final, elle permet, d&#039;un seul clic sur un bouton de la barre des tâches, d&#039;arrêter l&#039;ordinateur en faisant précéder cet arrêt d&#039;une sauvegarde de tous les éléments nouveaux ou modifiés sur /home. La solution idéale pour toujours disposer d&#039;une sauvegarde totalement à jour.
Objectif : disposer d&#039;une sauvegarde à l&#039;identique (avec option --del) de &#039;/home&#039;… et en plus une sauvegarde en double du bureau (Desktop) et du dossier &quot;Documents&quot;, (sans l&#039;option --del) pour ne pas avoir à regretter de ne disposer que d&#039;une sauvegarde ayant fidèlement effacé des documents qui auraient été effacés par erreur du bureau ou du dossier &quot;Documents&quot;.
</p>

</div>
<div class='secedit editbutton_section editbutton_12'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[Sauvegarde automatique à l&#039;arrêt de l&#039;ordinateur] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="sauvegarde_automatique_a_l_arret_de_l_ordinateur" /><input type="hidden" name="codeblockOffset" value="16" /><input type="hidden" name="range" value="20666-21766" /><button type="submit" title="Sauvegarde automatique à l&#039;arrêt de l&#039;ordinateur" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit13" id="ere_etapecreer_le_script_de_sauvegarde">1ère étape : créer le script de sauvegarde.</h3>
<div class="level3">

<p>
En voici un modèle. À vous de l&#039;adapter selon vos besoins :
</p>
<pre class="code">#!/bin/bash
# Vérifie la présence du volume : le script effectue la vérification du montage de la partition &quot;Sauve_home&quot; du disque dur externe usb.
# Si cette partition est montée, l&#039;autre partition de ce même disque externe (qui sert dans ce script
# à la sauvegarde du contenu d&#039;une partition fat32), est forcément montée aussi.
if [ ! -e &quot;/media/Sauve_home/&quot; ]
then
echo &quot;Erreur, le volume de sauvegarde est absent.&quot;
exit
fi
#titre de lancement de la sauvegarde générale
echo
echo &quot;LA SAUVEGARDE GENERALE EST EN COURS D&#039;EXECUTION AVANT ARRET DE L&#039;ORDINATEUR&quot;
echo
# pour donner un nom &quot;raccourci&quot; (incluant le chemin) au fichier donnant l&#039;historique des installations,
# mises à jour et désinstallations de paquets, fichier nommé &quot;historique_inst_maj_desinst.log&quot; :
  histor=/home/votre_identité/Documents/Sauvegardes/historique_inst_maj_desinst.log
  
# pour mettre à jour le fichier actualisé de l&#039;historique des installations, mises à jour et désinstallations de paquets :
zgrep -h &quot; installed \| upgrade \| remove &quot; /var/log/dpkg.log* | sort | uniq &gt; $histor
  
# pour donner un nom &quot;raccourci&quot; (incluant le chemin) au fichier backuperror.log :
backup=/home/votre_identité/Documents/Sauvegardes/backuperror.log
# à noter l&#039;usage des &quot;&gt;&quot; : un seul &quot;&gt;&quot; renvoie le contenu du terminal dans le fichier indiqué en écrasant tout ce que contient déjà ce fichier.
# &quot;&gt;&gt;&quot; renvoie le contenu du terminal sans écraser ce que contient déjà le fichier.
# Le chiffre &quot;2&quot; suivi d&#039;un seul &quot;&gt;&quot; renvoie seulement les messages d&#039;erreurs générés par le processus dans le fichier indiqué
# en écrasant le contenu de ce fichier. &quot;2&gt;&gt;&quot; renvoie les erreurs sans écraser le contenu du fichier.
  
# Sauvegarde de &#039;/home&#039; vers la partition ext4 du disque dur externe :
rsync -av --del --stats  --filter &quot;- .thumbnails/&quot; --filter &quot;- .Trash/&quot; --filter &quot;- *.tmp&quot; --filter &quot;- *.iso&quot; --filter &quot;- lost+found/&quot; --filter &quot;- .cache/&quot; --filter &quot;- .beagle/&quot;  /home/ /media/Sauve_home/SauvHomeLieu/ 2&gt; $backup
  
# Sauvegarde du bureau (/home/votre_identité/Desktop) vers la partition ext4 du disque dur externe :
rsync -av --stats --filter &quot;- *.iso&quot; /home/votre_identité/Desktop/ /media/Sauve_home/SauvHomeLieuDesktop/ 2&gt;&gt; $backup
  
# Sauvegarde du dossier &#039;Documents&#039; (/home/votre_identité/Documents) vers la partition ext4 du disque dur externe :
rsync -av --stats --filter &quot;- *.iso&quot; /home/votre_identité/Documents/ /media/Sauve_home/SauvHomeLieuDocuments/ 2&gt;&gt; $backup
  
# Insertion de la date à la fin de la liste d&#039;erreur si le fichier backuperror n&#039;est pas vide (c&#039;est à dire s&#039;il y a des erreurs),
# ce que vérifie l&#039;option &quot;-s&quot; :
if [ -s $backup ]; then
{
  date &gt;&gt; $backup
}
fi
  
# Arrêt de l&#039;ordinateur :
# Sous LUCID :
dbus-send --print-reply --dest=org.gnome.SessionManager /org/gnome/SessionManager org.gnome.SessionManager.RequestShutdown
# Sous Intrepid (?) :
#gnome-power-cmd.sh shutdown
# Sous JAUNTY :
#gnome-power-cmd shutdown
# Sous KARMIC :
#/usr/lib/indicator-session/gtk-logout-helper --shutdown</pre>
<div class="noteimportant">Pour les ordinateurs qui sont éteints chaque jour… ou plusieurs fois par jour, l&#039;idéal est de pouvoir lancer les sauvegardes à l&#039;arrêt de l&#039;ordinateur. Les commandes d&#039;arrêt du script précédent ne sont pas universelles sous Linux. Elles fonctionnent sous Ubuntu (gnome), Xubuntu (xfce)… et sans doute pour Kde4 (ce que nous n&#039;avons pas vérifié)… Mais elles peuvent ne pas être fonctionnelles sous certains environnements. Dans ce cas, il faut la remplacer par la commande suivante :<pre class="code">sudo shutdown -P now</pre>

<p>
et suivre les indications de l&#039;étape 3 ci-dessous.
</p>

</div><div class="notetip">Note : d&#039;autres éléments de sauvegarde, en plus de /home, peuvent être intégrés dans un script comme celui-ci, par exemple des sauvegardes de documents d&#039;une partition Fat32 vers une partition de sauvegarde Fat32 :<pre class="code"># Sauvegarde de &quot;Mes Documents&quot; de hda2 vers la partition FAT32 du disque dur externe :
rsync -av --stats --filter &quot;- *.tmp&quot; --filter &quot;- *.iso&quot; /media/hda2/Mes_documents_Lieu/ /media/disk/SauvMesDocsLieu/ 2&gt;&gt; $backup
  
# Sauvegarde des profils TB et FF de hda2 vers la partition FAT32 du disque dur externe :
rsync -av --stats --filter &quot;- Trash&quot; --filter &quot;- Junk&quot; --filter &quot;- *.msf&quot; --filter &quot;- Cache/&quot; /media/hda2/ProfilsTBFF/ /media/disk/SauvProfilsTBFFLieu/ 2&gt;&gt; $backup</pre>

</div>
</div>
<div class='secedit editbutton_section editbutton_13'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[1ère étape : créer le script de sauvegarde.] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="ere_etapecreer_le_script_de_sauvegarde" /><input type="hidden" name="codeblockOffset" value="16" /><input type="hidden" name="range" value="21767-26262" /><button type="submit" title="1ère étape : créer le script de sauvegarde." class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit14" id="eme_etapecreer_le_lanceur">2ème étape : créer le lanceur</h3>
<div class="level3">

<p>
Ajouter au tableau de bord un &quot;lanceur d&#039;application personnalisé&quot; (clic droit sur celui des tableaux de bord où se trouve l&#039;icône d&#039;arrêt de l&#039;ordinateur)…
Nom du lanceur : &quot;Sauvegarde Générale + Arrêt&quot;
</p>

<p>
Commande :
</p>
<pre class="code">xterm -geometry 170x60 -sb -rightbar -hold -e /home/votre_identité/Documents/Sauvegardes/sauvegarde_generale</pre>

<p>
<em>Vous pouvez régler la taille du terminal xterm &quot;-geometry 170x60&quot; en fonction de la taille de votre écran. Pour faire défiler les données avec l&#039;ascenseur : utiliser clic droit/clic gauche.</em>
</p>

<p>
On peut utiliser une icône semblable à celle d&#039;arrêt de l&#039;ordinateur… et signifiant en même temps la sauvegarde. Il est judicieux de placer l&#039;icône de ce lanceur juste à côté de celle commandant l&#039;arrêt du PC (pour association d&#039;idée).
</p>

<p>
On a ainsi le choix pour arrêter l&#039;ordinateur :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> sans sauvegarde, clic sur l&#039;icône d&#039;arrêt de l&#039;ordinateur :<a href="/_detail/tutoriel/stop.png?id=tutoriel%3Asauvegarder_home_avec_rsync" class="media" title="tutoriel:stop.png"><img src="/_media/tutoriel/stop.png" class="media img-responsive" alt="" /></a><br/>
(ce qui permet d&#039;accéder aux autres choix habituels : Redémarrer, Hibernation, etc.)</div>
</li>
<li class="level1"><div class="li"> avec sauvegarde, clic sur l&#039;icône :<a href="/_detail/tutoriel/sauv_and_stop.png?id=tutoriel%3Asauvegarder_home_avec_rsync" class="media" title="tutoriel:sauv_and_stop.png"><img src="/_media/tutoriel/sauv_and_stop.png" class="media img-responsive" alt="" /></a><br/>
(avec dans ce cas obligatoirement l&#039;arrêt de l&#039;ordinateur).</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_14'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[2ème étape : créer le lanceur] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="eme_etapecreer_le_lanceur" /><input type="hidden" name="codeblockOffset" value="18" /><input type="hidden" name="range" value="26263-27466" /><button type="submit" title="2ème étape : créer le lanceur" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit15" id="eme_etapepermettre_le_lancement_du_shutdown_sans_mot_de_passe">3ème étape : permettre le lancement du shutdown sans mot de passe</h3>
<div class="level3">
<div class="noteimportant">Cette étape est nécessaire seulement si la commande que vous utilisez pour l&#039;arrêt de l&#039;ordinateur à la fin du script est :<pre class="code">sudo shutdown -P now</pre>

<p>
Dans, le cas contraire, vous pouvez directement passer à la 4ème étape.
En effet, si à la fin du script, la commande que vous utilisez pour arrêter l&#039;ordinateur est (Jusqu&#039;à Hardy) :
</p>
<pre class="code">gnome-power-cmd.sh shutdown </pre>

<p>
ou bien sous Jaunty :
</p>
<pre class="code">gnome-power-cmd shutdown</pre>

<p>
ou bien sous Karmic :
</p>
<pre class="code">/usr/lib/indicator-session/gtk-logout-helper --shutdown</pre>

<p>
il est inutile de modifier le fichier &quot;/etc/sudoers&quot;.
Ces commandes &quot;gnome-power-cmd.sh shutdown&quot; ou &quot;gnome-power-cmd shutdown&quot; ou &quot;/usr/lib/indicator-session/gtk-logout-helper --shutdown&quot; sont donc à préférer si l&#039;une d&#039;elle est fonctionnelle dans votre environnement.
</p>

</div>
<p>
Ceci est nécessaire pour que le script puisse arrêter l&#039;ordinateur après réalisation de la sauvegarde, si vous utilisez pour cela la commande &quot;sudo shutdown -P now&quot; dans le script.
</p>
<div class="noteclassic">Cette petite manipulation est aussi nécessaire si vous utilisez &quot;sudo shutdown&quot; dans Grsync.
</div>
<p>
[voir le manuel &#039;man shutdown&#039;, en français]
</p>

<p>
Cette commande doit être lancée par &quot;sudo&quot;… et exige donc le mot de passe à l&#039;arrêt de l&#039;ordinateur, ce qui n&#039;est pas très pratique.
</p>

<p>
Il suffit de modifier les autorisations du fichiers /etc/sudoers via la commande visudo :
</p>
<pre class="code">sudo visudo</pre>

<p>
A la fin du fichier, on ajoute ceci :
</p>
<pre class="code"># Autorisation du shutdown par l&#039;utilisateur &quot;votre_identité&quot;
  votre_identité ALL=NOPASSWD:/sbin/shutdown</pre>
<div class="noteimportant">Depuis Hardy, &quot;sudo visudo&quot; fonctionne avec l&#039;éditeur de texte <strong>vi</strong>. Pour ceux qui ne maîtrisent pas l&#039;utilisation de vi, il est possible d&#039;éditer le fichier /etc/sudoers avec <strong>nano</strong> :<pre class="code">export EDITOR=nano &amp;&amp; sudo -E visudo</pre>

<p>
ou avec <strong>gedit</strong> :
</p>
<pre class="code">export EDITOR=gedit &amp;&amp; sudo -E visudo</pre>

<p>
<em>
L&#039;option-E préserve les variables d&#039;environnement de l&#039;utilisateur.</em>
</p>

</div>
</div>
<div class='secedit editbutton_section editbutton_15'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[3ème étape : permettre le lancement du shutdown sans mot de passe] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="eme_etapepermettre_le_lancement_du_shutdown_sans_mot_de_passe" /><input type="hidden" name="codeblockOffset" value="19" /><input type="hidden" name="range" value="27467-29497" /><button type="submit" title="3ème étape : permettre le lancement du shutdown sans mot de passe" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit16" id="eme_etapecreer_un_script_nomme_signalement_erreurs">4ème étape : créer un script nommé &quot;signalement_erreurs&quot;</h3>
<div class="level3">

<p>
Ce script, lancé au démarrage, affiche le fichier backuperror au démarrage de l&#039;ordinateur si ce fichier backuperror n&#039;est pas vide.
</p>

<p>
Contenu de ce script :
</p>
<pre class="code">#!/bin/bash
# ce script est destiné à être exécuté en tâche de fond lors du démarrage de l&#039;ordinateur... Il a pour objet de signaler les éventuelles erreurs de la sauvegarde lancée lors de l&#039;arrêt précédent de l&#039;ordinateur.
#
# Pour donner un nom abrégé au fichier en indiquant le chemin correspondant.
# (&quot;backuperror.log&quot; est le fichier destiné à enregistrer les éventuelles erreurs de sauvegarde.)
backup=/home/votre_identité/Documents/Sauvegardes/backuperror.log
# Indique une action (l&#039;édition par &quot;gedit&quot;) si le fichier n&#039;est pas vide (ce que vérifie l&#039;option -s) :
if [ -s $backup ]; then
{
  gedit $backup
}
# efface le fichier pour qu&#039;il ne soit ouvert au démarrage suivant de l&#039;ordinateur que s&#039;il a été recréé avec mention d&#039;erreurs lors du déroulement de la sauvegarde suivante.
rm $backup
fi</pre>

<p>
N.B. : dans ce script, remplacez si besoin &quot;gedit&quot; par l&#039;éditeur de fichier disponible sur votre version d&#039;Ubuntu, Kubuntu, Xubuntu ou Edubuntu…
</p>

<p>
Pour que ce script soit lancé au démarrage :
<strong>Système→Préférences→Sessions→Onglet &quot;Programmes au démarrage&quot;→Ajouter→Parcourir (pour indiquer le chemin du script &quot;signalement_erreurs&quot;)→Valider</strong>
</p>

<p>
Alors, la sauvegarde se fait juste avant l&#039;arrêt de l&#039;ordinateur. Au démarrage : RAS s&#039;il n&#039;y a eu aucune erreur lors de la sauvegarde…
… mais s&#039;il y a eu la moindre erreur lors de la sauvegarde, le fichier &quot;backuperror&quot; est ouvert par gedit (ou autre éditeur de fichier).
</p>

</div>
<div class='secedit editbutton_section editbutton_16'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[4ème étape : créer un script nommé &quot;signalement_erreurs&quot;] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="eme_etapecreer_un_script_nomme_signalement_erreurs" /><input type="hidden" name="codeblockOffset" value="21" /><input type="hidden" name="range" value="29498-31213" /><button type="submit" title="4ème étape : créer un script nommé &quot;signalement_erreurs&quot;" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit17 page-header" id="verifier_le_bon_deroulement_de_l_operation_de_sauvegarde">Vérifier le bon déroulement de l&#039;opération de sauvegarde</h2>
<div class="level2">

<p>
Le paragraphe qui précède explique comment savoir s&#039;il y a eu des erreurs au cours du processus de sauvegarde dans le cas d&#039;une sauvegarde associée à l&#039;arrêt de l&#039;ordinateur. Il est possible aussi, si vous n&#039;associez pas la sauvegarde à l&#039;arrêt de l&#039;ordinateur, d&#039;être informé dans le terminal du plus ou moins bon déroulement du processus de sauvegarde.
</p>

<p>
Pour obtenir dans le terminal un message indiquant la réussite du processus de sauvegarde, ou au contraire la présence d&#039;erreurs, inspirez-vous <a href="/tutoriel/sauvegarder_home_avec_rsync#ere_etape_creer_le_script_de_sauvegarde" class="wikilink1 curid" title="tutoriel:sauvegarder_home_avec_rsync" data-curid="true">du script précédent</a>.
</p>

<p>
A la fin de ce script, remplacez la commande &quot;sudo shutdown -P now&quot; par :
</p>
<pre class="code"># Retour sur la qualité de la sauvegarde :
if [ -s $backup ]; then
{
echo &quot;Il y a eu des erreurs : consultez le fichier /home/votre_identité/Documents/Sauvegardes/backuperror.log&quot;
}
else echo &quot;Sauvegardes réussies&quot;
fi
echo &quot;Processus terminé&quot;
read</pre>

<p>
… en adaptant comme il convient le chemin de votre fichier &quot;backuperror.log&quot;.
</p>

<p>
Si vous obtenez le message &quot;Sauvegardes réussies&quot;, cela signifie que le processus s&#039;est déroulé sans erreur. Lors des premières utilisations de votre script, vérifiez cependant la qualité de vos sauvegardes en effectuant les tests qui conviennent.
</p>

</div>
<div class='secedit editbutton_section editbutton_17'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[Vérifier le bon déroulement de l&#039;opération de sauvegarde] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="verifier_le_bon_deroulement_de_l_operation_de_sauvegarde" /><input type="hidden" name="codeblockOffset" value="22" /><input type="hidden" name="range" value="31214-32587" /><button type="submit" title="Vérifier le bon déroulement de l&#039;opération de sauvegarde" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit18 page-header" id="se_resservir_de_la_sauvegarde_en_tant_quehome_en_cas_de_crash">Se resservir de la sauvegarde en tant que /home en cas de crash</h2>
<div class="level2">

<p>
En cas de crash du disque dur qui contient /home il suffirait, à priori, de remplacer le disque dur du /home par celui de la sauvegarde, et de faire certainement quelques manipulations au niveau du /etc/fstab pour que tout reparte.
</p>
<div class="noteclassic"> En cas de crash physique du /home, au lieu d&#039;intervertir les disques, il est possible d&#039;en racheter un neuf. Une fois Ubuntu réinstallé, il suffit de reprendre la ligne de commande de rsync, mais en inversant source et destination.
</div>
</div>
<div class='secedit editbutton_section editbutton_18'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[Se resservir de la sauvegarde en tant que /home en cas de crash] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="se_resservir_de_la_sauvegarde_en_tant_quehome_en_cas_de_crash" /><input type="hidden" name="codeblockOffset" value="22" /><input type="hidden" name="range" value="32588-33147" /><button type="submit" title="Se resservir de la sauvegarde en tant que /home en cas de crash" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit19 page-header" id="autres_pages_de_la_documentation_francophone_ou_du_forum_sur_les_sauvegardes_applications_et_tutoriels">Autres pages de la documentation francophone ou du forum sur les sauvegardes (applications et tutoriels)</h2>
<div class="level2">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <strong><a href="/sauvegarde" class="wikilink1" title="sauvegarde">Pages de la documentation francophone Ubuntu traitant de la sauvegarde</a></strong></div>
</li>
</ul>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <strong><a href="http://forum.ubuntu-fr.org/viewtopic.php?id=85695" class="urlextern" title="http://forum.ubuntu-fr.org/viewtopic.php?id=85695" rel="nofollow"> Sauvegardez votre système avec G4L. (Ghost for Linux 0.21)</a></strong></div>
</li>
</ul>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <strong><a href="http://forum.ubuntu-fr.org/viewtopic.php?id=124152" class="urlextern" title="http://forum.ubuntu-fr.org/viewtopic.php?id=124152" rel="nofollow"> backup de /home avec mkisofs</a></strong></div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_19'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[Autres pages de la documentation francophone ou du forum sur les sauvegardes (applications et tutoriels)] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="autres_pages_de_la_documentation_francophone_ou_du_forum_sur_les_sauvegardes_applications_et_tutoriels" /><input type="hidden" name="codeblockOffset" value="22" /><input type="hidden" name="range" value="33148-33583" /><button type="submit" title="Autres pages de la documentation francophone ou du forum sur les sauvegardes (applications et tutoriels)" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit20 page-header" id="references">Références</h2>
<div class="level2">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <strong><a href="http://www.delafond.org/traducmanfr/man/man1/rsync.1.html" class="urlextern" title="http://www.delafond.org/traducmanfr/man/man1/rsync.1.html" rel="nofollow"> Manuel de rsync en français</a></strong></div>
</li>
<li class="level1"><div class="li"> <strong><a href="http://man.developpez.com/man1/rsync.1.php" class="urlextern" title="http://man.developpez.com/man1/rsync.1.php" rel="nofollow">Manuel rsync en français sur le site du &quot;Club des développeurs&quot;</a></strong></div>
</li>
<li class="level1"><div class="li"> <strong><a href="/tutoriel/sauvegarder_home_avec_grsync" class="wikilink1" title="tutoriel:sauvegarder_home_avec_grsync">Sauvegarder home avec Grsync</a></strong></div>
</li>
<li class="level1"><div class="li"> <strong><a href="http://forum.ubuntu-fr.org/viewtopic.php?id=82232" class="urlextern" title="http://forum.ubuntu-fr.org/viewtopic.php?id=82232" rel="nofollow">Fil de discussion du forum associé à cette page de la documentation</a></strong></div>
</li>
<li class="level1"><div class="li"> Tutoriel <a href="/tutoriel/sauvegarder_home" class="wikilink1" title="tutoriel:sauvegarder_home">Comment sauvegarder son dossier utilisateur</a></div>
</li>
</ul>
<hr />

<p>
<em>Page réalisée par : <a href="/utilisateurs/sorbus" class="wikilink1" title="utilisateurs:sorbus">Sorbus</a> et <a href="/utilisateurs/soupaloignon" class="wikilink2" title="utilisateurs:soupaloignon" rel="nofollow">soupaloignon</a> avec les contributions de <a href="/utilisateurs/poupoul2" class="wikilink1" title="utilisateurs:poupoul2">poupoul2</a>, jrev, Micnight, yanemail… et des autres participants au fil de discussion dédié (31 décembre 2007)</em>
——]
</p>

</div>
<div class='secedit editbutton_section editbutton_20'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/sauvegarder_home_avec_rsync"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631054311" /><input type="hidden" name="summary" value="[Références] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="references" /><input type="hidden" name="codeblockOffset" value="22" /><input type="hidden" name="range" value="33584-" /><button type="submit" title="Références" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="tutoriel/sauvegarder_home_avec_rsync.txt">tutoriel/sauvegarder_home_avec_rsync.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 08/09/2021, 00:38">Le 08/09/2021, 00:38</span></li><li class="text-muted">par 86.215.34.61</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=tutoriel%3Asauvegarder_home_avec_rsync&amp;1635532707" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
