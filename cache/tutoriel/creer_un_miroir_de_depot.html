<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>tutoriel:creer_un_miroir_de_depot [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="bionic,tutoriel,depots"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/tutoriel/creer_un_miroir_de_depot?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns=tutoriel"/>
<link rel="edit" title="Modifier cette page" href="/tutoriel/creer_un_miroir_de_depot?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/tutoriel/creer_un_miroir_de_depot"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/tutoriel/creer_un_miroir_de_depot"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/tutoriel/creer_un_miroir_de_depot"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='tutoriel';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"tutoriel:creer_un_miroir_de_depot","namespace":"tutoriel","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="tutoriel:creer_un_miroir_de_depot">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/tutoriel/creer_un_miroir_de_depot?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/tutoriel/creer_un_miroir_de_depot?do=media&amp;ns=tutoriel"  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/tutoriel/creer_un_miroir_de_depot?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/tutoriel/creer_un_miroir_de_depot?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/tutoriel/creer_un_miroir_de_depot?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/tutoriel/creer_un_miroir_de_depot?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/tutoriel/creer_un_miroir_de_depot?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">tutoriel:creer_un_miroir_de_depot</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/tutoriel/creer_un_miroir_de_depot?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/tutoriel/creer_un_miroir_de_depot?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/tutoriel/creer_un_miroir_de_depot?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#installation_de_apt-mirror","title":"Installation de \u00ab apt-mirror \u00bb","level":1},{"link":"#preparation_de_votre_sauvegarde","title":"Pr\u00e9paration de votre sauvegarde","level":1},{"link":"#configuration_de_apt-mirror","title":"Configuration de \u00ab apt-mirror \u00bb","level":1},{"link":"#creation_du_fichier_de_configuration","title":"Cr\u00e9ation du fichier de configuration","level":2},{"link":"#recuperation_des_paquets","title":"R\u00e9cup\u00e9ration des paquets","level":1},{"link":"#utilisation_de_votre_miroir","title":"Utilisation de votre miroir","level":1},{"link":"#directement","title":"Directement","level":2},{"link":"#a_distance_en_passant_par_un_serveur","title":"\u00c0 distance, en passant par un serveur","level":2},{"link":"#par_un_serveur_web_apache","title":"Par un serveur web apache","level":2},{"link":"#enlever_votre_miroir_du_systeme","title":"Enlever votre miroir du syst\u00e8me","level":1},{"link":"#mise_a_jour_de_votre_miroir","title":"Mise \u00e0 jour de votre miroir","level":1},{"link":"#manuellement","title":"Manuellement","level":2},{"link":"#automatiquement","title":"Automatiquement","level":2},{"link":"#problemes_connus","title":"Probl\u00e8mes connus","level":1},{"link":"#erreurapt-mirror_is_already_running","title":"Erreur\u202f: apt-mirror is already running","level":2},{"link":"#fichiers_de_traduction_fr_entre_autre","title":"Fichiers de traduction FR (entre autre)","level":2},{"link":"#cas_d_une_install_party_ou_d_une_installation_par_le_reseau_netinstall","title":"Cas d'une Install Party ou d'une installation par le r\u00e9seau (netinstall)","level":1},{"link":"#mise_a_niveau_a_partir_du_depot_local_dist_upgrade","title":"Mise \u00e0 niveau \u00e0 partir du d\u00e9pot local (dist upgrade)","level":1},{"link":"#explications","title":"Explications","level":2},{"link":"#les_fichiers_utilises","title":"Les fichiers utilis\u00e9s","level":2},{"link":"#parametrage_de_l_outil_update-manager","title":"Param\u00e9trage de l\u00b4outil update-manager","level":2},{"link":"#realisation","title":"R\u00e9alisation","level":2}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level1"><a href="#installation_de_apt-mirror">Installation de « apt-mirror »</a></li>
<li class="level1"><a href="#preparation_de_votre_sauvegarde">Préparation de votre sauvegarde</a></li>
<li class="level1"><a href="#configuration_de_apt-mirror">Configuration de « apt-mirror »</a>
<ul class="nav toc">
<li class="level2"><a href="#creation_du_fichier_de_configuration">Création du fichier de configuration</a></li>
</ul>
</li>
<li class="level1"><a href="#recuperation_des_paquets">Récupération des paquets</a></li>
<li class="level1"><a href="#utilisation_de_votre_miroir">Utilisation de votre miroir</a>
<ul class="nav toc">
<li class="level2"><a href="#directement">Directement</a></li>
<li class="level2"><a href="#a_distance_en_passant_par_un_serveur">À distance, en passant par un serveur</a></li>
<li class="level2"><a href="#par_un_serveur_web_apache">Par un serveur web apache</a></li>
</ul>
</li>
<li class="level1"><a href="#enlever_votre_miroir_du_systeme">Enlever votre miroir du système</a></li>
<li class="level1"><a href="#mise_a_jour_de_votre_miroir">Mise à jour de votre miroir</a>
<ul class="nav toc">
<li class="level2"><a href="#manuellement">Manuellement</a></li>
<li class="level2"><a href="#automatiquement">Automatiquement</a></li>
</ul>
</li>
<li class="level1"><a href="#problemes_connus">Problèmes connus</a>
<ul class="nav toc">
<li class="level2"><a href="#erreurapt-mirror_is_already_running">Erreur : apt-mirror is already running</a></li>
<li class="level2"><a href="#fichiers_de_traduction_fr_entre_autre">Fichiers de traduction FR (entre autre)</a></li>
</ul>
</li>
<li class="level1"><a href="#cas_d_une_install_party_ou_d_une_installation_par_le_reseau_netinstall">Cas d&#039;une Install Party ou d&#039;une installation par le réseau (netinstall)</a></li>
<li class="level1"><a href="#mise_a_niveau_a_partir_du_depot_local_dist_upgrade">Mise à niveau à partir du dépot local (dist upgrade)</a>
<ul class="nav toc">
<li class="level2"><a href="#explications">Explications</a></li>
<li class="level2"><a href="#les_fichiers_utilises">Les fichiers utilisés</a></li>
<li class="level2"><a href="#parametrage_de_l_outil_update-manager">Paramétrage de l´outil update-manager</a></li>
<li class="level2"><a href="#realisation">Réalisation</a></li>
</ul></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content"><div class="tags"><span>
	<a href="/bionic" class="wikilink1" title="bionic" rel="tag">bionic</a>,
	<a href="/tutoriel" class="wikilink1" title="tutoriel" rel="tag">tutoriel</a>,
	<a href="/depots" class="wikilink1" title="depots" rel="tag">dépôts</a>
</span></div>
<hr />

<h1 class="sectionedit1 page-header" id="administration_systemecomment_creer_un_miroir_de_depot_sur_un_support_usb_ou_via_un_serveur_web">Administration Système : Comment créer un miroir de dépôt sur un support USB ou via un serveur web</h1>
<div class="level1">

<p>
La création d&#039;un miroir pour les paquets accessibles par votre gestionnaire de paquets va vous permettre de créer et de maintenir la copie conforme de dépôts (officiels ou non) en local. La raison principale est de ne plus avoir besoin de connexion vers le net pour pouvoir installer un paquet ou bien faire des mises à jour. C&#039;est donc une solution pratique et efficace pour une <em>install party</em>, la mise à jour d&#039;un parc de machines (dans ce cas le miroir peut être couplé avec un serveur, un proxy, etc.) ou, pour en finir, la mise à jour ou l&#039;installation chez une personne ne disposant pas d&#039;une connexion vers le net, ou dont la connexion est trop lente. Cela est particulièrement utile pour certains pays africains avec un faible accès à internet et permet d&#039;y vulgariser facilement Linux.
</p>

<p>
Ce n&#039;est donc pas une procédure à prendre à la légère, car vous allez aspirer complètement le contenu d&#039;un ou plusieurs dépôts et les stocker dans un dossier. Ce dossier peut être sur un disque dur interne ou externe et il vous faudra une connexion internet conséquente. Pour l&#039;exemple, toute une nuit à été nécessaire pour aspirer les plus de 100 Gio (sans les sources) des dépôts officiels pour la <a href="/bionic" class="wikilink1" title="bionic">18.04</a>. Après cela vous pourrez installer une Ubuntu 16.04 sur un PC sans accès à Internet, le mettre à jour et ajouter n&#039;importe quel paquet et ses dépendances du moment qu&#039;il existe sur les dépôts officiels.
</p>
<div class="noteclassic">Si votre but n&#039;est que de partager des paquets que vous avez déjà téléchargés, il vous faut regarder du coté de <em>apt-cacher</em>.
</div>
</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Administration Système : Comment créer un miroir de dépôt sur un support USB ou via un serveur web] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="administration_systemecomment_creer_un_miroir_de_depot_sur_un_support_usb_ou_via_un_serveur_web" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="41-1761" /><button type="submit" title="Administration Système : Comment créer un miroir de dépôt sur un support USB ou via un serveur web" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit2 page-header" id="installation_de_apt-mirror">Installation de « apt-mirror »</h2>
<div class="level2">

<p>
<em>Apt-mirror</em> est le logiciel qui vous permet de créer le miroir des dépôts, pour l&#039;utiliser c&#039;est très simple, il suffit d&#039;<a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer le paquet</a> <strong><a href="apt://apt-mirror" class="interwiki iw_apt" title="apt://apt-mirror">apt-mirror</a></strong>.
</p>

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Installation de « apt-mirror »] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation_de_apt-mirror" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="1762-2023" /><button type="submit" title="Installation de « apt-mirror »" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit3 page-header" id="preparation_de_votre_sauvegarde">Préparation de votre sauvegarde</h2>
<div class="level2">

<p>
Dans l&#039;exemple qui suit, vous allez configurer un disque dur usb. Mais un autre emplacement est possible tant que vous en connaissez le chemin complet. Cela peut donc être un simple dossier dans votre compte utilisateur. Suivez les étapes suivantes:
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Avec <a href="/gparted" class="wikilink1" title="gparted">gparted</a> par exemple, commencez par créer une partition en <em>ext4</em> sur votre disque, et donnez-lui l&#039;étiquette <em>Depots</em>. Respectez bien la casse. Pensez à créer une partition avec une taille suffisamment grande pour recevoir tous les dépôts,</div>
</li>
<li class="level1"><div class="li"> Une fois la partition créée monter votre disque, et donnez-lui les droits comme suit: <pre class="code">sudo chown $USER /media/$USER/Depots</pre>
</div>
</li>
<li class="level1"><div class="li"> Créez un dossier <em>miroir</em> sur le disque <em>Depots</em>, avec cette commande par exemple: <pre class="code">mkdir /media/$USER/Depots/miroir</pre>
</div>
</li>
<li class="level1"><div class="li"> Dans celui-ci, nous avons besoin de créer 3 sous-dossiers afin que <em>apt-mirror</em> puisse fonctionner :<pre class="code">mkdir -p /media/$USER/Depots/miroir/{mirror,skel,var}</pre>

<p>
. Ces répertoires peuvent être tout aussi bien créés en utilisant <a href="/nautilus" class="wikilink1" title="nautilus">Nautilus</a> et sa possibilité de créer des dossiers.
</p>
</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Préparation de votre sauvegarde] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="preparation_de_votre_sauvegarde" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="2024-3168" /><button type="submit" title="Préparation de votre sauvegarde" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit4 page-header" id="configuration_de_apt-mirror">Configuration de « apt-mirror »</h2>
<div class="level2">

<p>
Par défaut, <em>apt-mirror</em> utilise son propre fichier de configuration : <strong>/etc/apt/mirror.list</strong>.
</p>

<p>
Soit vous modifiez ce fichier, ce qui me semble être la bonne solution dans le cas d&#039;un serveur, soit vous en créez un nouveau que vous sauvegarderez dans votre miroir. Il vous faudra néanmoins dans ce cas, spécifier à <em>apt-mirror</em> d&#039;utiliser votre propre fichier de configuration comme ceci : 
</p>
<pre class="code">sudo apt-mirror /media/$USER/Depots/miroir/apt-mirror-configuration</pre>

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Configuration de « apt-mirror »] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration_de_apt-mirror" /><input type="hidden" name="codeblockOffset" value="3" /><input type="hidden" name="range" value="3169-3701" /><button type="submit" title="Configuration de « apt-mirror »" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit5" id="creation_du_fichier_de_configuration">Création du fichier de configuration</h3>
<div class="level3">

<p>
Tout d&#039;abord copiez le fichier original dans votre répertoire : 
</p>
<pre class="code">sudo cp /etc/apt/mirror.list /media/$USER/Depots/miroir/apt-mirror-configuration</pre>

<p>
<a href="/tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">Éditez le fichier</a> « /media/$USER/Depots/miroir/apt-mirror-configuration » (votre fichier de configuration) afin que celui-ci contienne :
</p>
<pre class="file">############# config ##################
#
set base_path /media/$USER/Depots/miroir
## Dans le cas d&#039;un serveur web gardez le chemin par défaut (celui qui suit) ##
#set base_path    /var/spool/apt-mirror
# if you change the base path you must create the directories below with write privileges
#
set mirror_path  $base_path/mirror
set skel_path    $base_path/skel
set var_path     $base_path/var
set cleanscript $var_path/clean.sh
## set defaultarch xxxx (votre architecture i386/hppa/powerPC/ia64...)
set defaultarch  i386
set postmirror_script $base_path/postmirror.sh
set run_postmirror 0
set nthreads     10
set _tilde 0
#
############# end config ##############

######################################################
##        UBUNTU VERSION Bionic Beaver - 18.04      ##
##                i386 - 32bits                     ##
######################################################

##  Dépôts officiels  ##
deb http://fr.archive.ubuntu.com/ubuntu bionic main restricted
deb http://security.ubuntu.com/ubuntu bionic-security main restricted

## Major bug fix updates produced after the final release of the
## distribution.
deb http://fr.archive.ubuntu.com/ubuntu bionic-updates main restricted

##  Dépôts Universe et Multiverse  ##
deb http://fr.archive.ubuntu.com/ubuntu/ bionic universe
deb http://fr.archive.ubuntu.com/ubuntu/ bionic-updates universe
deb http://security.ubuntu.com/ubuntu bionic-security universe
deb http://fr.archive.ubuntu.com/ubuntu/ bionic multiverse
deb http://fr.archive.ubuntu.com/ubuntu/ bionic-updates multiverse
deb http://security.ubuntu.com/ubuntu bionic-security multiverse

##  Dépôts Backports  ##
deb http://fr.archive.ubuntu.com/ubuntu/ bionic-backports main restricted universe multiverse

## Dépôt commercial  ##
deb http://archive.canonical.com/ubuntu bionic partner

## Uncomment the following two lines to add software from Ubuntu&#039;s &#039;extras&#039; repository.##
deb http://extras.ubuntu.com/ubuntu bionic main

####################################################
##     UBUNTU VERSION bionic Beaver - 18.04       ##
##                AMD-64 - 64bits                 ##
####################################################

##  Dépôts officiels  ##
deb-amd64 http://fr.archive.ubuntu.com/ubuntu/ bionic main restricted
deb-amd64 http://security.ubuntu.com/ubuntu bionic-security main restricted

## Major bug fix updates produced after the final release of the
## distribution.
deb-amd64 http://fr.archive.ubuntu.com/ubuntu/ bionic-updates main restricted

##  Dépôts Universe et Multiverse  ##
deb-amd64 http://fr.archive.ubuntu.com/ubuntu/ bionic universe
deb-amd64 http://security.ubuntu.com/ubuntu bionic-security universe
deb-amd64 http://fr.archive.ubuntu.com/ubuntu/ bionic-updates universe
deb-amd64 http://fr.archive.ubuntu.com/ubuntu/ bionic multiverse
deb-amd64 http://security.ubuntu.com/ubuntu bionic-security multiverse
deb-amd64 http://fr.archive.ubuntu.com/ubuntu/ bionic-updates multiverse

##  Dépôts Backports  ##
deb-amd64 http://fr.archive.ubuntu.com/ubuntu/ bionic-backports main restricted universe multiverse

## Dépôt commercial  ##
deb-amd64 http://archive.canonical.com/ubuntu bionic partner

## Uncomment the following two lines to add software from Ubuntu&#039;s &#039;extras&#039; repository.##
deb-amd64 http://extras.ubuntu.com/ubuntu bionic main

####################################################
##     UBUNTU VERSION Bionic Beaver - 18.04       ##
##               Sources                          ##
####################################################

#deb-src http://fr.archive.ubuntu.com/ubuntu/ bionic main restricted
#deb-src http://fr.archive.ubuntu.com/ubuntu/ bionic-updates main restricted
#deb-src http://fr.archive.ubuntu.com/ubuntu/ bionic universe
#deb-src http://fr.archive.ubuntu.com/ubuntu/ bionic-updates universe
#deb-src http://fr.archive.ubuntu.com/ubuntu/ bionic multiverse
#deb-src http://fr.archive.ubuntu.com/ubuntu/ bionic-updates multiverse
#deb-src http://fr.archive.ubuntu.com/ubuntu/ bionic-backports main restricted universe multiverse
#deb-src http://security.ubuntu.com/ubuntu bionic-security main restricted
#deb-src http://security.ubuntu.com/ubuntu bionic-security universe
#deb-src http://archive.canonical.com/ubuntu bionic partner
#deb-src http://extras.ubuntu.com/ubuntu bionic main


############# clean ##############

clean http://fr.archive.ubuntu.com/ubuntu/ bionic
clean http://security.ubuntu.com/ubuntu bionic-security
clean http://archive.canonical.com/ubuntu bionic
clean http://extras.ubuntu.com/ubuntu bionic</pre>

<p>
Les lignes dont vous devez vous soucier sont :
</p>
<pre class="file">set base_path /media/$USER/Depots/miroir</pre>

<p>
Elle est à adapter à votre cas. Si vous utilisez un serveur apache, gardez le chemin par défaut:
</p>
<pre class="file">set base_path    /var/spool/apt-mirror</pre>

<p>
Cette ligne : 
</p>
<pre class="file">set defaultarch i386</pre>

<p>
 précise que je ne désire récupérer que les paquets pour l&#039;architecture i386. (Par défaut identique à l&#039;architecture de la machine)
</p>

<p>
Si vous voulez avoir plusieurs architectures dans votre miroir il suffit de le préciser dans les dépôts. Le fichier <em> apt-mirror-configuration</em> qui suit contient dépôts pour les architecture 32 et 64 bits. Les sources sont aussi présentes, elles ne seront téléchargées que si vous décommenter les lignes où vous avez <em>deb-src</em> (enlever les #).
Quelques explications : <strong>deb</strong> seul revient à dire deb-i386, car c&#039;est l&#039;architecture de base dans la configuration, tandis que pour les autres, il faut le déclarer avec <strong>deb-amd64</strong> deb-&#039;autre-architecture&#039;.
</p>

<p>
Viennent ensuite les lignes qui précisent quels sont les dépôts dont je souhaite faire une copie. Ces lignes sont celles par défaut pour l&#039;installation d&#039;une bionic, libre à vous de les modifier et/ou d&#039;en ajouter. Il faudra cependant en tenir compte lors de l&#039;intégration de votre miroir (voir la section « Utilisation de votre miroir »).
Les lignes qui suivent la section &quot;clean&quot; vous permettront de supprimer les paquets obsolètes de votre miroir, il faut les rentrer pour chaque adresse voulue (idéalement toutes). Il faudra par la suite lancer le script <em>clean.sh</em> présent dans le dossier où sont téléchargé les paquets (dossier miroir) pour la suppression, ou bien passer par le script postmirror.sh (à créer). Toutes ces informations sont détaillées sur la sortie du terminal.
</p>

<p>
Sauvegardez votre fichier. En principe dans «<em> /media/$USER/Depots/miroir</em> ».
</p>

</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Création du fichier de configuration] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="creation_du_fichier_de_configuration" /><input type="hidden" name="codeblockOffset" value="4" /><input type="hidden" name="range" value="3702-10558" /><button type="submit" title="Création du fichier de configuration" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit6 page-header" id="recuperation_des_paquets">Récupération des paquets</h2>
<div class="level2">

<p>
Lancez la création de votre miroir par :
</p>
<pre class="code">sudo apt-mirror /media/$USER/Depots/miroir/apt-mirror-configuration</pre>

<p>
Rappellez-vous que si vous ne passez pas de fichier de configuration à la commande <em>apt-mirror</em>, c&#039;est celui par défaut qui sera utilisé (« /etc/apt/mirror.list »), comme pour un serveur web avec apache, la commande est alors celle-ci:
</p>
<pre class="code">su - apt-mirror -c apt-mirror</pre>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Dans un premier temps <em>apt-mirror</em> récupère la liste du contenu des miroirs demandés.</div>
</li>
<li class="level1"><div class="li"> Dans un second temps <em>apt-mirror</em> vous indique la taille totale des paquets qu&#039;il lui faut télécharger (dans notre fichier d&#039;exemple cela représente environ 100 Gio pour les dépôts officiels bionic sans les sources). Voilà ce que vous verrez dans votre <a href="/terminal" class="wikilink1" title="terminal">terminal</a>: <pre class="code">ubuntu@ubuntu:~$ sudo apt-mirror /media/Depots/bionic/apt-mirror-config
[sudo] password for ubuntu:
Downloading 144 index files using 10 threads...
Begin time: Tue Jun 24 10:29:28 2014
[10]... [9]... [8]... [7]... [6]... [5]... [4]... [3]... [2]... [1]... [0]...
End time: Tue Jun 24 10:29:34 2014

Proceed indexes: [PPPPPPPPPPPPPPPPPPPPPPPP]

90.8 GiB will be downloaded into archive.
Downloading 63505 archive files using 10 threads...
Begin time: Tue Jun 24 10:31:16 2014
[10]... [9]... [8]... [7]... [6]... [5]... [4]... [3]... [2]... [1]... [0]...
End time: Thu Jun 26 08:54:50 2014

93.9 MiB in 267 files and 0 directories can be freed.
Run /media/Depots/bionic/clean.sh for this purpose.</pre>
</div>
</li>
<li class="level1"><div class="li"> Vous pouvez aller boire plusieurs cafés, même manger et dormir… à moins de disposer d&#039;une connexion de folie. <img src="/lib/images/smileys/icon_wink.gif" class="icon" alt=";-)" /></div>
</li>
</ul>

<p>
Si vous voulez surfer sur le net en même temps vous devriez installer <a href="/qos" class="wikilink1" title="qos">wondershaper</a> sur votre miroir.
</p>

<p>
Vous pouvez également ajouter:
</p>
<pre class="code"> set limit_rate 500k</pre>

<p>
 à votre fichier de configuration de apt-mirror
</p>

<p>
Si vous passez par un proxy et que vous obtenez le message :
</p>
<pre class="code">Proceed indexes: [Psh: cannot open archive.ubuntu.com/ubuntu//dists/bionic/main/binary-i386/Packages.gz: No such file
  apt-mirror: can&#039;t open index in proceed_index_gz at /usr/bin/apt-mirror line 390.</pre>

<p>
Veuillez vérifier les lignes suivantes dans le fichier <strong>wgetrc</strong>:
</p>
<pre class="code"> vi /etc/wgetrc</pre>
<pre class="file">  http_proxy ==/pre&gt;</pre>

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Récupération des paquets] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="recuperation_des_paquets" /><input type="hidden" name="codeblockOffset" value="9" /><input type="hidden" name="range" value="10559-12851" /><button type="submit" title="Récupération des paquets" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit7 page-header" id="utilisation_de_votre_miroir">Utilisation de votre miroir</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Utilisation de votre miroir] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="utilisation_de_votre_miroir" /><input type="hidden" name="codeblockOffset" value="16" /><input type="hidden" name="range" value="12852-12892" /><button type="submit" title="Utilisation de votre miroir" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit8" id="directement">Directement</h3>
<div class="level3">

<p>
Vous avez donc un disque dur externe contenant un miroir de nos dépôts préférés.  Comment le faire prendre en compte par le système afin que celui-ci utilise votre  miroir plutôt qu&#039;en passant par le net ?
</p>

<p>
Il faut modifier le fichier de configuration des sources du système (« /etc/apt/sources.list ») afin de lui indiquer d&#039;utiliser notre miroir.
Pour ce faire nous allons ouvrir un terminal et :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Faites une sauvegarde de ce fichier :<pre class="code">sudo cp /etc/apt/sources.list /etc/apt/sources.list.ORIGINAL</pre>
</div>
</li>
<li class="level1"><div class="li"> <a href="/tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">Ouvrez le fichier</a> « /etc/apt/sources.list ».</div>
</li>
<li class="level1"><div class="li"> Supprimez-en tout le contenu,</div>
</li>
<li class="level1"><div class="li"> Ajoutez (en remplaçant <em>$USER</em> par votre nom d&#039;utilisateur) :<pre class="file">deb file:/media/$USER/Depots/miroir/mirror/archive.ubuntu.com/ubuntu/ bionic main restricted multiverse universe
deb file:/media/$USER/Depots/miroir/mirror/archive.ubuntu.com/ubuntu/ bionic-updates main restricted multiverse universe
deb file:/media/$USER/Depots/miroir/mirror/archive.ubuntu.com/ubuntu/ bionic-security main restricted multiverse universe
deb file:/media/$USER/Depots/miroir/mirror/archive.ubuntu.com/ubuntu/ bionic-backports main restricted universe multiverse</pre>

<p>
Ces 4 lignes sont celles des dépôts officiels, se trouvant dans le fichier de configuration de <em>apt-mirror</em> (« /media/$USER/Depots/miroir/apt-mirror-configuration »). Vous pouvez aussi ajoutez les autres dépôts, en respectant bien le chemin. 
</p>
</div>
</li>
<li class="level1"><div class="li"> Sauvegardez votre fichier.</div>
</li>
<li class="level1"><div class="li"> Mettez à jour votre système de gestion de paquet :<pre class="code">sudo apt-get update</pre>
</div>
</li>
<li class="level1"><div class="li"> Désormais votre système utilise uniquement votre miroir. Vous pouvez donc faire vos manipulations, installations ou mises à jour de la manière dont vous le souhaitez.</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Directement] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="directement" /><input type="hidden" name="codeblockOffset" value="16" /><input type="hidden" name="range" value="12893-14671" /><button type="submit" title="Directement" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit9" id="a_distance_en_passant_par_un_serveur">À distance, en passant par un serveur</h3>
<div class="level3">

</div>

<h4 id="cote_serveur">Côté serveur</h4>
<div class="level4">

<p>
Un petit serveur HTTP vous suffit pour ce que vous avez à faire, inutile d&#039;installer et configurer une artillerie lourde comme Apache2. Python est notre ami ! Cependant si vous souhaitez tout de même utiliser apache regardez <a href="#par_un_serveur_web_apache" title="tutoriel:creer_un_miroir_de_depot ↵" class="wikilink1">ci-dessous</a>.
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Ouvrez une <a href="/terminal" class="wikilink1" title="terminal">terminal</a>, placez-vous dans le dossier qui sera la racine de votre serveur: <pre class="code">cd /media/$USER/Depots/miroir/</pre>
</div>
</li>
<li class="level1"><div class="li"> Entrez la commande magique :<pre class="code">  python -m SimpleHTTPServer 80 &amp;</pre>
</div>
</li>
<li class="level1"><div class="li"> Sous Focal Fossa (20.04) la commande est :<pre class="code"> python3 -m http.server 80 &amp;</pre>
</div>
</li>
</ul>

<p>
Le numéro en fin de commande (ici 80) est le port sur lequel tournera notre mini-serveur HTTP. Ce port doit être modifié (par exemple remplacé par 1234) si un autre serveur HTTP tourne sur la machine. 
Sous Focal Fossa, le port par défaut est 8000.
</p>

<p>
On peut tester son bon fonctionnement en se rendant sur <a href="http://localhost/" class="urlextern" title="http://localhost/" rel="nofollow">http://localhost/</a> si le port choisi est 80, ou sur <a href="http://localhost:1234/" class="urlextern" title="http://localhost:1234/" rel="nofollow">http://localhost:1234/</a> si le port choisi est 1234.
On y découvre ses dossiers et fichiers présents dans le <em>miroir</em>.
</p>

</div>

<h4 id="cote_client">Côté client</h4>
<div class="level4">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> sauvegardez le fichier de configuration: <pre class="code">sudo cp /etc/apt/sources.list /etc/apt/sources.list.ORIGINAL</pre>
</div>
</li>
<li class="level1"><div class="li"> <a href="/tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">Ouvrez le fichier</a> « /etc/apt/sources.list » afin de le faire pointer vers notre serveur.</div>
</li>
</ul>

<p>
Là où vous avez une ligne du style:
</p>
<pre class="file">deb http://fr.archive.ubuntu.com/ubuntu/ bionic-updates main restricted multiverse universe</pre>

<p>
vous allez devoir remplacer l&#039;adresse internet du serveur original par celui que vous avez spécialement installé. Si mon serveur est sur l&#039;adresse 192.168.0.1 je modifie ma ligne et j&#039;obtiens :
</p>
<pre class="file">deb http://192.168.0.1/mirror/fr.archive.ubuntu.com/ubuntu/ bionic-updates main restricted multiverse universe</pre>

<p>
On fait cette manipulation pour chaque entrée ou ligne et on sauvegarde.
</p>
<div class="notetip">Remplacez 192.168.0.1 par 192.168.0.1<strong>:1234</strong> si votre serveur HTTP tourne sur le port 1234.
</div>
<p>
On fait prendre en compte le nouveau fichier de configuration par un :
</p>
<pre class="code">sudo apt-get update</pre>

<p>
et vous voilà prêt à utiliser votre miroir et serveur local.
</p>

</div>
<div class='secedit editbutton_section editbutton_9'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[À distance, en passant par un serveur] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="a_distance_en_passant_par_un_serveur" /><input type="hidden" name="codeblockOffset" value="19" /><input type="hidden" name="range" value="14672-16909" /><button type="submit" title="À distance, en passant par un serveur" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit10" id="par_un_serveur_web_apache">Par un serveur web apache</h3>
<div class="level3">

<p>
La procédure est la même que <a href="#a_distance_en_passant_par_un_serveur" title="tutoriel:creer_un_miroir_de_depot ↵" class="wikilink1">ci-dessus</a> à l&#039;exception de ce qui suit. 
</p>

</div>

<h4 id="cote_serveur1">Côté serveur</h4>
<div class="level4">

<p>
Commencez par <a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer le paquet</a> <strong><a href="apt://apache2" class="interwiki iw_apt" title="apt://apache2">apache2</a></strong>.
Puis créez un lien symbolique pour que le dépôt soit accessible via le serveur web :
</p>
<pre class="code">ln -s /var/spool/apt-mirror/mirror/ /var/www/ubuntu</pre>

<p>
On peut tester le bon fonctionnement en se rendant via un navigateur web sur l&#039;adresse IP de notre dépôt.
</p>

</div>
<div class='secedit editbutton_section editbutton_10'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Par un serveur web apache] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="par_un_serveur_web_apache" /><input type="hidden" name="codeblockOffset" value="26" /><input type="hidden" name="range" value="16910-17442" /><button type="submit" title="Par un serveur web apache" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit11 page-header" id="enlever_votre_miroir_du_systeme">Enlever votre miroir du système</h2>
<div class="level2">

<p>
Avant de partir il vous faut restaurer la configuration initiale du système de paquet. Il vous faut donc remettre en état le système.
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Sauvegardez votre fichier modifié :<pre class="code">sudo cp /etc/apt/sources.list /etc/apt/sources.list.MIROIR</pre>
</div>
</li>
<li class="level1"><div class="li"> Remise en place du fichier original :<pre class="code">sudo rm /etc/apt/sources.list
sudo cp /etc/apt/sources.list.ORIGINAL /etc/apt/sources.list</pre>
</div>
</li>
<li class="level1"><div class="li"> Prise en compte de celui-ci par le système :<pre class="code">sudo apt-get update</pre>
</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_11'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Enlever votre miroir du système] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="enlever_votre_miroir_du_systeme" /><input type="hidden" name="codeblockOffset" value="27" /><input type="hidden" name="range" value="17443-17966" /><button type="submit" title="Enlever votre miroir du système" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit12 page-header" id="mise_a_jour_de_votre_miroir">Mise à jour de votre miroir</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_12'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Mise à jour de votre miroir] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="mise_a_jour_de_votre_miroir" /><input type="hidden" name="codeblockOffset" value="30" /><input type="hidden" name="range" value="17967-18008" /><button type="submit" title="Mise à jour de votre miroir" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit13" id="manuellement">Manuellement</h3>
<div class="level3">

<p>
Il suffit pour cela de relancer <em>apt-mirror</em> avec votre fichier de configuration et votre disque dur externe en place (ou votre miroir accessible selon le chemin indiqué dans la configuration de <em>apt-mirror</em>) :
</p>
<pre class="code"> apt-mirror /media/$USER/Depots/miroir/apt-mirror-configuration</pre>

</div>
<div class='secedit editbutton_section editbutton_13'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Manuellement] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="manuellement" /><input type="hidden" name="codeblockOffset" value="30" /><input type="hidden" name="range" value="18009-18324" /><button type="submit" title="Manuellement" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit14" id="automatiquement">Automatiquement</h3>
<div class="level3">

<p>
Tout est prêt. Il suffit juste de <a href="/tutoriel/comment_modifier_un_fichier" class="wikilink1" title="tutoriel:comment_modifier_un_fichier">décommenter une ligne dans le fichier</a> <strong>« /etc/cron.d/apt-mirror »</strong>, pour cela on enlève le « # » de la ligne :
</p>
<pre class="file">#0 4	* * *	apt-mirror	/usr/bin/apt-mirror &gt; /var/spool/apt-mirror/var/cron.log</pre>

<p>
On ajoute le fichier de configuration si celui-ci n&#039;est pas celui par défaut et on en profite pour modifier l&#039;heure afin d&#039;obtenir :
</p>
<pre class="file">0 13	* * *	apt-mirror	/usr/bin/apt-mirror /media/$USER/Depots/miroir/apt-mirror-configuration &gt; /var/spool/apt-mirror/var/cron.log</pre>

<p>
On sauvegarde et c&#039;est tout. Tous les jours, à 13 heures, le miroir se mettra à jour. <img src="/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />
</p>

<p>
Dans cet exemple, comme <em>/usr/bin/apt-mirror</em> est lancé en tant qu&#039;utilisateur <em>apt-mirror</em> il faut que les répertoires du miroir soient modifiables par cet utilisateur :
</p>
<pre class="code">sudo chown -R apt-mirror /media/$USER/Depots/miroir/{mirror,skel,var}</pre>

<p>
<a href="/cron" class="wikilink1" title="cron">Plus d&#039;informations sur Cron...</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_14'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Automatiquement] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="automatiquement" /><input type="hidden" name="codeblockOffset" value="31" /><input type="hidden" name="range" value="18325-19317" /><button type="submit" title="Automatiquement" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit15 page-header" id="problemes_connus">Problèmes connus</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_15'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Problèmes connus] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="problemes_connus" /><input type="hidden" name="codeblockOffset" value="34" /><input type="hidden" name="range" value="19318-19346" /><button type="submit" title="Problèmes connus" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit16" id="erreurapt-mirror_is_already_running">Erreur : apt-mirror is already running</h3>
<div class="level3">

<p>
L&#039;erreur suivante s&#039;affiche dans votre terminal: 
</p>
<pre class="code">apt-mirror is already running, exiting at /usr/bin/apt-mirror line 187.</pre>

<p>
La solution est de supprimer le fichier <code>apt-mirror.lock</code>: 
</p>
<pre class="code">rm -f /media/$USER/Depots/mirror/var/apt-mirror.lock</pre>

</div>
<div class='secedit editbutton_section editbutton_16'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Erreur : apt-mirror is already running] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="erreurapt-mirror_is_already_running" /><input type="hidden" name="codeblockOffset" value="34" /><input type="hidden" name="range" value="19347-19657" /><button type="submit" title="Erreur : apt-mirror is already running" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit17" id="fichiers_de_traduction_fr_entre_autre">Fichiers de traduction FR (entre autre)</h3>
<div class="level3">

<p>
Ce bug est répertorié sur le <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=932379" class="urlextern" title="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=932379" rel="nofollow">bug tracker</a> debian en septembre 2019
</p>

<p>
<a href="/tutoriel/comment_modifier_un_fichier" class="wikilink1" title="tutoriel:comment_modifier_un_fichier">Éditer le fichier</a> <strong>/usr/bin/apt-mirror</strong> avec les droits d&#039;administration et aller à la ligne 523: 
</p>
<pre class="code file bash"><span class="kw1">if</span> <span class="br0">&#40;</span> <span class="re1">$filename</span> =~ m<span class="br0">&#123;</span>^<span class="re1">$component</span><span class="sy0">/</span>i18n<span class="sy0">/</span>Translation-<span class="br0">&#91;</span>^.<span class="sy0">/</span><span class="br0">&#93;</span><span class="sy0">*</span>\.bz2$<span class="br0">&#125;</span> <span class="br0">&#41;</span></pre>

<p>
 pour la modifier comme suit: 
</p>
<pre class="code file bash"><span class="kw1">if</span> <span class="br0">&#40;</span> <span class="re1">$filename</span> =~ m<span class="br0">&#123;</span>^<span class="re1">$component</span><span class="sy0">/</span>i18n<span class="sy0">/</span>Translation-<span class="br0">&#91;</span>^.<span class="sy0">/</span><span class="br0">&#93;</span><span class="sy0">*</span>\.<span class="br0">&#40;</span>gz<span class="sy0">|</span>bz2<span class="sy0">|</span>xz<span class="br0">&#41;</span>$<span class="br0">&#125;</span> <span class="br0">&#41;</span></pre>

</div>
<div class='secedit editbutton_section editbutton_17'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Fichiers de traduction FR (entre autre)] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="fichiers_de_traduction_fr_entre_autre" /><input type="hidden" name="codeblockOffset" value="36" /><input type="hidden" name="range" value="19658-20186" /><button type="submit" title="Fichiers de traduction FR (entre autre)" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit18 page-header" id="cas_d_une_install_party_ou_d_une_installation_par_le_reseau_netinstall">Cas d&#039;une Install Party ou d&#039;une installation par le réseau (netinstall)</h2>
<div class="level2">

<p>
Dans le cas d&#039;une Install Party, pensez à ajouter aussi les dépôts &quot;debian-installer&quot; nécessaires pour une <a href="/tutoriel/installer_ubuntu_par_internet" class="wikilink1" title="tutoriel:installer_ubuntu_par_internet">netinstall</a>: 
</p>

<p>
Pour information si vous souhaitez utiliser votre dépôt pour faire vos installation d’Ubuntu en local (netinstall) ajoutez ou ou remplacer ces lignes, pour toutes les architectures souhaités (dans notre exemple :  i386 et amd64 soit deb et deb-amd64):
</p>
<pre class="file">## Dépôts officiels ##
deb http://fr.archive.ubuntu.com/ubuntu bionic main/debian-installer restricted/debian-installer universe/debian-installer multiverse/debian-installer
deb http://archive.ubuntu.com/ubuntu bionic-updates      main/debian-installer restricted/debian-installer universe/debian-installer
deb http://archive.ubuntu.com/ubuntu bionic-backports    main/debian-installer
deb http://archive.ubuntu.com/ubuntu bionic-security     main/debian-installer restricted/debian-installer universe/debian-installer


## Dépôts officiels ##
deb-amd64 http://fr.archive.ubuntu.com/ubuntu bionic main/debian-installer restricted/debian-installer universe/debian-installer multiverse/debian-installer
deb-amd64 http://archive.ubuntu.com/ubuntu bionic-updates      main/debian-installer restricted/debian-installer universe/debian-installer
deb-amd64 http://archive.ubuntu.com/ubuntu bionic-backports    main/debian-installer
deb-amd64 http://archive.ubuntu.com/ubuntu bionic-security     main/debian-installer restricted/debian-installer universe/debian-installer</pre>
<div class="noteclassic"><em>Apt-mirror</em> génère des fichiers de log. Ils se trouvent dans <strong>/var</strong> à la racine du dossier de votre dépôt. (dans le chemin que vous avez paramétré dans votre mirror.list : <strong>set base_path /media/$USER/Depots/miroir</strong>, dans le début du tuto).
</div>
</div>
<div class='secedit editbutton_section editbutton_18'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Cas d&#039;une Install Party ou d&#039;une installation par le réseau (netinstall)] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="cas_d_une_install_party_ou_d_une_installation_par_le_reseau_netinstall" /><input type="hidden" name="codeblockOffset" value="38" /><input type="hidden" name="range" value="20187-22053" /><button type="submit" title="Cas d&#039;une Install Party ou d&#039;une installation par le réseau (netinstall)" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit19 page-header" id="mise_a_niveau_a_partir_du_depot_local_dist_upgrade">Mise à niveau à partir du dépot local (dist upgrade)</h2>
<div class="level2">

<p>
La dernière version d&#039;Ubuntu est téléchargée sur le miroir, mais vos poste(s) client(s) ne voi(en)t pas qu´il y a à disposition une version de mise à jour de la distribution (Mise à jour de precise vers bionic par exemple).
Avec une connexion permanente à internet, le logiciel de mise à jour (update-manager) propose la mise à disposition de la nouvelle version d&#039;Ubuntu disponible <strong>mais pas avec un dépôt local sans connexion à internet</strong>. Ce qui suit va vous expliquer comment le faire fonctionner.
</p>

</div>
<div class='secedit editbutton_section editbutton_19'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Mise à niveau à partir du dépot local (dist upgrade)] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="mise_a_niveau_a_partir_du_depot_local_dist_upgrade" /><input type="hidden" name="codeblockOffset" value="39" /><input type="hidden" name="range" value="22054-22639" /><button type="submit" title="Mise à niveau à partir du dépot local (dist upgrade)" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit20" id="explications">Explications</h3>
<div class="level3">

<p>
Le logiciel d´installation des paquets <em>update-manager</em> consulte les fichiers <em>meta-release</em>, <em>meta-release-lts</em> et <em>meta-release-proposed</em> situés à l&#039;adresse <a href="http://changelogs.ubuntu.com/" class="urlextern" title="http://changelogs.ubuntu.com/" rel="nofollow">http://changelogs.ubuntu.com/</a> et affiche une fenêtre de mise à jour si une nouvelle version est disponible. 
</p>

<p>
Dans le cas de votre miroir ces fichiers ne sont pas téléchargées lors des opérations précédentes, voilà pourquoi <em>update-manager</em> ne dit rien! Vous allez devoir récupérer les bons fichiers et configurer l´environnement de <em>update-manager</em> pour notre miroir.
</p>

</div>
<div class='secedit editbutton_section editbutton_20'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Explications] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="explications" /><input type="hidden" name="codeblockOffset" value="39" /><input type="hidden" name="range" value="22640-23223" /><button type="submit" title="Explications" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit21" id="les_fichiers_utilises">Les fichiers utilisés</h3>
<div class="level3">

<p>
Voici le contenu du fichier <em>meta-release-lts-proposed</em>:
</p>
<pre class="file">Dist: xenial
Name: Xenial Xerus
Version: 14.04.4 LTS
Date: Thu, 26 Apr 2016 12:04:00 UTC
Supported: 1
Description: This is the 16.04.4 LTS release
Release-File: http://archive.ubuntu.com/ubuntu/dists/xenial/Release
ReleaseNotes: http://archive.ubuntu.com/ubuntu/dists/xenial-updates/main/dist-upgrader-all/current/ReleaseAnnouncement
ReleaseNotesHtml: http://archive.ubuntu.com/ubuntu/dists/xenial-updates/main/dist-upgrader-all/current/ReleaseAnnouncement.html
UpgradeTool: http://archive.ubuntu.com/ubuntu/dists/xenial-updates/main/dist-upgrader-all/current/precise.tar.gz
UpgradeToolSignature: http://archive.ubuntu.com/ubuntu/dists/xenial-updates/main/dist-upgrader-all/current/xenial.tar.gz.gpg
  
Dist: bionic
Name: Bionic Beaver
Version: 18.04
Date: Thu, 17 Apr 2018 14:04:00 UTC
Supported: 1
Description: This is the 16.04 release
Release-File: http://archive.ubuntu.com/ubuntu/dists/bionic/Release
ReleaseNotes: http://archive.ubuntu.com/ubuntu/dists/bionic/main/dist-upgrader-all/current/ReleaseAnnouncement
ReleaseNotesHtml: http://archive.ubuntu.com/ubuntu/dists/bionic/main/dist-upgrader-all/current/ReleaseAnnouncement.html
UpgradeTool: http://archive.ubuntu.com/ubuntu/dists/bionic/main/dist-upgrader-all/current/bionic.tar.gz
UpgradeToolSignature: http://archive.ubuntu.com/ubuntu/dists/bionic/main/dist-upgrader-all/current/bionic.tar.gz.gpg</pre>

<p>
Concernant le fichier <em>meta-release</em>, le même principe est utilisé mais il contient en plus toutes les versions intermédiaires aux versions LTS.
Ces fichiers indiquent pour chaque version d&#039;Ubuntu, le nom, la version et où sont stockés les éléments de cette version.
Si une nouvelle mise à jour d&#039;Ubuntu est disponible ces fichier seront mis à jour.
</p>

</div>
<div class='secedit editbutton_section editbutton_21'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Les fichiers utilisés] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="les_fichiers_utilises" /><input type="hidden" name="codeblockOffset" value="39" /><input type="hidden" name="range" value="23224-25051" /><button type="submit" title="Les fichiers utilisés" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit22" id="parametrage_de_l_outil_update-manager">Paramétrage de l´outil update-manager</h3>
<div class="level3">

<p>
Le logiciel de mise à jour utilise les données indiquées par le champ <strong>UpgradeTool</strong>. 
</p>

<p>
Exemple: pour la distribution xenial on a  <a href="http://archive.ubuntu.com/ubuntu/dists/bionic/main/dist-upgrader-all/current/" class="urlextern" title="http://archive.ubuntu.com/ubuntu/dists/bionic/main/dist-upgrader-all/current/" rel="nofollow">http://archive.ubuntu.com/ubuntu/dists/bionic/main/dist-upgrader-all/current/</a>.
De plus, le logiciel de mise à jour contient dans son code cette adresse par défaut <a href="http://changelogs.ubuntu.com/" class="urlextern" title="http://changelogs.ubuntu.com/" rel="nofollow">http://changelogs.ubuntu.com/</a>.
Il est possible de préciser dans le fichier « <em>/etc/update-manager/meta-release</em> » un nouveau chemin en renseignant les lignes des champs :  <strong><abbr title="Uniform Resource Identifier">URI</abbr></strong> et <strong><abbr title="Uniform Resource Identifier">URI</abbr>_LTS</strong>.
Dans le cas du dépôt local vous ferez la même chose.
</p>

</div>
<div class='secedit editbutton_section editbutton_22'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Paramétrage de l´outil update-manager] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="parametrage_de_l_outil_update-manager" /><input type="hidden" name="codeblockOffset" value="40" /><input type="hidden" name="range" value="25052-25667" /><button type="submit" title="Paramétrage de l´outil update-manager" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit23" id="realisation">Réalisation</h3>
<div class="level3">

</div>

<h4 id="pre-requis">Pré-requis</h4>
<div class="level4">

<p>
Le miroir a déjà été mis à jour comme décrit par les chapitres ci-dessus.
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Créer un dossier temporaire pour accueillir nos fichiers avant modifications et déplacez-vous dedans, pour ce faire entrez dans un <a href="/terminal" class="wikilink1" title="terminal">terminal</a> les commandes: <pre class="code">mkdir mon_tmp 
cd mon_tmp</pre>
</div>
</li>
<li class="level1"><div class="li"> Téléchargez les fichiers meta-release-lts et meta-release-lts-proposed dans le répertoire temporaire: <pre class="code">wget http://changelogs.ubuntu.com/meta-release-lts 
wget http://changelogs.ubuntu.com/meta-release-lts-proposed</pre>
</div>
</li>
<li class="level1"><div class="li"> Mettez à jour les fichiers meta-release*:</div>
</li>
</ul>

<p>
En éditant les fichiers <em>meta-release-lts</em> et <em>meta-release-lts-proposed</em> afin de modifier l&#039;adresse internet par l&#039;adresse du dépôt local (dans notre cas  <a href="http://archive.ubuntu.com/ubuntu" class="urlextern" title="http://archive.ubuntu.com/ubuntu" rel="nofollow">http://archive.ubuntu.com/ubuntu</a> par <a href="http://192.168.0.1/mirror/fr.archive.ubuntu.com/ubuntu/" class="urlextern" title="http://192.168.0.1/mirror/fr.archive.ubuntu.com/ubuntu/" rel="nofollow">http://192.168.0.1/mirror/fr.archive.ubuntu.com/ubuntu/</a> 192.168.0.1 étant l´adresse de notre serveur embarquant le miroir).
</p>

<p>
Télécharger le dossier indiqué par la ligne <strong>ReleaseNotes</strong> de la version correspondante du fichier <strong>meta-release</strong> :
 
</p>
<pre class="file">Dist: bionic
Name: bionic Xerus
Version: 16.04
Date: Thu, 17 Apr 2016 14:04:00 UTC
Supported: 1
Description: This is the 16.04 release
Release-File: http://archive.ubuntu.com/ubuntu/dists/bionic/Release
ReleaseNotes: http://archive.ubuntu.com/ubuntu/dists/bionic/main/dist-upgrader-all/current/ReleaseAnnouncement
ReleaseNotesHtml: http://archive.ubuntu.com/ubuntu/dists/bionic/main/dist-upgrader-all/current/ReleaseAnnouncement.html
UpgradeTool: http://archive.ubuntu.com/ubuntu/dists/bionic/main/dist-upgrader-all/current/bionic.tar.gz
UpgradeToolSignature: http://archive.ubuntu.com/ubuntu/dists/bionic/main/dist-upgrader-all/current/bionic.tar.gz.gpg</pre>

<p>
Pour la bionic ReleaseNotes: <a href="http://archive.ubuntu.com/ubuntu/dists/bionic/main/dist-upgrader-all/current/" class="urlextern" title="http://archive.ubuntu.com/ubuntu/dists/bionic/main/dist-upgrader-all/current/" rel="nofollow">http://archive.ubuntu.com/ubuntu/dists/bionic/main/dist-upgrader-all/current/</a><strong>ReleaseAnnouncement</strong> le répertoire à télécharger sera <strong>0.87.30</strong> et le répertoire cible dans le miroir sera <strong>bionic/main/dist-upgrader-all/</strong>.
</p>

<p>
Récupérons tout d´abord le répertoire: 
</p>
<pre class="code">wget -r http://archive.ubuntu.com/ubuntu/dists/bionic/main/dist-upgrader-all/current</pre>

<p>
Maintenant vous devez avoir :
</p>
<pre class="code">ls
archive.ubuntu.com  meta-release-lts  meta-release-lts-proposed</pre>

<p>
Vous avez maintenant toutes les données pour mettre à jour notre miroir.
</p>

</div>

<h4 id="mise_a_jour_du_depot">Mise à jour du dépôt</h4>
<div class="level4">

<p>
Mettre en place l´environnement de mise à jour dans le miroir, pour cela:
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Créer le dossier de description de la mise à jour (<strong>Dist</strong>-proposed/main/dist-upgrader-all) dans notre miroir:<pre class="code">mkdir -p  /media/$USER/Depots/miroir/mirror/archive.ubuntu.com/ubuntu/dists/bionic/main/dist-upgrader-all</pre>
</div>
</li>
<li class="level1"><div class="li"> Copiez dans le dépôt le dossier dist-upgrader-all en remplaçant « Votre-Distrib » par la version Ubuntu cible ici bionic : <pre class="code">cp -r archive.ubuntu.com  /media/$USER/Depots/miroir/mirror/archive.ubuntu.com/ubuntu/dists/bionic/main/dist-upgrader-all/</pre>
</div>
</li>
</ul>

<p>
Créer dans le dépôt un nouveau dossier <em>changelogs</em> visible par le client:
</p>
<pre class="code">mkdir /media/$USER/Depots/miroir/mirror/archive.ubuntu.com/ubuntu/dists/changelogs</pre>

<p>
Copier les fichiers meta-release*:
</p>
<pre class="code">cp -r meta-release* /media/$USER/Depots/miroir/mirror/archive.ubuntu.com/ubuntu/dists/changelogs/</pre>

<p>
Voilà c&#039;est terminé pour le dépôt.
</p>

</div>

<h4 id="configuration_du_logiciel_de_mise_a_jour_update-manager">Configuration du logiciel de mise à jour (update-manager)</h4>
<div class="level4">

<p>
Il faut maintenant indiquer au logiciel de mise à jour où récupérer les informations de mise à jour.
</p>

<p>
<a href="/tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">Éditez le fichier</a> <strong>/etc/update-manager/meta-release</strong>: 
</p>
<pre class="file"># default location for the meta-release file
  [METARELEASE]
  URI =/meta-release
  URI_LTS =/meta-release-lts
  URI_UNSTABLE_POSTFIX = -development
  URI_PROPOSED_POSTFIX = -proposed</pre>

<p>
Les lignes à modifier sont:
</p>
<pre class="file">  URI =/meta-release 
  URI_LTS =/meta-release-lts</pre>

<p>
Dans le cas de l&#039;exemple remplacez ces deux lignes par :
</p>
<pre class="file">  URI =/ubuntu/dists/changelogs/meta-release
  URI_LTS =/ubuntu/dists/changelogs/meta-release-lts</pre>

<p>
Et voilà votre dépôt est prêt il ne reste plus qu&#039;à mettre à jour le fichier «/etc/update-manager/meta-release » sur tout les postes clients afin qu&#039;il profite des mise à niveau au travers du logiciel update-manager comme avec une connexion à internet permanente.
</p>

<p>
Nota : Il existe d&#039;autres logiciels pour accomplir cette tâche : 
<a href="https://help.ubuntu.com/community/Debmirror" class="urlextern" title="https://help.ubuntu.com/community/Debmirror" rel="nofollow">Debmirror</a> et d&#039;autres encore.
</p>
<hr />

<p>
Contributeurs: <a href="/utilisateurs/boolet" class="wikilink1" title="utilisateurs:boolet">Boolet</a>, <a href="/utilisateurs/mimilus" class="wikilink2" title="utilisateurs:mimilus" rel="nofollow">Mimilus</a>, <a href="/utilisateurs/claudiux" class="wikilink1" title="utilisateurs:claudiux">claudiux</a>, <a href="/utilisateurs/mr_djez" class="wikilink1" title="utilisateurs:mr_djez">Mr_Djez</a>,  <a href="/utilisateurs/biounator" class="wikilink2" title="utilisateurs:biounator" rel="nofollow">Biounator</a>, <a href="/utilisateurs/l_africain" class="wikilink1" title="utilisateurs:l_africain">L&#039;Africain</a>.<em>
</p>

</div>
<div class='secedit editbutton_section editbutton_23'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/creer_un_miroir_de_depot"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1625576615" /><input type="hidden" name="summary" value="[Réalisation] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="realisation" /><input type="hidden" name="codeblockOffset" value="40" /><input type="hidden" name="range" value="25668-" /><button type="submit" title="Réalisation" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="tutoriel/creer_un_miroir_de_depot.txt">tutoriel/creer_un_miroir_de_depot.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 06/07/2021, 15:03">Le 06/07/2021, 15:03</span></li><li class="text-muted">par Alain Monteil</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=tutoriel%3Acreer_un_miroir_de_depot&amp;1635531671" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
