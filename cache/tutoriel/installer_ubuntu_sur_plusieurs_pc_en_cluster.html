<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>tutoriel:installer_ubuntu_sur_plusieurs_pc_en_cluster [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="tutoriel,serveur,installation,vetuste"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns=tutoriel"/>
<link rel="edit" title="Modifier cette page" href="/tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='tutoriel';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"tutoriel:installer_ubuntu_sur_plusieurs_pc_en_cluster","namespace":"tutoriel","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="tutoriel:installer_ubuntu_sur_plusieurs_pc_en_cluster">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster?do=media&amp;ns=tutoriel"  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">tutoriel:installer_ubuntu_sur_plusieurs_pc_en_cluster</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"></div><!-- CONTENT --><div class="dw-content"><div class="notetag">Cette page est considérée comme <a href="/vetuste">vétuste</a> et ne contient plus d'informations utiles.<br />
<a href="/wiki/participer_wiki">Apportez votre aide…</a>
</div>
<div class="tags"><span>
	<a href="/tutoriel" class="wikilink1" title="tutoriel" rel="tag">tutoriel</a>,
	<a href="/serveur" class="wikilink1" title="serveur" rel="tag">serveur</a>,
	<a href="/installation" class="wikilink1" title="installation" rel="tag">installation</a>,
	<a href="/vetuste" class="wikilink1" title="vetuste" rel="tag">vétuste</a>
</span></div>
<hr />

<h1 class="sectionedit1 page-header" id="installer_ubuntu_sur_plusieurs_pc_en_cluster">Installer Ubuntu sur plusieurs PC en cluster</h1>
<div class="level1">

<p>
traduit de <a href="https://help.ubuntu.com/community/UbuntuOnCluster" class="urlextern" title="https://help.ubuntu.com/community/UbuntuOnCluster" rel="nofollow"> UbuntuOnCluster</a> par Zed
</p>

<p>
Cette page à pour but de présenter l&#039;installation d&#039;Ubuntu sur un groupe important de machines( <a href="https://fr.wikipedia.org/wiki/Grappe_de_serveurs" class="interwiki iw_wpfr" title="https://fr.wikipedia.org/wiki/Grappe_de_serveurs">cluster</a>). Il faudra installer une première machine manuellement (le serveur d&#039;installation), et toutes les autres machines seront installées lorsqu&#039;elles démarreront. Nous utiliserons Ubuntu Dapper. Le programme d&#039;installation par défaut (debian-installer) fonctionne très bien. Ce n&#039;est pas la peine d&#039;utiliser Kickstart ou <abbr title="Fournisseur d&#039;Accès à Internet">FAI</abbr>
</p>

<p>
Prérequis pour le serveur:
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Ubuntu-base install (ubuntu-server va très bien)</div>
</li>
<li class="level1"><div class="li"> Une image <a href="http://releases.ubuntu.com/dapper" class="urlextern" title="http://releases.ubuntu.com/dapper" rel="nofollow"> .iso</a></div>
</li>
<li class="level1"><div class="li"> Soit il faut avoir le <abbr title="Network Address Translation">NAT</abbr> activé sur le serveur <a href="http://kaarsemaker.net/files/ubuntu-cluster/enable_nat" class="urlextern" title="http://kaarsemaker.net/files/ubuntu-cluster/enable_nat" rel="nofollow">exemple</a> ou bien toutes les machines doivent recevoir une IP publique.</div>
</li>
<li class="level1"><div class="li"> Quelques paquets détaillés ci-dessous</div>
</li>
</ul>

</div>

<h4 id="etape_1configuration_du_serveur_dhcp_du_demarrage_par_pxe">Etape 1: Configuration du serveur DHCP &amp; du démarrage par PXE</h4>
<div class="level4">

<p>
Premièrement, il vous faut connaitre l&#039;adresse <abbr title="Medium Access Control">MAC</abbr> de toutes vos machines, ceci afin qu&#039;elles récupèrent toujours la même adresse IP et nom d&#039;hôte.
</p>

<p>
Procédez maintenant à l&#039;installation de <strong>dhcp3-server</strong> et <strong>tftpd-hpa</strong>
</p>

<p>
Une fois les deux paquets installés, éditez le fichier /etc/dhcp3/dhcpd.conf, un exemple est disponible <a href="http://kaarsemaker.net/files/ubuntu-cluster" class="urlextern" title="http://kaarsemaker.net/files/ubuntu-cluster" rel="nofollow">http://kaarsemaker.net/files/ubuntu-cluster</a>; les commentaires sont assez clair.
</p>

<p>
Le démarrage par PXE demande à ce que l&#039;image .iso soit montée localement, je l&#039;ai donc monté sous /var/lib/tftpboot/ubuntu/
</p>
<pre class="code">mkdir /var/lib/tftpboot/ubuntu
echo &#039;/data/ubuntu-5.04-install-i386.iso /var/lib/tftpboot/ubuntu/ auto defaults,loop 0 0&#039; &gt;&gt; /etc/fstab
mount -a</pre>

<p>
La prochaine étape est de configurer le PXE. J&#039;ai donc créé deux fichiers: un pour l&#039;installation et un second pour le démarrage local (cad: démarrer le système localement). Créez un dossier /var/lib/tftpboot/pxelinux.cfg et mettez y les fichiers suivants: <a href="http://kaarsemaker.net/files/ubuntu-cluster/default" class="urlextern" title="http://kaarsemaker.net/files/ubuntu-cluster/default" rel="nofollow"> default</a>
<a href="http://kaarsemaker.net/files/ubuntu-cluster/localboot" class="urlextern" title="http://kaarsemaker.net/files/ubuntu-cluster/localboot" rel="nofollow"> localboot</a>
</p>

<p>
Comme vous pouvez le voir l&#039;action par défaut est l&#039;installation. Il est possible de passer quelques options ici (la ligne kernel). Pour récupérer de la place pour les options (la place est limitée), créez des liens symboliques vers les fichiers suivants:
</p>
<pre class="code">cd /var/lib/tftpboot
ln -s ubuntu/install/netboot/ubuntu-installer/i386/initrd.gz 
ubuntu/install/netboot/ubuntu-installer/i386/linux
ubuntu/install/netboot/pxelinux.0 
ubuntu/install/netboot/ubuntu-installer/</pre>

<p>
Vous pouvez voir dans la configuration que nous utilisons ces liens
</p>

</div>

<h4 id="etape_2configuration_du_nis_et_du_nfs">Etape 2: Configuration du nis et du nfs</h4>
<div class="level4">

<p>
Pour les machines en cluster, nis et nfs sont habituellement utilisées pour partager les informations sur les utilisateurs et des parties du système de fichiers. Il faudra donc installer les deux paquets suivants sur le serveur : <code>nis nfs-kernel-server</code>.
</p>

<p>
Note: le paquet nis (pas nis en lui-même) est un buggé, il essayera de lancer ypbind même si on ne lui demande pas. Il ignore également le preseed, plus loin nous créerons une nouvelle version du package, pour l&#039;instant il faut juste laisser ypbind partir en time out.
</p>

<p>
Lorsque l&#039;installation de nis demande un domaine, prenez un nom de votre choix. Dès que ypbind est mort, arrêtez nis avec la commande suivante :
</p>
<pre class="code">invoke-rc.d nis stop</pre>

<p>
Il faut maintenant éditer /etc/default/nis et activer le serveur nis <a href="http://kaarsemaker.net/files/ubuntu-cluster/nis" class="urlextern" title="http://kaarsemaker.net/files/ubuntu-cluster/nis" rel="nofollow"> (exemple)</a>. Il vous faudra également initialiser la base nis avec :
</p>
<pre class="code">/usr/lib/yp/ypinit -m</pre>

<p>
Vous pouvez maintenant démarrer le service nis :
</p>
<pre class="code">invoke-rc.d nis start</pre>

<p>
Pour le <abbr title="Network File System">NFS</abbr>, il faut éditer /etc/exports pour exporter les parties du système de fichiers utiles. Sur mon cluster, j&#039;ai exporté /home et /data, voici un exemple de fichier de configuration pour <abbr title="Network File System">NFS</abbr>
</p>
<pre class="code"># /etc/exports: the access control list for filesystems which may be exported
#               to NFS clients.  See exports(5).
 /home   192.168.0.0/255.255.0.0(rw,async)
/data   192.168.0.0/255.255.0.0(rw,async)}}}</pre>

<p>
Redémarrez le serveurs <abbr title="Network File System">NFS</abbr>
</p>
<pre class="code">invoke-rc.d nfs-kernel-server restart</pre>

</div>

<h4 id="etape_3configuration_du_miroir_local_et_du_proxy">Etape 3: Configuration du miroir local et du proxy</h4>
<div class="level4">

<p>
L&#039;installation depuis un miroir local et en utilisant un proxy httpd pour le reste augmente de manière significative la vitesse des installations. Comme apt-proxy ne fonctionne pas trop bien, nous allons utiliser squid. Pour la récupération apres l&#039;installation il faut également php, on l&#039;a donc installé. (Un script CGI aurait très bien fait l&#039;affaire, c&#039;est une histoire de gout)
</p>

<p>
Il vous faut donc les paquets suivants : <code>apache2 libapache2-mod-php4 squid</code>
</p>

<p>
Mon cluster a seulement une IP publique, donc seul le maitre est connecté à Internet. Les autres noeuds sont simplement connectés au maitre (et via le <abbr title="Network Address Translation">NAT</abbr> ils peuvent accéder à Internet). Comme je ne veux pas faire office de proxy public, J&#039;ai configuré squid pour qu&#039;il écoute seulement sur eth1 (l&#039;interface interne). On peut faire pareil avec apache en éditant le fichier /etc/apache2/ports.conf.
</p>
<pre class="code">invoke-rc.d apache2 stop
echo &#039;Listen 192.168.0.1:80&#039; &gt; /etc/apache2/ports.conf
echo &#039;Listen 127.0.0.1:80&#039; &gt;&gt; /etc/apache2/ports.conf
invoke-rc.d apache start</pre>

<p>
Il faut également éditer la configuration de squid. Un <a href="http://kaarsemaker.net/files/ubuntu-cluster/squid.conf" class="urlextern" title="http://kaarsemaker.net/files/ubuntu-cluster/squid.conf" rel="nofollow"> exemple</a> est accessible.
</p>

<p>
Faites un lien symbolique de l&#039;iso vers apache pour la servir.
</p>
<pre class="code">ln -s /var/lib/tftpboot/ubuntu/ubuntu /var/www/ubuntu</pre>

</div>

<h4 id="etape_4preseed">Etape 4: preseed</h4>
<div class="level4">

<p>
Tout est maintenant configuré sur le serveur, nous pouvons maintenant passer à la configuration des clients. Tftpboot va lancer l&#039;installeur Ubuntu. L&#039;installeur pose des questions, mais les réponses peuvent être &quot;enregistrées&quot; dans un fichier appelé preseed. 
</p>

<p>
Un fichier preseed qui répond avec la valeur par défaut a toutes les questions et qui installe ubuntu-base et openssh-server est disponible <a href="http://kaarsemaker.net/files/ubuntu-cluster/preseed" class="urlextern" title="http://kaarsemaker.net/files/ubuntu-cluster/preseed" rel="nofollow"> ici</a>.
</p>

<p>
Ce que l&#039;on peut changer: langue, les paquets à installer (qui sont des chaines aptitude), le premier utilisateur ainsi que le partitionnement. Configurez ceci à votre convenance, puis enregistrez le à la racine d&#039;apache.
</p>

</div>

<h4 id="etape_5apres_le_redemarrage">Etape 5: Après le redémarrage</h4>
<div class="level4">

<p>
L&#039;installeur redémarre après l&#039;installation classique, ce qui signifie qu&#039;il sera relancé. Bien sur nous ne voulons pas ça, c&#039;est pourquoi il est nécessaire de créer un système d&#039;enregistrement. Comme vous pouvez le voir dans le fichier pressed, la ligne preseed/late-command correspond à 
</p>
<pre class="code">wget http://192.168.0.1/register.php</pre>

<p>
 Ceci ne fait rien sur le client, mais le script PHP créé un fichier de boot PXE pour cette machine, qui force le démarrage depuis le disque dur local. Si vous désirez réinstaller une machine, il vous suffit de supprimer le fichier de boot PXE associé, et l&#039;installation se relancera.
</p>

<p>
Pour que ceci fonctionne, l&#039;utilisateur <code>www-data</code> doit pouvoir écrire dans /var/lib/tftpboot/pxelinux.cfg
</p>
<pre class="code"> chown :www-data /var/lib/tftpboot/pxelinux.cfg
 chmod g+w $_</pre>

<p>
Voici le contenu du script register.php à enregistrer dans  
</p>
<pre class="code">/var/www/register.php </pre>
<pre class="code php"><span class="kw2">&lt;?php</span>
  <span class="kw2">function</span> _dechex<span class="br0">&#40;</span><span class="re0">$x</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">return</span> <a href="http://www.php.net/sprintf"><span class="kw3">sprintf</span></a><span class="br0">&#40;</span><span class="st0">&quot;<span class="es6">%02s</span>&quot;</span><span class="sy0">,</span><a href="http://www.php.net/dechex"><span class="kw3">dechex</span></a><span class="br0">&#40;</span><span class="re0">$x</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="br0">&#125;</span>
  <span class="re0">$host</span> <span class="sy0">=</span> <a href="http://www.php.net/strtoupper"><span class="kw3">strtoupper</span></a><span class="br0">&#40;</span><a href="http://www.php.net/implode"><span class="kw3">implode</span></a><span class="br0">&#40;</span><span class="st_h">''</span><span class="sy0">,</span><a href="http://www.php.net/array_map"><span class="kw3">array_map</span></a><span class="br0">&#40;</span>_dechex<span class="sy0">,</span><a href="http://www.php.net/explode"><span class="kw3">explode</span></a><span class="br0">&#40;</span><span class="st_h">'.'</span><span class="sy0">,</span><span class="re0">$_SERVER</span><span class="br0">&#91;</span><span class="st_h">'REMOTE_ADDR'</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <a href="http://www.php.net/copy"><span class="kw3">copy</span></a><span class="br0">&#40;</span><span class="st0">&quot;/var/lib/tftpboot/pxelinux.cfg/localboot&quot;</span><span class="sy0">,</span> <span class="st0">&quot;/var/lib/tftpboot/pxelinux.cfg/<span class="es4">$host</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="sy1">?&gt;</span></pre>

</div>

<h4 id="etape_6apres_l_installation">Etape 6: Après l&#039;installation</h4>
<div class="level4">

<p>
Le script exécuté après l&#039;installation (appelé postinstall) peut être utilisé pour tout faire. Je l&#039;ai utilisé pour installer un nis correct et faire une bonne configuration, et quelques trucs en raport avec le démarrage.
</p>

<p>
Pour créer un paquet NIS correct, voici comment faire (depuis breezy ce n&#039;est plus nécessaire: le paquet a été corrigé).
</p>
<pre class="code">mkdir nispackage
cd nispackage
apt-get source nis
cd nis-3.12/debian</pre>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Ouvrir le fichier <code>postinst</code></div>
</li>
<li class="level1"><div class="li"> Commenter la ligne 61 (celle avec <code>db_input</code>)</div>
</li>
<li class="level1"><div class="li"> Juste avant la ligne 64 (celle avec <code>if [ &quot;$RET </code> ajouter une ligne contenant <code>RET=domaine</code> ou domaine est le domaine NIS que vous avez choisi).</div>
</li>
<li class="level1"><div class="li"> Commenter la ligne 106 (celle avec <code>db_text</code>) </div>
</li>
</ul>

<p>
Tapez ensuite les commandes suivantes:
</p>
<pre class="code">cd ..
apt-get build-dep nis
dpkg-buildpackage</pre>

<p>
Copiez le .deb (qui se trouve dans le dossier nispackage) a un endroit ou les clients peuvent y accéder (soit par wget ou via un montage nfs)
</p>

<p>
Le script post-install doit être placé dans /var/www
Le mien ressemble à:
</p>
<pre class="code">#!/bin/bash

# Etape 1: Montage initial
mkdir /data
mount -t nfs 192.168.0.1:/data /data -o rw,soft,bg,rsize=32768,wsize=32768,tcp,timeo=600,intr

# Etape 2: Installation et configuration du NIS
aptitude -y install portmap libslp1
dpkg -i /data/nis_3.12-3_i386.deb
cp /data/nsswitch.conf /etc/nsswitch.conf
echo &#039;+::::::&#039; &gt;&gt; /etc/passwd
echo &#039;+::::::::&#039; &gt;&gt; /etc/shadow
echo &#039;+:::&#039; &gt;&gt; /etc/group

# Réparer le démarrage (nis avec une erreur nfs )
DIR=`pwd`
cd /etc/rc2.d
ln -s ../init.d/mountnfs.sh S20mountnfs.sh
cd $DIR

# Etape 2: Montage correct
umount /data
echo &#039;enterprise:/home  /home   nfs     rw,soft,bg,rsize=32768,wsize=32768,tcp,timeo=600,intr&#039; &gt;&gt; /etc/fstab
echo &#039;enterprise:/data  /data   nfs     rw,soft,bg,rsize=32768,wsize=32768,tcp,timeo=600,intr&#039; &gt;&gt; /etc/fstab
mount -a

# Etape 3: Corriger le sources.list et faire un update
cp /data/sources.list /etc/apt/sources.list
aptitude update
aptitude -y upgrade

# Etape 4: Installer d&#039;autres paquets utiles et supprimer le log d&#039;instalaltion qui contient le mot de passe en clair
aptitude -y install linux-686-smp manpages-dev
rm /var/log/installer/debconf-seed
rm /var/log/installer/cdebconf/questions.dat

# Etape 5: Activer les crontab utiles
echo &#039;0 *    * * *  root   test -x /data/upgrade &amp;&amp; /data/upgrade&#039; &gt;&gt; /etc/crontab

# Etape 6: Redémarrer, nous avons mis un nouveau kernel
reboot</pre>

<p>
Téléchargements: <a href="http://kaarsemaker.net/files/ubuntu-cluster/nsswitch.conf example" class="urlextern" title="http://kaarsemaker.net/files/ubuntu-cluster/nsswitch.conf example" rel="nofollow"> nsswitch.conf</a>
<a href="http://kaarsemaker.net/files/ubuntu-cluster/sources.list" class="urlextern" title="http://kaarsemaker.net/files/ubuntu-cluster/sources.list" rel="nofollow"> sources.list avec miroir local</a>
<a href="http://kaarsemaker.net/files/ubuntu-cluster/post-install" class="urlextern" title="http://kaarsemaker.net/files/ubuntu-cluster/post-install" rel="nofollow"> le script post-install</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1323958958" /><input type="hidden" name="summary" value="[Installer Ubuntu sur plusieurs PC en cluster] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installer_ubuntu_sur_plusieurs_pc_en_cluster" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="54-10386" /><button type="submit" title="Installer Ubuntu sur plusieurs PC en cluster" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit2 page-header" id="pages_en_rapport">Pages en rapport</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1323958958" /><input type="hidden" name="summary" value="[Pages en rapport] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="pages_en_rapport" /><input type="hidden" name="codeblockOffset" value="4" /><input type="hidden" name="range" value="10387-" /><button type="submit" title="Pages en rapport" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster.txt">tutoriel/installer_ubuntu_sur_plusieurs_pc_en_cluster.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 15/12/2011, 15:22">Le 15/12/2011, 15:22</span></li><li>(modification externe)</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=tutoriel%3Ainstaller_ubuntu_sur_plusieurs_pc_en_cluster&amp;1635532198" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
