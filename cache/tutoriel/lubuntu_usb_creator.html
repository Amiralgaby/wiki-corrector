<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>tutoriel:lubuntu_usb_creator [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="boot,live usb,lubuntu,mbr,tutoriel,trusty"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/tutoriel/lubuntu_usb_creator?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns=tutoriel"/>
<link rel="edit" title="Modifier cette page" href="/tutoriel/lubuntu_usb_creator?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/tutoriel/lubuntu_usb_creator"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/tutoriel/lubuntu_usb_creator"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/tutoriel/lubuntu_usb_creator"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='tutoriel';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"tutoriel:lubuntu_usb_creator","namespace":"tutoriel","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="tutoriel:lubuntu_usb_creator">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/tutoriel/lubuntu_usb_creator?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/tutoriel/lubuntu_usb_creator?do=media&amp;ns=tutoriel"  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/tutoriel/lubuntu_usb_creator?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/tutoriel/lubuntu_usb_creator?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/tutoriel/lubuntu_usb_creator?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/tutoriel/lubuntu_usb_creator?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/tutoriel/lubuntu_usb_creator?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">tutoriel:lubuntu_usb_creator</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/tutoriel/lubuntu_usb_creator?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/tutoriel/lubuntu_usb_creator?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/tutoriel/lubuntu_usb_creator?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#pre-requis","title":"Pr\u00e9-requis","level":1},{"link":"#plateformes_supportees","title":"Plateformes support\u00e9es","level":2},{"link":"#un_live_usb_persistant","title":"Un live USB persistant ?","level":1},{"link":"#ce_que_je_vous_propose_ici","title":"Ce que je vous propose ici","level":1},{"link":"#fonctionnement_d_un_support_bootable","title":"Fonctionnement d'un support bootable","level":1},{"link":"#support_bootable_et_mbr","title":"Support bootable et MBR","level":2},{"link":"#partition_principaleetendue","title":"Partition principale \/ \u00e9tendue","level":2},{"link":"#vbr_et_bootloader","title":"VBR et bootloader","level":2},{"link":"#en_resume","title":"En r\u00e9sum\u00e9","level":2},{"link":"#installation_manuelle_du_live_usb","title":"Installation manuelle du Live USB","level":1},{"link":"#preparation","title":"Pr\u00e9paration","level":2},{"link":"#session_live_fr_et_silencieuse","title":"Session Live FR et silencieuse","level":2},{"link":"#remplacer_le_fichier_gfxbootc32","title":"Remplacer le fichier gfxboot.c32","level":2},{"link":"#mettre_en_place_le_pc-live","title":"Mettre en place le PC-LIVE","level":2},{"link":"#er_demarragelive_session","title":"1er d\u00e9marrage : Live session","level":2},{"link":"#eme_demarragevotre_session","title":"2\u00e8me d\u00e9marrage : votre session","level":2},{"link":"#tests_d_acces_distant","title":"Tests d'acc\u00e8s distant","level":2},{"link":"#luc_lubuntu_usb_creator","title":"L.U.C. (Lubuntu USB Creator)","level":1},{"link":"#fonctionnement","title":"Fonctionnement","level":2},{"link":"#synoptique_et_role_des_fichiers","title":"Synoptique et r\u00f4le des fichiers","level":2},{"link":"#mode_d_emploi","title":"Mode d'emploi","level":2},{"link":"#le_code","title":"Le code","level":2},{"link":"#mini_how-to","title":"Mini How-To","level":1},{"link":"#avant_l_installation","title":"Avant l'installation","level":2},{"link":"#apres_l_installation","title":"Apr\u00e8s l'installation","level":2},{"link":"#les_autres_os","title":"Les autres OS ?","level":1},{"link":"#live_usb_64_bits","title":"Live USB 64 bits","level":2},{"link":"#live_usb_autres_distros","title":"Live USB autres distros","level":2},{"link":"#pc-builder_autre_que_ubuntu","title":"PC-BUILDER autre que Ubuntu","level":2},{"link":"#pc-builder_sous_windows","title":"PC-BUILDER sous Windows","level":2},{"link":"#todo","title":"TODO","level":1},{"link":"#ou_vais-je","title":"O\u00f9 vais-je ?","level":2},{"link":"#pistes_a_suivre_ou_pas","title":"Pistes \u00e0 suivre (ou pas :) ) ?","level":2},{"link":"#problemes_connus","title":"Probl\u00e8mes connus","level":1},{"link":"#le_mot_de_la_fin","title":"Le mot de la fin","level":1},{"link":"#historique","title":"Historique","level":1}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level1"><a href="#pre-requis">Pré-requis</a>
<ul class="nav toc">
<li class="level2"><a href="#plateformes_supportees">Plateformes supportées</a></li>
</ul>
</li>
<li class="level1"><a href="#un_live_usb_persistant">Un live USB persistant ?</a></li>
<li class="level1"><a href="#ce_que_je_vous_propose_ici">Ce que je vous propose ici</a></li>
<li class="level1"><a href="#fonctionnement_d_un_support_bootable">Fonctionnement d&#039;un support bootable</a>
<ul class="nav toc">
<li class="level2"><a href="#support_bootable_et_mbr">Support bootable et MBR</a></li>
<li class="level2"><a href="#partition_principaleetendue">Partition principale / étendue</a></li>
<li class="level2"><a href="#vbr_et_bootloader">VBR et bootloader</a></li>
<li class="level2"><a href="#en_resume">En résumé</a></li>
</ul>
</li>
<li class="level1"><a href="#installation_manuelle_du_live_usb">Installation manuelle du Live USB</a>
<ul class="nav toc">
<li class="level2"><a href="#preparation">Préparation</a></li>
<li class="level2"><a href="#session_live_fr_et_silencieuse">Session Live FR et silencieuse</a></li>
<li class="level2"><a href="#remplacer_le_fichier_gfxbootc32">Remplacer le fichier gfxboot.c32</a></li>
<li class="level2"><a href="#mettre_en_place_le_pc-live">Mettre en place le PC-LIVE</a></li>
<li class="level2"><a href="#er_demarragelive_session">1er démarrage : Live session</a></li>
<li class="level2"><a href="#eme_demarragevotre_session">2ème démarrage : votre session</a></li>
<li class="level2"><a href="#tests_d_acces_distant">Tests d&#039;accès distant</a></li>
</ul>
</li>
<li class="level1"><a href="#luc_lubuntu_usb_creator">L.U.C. (Lubuntu USB Creator)</a>
<ul class="nav toc">
<li class="level2"><a href="#fonctionnement">Fonctionnement</a></li>
<li class="level2"><a href="#synoptique_et_role_des_fichiers">Synoptique et rôle des fichiers</a></li>
<li class="level2"><a href="#mode_d_emploi">Mode d&#039;emploi</a></li>
<li class="level2"><a href="#le_code">Le code</a></li>
</ul>
</li>
<li class="level1"><a href="#mini_how-to">Mini How-To</a>
<ul class="nav toc">
<li class="level2"><a href="#avant_l_installation">Avant l&#039;installation</a></li>
<li class="level2"><a href="#apres_l_installation">Après l&#039;installation</a></li>
</ul>
</li>
<li class="level1"><a href="#les_autres_os">Les autres OS ?</a>
<ul class="nav toc">
<li class="level2"><a href="#live_usb_64_bits">Live USB 64 bits</a></li>
<li class="level2"><a href="#live_usb_autres_distros">Live USB autres distros</a></li>
<li class="level2"><a href="#pc-builder_autre_que_ubuntu">PC-BUILDER autre que Ubuntu</a></li>
<li class="level2"><a href="#pc-builder_sous_windows">PC-BUILDER sous Windows</a></li>
</ul>
</li>
<li class="level1"><a href="#todo">TODO</a>
<ul class="nav toc">
<li class="level2"><a href="#ou_vais-je">Où vais-je ?</a></li>
<li class="level2"><a href="#pistes_a_suivre_ou_pas">Pistes à suivre (ou pas :) ) ?</a></li>
</ul>
</li>
<li class="level1"><a href="#problemes_connus">Problèmes connus</a></li>
<li class="level1"><a href="#le_mot_de_la_fin">Le mot de la fin</a></li>
<li class="level1"><a href="#historique">Historique</a></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content"><div class="notetag">Selon les <a href="/tags">tags</a> présents sur cette page, les informations qu'elle contient  n'ont pas été vérifiées pour les dernières versions LTS depuis <a href="/trusty">Ubuntu 14.04 LTS.</a><br />
<a href="/wiki/participer_wiki">Apportez votre aide…</a>
</div>
<div class="tags"><span>
	<a href="/boot?do=showtag&amp;tag=boot" class="wikilink1" title="boot" rel="tag">boot</a>,
	<a href="/live_usb" class="wikilink1" title="live_usb" rel="tag">live usb</a>,
	<a href="/lubuntu" class="wikilink1" title="lubuntu" rel="tag">lubuntu</a>,
	<a href="/mbr" class="wikilink1" title="mbr" rel="tag">mbr</a>,
	<a href="/tutoriel" class="wikilink1" title="tutoriel" rel="tag">tutoriel</a>,
	<a href="/trusty" class="wikilink1" title="trusty" rel="tag">Trusty</a>
</span></div>
<hr />
<div class="noteimportant">Tout ce qui trouve dans cette page est à prendre <strong>avec des pincettes</strong>. Certains éléments sont obsolètes et/ou mal maîtrisés. En définitive, il y a <strong>à boire et à manger</strong> mais certains éléments sont très utiles (en partie l&#039;écriture du script <strong>bash</strong> dont je suis assez fier <img src="/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />). Je reviendrais certainement bientôt, mettre à jour et simplifier, parce qu&#039;avec le recul je trouve cette page fouilli et peu optimisée. A suivre …. lnj le 25/02/21 à 09:35
</div>
<h1 class="sectionedit1 page-header" id="lubuntu_usb_creator">Lubuntu USB Creator</h1>
<div class="level1">
<div class="noteclassic">Ce tutoriel a pour origine un besoin de remplacer un disque dur défaillant (voir <a href="http://openclassrooms.com/forum/sujet/remplacer-un-hdd-par-un-live-usb#message-88173124" class="urlextern" title="http://openclassrooms.com/forum/sujet/remplacer-un-hdd-par-un-live-usb#message-88173124" rel="nofollow">ici</a>). Comme je pouvais difficilement le remplacer (format 1.8&quot; peu commun), je suis parti en quête de solution alternative. Je voulais explorer la possibilité d&#039;utiliser un Live <abbr title="Universal Serial Bus">USB</abbr>, mais sans trop savoir où je m&#039;aventurais. Pris au jeu, cette exploration est devenue un projet à part entière. 
<p>
Ayant bien-bien-bien avancé sur le sujet et je vous propose aujourd&#039;hui le fruit de mon travail… <img src="/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />
</p>

</div>
<p>
Comme je le disais dans mon <a href="http://openclassrooms.com/forum/sujet/remplacer-un-hdd-par-un-live-usb#message-88173124" class="urlextern" title="http://openclassrooms.com/forum/sujet/remplacer-un-hdd-par-un-live-usb#message-88173124" rel="nofollow">post initial</a>, j&#039;allais tester la solution du Live <abbr title="Universal Serial Bus">USB</abbr> à partir d&#039;un S-ATA externe connecté par <abbr title="Universal Serial Bus">USB</abbr>. 
</p>

<p>
J&#039;ai réussi à créer un Live <abbr title="Universal Serial Bus">USB</abbr> persistant sur un HDD <abbr title="Serial Advanced Technology Attachment">SATA</abbr> branché sur une station d&#039;accueil externe et connectée via <abbr title="Universal Serial Bus">USB</abbr>. De plus, j&#039;ai réussi à créer un script &#039;OneTouch&#039; qui construit lui même le Live <abbr title="Universal Serial Bus">USB</abbr> à partir de nos réglages.
</p>

<p>
Je l&#039;ai appelé L.U.C. (Lubuntu <abbr title="Universal Serial Bus">USB</abbr> Creator).
</p>

<p>
Comme je suis trop content <img src="/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" /> !
</p>

<p>
Ce document est devenu très grand et tout ne sera pas utile pour tout le monde.
</p>
<div class="notetip">Pour ceux qui sont juste curieux du résultat, vous pouvez directement lire le chapitre <a href="#pre-requis" title="tutoriel:lubuntu_usb_creator ↵" class="wikilink1">Pré-requis</a> puis poursuivre par <a href="#mode_d_emploi" title="tutoriel:lubuntu_usb_creator ↵" class="wikilink1">Mode d&#039;emploi</a> (temps d&#039;installation estimé : 20 minutes)
</div><div class="noteclassic">Si vous avez des commentaires, remarqué des erreurs ou adapté le script à d&#039;autres distributions, n&#039;hésitez pas à faire un retour sur le <a href="http://forum.ubuntu-fr.org/viewtopic.php?pid=19673001#p19673001" class="urlextern" title="http://forum.ubuntu-fr.org/viewtopic.php?pid=19673001#p19673001" rel="nofollow">forum</a>.
</div>
</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Lubuntu USB Creator] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="lubuntu_usb_creator" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="557-2288" /><button type="submit" title="Lubuntu USB Creator" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit2 page-header" id="pre-requis">Pré-requis</h2>
<div class="level2">

<p>
Pour mettre tout ça en place, vous aurez besoins des éléments suivants :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Disposer des <a href="/sudo" class="wikilink1" title="sudo">droits d&#039;administration</a>.</div>
</li>
<li class="level1"><div class="li"> Disposer d&#039;une connexion à Internet configurée et activée.</div>
</li>
<li class="level1"><div class="li"> Le fichier ISO de la distribution  <a href="https://help.ubuntu.com/community/Lubuntu/GetLubuntu" class="urlextern" title="https://help.ubuntu.com/community/Lubuntu/GetLubuntu" rel="nofollow">Lubuntu</a> pour architecture 32 bits (voir les <a href="#plateformes_supportees" title="tutoriel:lubuntu_usb_creator ↵" class="wikilink1">plateformes supportées</a>)</div>
</li>
</ul>

<p>
Pour connaître l&#039;architecture du micro-processeur : 
</p>
<pre class="code bash">lscpu <span class="sy0">|</span><span class="kw2">grep</span> bit</pre>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Un PC pour construire le support <abbr title="Universal Serial Bus">USB</abbr>, appelons le <strong>PC-BUILDER</strong> (voir les <a href="#plateformes_supportees" title="tutoriel:lubuntu_usb_creator ↵" class="wikilink1">plateformes supportées</a>)</div>
</li>
<li class="level1"><div class="li"> Un disque dur externe <abbr title="Serial Advanced Technology Attachment">SATA</abbr> + station accueil <abbr title="Serial Advanced Technology Attachment">SATA</abbr> reliée par <abbr title="Universal Serial Bus">USB</abbr> ou eSATA (pour ceux qui ne connaissent pas : <a href="http://lmgtfy.com/?q=station+accueil+sata+usb" class="urlextern" title="http://lmgtfy.com/?q=station+accueil+sata+usb" rel="nofollow">http://lmgtfy.com/?q=station+accueil+sata+usb</a>) ; pour ceux qui n&#039;ont pas un tel matériel une simple clé <abbr title="Universal Serial Bus">USB</abbr> de 2 <abbr title="Gigabyte">GB</abbr> mini fera l&#039;affaire pour tester.</div>
</li>
</ul>
<div class="notewarning">ATTENTION : la technologie d&#039;une clé <abbr title="Universal Serial Bus">USB</abbr> n&#039;étant pas prévue pour les multiples écritures nécessaires au fonctionnement d&#039;un <abbr title="Operating System">OS</abbr>, il en résultera une durée de vie réduite, vous voilà prévenu !

</div><ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Un autre PC pour tester, appelons le <strong>PC-LIVE</strong> qui servira d&#039;hôte à notre Live <abbr title="Universal Serial Bus">USB</abbr> (il ne touchera pas à l&#039;éventuel <abbr title="Operating System">OS</abbr> en place) ; si on n&#039;a pas de 2ème PC on peut utiliser PC-BUILDER, seulement ce sera moins pratique (surtout pour l&#039;accès distant ^^ )</div>
</li>
</ul>
<div class="notetip">Maintenant que vous avez les pré-requis, peut être voudriez-vous tester la <a href="#mode_d_emploi" title="tutoriel:lubuntu_usb_creator ↵" class="wikilink1">finalité</a> (temps estimé : 20 min) ?
</div>
</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Pré-requis] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="pre-requis" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="2289-3876" /><button type="submit" title="Pré-requis" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit3" id="plateformes_supportees">Plateformes supportées</h3>
<div class="level3">

<p>
Ces couples de plateformes ont été testées avec succès :
</p>
<div class="table-responsive"><table class="inline table table-striped table-condensed">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> <abbr title="Operating System">OS</abbr> PC-BUILDER            </th><th class="col1 leftalign"> CPU     </th><th class="col2 leftalign"> <abbr title="Operating System">OS</abbr> PC-LIVE            </th><th class="col3 leftalign"> CPU     </th><th class="col4"> RMQ </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> Ubuntu 12.04 LTS 32 bits </td><td class="col1"> 32 bits </td><td class="col2"> Lubuntu 14.10 32 bits </td><td class="col3"> 32 bits </td><td class="col4 leftalign">     </td>
	</tr>
	<tr class="row2">
		<td class="col0"> Ubuntu 14.04 LTS 64 bits </td><td class="col1"> 32 bits </td><td class="col2"> Lubuntu 14.10 32 bits </td><td class="col3"> 32 bits </td><td class="col4"> environnement VM </td>
	</tr>
</table></div>
<div class="notetip">N&#039;hésitez pas à faire un retour sur le <a href="http://forum.ubuntu-fr.org/viewtopic.php?pid=19673001#p19673001" class="urlextern" title="http://forum.ubuntu-fr.org/viewtopic.php?pid=19673001#p19673001" rel="nofollow">forum</a>, pour faire évoluer cette liste.
</div>
</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Plateformes supportées] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="plateformes_supportees" /><input type="hidden" name="codeblockOffset" value="1" /><input type="hidden" name="range" value="3877-4389" /><button type="submit" title="Plateformes supportées" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit5 page-header" id="un_live_usb_persistant">Un live USB persistant ?</h2>
<div class="level2">

<p>
Le Net regorge de tutoriels pour créer des Live CD et Live <abbr title="Universal Serial Bus">USB</abbr> .
</p>

<p>
Mais au fait c&#039;est quoi un Live xx ?
</p>

<p>
C&#039;est la possibilité de démarrer un mini <abbr title="Operating System">OS</abbr> pour par exemple installer un système un peu plus costaud ou tout simplement le tester sans affecter l&#039;éventuel système déjà en place.
</p>

<p>
Comme les CDs c&#039;est un peu galère, on a créé les Live <abbr title="Universal Serial Bus">USB</abbr> qui sont plus rapides et plus {ergonom|économ|écolog}iques. 
</p>

<p>
Cerise sur le gateau, la persistance. Ben oui, pourquoi ne pas pouvoir enregistrer ses réglages, ses fichiers aussi ?
</p>

<p>
La persistance a réglé le problème, à un tel point qu&#039;on pourrait presque songer à remplacer son vieux <abbr title="Operating System">OS</abbr> par un Live <abbr title="Universal Serial Bus">USB</abbr> persistant (sisi j&#039;vous jure <img src="/lib/images/smileys/icon_razz.gif" class="icon" alt=":-P" /> ).
</p>

<p>
A noter que de base, la persistance réside dans un fichier nommé <strong>casper-rw</strong> de 4 <abbr title="Gigabyte">GB</abbr> maxi (limitation FAT32) et se trouve à la racine du support.
</p>

</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Un live USB persistant ?] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="un_live_usb_persistant" /><input type="hidden" name="codeblockOffset" value="1" /><input type="hidden" name="range" value="4390-5279" /><button type="submit" title="Un live USB persistant ?" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit6 page-header" id="ce_que_je_vous_propose_ici">Ce que je vous propose ici</h2>
<div class="level2">

<p>
Un Live <abbr title="Universal Serial Bus">USB</abbr> dont la persistance se fera sur une partition à part entière dédiée. Il sera équipé du système d&#039;exploitation Lubuntu, car très léger. Il sera accessible à distance via SSH ou par <abbr title="Virtual Network Computing">VNC</abbr> à une adresse IP définie AVANT la création du support. Il sera en français, à l&#039;heure et aura comme unique utilisateur … vous ! Il possèdera les fonctions de base d&#039;un système d&#039;exploitation : client navigateur Internet, éditeur de texte, navigateur de fichiers, Disk, GParted, etc. En outre, il intégrera tous les outils que vous jugerez bon de lui ajouter (avant ou après sa création).
</p>

<p>
Il faut ajouter que tout se configure avant l&#039;installation en renseignant <a href="#mode_d_emploi" title="tutoriel:lubuntu_usb_creator ↵" class="wikilink1">quelques paramètres</a> (pas de quoi foueter un chat non plus hein !).
</p>

<p>
Le top must de la mort qui tue <img src="/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />, in situ on pourra réinitialiser le support comme si on venait de le créer (reboot nécessaire) et on pourra même modifier sa propre installation sans repasser par la re-création du support (plus d&#039;explications dans le <a href="#mini_how-to" title="tutoriel:lubuntu_usb_creator ↵" class="wikilink1">mini How-To</a>)
</p>

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Ce que je vous propose ici] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="ce_que_je_vous_propose_ici" /><input type="hidden" name="codeblockOffset" value="1" /><input type="hidden" name="range" value="5280-6377" /><button type="submit" title="Ce que je vous propose ici" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit7 page-header" id="fonctionnement_d_un_support_bootable">Fonctionnement d&#039;un support bootable</h2>
<div class="level2">
<div class="noteclassic">J&#039;ai fait une grosse recherche sur tout le mécanisme de boot et je me propose de vous exposer mes découvertes. Cette partie optionnelle est longue et technique, mais elle n&#039;est pas complexe. De plus, j&#039;ai précisé mes sources. Bonne lecture !

</div><div class="noteimportant">Ce que je décris ici, c&#039;est ce que j&#039;ai compris après plein, plein, pleins de lectures sur le sujet. Des sujets qui parfois se contredisent, surtout au niveau des termes. Je ne garanti pas l&#039;exactitude, mais je suis parti du principe que quand plusieurs explications vont dans le même sens, c&#039;est qu&#039;elle doivent être vraies ou tendre vers la vérité. Ensuite, il y a mes propres expériences (réalisées avec mes mimines à moi), le bon sens et l&#039;intuition. Toutefois quand j&#039;annonce quelque chose, j&#039;essaye dans la mesure du possible de citer mes sources. Si vous voyez des erreurs n&#039;hésitez pas à le signaler, mais dans la même optique, en citant vos sources.

</div>
<p>
Nota : ici je ne parle que du mécanisme de boot par <abbr title="Basic Input-Output System">BIOS</abbr> / MBR ; je m&#039;attaquerais peut être plus tard au boot UEFI / GPT encore que je ne sois pas sûr que des Live <abbr title="Universal Serial Bus">USB</abbr> de plus de 2 TB soient pertinents.
</p>

<p>
Le schéma à avoir en tête (<a href="http://poloastucien.free.fr/mbr_fat_secteurs_boot_h.html#1" class="urlextern" title="http://poloastucien.free.fr/mbr_fat_secteurs_boot_h.html#1" rel="nofollow">source</a>) :
</p>

<p>
<a href="/lib/exe/fetch.php?tok=f76a57&amp;media=http%3A%2F%2Fpoloastucien.free.fr%2Fmbr_secteurs-01.jpg" class="media" title="http://poloastucien.free.fr/mbr_secteurs-01.jpg"><img src="/lib/exe/fetch.php?tok=f76a57&amp;media=http%3A%2F%2Fpoloastucien.free.fr%2Fmbr_secteurs-01.jpg" class="media img-responsive" title="mbr_secteurs-01.jpg" alt="mbr_secteurs-01.jpg" /></a>
</p>

<p>
Nota : <strong>BS</strong> (Boot Sector) sera nommé VBR, dans les explications suivantes, car boot sector est un terme trop générique.
</p>

<p>
Je passe toutes les étapes (très intéressantes) sur le démarrage physique et électronique du PC, pour arriver à la dernière étape de traitement du <abbr title="Basic Input-Output System">BIOS</abbr> après le POST (<a href="http://fr.wikipedia.org/wiki/Power-On_Self-Test" class="urlextern" title="http://fr.wikipedia.org/wiki/Power-On_Self-Test" rel="nofollow">Power-On Self-Test</a>)
</p>

<p>
Le <abbr title="Basic Input-Output System">BIOS</abbr> cherche le premier support bootable, dont on peut définir soi-même l&#039;ordre de recherche (boot sequence) ou à la demande avec la touche F12 (ou autre), puis exécute le code du MBR…
</p>

</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Fonctionnement d&#039;un support bootable] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="fonctionnement_d_un_support_bootable" /><input type="hidden" name="codeblockOffset" value="1" /><input type="hidden" name="range" value="6378-8325" /><button type="submit" title="Fonctionnement d&#039;un support bootable" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit8" id="support_bootable_et_mbr">Support bootable et MBR</h3>
<div class="level3">

<p>
Q : Qu&#039;est ce qu&#039;un support bootable ?<br/>

R : C&#039;est un support qui lors du démarrage d&#039;un PC, va exécuter du code pour charger un système d&#039;exploitation ou autres. Pour permettre cela, il faut que les premiers octets du support constituent un MBR bootable ou plus rarement, un VBR bootable (voir plus bas).
</p>

<p>
Q : Qu&#039;est ce qu&#039;un <strong>MBR</strong> (Master Boot Record) ?<br/>

R : <em>C&#039;est le premier secteur adressable d&#039;un disque dur (cylindre 0, tête 0 et secteur 1, ou secteur 0 en adressage logique) dans le cadre d&#039;un partitionnement Intel.</em> (<a href="http://fr.wikipedia.org/wiki/Master_boot_record" class="urlextern" title="http://fr.wikipedia.org/wiki/Master_boot_record" rel="nofollow">wiki</a>). Par héritage, pour adapter aux supports autres que le disque dur, on dira que le <a href="http://fr.wikipedia.org/wiki/Master_boot_record" class="urlextern" title="http://fr.wikipedia.org/wiki/Master_boot_record" rel="nofollow">MBR</a> ce sont les <strong>512 premiers octets</strong> de n&#039;importe quel support bootable.
</p>

<p>
Nota : 
</p>
<pre class="code bash"><span class="kw2">fdisk</span> <span class="re5">-l</span> <span class="sy0">/</span>dev<span class="sy0">/&lt;</span>device<span class="sy0">&gt;</span></pre>

<p>
 retourne l&#039;adresse en CHS (Cylinder, Head, Sector) et l&#039;adresse du premier secteur LBA (Logical Block Address) MEME si le support est une simple clé <abbr title="Universal Serial Bus">USB</abbr>, alors que physiquement il n&#039;y a ni cylindres, ni têtes de lecture sur une clé <abbr title="Universal Serial Bus">USB</abbr> (comme quoi l&#039;héritage…)
</p>

<p>
Q : Quel est le contenu d&#039;un MBR ?<br/>

R : Un code exécutable (appelons la <strong>routine_MBR</strong>), d&#039;éventuels messages d&#039;erreurs en cas de problème, le descripteur des partitions principales, une signature de contrôle facultative et se termine obligatoirement par les octets &quot;55 aa&quot; qui représentent le <strong>nombre magique</strong> 0xaa55 (<a href="http://fr.wikipedia.org/wiki/Master_boot_record#Structure_du_MBR" class="urlextern" title="http://fr.wikipedia.org/wiki/Master_boot_record#Structure_du_MBR" rel="nofollow">wiki</a>) pour distinguer un support bootable d&#039;un autre (<a href="http://poloastucien.free.fr/mbr_fat_secteurs_boot_h.html#2" class="urlextern" title="http://poloastucien.free.fr/mbr_fat_secteurs_boot_h.html#2" rel="nofollow">sources</a>)
</p>
<div class="noteimportant">Attention : le nombre magique ne suffit pas en soi, pour déterminer si le support est réellement bootable, il faut également qu&#039;une partition soit active (voir dessous) !

</div>
<p>
On peut visualiser le contenu hexadécimal/<abbr title="American Standard Code for Information Interchange">ASCII</abbr> d&#039;un MBR grâce à la commande hexdump ou hd 
</p>
<pre class="code bash">hd <span class="sy0">/</span>dev<span class="sy0">/&lt;</span>device<span class="sy0">&gt;</span> <span class="re5">-n</span> <span class="nu0">512</span> <span class="re5">-s</span> <span class="nu0">0</span></pre>
<pre class="code">$ hd /dev/sde -n 512 -s 0
00000000  fa b8 00 10 8e d0 bc 00  b0 b8 00 00 8e d8 8e c0  |................|
00000010  fb be 00 7c bf 00 06 b9  00 02 f3 a4 ea 21 06 00  |...|.........!..|
00000020  00 be be 07 38 04 75 0b  83 c6 10 81 fe fe 07 75  |....8.u........u|
00000030  f3 eb 16 b4 02 b0 01 bb  00 7c b2 80 8a 74 01 8b  |.........|...t..|
00000040  4c 02 cd 13 ea 00 7c 00  00 eb fe 00 00 00 00 00  |L.....|.........|
00000050  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
000001b0  00 00 00 00 00 00 00 00  30 85 09 00 00 00 80 01  |........0.......|
000001c0  01 00 0c fe 3f 79 3f 00  00 00 bb e7 1d 00 00 00  |....?y?.........|
000001d0  01 7a 83 fe ff ff fa e7  1d 00 c7 a2 83 12 00 00  |.z..............|
000001e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000001f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 55 aa  |..............U.|
00000200</pre>

<p>
Vous remarquerez que cette section se termine par &quot;55 aa&quot;, on a donc le nombre magique 0xaa55, on visualise donc le MBR d&#039;un disque bootable
</p>

<p>
Nota : * indique que la ligne du dessus est répétée plusieurs fois
</p>

<p>
Q : Que contient le <strong>descripteur de partitions principales</strong> ?<br/>

R : 64 octets décrivant les 4 partitions principales. Pour chacune des partitions sur 16 octets (16*4=64), on sait si la partition est active (donc bootable), on connait son système de fichiers sous-jacent (<strong>FS</strong> : File System), sa taille et sa position (<a href="http://poloastucien.free.fr/mbr_fat_secteurs_boot_h.html#2" class="urlextern" title="http://poloastucien.free.fr/mbr_fat_secteurs_boot_h.html#2" rel="nofollow">sources</a>)
</p>

<p>
En reprenant l&#039;affichage hexdump du dessus :
</p>
<pre class="code">000001b0                                             80 01  |              ..|
000001c0  01 00 0c fe 3f 79 3f 00  00 00 bb e7 1d 00        |....?y?.......  |

000001c0                                             00 00  |              ..|
000001d0  01 7a 83 fe ff ff fa e7  1d 00 c7 a2 83 12        |.z............  |

000001d0                                             00 00  |              ..|
000001e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000001f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00        |..............  |</pre>

<p>
Ici :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Le 1er bloc (ligne 000001b0) représente le descripteur de partition 1 : le 80 du début indique que la partition est active (et donc bootable).</div>
</li>
<li class="level1"><div class="li"> Le 2ème bloc (ligne 000001c0) représente le descripteur de la partition 2 : le 00 du début indique que la partition n&#039;est pas active (donc n&#039;est pas bootable).</div>
</li>
<li class="level1"><div class="li"> Le 3ème bloc (commence à la ligne 000001d0) représente les descripteurs des partitions 3 et 4 : comme elles sont remplies de &quot;00&quot;, cela indique qu&#039;il n&#039;y a pas de 3ème et 4ème partition.</div>
</li>
</ul>

<p>
Pour plus d&#039;explications, voir <a href="http://poloastucien.free.fr/mbr_fat_secteurs_boot_h.html#2" class="urlextern" title="http://poloastucien.free.fr/mbr_fat_secteurs_boot_h.html#2" rel="nofollow">ici</a>.
</p>

</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Support bootable et MBR] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="support_bootable_et_mbr" /><input type="hidden" name="codeblockOffset" value="1" /><input type="hidden" name="range" value="8326-13114" /><button type="submit" title="Support bootable et MBR" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit9" id="partition_principaleetendue">Partition principale / étendue</h3>
<div class="level3">

<p>
Q : Que trouve t-on au début d&#039;une <strong>partition principale</strong> ?<br/>

R : 512 octets qui constituent, soit le début d&#039;un secteur de boot de volume (VBR), soit un secteur de boot de partition étendue (EBR) - (<a href="http://poloastucien.free.fr/mbr_fat_secteurs_boot_h.html#1" class="urlextern" title="http://poloastucien.free.fr/mbr_fat_secteurs_boot_h.html#1" rel="nofollow">sources</a>).
</p>

<p>
Q : Qu&#039;est ce qu&#039;une <strong>partition étendue</strong> ?<br/>

R : Permet d&#039;étendre le nombre de partitions pour dépasser la limite des 4 partitions principales.
</p>

<p>
<img src="/lib/images/smileys/fixme.gif" class="icon" alt="FIXME" /> Q : Que contient un secteur de boot d&#039;une partition étendue ?<br/>

R : Même type de structure qu&#039;un MBR (<a href="http://en.wikipedia.org/wiki/Extended_boot_record" class="urlextern" title="http://en.wikipedia.org/wiki/Extended_boot_record" rel="nofollow">EBR</a>), en revanche semble commencer par une instruction de saut.
</p>

</div>
<div class='secedit editbutton_section editbutton_9'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Partition principale / étendue] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="partition_principaleetendue" /><input type="hidden" name="codeblockOffset" value="5" /><input type="hidden" name="range" value="13115-13814" /><button type="submit" title="Partition principale / étendue" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit10" id="vbr_et_bootloader">VBR et bootloader</h3>
<div class="level3">

<p>
Q : Qu&#039;est ce qu&#039;un <strong>VBR</strong> (Volume Boot Record) ?<br/>

R : C&#039;est un secteur de boot de partition. Les informations qu&#039;elle contient, varient selon le FS sous-jacent. Certains supports contiennent directement un VBR sans MBR parent ; c&#039;est le cas de nos vieilles disquettes (<a href="http://en.wikipedia.org/wiki/Volume_boot_record#Signature" class="urlextern" title="http://en.wikipedia.org/wiki/Volume_boot_record#Signature" rel="nofollow">wiki</a>)
</p>

<p>
Nota : la taille d&#039;un VBR dépend du FS sous-jacent (FAT32 : 32 secteurs, NTFS : 16 secteurs - <a href="http://poloastucien.free.fr/mbr_fat_secteurs_boot_h.html#1" class="urlextern" title="http://poloastucien.free.fr/mbr_fat_secteurs_boot_h.html#1" rel="nofollow">source</a>)
</p>

<p>
Q : Quel est le contenu d&#039;un VBR ?<br/>

R : Un VBR commence toujours par une instruction de saut vers le code exécutable que nous appellerons <strong>routine_VBR</strong>, est suivi par le BPB qui donne les caractéristiques physiques de la partition et surtout l&#039;adresse de la table d&#039;allocation de fichiers, suivi de la routine_VBR, les éventuels messages d&#039;erreur, et comme pour le MBR, elle se termine par le nombre magique 0xaa55 (<a href="http://poloastucien.free.fr/mbr_fat_secteurs_boot_h.html#5" class="urlextern" title="http://poloastucien.free.fr/mbr_fat_secteurs_boot_h.html#5" rel="nofollow">source</a>). La routine_VBR exécutera le bootloader.
</p>

<p>
Nota : on peut visualiser le contenu hexadécimal/<abbr title="American Standard Code for Information Interchange">ASCII</abbr> d&#039;un VBR de partition grâce à la commande hexdump 
</p>
<pre class="code bash">hd <span class="sy0">/</span>dev<span class="sy0">/&lt;</span>device<span class="sy0">&gt;&lt;</span>num_part<span class="sy0">&gt;</span> <span class="re5">-n</span> <span class="nu0">512</span> <span class="re5">-s</span> <span class="nu0">0</span></pre>
<pre class="code">$ hd /dev/sde1 -n 512 -s 0
00000000  eb 58 90 53 59 53 4c 49  4e 55 58 00 02 08 20 00  |.X.SYSLINUX... .|
00000010  02 00 00 00 00 f8 00 00  3f 00 ff 00 00 00 00 00  |........?.......|
00000020  bb e7 1d 00 78 07 00 00  00 00 00 00 02 00 00 00  |....x...........|
00000030  01 00 06 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000040  00 01 29 04 22 bd 91 4c  5f 4c 55 42 55 4e 54 55  |..).&quot;..L_LUBUNTU|
00000050  20 20 46 41 54 33 32 20  20 20 fa fc 31 c9 8e d1  |  FAT32   ..1...|
00000060  bc 76 7b 52 06 57 1e 56  8e c1 b1 26 bf 78 7b f3  |.v{R.W.V...&amp;.x{.|
00000070  a5 8e d9 bb 78 00 0f b4  37 0f a0 56 20 d2 78 1b  |....x...7..V .x.|
00000080  31 c0 b1 06 89 3f 89 47  02 f3 64 a5 8a 0e 18 7c  |1....?.G..d....||
00000090  88 4d f8 50 50 50 50 cd  13 eb 62 8b 55 aa 8b 75  |.M.PPPP...b.U..u|
000000a0  a8 c1 ee 04 01 f2 83 fa  4f 76 31 81 fa b2 07 73  |........Ov1....s|
000000b0  2b f6 45 b4 7f 75 25 38  4d b8 74 20 66 3d 21 47  |+.E..u%8M.t f=!G|
000000c0  50 54 75 10 80 7d b8 ed  75 0a 66 ff 75 ec 66 ff  |PTu..}..u.f.u.f.|
000000d0  75 e8 eb 0f 51 51 66 ff  75 bc eb 07 51 51 66 ff  |u...QQf.u...QQf.|
000000e0  36 1c 7c b4 08 e8 e9 00  72 13 20 e4 75 0f c1 ea  |6.|.....r. .u...|
000000f0  08 42 89 16 1a 7c 83 e1  3f 89 0e 18 7c fb bb aa  |.B...|..?...|...|
00000100  55 b4 41 e8 cb 00 72 10  81 fb 55 aa 75 0a f6 c1  |U.A...r...U.u...|
00000110  01 74 05 c6 06 46 7d 00  66 b8 88 1a 02 00 66 ba  |.t...F}.f.....f.|
00000120  00 00 00 00 bb 00 80 e8  0e 00 66 81 3e 1c 80 5e  |..........f.&gt;..^|
00000130  30 95 71 75 74 e9 f8 02  66 03 06 60 7b 66 13 16  |0.qut...f..`{f..|
00000140  64 7b b9 10 00 eb 2b 66  52 66 50 06 53 6a 01 6a  |d{....+fRfP.Sj.j|
00000150  10 89 e6 66 60 b4 42 e8  77 00 66 61 8d 64 10 72  |...f`.B.w.fa.d.r|
00000160  01 c3 66 60 31 c0 e8 68  00 66 61 e2 da c6 06 46  |..f`1..h.fa....F|
00000170  7d 2b 66 60 66 0f b7 36  18 7c 66 0f b7 3e 1a 7c  |}+f`f..6.|f..&gt;.||
00000180  66 f7 f6 31 c9 87 ca 66  f7 f7 66 3d ff 03 00 00  |f..1...f..f=....|
00000190  77 17 c0 e4 06 41 08 e1  88 c5 88 d6 b8 01 02 e8  |w....A..........|
000001a0  2f 00 66 61 72 01 c3 e2  c9 31 f6 8e d6 bc 68 7b  |/.far....1....h{|
000001b0  8e de 66 8f 06 78 00 be  da 7d ac 20 c0 74 09 b4  |..f..x...}. .t..|
000001c0  0e bb 07 00 cd 10 eb f2  31 c0 cd 16 cd 19 f4 eb  |........1.......|
000001d0  fd 8a 16 74 7b 06 cd 13  07 c3 42 6f 6f 74 20 65  |...t{.....Boot e|
000001e0  72 72 6f 72 0d 0a 00 00  00 00 00 00 00 00 00 00  |rror............|
000001f0  00 00 00 00 00 00 00 00  fe 02 b2 3e 18 37 55 aa  |...........&gt;.7U.|
00000200</pre>

<p>
En reprenant l&#039;affichage hexdump du dessus :
</p>
<pre class="code">00000000  eb 58 90                                          |.X.             |

00000000           53 59 53 4c 49  4e 55 58                 |   SYSLINUX    |

00000000                                       02 08 20 00  |            .. .|
00000010  02 00 00 00 00 f8 00 00  3f 00 ff 00 00 00 00 00  |........?.......|
00000020  bb e7 1d 00 78 07 00 00  00 00 00 00 02 00 00 00  |....x...........|
00000030  01 00 06 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000040  00 01 29 04 22 bd 91 4c  5f 4c 55 42 55 4e 54 55  |..).&quot;..L_LUBUNTU|
00000050  20 20 46 41 54 33 32 20  20                       |  FAT32         |

00000050                              20 fa fc 31 c9 8e d1  |          ..1...|
00000060  bc 76 7b 52 06 57 1e 56  8e c1 b1 26 bf 78 7b f3  |.v{R.W.V...&amp;.x{.|
00000070  a5 8e d9 bb 78 00 0f b4  37 0f a0 56 20 d2 78 1b  |....x...7..V .x.|
00000080  31 c0 b1 06 89 3f 89 47  02 f3 64 a5 8a 0e 18 7c  |1....?.G..d....||
00000090  88 4d f8 50 50 50 50 cd  13 eb 62 8b 55 aa 8b 75  |.M.PPPP...b.U..u|
000000a0  a8 c1 ee 04 01 f2 83 fa  4f 76 31 81 fa b2 07 73  |........Ov1....s|
000000b0  2b f6 45 b4 7f 75 25 38  4d b8 74 20 66 3d 21 47  |+.E..u%8M.t f=!G|
000000c0  50 54 75 10 80 7d b8 ed  75 0a 66 ff 75 ec 66 ff  |PTu..}..u.f.u.f.|
000000d0  75 e8 eb 0f 51 51 66 ff  75 bc eb 07 51 51 66 ff  |u...QQf.u...QQf.|
000000e0  36 1c 7c b4 08 e8 e9 00  72 13 20 e4 75 0f c1 ea  |6.|.....r. .u...|
000000f0  08 42 89 16 1a 7c 83 e1  3f 89 0e 18 7c fb bb aa  |.B...|..?...|...|
00000100  55 b4 41 e8 cb 00 72 10  81 fb 55 aa 75 0a f6 c1  |U.A...r...U.u...|
00000110  01 74 05 c6 06 46 7d 00  66 b8 88 1a 02 00 66 ba  |.t...F}.f.....f.|
00000120  00 00 00 00 bb 00 80 e8  0e 00 66 81 3e 1c 80 5e  |..........f.&gt;..^|
00000130  30 95 71 75 74 e9 f8 02  66 03 06 60 7b 66 13 16  |0.qut...f..`{f..|
00000140  64 7b b9 10 00 eb 2b 66  52 66 50 06 53 6a 01 6a  |d{....+fRfP.Sj.j|
00000150  10 89 e6 66 60 b4 42 e8  77 00 66 61 8d 64 10 72  |...f`.B.w.fa.d.r|
00000160  01 c3 66 60 31 c0 e8 68  00 66 61 e2 da c6 06 46  |..f`1..h.fa....F|
00000170  7d 2b 66 60 66 0f b7 36  18 7c 66 0f b7 3e 1a 7c  |}+f`f..6.|f..&gt;.||
00000180  66 f7 f6 31 c9 87 ca 66  f7 f7 66 3d ff 03 00 00  |f..1...f..f=....|
00000190  77 17 c0 e4 06 41 08 e1  88 c5 88 d6 b8 01 02 e8  |w....A..........|
000001a0  2f 00 66 61 72 01 c3 e2  c9 31 f6 8e d6 bc 68 7b  |/.far....1....h{|
000001b0  8e de 66 8f 06 78 00 be  da 7d ac 20 c0 74 09 b4  |..f..x...}. .t..|
000001c0  0e bb 07 00 cd 10 eb f2  31 c0 cd 16 cd 19 f4 eb  |........1.......|
000001d0  fd 8a 16 74 7b 06 cd 13  07 c3 42 6f 6f 74 20 65  |...t{.....Boot e|
000001e0  72 72 6f 72 0d 0a 00 00  00 00 00 00 00 00 00 00  |rror............|
000001f0  00 00 00 00 00 00 00 00  fe 02 b2 3e 18 37 55 aa  |...........&gt;.7U.|
00000200</pre>

<p>
On peut notera que :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Les 3 premiers octets constituent une instruction de saut de 88 octets (<a href="http://www.binaryhexconverter.com/hex-to-decimal-converter" class="urlextern" title="http://www.binaryhexconverter.com/hex-to-decimal-converter" rel="nofollow">58h=88d</a> ; 58 en héxadécimal correspond à 88 décimal). Donc on va &quot;sauter&quot; 88 octets qui nous emmène directement au 4ème bloc (ligne 0000050)</div>
</li>
<li class="level1"><div class="li"> Les 8 octets suivants concernent le <a href="http://thestarman.narod.ru/asm/mbr/W7VBR.htm" class="urlextern" title="http://thestarman.narod.ru/asm/mbr/W7VBR.htm" rel="nofollow">OEM ID</a> (en gros qui a créé le VBR) : ici on voit que c&#039;est SYSLINUX</div>
</li>
<li class="level1"><div class="li"> Le bloc suivant concerne le BPB (<a href="http://fr.wikipedia.org/wiki/BIOS_parameter_block" class="urlextern" title="http://fr.wikipedia.org/wiki/BIOS_parameter_block" rel="nofollow">BIOS parameter block</a>) qui décrit la couche physique du support ; également on peut voir en clair le libellé du support (ici L_LUBUNTU), ainsi que le FS (ici le système de fichier est en FAT32)</div>
</li>
<li class="level1"><div class="li"> Le dernier bloc commence par la routine_VBR (exécuté après l&#039;instruction de saut), suivi des messages d&#039;erreur</div>
</li>
<li class="level1"><div class="li"> Encore et toujours, les deux derniers octets constituent le nombre magique 0xaa55</div>
</li>
</ul>

<p>
Plus d&#039;explications <a href="http://thestarman.narod.ru/asm/mbr/W7VBR.htm" class="urlextern" title="http://thestarman.narod.ru/asm/mbr/W7VBR.htm" rel="nofollow">ici</a> (attention : en anglais et pour utilisateurs avertis)
</p>

<p>
Q : Qu&#039;est ce qu&#039;un <strong>bootloader</strong> ?<br/>

R : C&#039;est un programme en lecture seule accessible dans le système de fichiers (généralement on peut le voir avec un simple ls). Son rôle est de charger en mémoire un mini-système d&#039;exploitation qui à son tour pourra charger un système d&#039;exploitation &quot;lourd&quot; (Ubuntu, Windows).
</p>

</div>
<div class='secedit editbutton_section editbutton_10'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[VBR et bootloader] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="vbr_et_bootloader" /><input type="hidden" name="codeblockOffset" value="5" /><input type="hidden" name="range" value="13815-21882" /><button type="submit" title="VBR et bootloader" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit11" id="en_resume">En résumé</h3>
<div class="level3">

<p>
On peut dire ici que le démarrage se fait en trois temps après le POST. Le <abbr title="Basic Input-Output System">BIOS</abbr> exécute la routine_MBR, qui exécute à son tour la routine_VBR, qui exécute elle même le boot loader. Rien n&#039;empêche de le faire en deux temps : le <abbr title="Basic Input-Output System">BIOS</abbr> exécute la routine_MBR qui exécute elle même le bootloader. Voir en un temps, le <abbr title="Basic Input-Output System">BIOS</abbr> exécute la routine_MBR qui se trouve être le fichier bootloader. Aussi, je rappelle qu&#039;on peut très bien avoir un VBR sans MBR (cas des <a href="http://en.wikipedia.org/wiki/Design_of_the_FAT_file_system#Bootsector" class="urlextern" title="http://en.wikipedia.org/wiki/Design_of_the_FAT_file_system#Bootsector" rel="nofollow">disquettes</a>).
</p>

<p>
Tout ça pour dire, que finalement tout est possible, selon &quot;comment&quot; on écrit le <abbr title="Basic Input-Output System">BIOS</abbr>, la routine de MBR / VBR, etc.
</p>

<p>
Ceci explique certainement, pourquoi les explications concernant le boot, sont floues et divergentes. En tout cas j&#039;espère vous avoir éclairé sur ses possibilités.
</p>

</div>
<div class='secedit editbutton_section editbutton_11'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[En résumé] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="en_resume" /><input type="hidden" name="codeblockOffset" value="8" /><input type="hidden" name="range" value="21883-22749" /><button type="submit" title="En résumé" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit12 page-header" id="installation_manuelle_du_live_usb">Installation manuelle du Live USB</h2>
<div class="level2">

<p>
Avant d&#039;élaborer le <a href="#le_code" title="tutoriel:lubuntu_usb_creator ↵" class="wikilink1">script OneTouch</a>, je suis bien évidemment passé par la phase &quot;installation à la mano&quot;.
</p>
<div class="noteimportant">Ce guide manuel est dédié pour un live <abbr title="Universal Serial Bus">USB</abbr> &quot;Lubuntu 14.10 32 bits&quot; qui a été créé depuis un PC équipé de &quot;Ubuntu 12.04 LTS 32 bits&quot; (PC-BUILDER) ; si vous n&#039;avez pas ces prérequis, vous aurez certainement à adapter les consignes suivantes.

</div>
</div>
<div class='secedit editbutton_section editbutton_12'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Installation manuelle du Live USB] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation_manuelle_du_live_usb" /><input type="hidden" name="codeblockOffset" value="8" /><input type="hidden" name="range" value="22750-23195" /><button type="submit" title="Installation manuelle du Live USB" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit13" id="preparation">Préparation</h3>
<div class="level3">

<p>
Pour créer le support avec une persistance dans une partition <strong>/casper-rw</strong>, j&#039;ai suivi <a href="http://gornthorn.over-blog.fr/article-live-usb-en-mode-persistant-avec-l-integralite-de-la-cle-usb-74373994.html" class="urlextern" title="http://gornthorn.over-blog.fr/article-live-usb-en-mode-persistant-avec-l-integralite-de-la-cle-usb-74373994.html" rel="nofollow">ce lien</a> qui utilise l&#039;outil &quot;Créer un disque de démarrage&quot; et GParted (<a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">Installez les paquets</a> <strong><a href="apt://gparted" class="interwiki iw_apt" title="apt://gparted">gparted</a></strong>).
</p>

<p>
L&#039;outil &quot;Créer un disque de démarrage&quot; est par défaut sous Ubuntu et contient quelques bugs. Entre autres :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Pour une raison que j&#039;ignore, parfois le support disparait au bout d&#039;un moment ; il suffit de rebrancher le support pour qu&#039;il réapparaisse</div>
</li>
<li class="level1"><div class="li"> Apparemment, si on utilise une connexion eSATA, le support ne sera pas détecté par l&#039;application (en tout cas, moi je n&#039;ai pas réussi), donc uniquement en connexion <abbr title="Universal Serial Bus">USB</abbr></div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_13'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Préparation] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="preparation" /><input type="hidden" name="codeblockOffset" value="8" /><input type="hidden" name="range" value="23196-24026" /><button type="submit" title="Préparation" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit14" id="session_live_fr_et_silencieuse">Session Live FR et silencieuse</h3>
<div class="level3">

<p>
Modifier le fichier de configuration (<a href="/tutoriel/comment_modifier_un_fichier" class="wikilink1" title="tutoriel:comment_modifier_un_fichier">Ouvrez le fichier</a> <strong>&lt;racine_support_usb&gt;/syslinux/syslinux.cfg</strong>).
</p>

<p>
Remplacer son contenu par :
</p>
<pre class="code">DEFAULT live
LABEL live
  SAY Lubuntu USB Live Persistant
  KERNEL /casper/vmlinuz
  APPEND noprompt persistent boot=casper initrd=/casper/initrd.lz quiet splash \
  locale=fr_FR.UTF-8 console-setup/layoutcode=fr</pre>

</div>
<div class='secedit editbutton_section editbutton_14'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Session Live FR et silencieuse] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="session_live_fr_et_silencieuse" /><input type="hidden" name="codeblockOffset" value="8" /><input type="hidden" name="range" value="24027-24472" /><button type="submit" title="Session Live FR et silencieuse" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit15" id="remplacer_le_fichier_gfxbootc32">Remplacer le fichier gfxboot.c32</h3>
<div class="level3">

<p>
Remplacer le fichier gfxboot.c32 du support par celui du PC-BUILDER de création :
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">cp</span> <span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>syslinux<span class="sy0">/</span>gfxboot.c32 <span class="sy0">&lt;</span>racine_support_usb<span class="sy0">&gt;/</span>syslinux<span class="sy0">/</span>gfxboot.c32</pre>

<p>
Nota :<br/>

Si on ne fait pas cette étape, le boot automatique ne marchera pas et se soldera par un prompt &quot;boot :&quot;. Dans ce cas, on n&#039;aura plus qu&#039;à taper manuellement <strong>&quot;live&quot;</strong> (sans les guillemets), suivi d&#039;un appui la touche <strong>Entrée</strong>.
</p>

</div>
<div class='secedit editbutton_section editbutton_15'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Remplacer le fichier gfxboot.c32] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="remplacer_le_fichier_gfxbootc32" /><input type="hidden" name="codeblockOffset" value="9" /><input type="hidden" name="range" value="24473-24940" /><button type="submit" title="Remplacer le fichier gfxboot.c32" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit16" id="mettre_en_place_le_pc-live">Mettre en place le PC-LIVE</h3>
<div class="level3">

<p>
Brancher le live <abbr title="Universal Serial Bus">USB</abbr> sur un PC de test éteint (PC-LIVE)
</p>

<p>
S&#039;assurer que le PC-LIVE est relié physiquement au réseau (au besoin démarrez le et vérifiez que vous avez accès au réseau).
</p>

<p>
Démarrer le PC-LIVE et configurer le <abbr title="Basic Input-Output System">BIOS</abbr> pour qu&#039;il démarre sur le Live <abbr title="Universal Serial Bus">USB</abbr> ou bien choisir le support depuis la liste des périphériques (F12 ou autre).
</p>

<p>
NB : je ne décris pas cette étape qui varie d&#039;une machine à une autre, toutefois une recherche avec votre moteur de recherche favori, devrait donner rapidement la solution.
</p>

</div>
<div class='secedit editbutton_section editbutton_16'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Mettre en place le PC-LIVE] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="mettre_en_place_le_pc-live" /><input type="hidden" name="codeblockOffset" value="10" /><input type="hidden" name="range" value="24941-25503" /><button type="submit" title="Mettre en place le PC-LIVE" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit17" id="er_demarragelive_session">1er démarrage : Live session</h3>
<div class="level3">

<p>
Vous venez de démarrer le support avec succès et le bureau est affiché. Il ne reste plus qu&#039;à personnaliser et ajouter un nouvel utilisateur (vous).
</p>
<div class="notetip">On peut noter qu&#039;il y a un raccourci &quot;Installer Lubuntu&quot; sur le bureau

</div>
</div>

<h4 id="modifier_adresse_ip_via_network_manager">Modifier adresse IP via Network Manager</h4>
<div class="level4">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Icône réseau en bas à droite &gt; Modification des connexions (Edit Connections)</div>
</li>
<li class="level1"><div class="li"> Sélectionner : Connexion filaire 1 (Wired connection 1)</div>
</li>
<li class="level1 node"><div class="li"> Modifier (Edit)</div>
<ul class=" fix-media-list-overlap">
<li class="level2 node"><div class="li"> Onglet &quot;Paramètres IPv4&quot; (IPv4 settings) et renseigner (adapter à votre cas) :</div>
<ul class=" fix-media-list-overlap">
<li class="level3"><div class="li"> Méthode (Method) : manuelle (manual)</div>
</li>
<li class="level3"><div class="li"> Adresse (Address) : 192.168.0.3</div>
</li>
<li class="level3"><div class="li"> Masque réseau (Netmask) : 24 (/24 soit 255.255.255.0)</div>
</li>
<li class="level3"><div class="li"> Passerelle (Gateway) : 192.168.0.254</div>
</li>
<li class="level3"><div class="li"> <abbr title="Domain Name System">DNS</abbr> (<abbr title="Domain Name System">DNS</abbr> servers) : 8.8.8.8</div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> Enregistrer (Save)</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Fermer (Close)</div>
</li>
</ul>

</div>

<h4 id="environnement_complet_en_fr">Environnement complet en FR</h4>
<div class="level4">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Menu démarrer &gt; Préférences &gt; Prise en charge des langues</div>
</li>
<li class="level1 node"><div class="li"> Popup &quot;La prise en charge des langues n&#039;est pas complètement installée&quot;</div>
<ul class=" fix-media-list-overlap">
<li class="level2"><div class="li"> Installer</div>
</li>
</ul>
</li>
<li class="level1 node"><div class="li"> Installer / Supprimer des langues</div>
<ul class=" fix-media-list-overlap">
<li class="level2"><div class="li"> Cocher : Français</div>
</li>
<li class="level2"><div class="li"> Décocher : Anglais</div>
</li>
<li class="level2"><div class="li"> Appliquer les changements</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Appliquer à tout le système</div>
</li>
<li class="level1"><div class="li"> Close</div>
</li>
</ul>

</div>

<h4 id="installer_ssh_et_vnc">Installer SSH et VNC</h4>
<div class="level4">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Menu démarrer &gt; Outils système &gt; Gestionnaire de paquets Synaptic</div>
</li>
<li class="level1 node"><div class="li"> Popup &quot;Présentation rapide&quot;</div>
<ul class=" fix-media-list-overlap">
<li class="level2"><div class="li"> Fermer</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Tout mettre à niveau</div>
</li>
<li class="level1"><div class="li"> Rechercher</div>
</li>
<li class="level1 node"><div class="li"> Saisir : openssh-server</div>
<ul class=" fix-media-list-overlap">
<li class="level2"><div class="li"> Rechercher</div>
</li>
</ul>
</li>
<li class="level1 node"><div class="li"> Cocher &gt; Sélectionner pour l&#039;installation</div>
<ul class=" fix-media-list-overlap">
<li class="level2"><div class="li"> Ajouter à la sélection</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Refaire une recherche pour <strong>vino</strong> et pour <strong>x11vnc</strong></div>
</li>
<li class="level1"><div class="li"> Appliquer</div>
</li>
<li class="level1 node"><div class="li"> Popup &quot;Appliquer les modification suivantes&quot;</div>
<ul class=" fix-media-list-overlap">
<li class="level2"><div class="li"> Appliquer</div>
</li>
</ul>
</li>
<li class="level1 node"><div class="li"> Popup &quot;Les modifications ont été appliquées&quot;</div>
<ul class=" fix-media-list-overlap">
<li class="level2"><div class="li"> Fermer</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Fermer</div>
</li>
</ul>

</div>

<h4 id="creer_votre_utilisateur_vous">Créer votre utilisateur (vous)</h4>
<div class="level4">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Menu démarrer &gt; Outils système &gt; Utilisateurs et groupes</div>
</li>
<li class="level1 node"><div class="li"> Ajouter et renseigner les différents champs (adapter) :</div>
<ul class=" fix-media-list-overlap">
<li class="level2"><div class="li"> Nom : mon nom complet</div>
</li>
<li class="level2"><div class="li"> Utilisateur : mon_login</div>
</li>
<li class="level2"><div class="li"> Valider</div>
</li>
</ul>
</li>
<li class="level1 node"><div class="li"> Popup &quot;Modifier le mot de passe de l&#039;utilisateur&quot; (adapter) :</div>
<ul class=" fix-media-list-overlap">
<li class="level2"><div class="li"> Nouveau mot de passe : mot_de_passe_super_baleze</div>
</li>
<li class="level2"><div class="li"> Confirmation (retaper) :</div>
</li>
<li class="level2"><div class="li"> Cocher (option) &quot;Ne pas demander de mot de passe à la connexion&quot;</div>
</li>
<li class="level2"><div class="li"> Valider</div>
</li>
</ul>
</li>
<li class="level1 node"><div class="li"> Gérer les groupes</div>
<ul class=" fix-media-list-overlap">
<li class="level2"><div class="li"> Sélectionner le groupe sudo</div>
</li>
<li class="level2 node"><div class="li"> Propriétés</div>
<ul class=" fix-media-list-overlap">
<li class="level3"><div class="li"> Cocher &quot;vous&quot; dans la liste des membres du groupe</div>
</li>
<li class="level3"><div class="li"> Valider</div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> Fermer</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Fermer</div>
</li>
</ul>

</div>

<h4 id="ouverture_auto_de_session">Ouverture auto de session</h4>
<div class="level4">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Menu démarrer &gt; Accessoires &gt; LXTerminal</div>
</li>
<li class="level1"><div class="li"> Saisir les lignes suivantes (adapter mon_login) et les exécuter :</div>
</li>
</ul>
<pre class="code bash"><span class="re2">ME</span>=<span class="sy0">&lt;</span>mon_login<span class="sy0">&gt;</span>
<span class="kw2">sudo</span> <span class="kw2">sed</span> <span class="re5">-i</span> <span class="st0">&quot;s/lubuntu/<span class="es2">$ME</span>/g&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>lightdm<span class="sy0">/</span>lightdm.conf
<span class="kw3">exit</span></pre>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Menu démarrer &gt; Déconnexion &gt; Redémarrer</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_17'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[1er démarrage : Live session] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="er_demarragelive_session" /><input type="hidden" name="codeblockOffset" value="10" /><input type="hidden" name="range" value="25504-28200" /><button type="submit" title="1er démarrage : Live session" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit18" id="eme_demarragevotre_session">2ème démarrage : votre session</h3>
<div class="level3">

<p>
Vous venez d&#039;ouvrir automatiquement votre session avec succès. Il ne reste plus qu&#039;à supprimer l&#039;utilisateur par défaut de la Live session &quot;lubuntu&quot; et configurer l&#039;accès <abbr title="Virtual Network Computing">VNC</abbr>.
</p>
<div class="notetip">Vous pourrez constater, qu&#039;il N&#039;Y A PLUS de raccourci &quot;Installer Lubuntu&quot; sur le bureau

</div>
</div>

<h4 id="supprimer_l_utilisateur_lubuntu_et_son_groupe">Supprimer l&#039;utilisateur &quot;lubuntu&quot; et son groupe</h4>
<div class="level4">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Menu démarrer &gt; Accessoires &gt; LXTerminal</div>
</li>
<li class="level1"><div class="li"> Saisir les lignes suivantes telles quelles et les exécuter :</div>
</li>
</ul>
<pre class="code bash"><span class="re2">LU</span>=lubuntu
<span class="kw2">sudo</span> deluser <span class="re1">$LU</span>
<span class="kw2">sudo</span> usermod <span class="re5">-g</span> <span class="re1">$USER</span> <span class="re1">$LU</span>
<span class="kw2">sudo</span> delgroup <span class="re1">$LU</span>
<span class="kw2">sudo</span> <span class="kw2">rm</span> <span class="re5">-rf</span> <span class="sy0">/</span>home<span class="sy0">/</span><span class="re1">$LU</span>
<span class="kw2">sudo</span> <span class="kw2">sed</span> <span class="re5">-i</span> <span class="st0">&quot;s/^<span class="es2">$LU</span>/<span class="es2">$USER</span>/g&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>sudoers.d<span class="sy0">/</span>casper
<span class="kw2">sudo</span> <span class="kw2">sed</span> <span class="re5">-i</span> <span class="st0">&quot;/^<span class="es2">$LU</span>:/d&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span><span class="kw2">passwd</span>
<span class="kw2">sudo</span> <span class="kw2">sed</span> <span class="re5">-i</span> <span class="st0">&quot;/^<span class="es2">$LU</span>:/d&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>shadow
<span class="kw3">exit</span></pre>

</div>

<h4 id="configurer_vnc">Configurer VNC</h4>
<div class="level4">

<p>
Autoriser l&#039;accès distant :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1 node"><div class="li"> Menu démarrer &gt; Exécuter et saisir : <pre class="code">vino-preferences</pre>
</div>
<ul class=" fix-media-list-overlap">
<li class="level2"><div class="li"> Cocher &quot;Autoriser d&#039;autres utilisateurs à voir votre bureau&quot;</div>
</li>
<li class="level2"><div class="li"> Fermer</div>
</li>
</ul>
</li>
</ul>

<p>
Sécuriser l&#039;échange par <abbr title="Virtual Network Computing">VNC</abbr> :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Menu démarrer &gt; Accessoires &gt; LXTerminal</div>
</li>
<li class="level1 node"><div class="li"> Saisir les lignes suivantes telles quelles et les exécuter :</div>
<ul class=" fix-media-list-overlap">
<li class="level2 node"><div class="li"> x11vnc -storepasswd</div>
<ul class=" fix-media-list-overlap">
<li class="level3"><div class="li"> Renseigner mot de passe : mot_de_passe_super_baleze</div>
</li>
<li class="level3"><div class="li"> Confirmation (retaper) :</div>
</li>
<li class="level3"><div class="li"> Write password to … : y</div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> exit</div>
</li>
</ul>
</li>
</ul>

<p>
Démarrage automatique de <abbr title="Virtual Network Computing">VNC</abbr> :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Menu démarrer &gt; Accessoires &gt; LXTerminal</div>
</li>
<li class="level1"><div class="li"> Saisir les lignes suivantes telles quelles et les exécuter :</div>
</li>
</ul>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">bash</span> <span class="re5">-c</span> <span class="st0">&quot;echo x11vnc -rfbauth /home/<span class="es2">$USER</span>/.vnc/passwd -forever -repeat -display :0 \&amp; &gt;&gt; /etc/profile&quot;</span>
<span class="kw3">exit</span></pre>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Menu démarrer &gt; Déconnexion &gt; Redémarrer</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_18'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[2ème démarrage : votre session] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="eme_demarragevotre_session" /><input type="hidden" name="codeblockOffset" value="11" /><input type="hidden" name="range" value="28201-29786" /><button type="submit" title="2ème démarrage : votre session" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit19" id="tests_d_acces_distant">Tests d&#039;accès distant</h3>
<div class="level3">

<p>
Désormais on peut accéder à distance par SSH : depuis le terminal d&#039;un PC (appelons le PC-CLIENT, exécuter la ligne suivante dans un terminal :
</p>
<pre class="code bash"><span class="kw2">ssh</span> <span class="sy0">&lt;</span>mon_login<span class="sy0">&gt;@&lt;</span>ip_PC-LIVE<span class="sy0">&gt;</span></pre>

<p>
 (ex : ssh lnj@192.168.0.3)
</p>

<p>
Et on peut également accéder avec un client <abbr title="Virtual Network Computing">VNC</abbr>, pour ma part j&#039;ai utilisé Remmina.
</p>

<p>
Il faut configurer la connexion comme ceci (adapter) :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Nom : nom_du_profil (ex : live_pc)</div>
</li>
<li class="level1"><div class="li"> Protocole : &quot;<abbr title="Virtual Network Computing">VNC</abbr> - Virtual Network Computing&quot;</div>
</li>
<li class="level1"><div class="li"> Serveur : 192.168.0.3 (adresse statique du serveur)</div>
</li>
<li class="level1"><div class="li"> Nom d&#039;utilisateur : mon_login</div>
</li>
<li class="level1"><div class="li"> Mot de passe (celui généré par x11vnc -storepasswd) : mot_de_passe_super_baleze</div>
</li>
<li class="level1"><div class="li"> Profondeur de couleur : autre chose que 256 couleurs (sinon ne marche pas)</div>
</li>
<li class="level1"><div class="li"> Se connecter</div>
</li>
</ul>

<p>
Et voilou <img src="/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" /> !
</p>

</div>
<div class='secedit editbutton_section editbutton_19'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Tests d&#039;accès distant] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="tests_d_acces_distant" /><input type="hidden" name="codeblockOffset" value="14" /><input type="hidden" name="range" value="29787-30566" /><button type="submit" title="Tests d&#039;accès distant" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit20 page-header" id="luc_lubuntu_usb_creator">L.U.C. (Lubuntu USB Creator)</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_20'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[L.U.C. (Lubuntu USB Creator)] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="luc_lubuntu_usb_creator" /><input type="hidden" name="codeblockOffset" value="15" /><input type="hidden" name="range" value="30567-30608" /><button type="submit" title="L.U.C. (Lubuntu USB Creator)" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit21" id="fonctionnement">Fonctionnement</h3>
<div class="level3">

<p>
Nous allons voir ici, le fonctionnement interne de votre Live <abbr title="Universal Serial Bus">USB</abbr>.
</p>
<div class="noteclassic">Cette partie optionnelle est longue et technique, mais elle n&#039;est pas complexe. Bonne lecture !

</div><div class="noteimportant">Volontairement, je ne donne pas trop d&#039;explications dans la section qui suit, car je maitrise mal et ça alourdirait.

</div>
<p>
Si vous avez lu le chapitre <a href="#fonctionnement_d_un_support_bootable" title="tutoriel:lubuntu_usb_creator ↵" class="wikilink1">Fonctionnement d&#039;un support bootable</a>, le début devrait vous sembler limpide.
</p>

<p>
Donc, vous branchez votre support <abbr title="Universal Serial Bus">USB</abbr> et vous démarrez la machine. Le <abbr title="Basic Input-Output System">BIOS</abbr> effectue le POST et détermine le premier support bootable.
</p>

<p>
Et ensuite ?
</p>

</div>

<h4 id="boot_support">Boot support</h4>
<div class="level4">

<p>
Le <abbr title="Basic Input-Output System">BIOS</abbr> va exécuter la routine_MBR (construite par la commande <strong>parted /dev/&lt;device&gt; mklabel -s &quot;msdos&quot;</strong>), qui à son tour va exécuter la routine_VBR (construite par la commande <strong>syslinux /dev/&lt;device&gt;</strong>), qui va exécuter le boot loader (fichier <strong>/ldlinux.sys</strong> créé par la commande syslinux précédente).
</p>

</div>

<h4 id="le_bootloader_syslinux">Le bootloader syslinux</h4>
<div class="level4">

<p>
A ce stade, syslinux ce n&#039;est qu&#039;un simple prompt (c.a.d. un curseur qui clignote sur fond noir <img src="/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" /> ) qui attend que vous saisissiez quelque chose, avant d&#039;appuyer sur la touche Entrée. En réalité, il attend que vous lui fournissiez un <strong>kernel</strong>.
</p>

<p>
Vous pourriez simplement taper manuellement (sur un clavier QWERTY of course <img src="/lib/images/smileys/icon_wink.gif" class="icon" alt=";-)" /> ) :<br/>

</p>
<pre class="code bash"><span class="sy0">/</span>casper<span class="sy0">/</span>vmlinuz <span class="sy0">/</span>casper<span class="sy0">/</span>initrd.lz</pre>

<p>
Et ça marcherait (explication plus bas) !
</p>

<p>
Fort heureusement, <strong>/syslinux.sys</strong> est accompagné d&#039;un fichier <strong>/syslinux/syslinux.cfg</strong> qui automatise son fonctionnement.
</p>

<p>
Donc, <strong>/syslinux.sys</strong> va <a href="http://www.syslinux.org/wiki/index.php/SYSLINUX#How_do_I_Configure_SYSLINUX.3F" class="urlextern" title="http://www.syslinux.org/wiki/index.php/SYSLINUX#How_do_I_Configure_SYSLINUX.3F" rel="nofollow">lire</a> <strong>/syslinux/syslinux.cfg</strong>, en déduire et exécuter <strong>/casper/vmlinuz /casper/initrd.lz</strong> suivi des autres joyeusetés, telles que désactiver le network-manager pour le remplacer par ifup, indiquer la persistance, booter silencieusement (écran splash à l&#039;appui), etc.
</p>

<p>
Que sont ces fichiers du dossier <strong>/casper</strong> :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <strong>/casper/vmlinuz</strong> : <strong>kernel</strong> de linux au format compressé (d&#039;où le &quot;z&quot; au lieu du &quot;x&quot;), c&#039;est à dire le noyau de linux, par défaut sans interractions extérieures possibles et qui sera chargé en mémoire vive.</div>
</li>
<li class="level1"><div class="li"> <strong>/casper/initrd.lz</strong> : (<a href="http://en.wikipedia.org/wiki/Initrd" class="urlextern" title="http://en.wikipedia.org/wiki/Initrd" rel="nofollow">initial ramdisk</a>) ajoute une sorte de mini système d&#039;exploitation (compressé et lui aussi en mémoire vive) qui permettra, entre autre, d&#039;interagir sur le kernel, de lui ajouter des pilotes et des fonctionnalités, mais aussi, il permettra de dialoguer avec l&#039;utilisateur.</div>
</li>
</ul>

<p>
Pour s&#039;en convaincre, si le chargement du système échoue après l&#039;exécution du boot loader <strong>/syslinux.sys</strong>, on se retrouve avec une ligne de commande (initramfs) avec un shell qui prend en compte les commandes busybox (<a href="http://fr.wikipedia.org/wiki/BusyBox" class="urlextern" title="http://fr.wikipedia.org/wiki/BusyBox" rel="nofollow">wiki</a>).
</p>

<p>
Maintenant que le mini-système et ses pilotes sont en mémoire, l&#039;installation Live commence…
</p>

</div>

<h4 id="er_demarrage_systeme">1er démarrage système</h4>
<div class="level4">
<div class="noteimportant">Ne maitrisant pas du tout le processus de boot du système Live, je préfère m&#039;abstenir de dire des bêtises et sauter directement à la phase suivante

</div>
<p>
Notre système de fichier est monté.
</p>

<p>
L&#039;étape suivante c&#039;est l&#039;exécution automatique de <strong>/etc/profile</strong> (point d&#039;entrée sous notre contrôle - voir <a href="#synoptique_et_role_des_fichiers" title="tutoriel:lubuntu_usb_creator ↵" class="wikilink1">synoptique</a>), qui va exécuter un script externe au système <strong>/cdrom/scripts/runme1st_from_ext.sh</strong> (externe, car il se trouve sur la première partition du Live <abbr title="Universal Serial Bus">USB</abbr>). Cette étape va s&#039;effectuer APRES l&#039;ouverture de la Live session, lorsque le bureau sera affiché, pour avoir une interaction avec l&#039;utilisateur final (vous). Ce dernier pourra alors suivre les opérations en cours dans un terminal. Si on ne lui montre pas, il aura l&#039;impression que le démarrage dure (c&#039;est tordu, mais ça marche :D !)
</p>

<p>
Remarque importante :
</p>

<p>
Pour arriver à créer ce point d&#039;entrée, on a extrait le contenu du fichier <strong>&lt;racine_live_usb&gt;/casper/filesystem.squashfs</strong> (système d&#039;exploitation au format compressé <a href="http://fr.wikipedia.org/wiki/SquashFS" class="urlextern" title="http://fr.wikipedia.org/wiki/SquashFS" rel="nofollow">SQUASHFS</a> en lecture seule), on en a modifié le fichier <strong>&lt;racine_contenu&gt;/etc/profile</strong> et on a reconstruit <strong>&lt;racine_live_usb&gt;/casper/filesystem.squashfs</strong>. La modification ayant inséré dans <strong>/etc/profile</strong> une unique instruction qui dit tout simplement : exécute le fichier externe <strong>/cdrom/scripts/runme1st_from_ext.sh</strong> (voir <a href="#synoptique_et_role_des_fichiers" title="tutoriel:lubuntu_usb_creator ↵" class="wikilink1">synoptique</a>)
</p>

<p>
Ce script externe va supprimer son propre déclencheur dans <strong>/etc/profile</strong> (pour éviter qu&#039;il soit exécuté à chaque démarrage) et réaliser la première phase de post-installation.
</p>

<p>
Cette première phase va permettre d&#039;installer le système aux petits oignons : sa configuration réseau, ses outils, ses réglages, l&#039;utilisateur final (vous), l&#039;accès distant et dernière étape, la création du script <strong>/home/runmelast.sh</strong> avec son déclencheur ajouté dans <strong>/etc/rc.local</strong>.
</p>

<p>
<strong>/home/runmelast.sh</strong> sera exécuté après redémarrage.
</p>

<p>
Cette première phase s&#039;achève avec le redémarrage de la machine.
</p>

</div>

<h4 id="eme_demarrage_systeme">2ème démarrage système</h4>
<div class="level4">

<p>
La deuxième phase de post-installation démarre avec l&#039;exécution automatique du script <strong>/etc/rc.local</strong> qui exécute à son tour <strong>/home/runmelast.sh</strong>.
</p>

<p>
<strong>/home/runmelast.sh</strong> va supprimer : l&#039;utilisateur de la Live session qui n&#039;est plus utile et qui a un mot de passe vide (on ne pouvait pas le faire avant car on était sur sa propre session, donc impossible de se supprimer soi-même), son déclencheur dans <strong>/etc/rc.local</strong>, lui-même.
</p>

<p>
Et voilou !
</p>

</div>
<div class='secedit editbutton_section editbutton_21'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Fonctionnement] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="fonctionnement" /><input type="hidden" name="codeblockOffset" value="15" /><input type="hidden" name="range" value="30609-36212" /><button type="submit" title="Fonctionnement" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit22" id="synoptique_et_role_des_fichiers">Synoptique et rôle des fichiers</h3>
<div class="level3">

<p>
Synoptique de LUC :
</p>

<p>
<a href="/_media/tutoriel/luc_synoptic.png" class="media" title="tutoriel:luc_synoptic.png"><img src="/_media/tutoriel/luc_synoptic.png" class="media img-responsive" alt="" /></a>
</p>

<p>
Rôle des fichiers :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> luc : dossier projet</div>
</li>
<li class="level1"><div class="li"> luc/iso : montage du fichier ISO</div>
</li>
<li class="level1"><div class="li"> luc/iso/casper/filesystem.squashfs : le filesystem du Live CD au format squashfs</div>
</li>
<li class="level1"><div class="li"> luc/liveusb : dossier montage du support <abbr title="Universal Serial Bus">USB</abbr></div>
</li>
<li class="level1"><div class="li"> luc/liveusb/casper/filesystem.squashfs : le filesystem du Live <abbr title="Universal Serial Bus">USB</abbr> au format squashfs RO</div>
</li>
<li class="level1"><div class="li"> luc/liveusb/casper/vmlinuz : le kernel linux compressé qui sera chargé en mémoire</div>
</li>
<li class="level1"><div class="li"> luc/liveusb/casper/initrd.lz : sorte de mini-<abbr title="Operating System">OS</abbr> chargé en mémoire, qui interface kernel + utilisateur</div>
</li>
<li class="level1"><div class="li"> luc/liveusb/idlinux.sys : bootloader qui rend le support bootable (généré par syslinux)</div>
</li>
<li class="level1"><div class="li"> luc/liveusb/scripts : scripts externes au live <abbr title="Universal Serial Bus">USB</abbr> (accessible depuis <strong>/cdrom</strong> du Live <abbr title="Universal Serial Bus">USB</abbr>)</div>
</li>
<li class="level1"><div class="li"> luc/liveusb/scripts/reset.sh : réinitialise tout comme au premier boot (donnée persistantes de <strong>casper-rw perdues</strong>)</div>
</li>
<li class="level1"><div class="li"> luc/liveusb/scripts/runme1st_from_ext.sh : script auto-déclenché au premier boot du Live <abbr title="Universal Serial Bus">USB</abbr> par le point d&#039;entrée <strong>/etc/profile</strong></div>
</li>
<li class="level1"><div class="li"> luc/liveusb/syslinux/gfxboot.c32 : fichier remplacé par celui de PC-BUILDER</div>
</li>
<li class="level1"><div class="li"> luc/liveusb/syslinux/syslinux.cfg : configuration de boot du Live <abbr title="Universal Serial Bus">USB</abbr></div>
</li>
<li class="level1"><div class="li"> luc/squashfs : dossier montage de <strong>luc/filesystem.squashfs</strong></div>
</li>
<li class="level1"><div class="li"> luc/custom-squashfs : dossier RW sur une copie du contenu de <strong>luc/iso/casper/filesystem.squashfs</strong>, on ajoute uniquement le point d&#039;entrée dans <strong>/etc/profile</strong> vers <strong>/cdrom/scripts/runme1st.sh</strong></div>
</li>
<li class="level1"><div class="li"> luc/filesystem.squashfs : copie en RW de <strong>luc/iso/casper/filesystem.squashfs</strong> en RO</div>
</li>
</ul>

<p>
Nota : RW (Lecture / Ecriture), RO (Lecture seule)
</p>

</div>
<div class='secedit editbutton_section editbutton_22'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Synoptique et rôle des fichiers] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="synoptique_et_role_des_fichiers" /><input type="hidden" name="codeblockOffset" value="16" /><input type="hidden" name="range" value="36213-37846" /><button type="submit" title="Synoptique et rôle des fichiers" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit23" id="mode_d_emploi">Mode d&#039;emploi</h3>
<div class="level3">
<div class="noteimportant">Pour automatiser la gestion du réseau, je n&#039;ai pas eu d&#039;autre choix, que de me passer du Network Manager qui n&#039;est pas configurable en ligne de commande sous Ubuntu. La version nmcli ne permet pas le paramétrage sous Ubuntu (apparemment sous les autres distributions ça marche). Je ne le désinstalle pas, il est seulement &quot;caché&quot; par le paramètre <strong>ip=frommedia</strong> de <strong>&lt;racine_live_<abbr title="Universal Serial Bus">USB</abbr>&gt;/syslinux/syslinux.cfg</strong>. Supprimer le paramètre et redémarrer permettra d&#039;utiliser à nouveau le Network Manager.

</div>
<p>
Copier le contenu du <a href="#le_code" title="tutoriel:lubuntu_usb_creator ↵" class="wikilink1">script OneTouch</a> et le coller dans le fichier  <strong>luc_onetouch_install.sh</strong>
</p>

<p>
Donnez vous les droits d&#039;exécution :<br/>

</p>
<pre class="code bash"><span class="kw2">chmod</span> u+x luc_onetouch_install.sh</pre>

<p>
Déterminer le support que vous allez utiliser :<br/>

</p>
<pre class="code bash">lsblk <span class="re5">-o</span> NAME,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT</pre>

</div>

<h4 id="configurer_parametres_fonctionnels_ou_laisser_les_valeurs_par_defaut">Configurer paramètres fonctionnels (ou laisser les valeurs par défaut)</h4>
<div class="level4">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <strong>DEV</strong> : c&#039;est un support entier choisi et non une partition (ex : DEV=/dev/sde)</div>
</li>
<li class="level1"><div class="li"> <strong>ISO</strong> : chemin absolu du fichier ISO de Lubuntu (ex : ISO=&#039;/ISO/lubuntu-14.10-desktop-i386.iso&#039;</div>
</li>
<li class="level1"><div class="li"> <strong>ME</strong> : c&#039;est … vous, le nom de login de votre utilisateur (ex : ME=lnj)</div>
</li>
<li class="level1"><div class="li"> <strong>ME_FULL</strong> : c&#039;est encore vous mais avec le nom long (ex : ME_FULL=&#039;Le nain jaune&#039;)</div>
</li>
<li class="level1"><div class="li"> <strong>NET_ADDRESS</strong> : adresse IP statique donnée au PC-LIVE (ex : NET_ADDRESS=192.168.0.3)</div>
</li>
<li class="level1"><div class="li"> <strong>NET_NETMASK</strong> : masque réseau du réseau de PC-LIVE (ex : NET_NETMASK=255.255.255.0)</div>
</li>
<li class="level1"><div class="li"> <strong>NET_GATEWAY</strong> : la passerelle du réseau de PC-LIVE (ex : NET_GATEWAY=192.168.0.254)</div>
</li>
<li class="level1"><div class="li"> <strong>NET_<abbr title="Domain Name System">DNS</abbr></strong> : un serveur <abbr title="Domain Name System">DNS</abbr> accessible par le PC-LIVE (ex : NET_<abbr title="Domain Name System">DNS</abbr>=8.8.8.8)</div>
</li>
</ul>

</div>

<h4 id="configurer_les_parametres_pre-configures_ou_laisser_les_valeurs_par_defaut">Configurer les paramètres pré-configurés (ou laisser les valeurs par défaut)</h4>
<div class="level4">

<p>
Remarque : pour plus de détails, voir le <a href="#le_code" title="tutoriel:lubuntu_usb_creator ↵" class="wikilink1">script OneTouch</a>
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <strong><abbr title="Universal Serial Bus">USB</abbr>_LABEL</strong> : le nom de la partition 1 de votre Live <abbr title="Universal Serial Bus">USB</abbr> (ex : <abbr title="Universal Serial Bus">USB</abbr>_LABEL=L_LUBUNTU)</div>
</li>
<li class="level1"><div class="li"> <strong><abbr title="Universal Serial Bus">USB</abbr>_PART1_SIZE</strong> : la taille de la partition 1 (ex : <abbr title="Universal Serial Bus">USB</abbr>_PART1_SIZE=1G)</div>
</li>
<li class="level1"><div class="li"> <strong><abbr title="Universal Serial Bus">USB</abbr>_PART2_SIZE</strong> : la taille de la partition 2 (ex : <abbr title="Universal Serial Bus">USB</abbr>_PART2_SIZE=100%)</div>
</li>
<li class="level1"><div class="li"> <strong>LIVE_<abbr title="Universal Serial Bus">USB</abbr>_BOOT_MESSAGE</strong> : Message de bienvenue lors du démarrage (ex: LIVE_<abbr title="Universal Serial Bus">USB</abbr>_BOOT_MESSAGE=&#039;Lubuntu <abbr title="Universal Serial Bus">USB</abbr> Live Persistant&#039;</div>
</li>
<li class="level1"><div class="li"> <strong>LIVE_<abbr title="Universal Serial Bus">USB</abbr>_BOOT_QUIET</strong> : indique si le démarrage est verbeux / silencieux (0/1) (ex : LIVE_<abbr title="Universal Serial Bus">USB</abbr>_BOOT_QUIET=1)</div>
</li>
<li class="level1"><div class="li"> <strong>ME_DEFAULT_PASSWORD</strong> : mon mot de passe en clair pour l&#039;installation ; à changer dès l&#039;ouverture de session (ex : ME_DEFAULT_PASSWORD=lubuntu)</div>
</li>
<li class="level1"><div class="li"> <strong>EMBED_PACKETS</strong> : liste des logiciels qui seront installés (SSH sera automatiquement ajouté) (ex : EMBED_PACKETS=&#039; &#039;)</div>
</li>
<li class="level1"><div class="li"> <strong>EMBED_<abbr title="Virtual Network Computing">VNC</abbr></strong> : indique si <abbr title="Virtual Network Computing">VNC</abbr> sera non installé / installé (0/1) (ex : EMBED_<abbr title="Virtual Network Computing">VNC</abbr>=1)</div>
</li>
<li class="level1"><div class="li"> <strong>UPDATE_<abbr title="Operating System">OS</abbr></strong> : indique si on occulte / fait la MAJ <abbr title="Operating System">OS</abbr> (0/1) (ex : UPDATE_<abbr title="Operating System">OS</abbr>=1)</div>
</li>
<li class="level1"><div class="li"> <strong>INSTALL_APP_LANG</strong> : indique si on occulte / installe le support de langues pour les applications (0/1) (ex : INSTALL_APP_LANG=1)</div>
</li>
</ul>

</div>

<h4 id="installer_le_support">Installer le support</h4>
<div class="level4">

<p>
Exécuter :<br/>

</p>
<pre class="code bash"><span class="kw2">sudo</span> .<span class="sy0">/</span>luc_onetouch_install.sh</pre>

</div>

<h4 id="utiliser_la_configuration_rapide">Utiliser la configuration rapide</h4>
<div class="level4">

<p>
Exécuter :<br/>

</p>
<pre class="code bash"><span class="kw2">sudo</span> .<span class="sy0">/</span>luc_onetouch_install.sh DEV ISO</pre>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <strong>DEV</strong> est un support entier et est nécessairement le 1er paramètre</div>
</li>
<li class="level1"><div class="li"> <strong>ISO</strong> (optionnel) est le chemin de l&#039;ISO et est nécessairement le 2ème paramètre</div>
</li>
</ul>

<p>
Cette configuration rapide permet de ne pas modifier le script pour ces paramètres.
</p>

</div>

<h4 id="modifier_vos_mots_de_passe">Modifier vos mots de passe</h4>
<div class="level4">

<p>
Une fois le Live <abbr title="Universal Serial Bus">USB</abbr> démarré et opérationnel, n&#039;oubliez pas de modifier sur le PC-LIVE :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Mot de passe de session : <pre class="code bash"><span class="kw2">passwd</span></pre>
</div>
</li>
<li class="level1"><div class="li"> Mot de passe de <abbr title="Virtual Network Computing">VNC</abbr> (si vous l&#039;avez installé) : <pre class="code bash">x11vnc <span class="re5">-storepasswd</span></pre>
</div>
</li>
</ul>

</div>

<h4 id="les_outils">Les outils</h4>
<div class="level4">

<p>
Des alias ont été ajoutés au profil de l&#039;utilisateur final (vous) dans le fichier <strong>~/.bahsrc</strong> ; ils ciblent des fichier du dossier externe <strong>/cdrom</strong>.
</p>

<p>
Les outils :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> luc_edit_runme1st : édite le script <strong>/cdrom/scripts/runme1st_from_ext.sh</strong></div>
</li>
<li class="level1"><div class="li"> luc_edit_syslinux : édite la configuration <strong>/cdrom/syslinux/syslinux.cfg</strong></div>
</li>
<li class="level1"><div class="li"> luc_reset : (attention : contenu de la persistance perdu) réinitialise la partition <strong>casper-rw</strong> (<strong>/cdrom/scripts/reset.sh</strong>) ; redémarrage nécessaire avec le mot de passe configuré dans <strong>ME_DEFAULT_PASSWORD</strong></div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_23'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Mode d&#039;emploi] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="mode_d_emploi" /><input type="hidden" name="codeblockOffset" value="16" /><input type="hidden" name="range" value="37847-42072" /><button type="submit" title="Mode d&#039;emploi" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit24" id="le_code">Le code</h3>
<div class="level3">
<div class="noteclassic">Si vous avez des commentaires, remarqué des erreurs ou adapté le script à d&#039;autres distributions, n&#039;hésitez pas à faire un retour sur le <a href="http://forum.ubuntu-fr.org/viewtopic.php?pid=19673001#p19673001" class="urlextern" title="http://forum.ubuntu-fr.org/viewtopic.php?pid=19673001#p19673001" rel="nofollow">forum</a>.
</div>
<p>
Le script luc_onetouch_install.sh (n&#039;oubliez pas de <a href="#mode_d_emploi" title="tutoriel:lubuntu_usb_creator ↵" class="wikilink1">configurer</a>)
</p>
<dl class="code">
<dt><a href="/_export/code/tutoriel/lubuntu_usb_creator?codeblock=22" title="Télécharger cet extrait" class="mediafile mf_sh">luc_onetouch_install.sh</a></dt>
<dd><pre class="code bash"><span class="co0">#!/bin/bash</span>
&nbsp;
<span class="co0"># LUBUNTU USB CREATOR aka LUC (run as sudo only)</span>
<span class="co0"># Up to date version : https://doc.ubuntu-fr.org/tutoriel/lubuntu_usb_creator</span>
<span class="co0"># v1.4 lnj 22/04/2015</span>
&nbsp;
<span class="co0"># USAGE : luc_onetouch_install.sh [DEV [ISO]]</span>
<span class="co0"># Where optional DEV is device disk (not a partition) and optional ISO an ISO file.</span>
&nbsp;
<span class="co0"># Supported versions : https://doc.ubuntu-fr.org/tutoriel/lubuntu_usb_creator?do=edit&amp;rev=0#plateformes_supportees</span>
&nbsp;
<span class="co0"># History : </span>
<span class="co0">#	- v1.4 lnj 22/04/2015 : adding needed dependency</span>
<span class="co0">#	- v1.3 lnj 15/04/2015 : adding needed dependency squashfs-tools  </span>
<span class="co0">#	- v1.2 lnj 12/04/2015</span>
&nbsp;
<span class="co0"># Different links which help me :</span>
<span class="co0"># http://askubuntu.com/questions/397481/how-to-make-a-persistent-live-ubuntu-usb-with-more-than-4gb</span>
<span class="co0"># http://david.hautbois.free.fr/wordpress/index.php/175-how-to-customize-your-ubuntu-live-usb-stick</span>
<span class="co0"># http://day-to-day-stuff.blogspot.fr/2011/03/on-making-custom-ubuntu-bootable-usb.html</span>
<span class="co0"># more - boot process : https://wiki.archlinux.org/index.php/syslinux</span>
<span class="co0"># http://doc.ubuntu-fr.org/tutoriel/live_usb_install4</span>
<span class="co0"># http://www.linux.com/community/blogs/133-general-linux/420179-creating-a-debian-live-usb-flash-drive-with-persistence-for-non-techies</span>
<span class="co0"># https://help.ubuntu.com/community/USB%20Installation%20Media)</span>
&nbsp;
&nbsp;
<span class="co0">################################## CHOOSE HDD #####################################</span>
&nbsp;
<span class="co0"># to retrieve parts and disks : http://www.labtestproject.com/using_linux/partition_hard_disk_using_fdisk_command_on_linux_fedora_system</span>
<span class="co0"># lsblk -o NAME,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT</span>
&nbsp;
&nbsp;
<span class="co0">################################ STATIC SETTINGS ##################################</span>
&nbsp;
<span class="co0"># ------------------------------- FUNCTIONAL --------------------------------------</span>
<span class="co0"># DEV : the DEV disk used to install Live USB (not part) ; can be given from $1 arg</span>
<span class="co0">#	See lsblk command above to determine the target disk</span>
<span class="co0">#	!!! Warning: DEV data will be permanently deleted (no possible return ) !!!</span>
<span class="co0"># ISO : ISO file location (only absolute paths is possible) ; i.e. '/ISO/tux.iso'</span>
<span class="co0"># ME : my short name user </span>
<span class="co0"># ME_FULL : my full name user </span>
<span class="co0"># NET_ADDRESS :	static IP address wanted in my network</span>
<span class="co0">#	!!! Becareful : possible IP conflict with other PC, especially DHCP scope !!!</span>
<span class="co0"># NET_NETMASK : my network mask</span>
<span class="co0"># NET_GATEWAY : the accessible gateway (i.e. to join the Internet)</span>
<span class="co0"># NET_DNS : an accessible DNS server to allow internet browsing and apt-get jobs too</span>
&nbsp;
<span class="re2">DEV</span>=<span class="sy0">/</span>dev<span class="sy0">/</span>sde
<span class="co0">#	!!! Warning: DEV data will be permanently deleted (no possible return ) !!!</span>
<span class="re2">ISO</span>=<span class="st_h">'/ISO/lubuntu-14.10-desktop-i386.iso'</span>
<span class="re2">ME</span>=user
<span class="re2">ME_FULL</span>=<span class="st_h">'User'</span>
<span class="re2">NET_ADDRESS</span>=192.168.0.3
<span class="re2">NET_NETMASK</span>=255.255.255.0
<span class="re2">NET_GATEWAY</span>=192.168.0.254
<span class="re2">NET_DNS</span>=8.8.8.8
&nbsp;
<span class="co0"># ------------------------------- PRE-CONFIGURED -----------------------------------</span>
<span class="co0"># USB_LABEL : partition 1 label [default : L_LUBUNTU (Live LUBUNTU)]</span>
<span class="co0"># USB_PART1_SIZE : size for the partition 1</span>
<span class="co0">#	[recommended : USB_PART1_SIZE=1G - for 1 GB, see man parted search unit]</span>
<span class="co0"># USB_PART2_SIZE : size for the partition 2</span>
<span class="co0">#	[recommended : USB_PART2_SIZE=100% - for all the remaining space] </span>
<span class="co0">#	If we want a 3rd part or more, not give 100% or specify in absolute size</span>
<span class="co0">#	for example 10GB (see man parted and search unit)</span>
<span class="co0"># LIVE_USB_BOOT_MESSAGE : welcome boot message [dft : 'Lubuntu USB Live Persistant']</span>
<span class="co0"># LIVE_USB_BOOT_QUIET : 0/1 (0 =&gt; verbose/no splash, 1 =&gt; quiet with splash)</span>
<span class="co0">#	[default : 1]</span>
<span class="co0"># ME_DEFAULT_PASSWORD : my simple default password (change it for first logon)</span>
<span class="co0">#	!!! Becareful : password in clear, so give a temp simple password !!!</span>
<span class="co0">#	[default : lubuntu]</span>
<span class="co0"># EMBED_PACKETS : list of packets automatically installed at 1st boot</span>
<span class="co0">#	separate all packets by a space</span>
<span class="co0">#	i.e. EMBED_PACKETS='htop vim'</span>
<span class="co0">#	[default : '']</span>
<span class="co0">#	Nota : ssh is later included by default</span>
<span class="co0"># EMBED_VNC : 0/1 embed VNC for remote desktop (0 =&gt; no, 1 =&gt; yes)</span>
<span class="co0">#	http://adept1formatique.unblog.fr/2013/08/12/bureau-a-distance-avec-lubuntu/</span>
<span class="co0">#	[default : 1]</span>
<span class="co0"># UPDATE_OS : 0/1 update OS (take a while) (0 =&gt; no, 1 =&gt; yes)</span>
<span class="co0">#	[default : 1]</span>
<span class="co0"># INSTALL_APP_LANG : 0/1 install language for apps (take a while) (0 =&gt; no, 1 =&gt; yes)</span>
<span class="co0">#	[default : 1]</span>
&nbsp;
<span class="re2">USB_LABEL</span>=L_LUBUNTU
<span class="re2">USB_PART1_SIZE</span>=1G
<span class="re2">USB_PART2_SIZE</span>=<span class="nu0">100</span><span class="sy0">%</span>
<span class="re2">LIVE_USB_BOOT_MESSAGE</span>=<span class="st_h">'Lubuntu USB Live Persistant'</span>
<span class="re2">LIVE_USB_BOOT_QUIET</span>=<span class="nu0">1</span>
<span class="re2">ME_DEFAULT_PASSWORD</span>=lubuntu
<span class="co0">#	!!! Becareful : password in clear, so give a temp simple password !!!</span>
<span class="re2">EMBED_PACKETS</span>=<span class="st_h">''</span>
<span class="re2">EMBED_VNC</span>=<span class="nu0">1</span>
<span class="re2">UPDATE_OS</span>=<span class="nu0">1</span>
<span class="re2">INSTALL_APP_LANG</span>=<span class="nu0">1</span>
&nbsp;
&nbsp;
<span class="co0"># ----------------------------------------------------------------------</span>
&nbsp;
<span class="co0"># For future version</span>
<span class="co0">#</span>
<span class="co0"># DEFAULT_LIVE_USB_USER : default live session user</span>
<span class="co0"># NETWORK_MANAGER_ACTIVE : 0/1 indicate how to manage network (0 =&gt; ifup, 1 =&gt; NM)</span>
<span class="co0">#	[default : 0]</span>
<span class="co0"># LOCALE : embed locale for keyboard, live session boot and other stuff</span>
<span class="co0">#	[default : FR so 'locale=fr_FR.UTF-8 console-setup/layoutcode=fr'</span>
<span class="co0"># LANGUAGE_SUPPORT : make apps language with the right language support</span>
<span class="co0">#	[default : fr]</span>
<span class="co0"># DATE_TIME_ZONE : synchro Time Zone (http://askubuntu.com/a/594186)</span>
<span class="co0">#	[default : Europe/Paris]</span>
<span class="co0"># WAITING_REBOOT_TITLE : title to display in the terminal before reboot</span>
<span class="co0">#	[default : 'Patienter avant le redémarrage...']</span>
&nbsp;
<span class="re2">DEFAULT_LIVE_USB_USER</span>=lubuntu
<span class="re2">NETWORK_MANAGER_ACTIVE</span>=<span class="nu0">0</span>
<span class="re2">LOCALE</span>=<span class="st_h">'locale=fr_FR.UTF-8 console-setup/layoutcode=fr'</span>
<span class="re2">LANGUAGE_SUPPORT</span>=fr
<span class="re2">DATE_TIME_ZONE</span>=Europe<span class="sy0">/</span>Paris
<span class="re2">WAITING_REBOOT_TITLE</span>=<span class="st_h">'Patienter avant le redémarrage...'</span>
&nbsp;
<span class="co0"># Embed ssh to install</span>
<span class="re2">EMBED_PACKETS</span>=<span class="st0">&quot;ssh <span class="es2">$EMBED_PACKETS</span>&quot;</span>
&nbsp;
<span class="co0"># Embed VNC to install</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re1">$EMBED_VNC</span> <span class="re5">-eq</span> <span class="nu0">1</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
	<span class="re2">EMBED_PACKETS</span>=<span class="st0">&quot;<span class="es2">$EMBED_PACKETS</span> vino x11vnc&quot;</span>
<span class="kw1">fi</span>
&nbsp;
<span class="co0"># Quiet or not</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re1">$LIVE_USB_BOOT_QUIET</span> <span class="re5">-eq</span> <span class="nu0">1</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
	<span class="re2">LIVE_USB_BOOT_QUIET</span>=<span class="st_h">'quiet splash'</span>
<span class="kw1">else</span>
	<span class="re2">LIVE_USB_BOOT_QUIET</span>=
<span class="kw1">fi</span>
&nbsp;
<span class="co0"># Manage network with NM or ifup</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re1">$NETWORK_MANAGER_ACTIVE</span> <span class="re5">-eq</span> <span class="nu0">1</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
	<span class="re2">NETWORK_MANAGER_ACTIVE</span>=
<span class="kw1">else</span>
	<span class="re2">NETWORK_MANAGER_ACTIVE</span>=<span class="st_h">'ip=frommedia'</span>
<span class="kw1">fi</span>
&nbsp;
<span class="co0"># Define customized colors : http://stackoverflow.com/a/5947802</span>
<span class="re2">C_red</span>=<span class="st_h">'\033[1;31m'</span>
<span class="re2">C_blue</span>=<span class="st_h">'\033[0;34m'</span>
<span class="re2">C_green</span>=<span class="st_h">'\033[0;32m'</span>
<span class="re2">C_yellow</span>=<span class="st_h">'\033[1;33m'</span>
<span class="re2">C_NC</span>=<span class="st_h">'\033[0m'</span>
&nbsp;
<span class="co0"># Echoing all steps (usage : echof &quot;...&quot; [color])</span>
<span class="co0"># a=( &quot;$@&quot; ) ... ${a[1]} because ${$2} does not work (args to array)</span>
<span class="co0"># http://stackoverflow.com/a/18041780 + http://stackoverflow.com/a/12711837</span>
<span class="kw1">function</span> echof <span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;$2&quot;</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span> <span class="re2">a</span>=<span class="br0">&#40;</span> <span class="st0">&quot;$@&quot;</span> <span class="br0">&#41;</span> ; <span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;<span class="es1">\n</span><span class="es3">${a[1]}</span>=&gt; $1<span class="es3">${C_NC}</span><span class="es1">\n</span>&quot;</span> ; <span class="kw1">else</span> <span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;<span class="es1">\n</span><span class="es3">${C_yellow}</span>=&gt; $1<span class="es3">${C_NC}</span><span class="es1">\n</span>&quot;</span> ; <span class="kw1">fi</span> <span class="br0">&#125;</span>
&nbsp;
&nbsp;
<span class="co0">############################## PROTECT DATA #############################</span>
&nbsp;
<span class="re2">LUC_MNT</span>=~<span class="sy0">/</span>tmp<span class="sy0">/</span>mnt
&nbsp;
<span class="co0"># If we give arg1 it will become DEV</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;$1&quot;</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
	<span class="re2">DEV</span>=<span class="re4">$1</span>
<span class="kw1">fi</span>
&nbsp;
<span class="co0"># If we give arg2 it will become ISO</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;$2&quot;</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
	<span class="re2">ISO</span>=<span class="st0">&quot;$2&quot;</span>
<span class="kw1">fi</span>
&nbsp;
<span class="co0"># Get DISK part of DEV, so /dev/sde gives sde</span>
<span class="re2">DISK</span>=<span class="sy0">`</span><span class="kw3">echo</span> <span class="re1">$DEV</span> <span class="sy0">|</span><span class="kw2">sed</span> <span class="st0">&quot;s/.*\/\([a-z]*\)$/\1/&quot;</span><span class="sy0">`</span>
&nbsp;
<span class="co0"># If DEV is not a real device disk</span>
<span class="re2">IS_DISK</span>=<span class="sy0">`</span>lsblk <span class="re5">-o</span> NAME,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT <span class="sy0">|</span><span class="kw2">grep</span> ^<span class="re1">$DISK</span><span class="sy0">`</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="sy0">!</span> <span class="st0">&quot;<span class="es2">$IS_DISK</span>&quot;</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
	<span class="kw3">echo</span> <span class="st0">&quot;Error : <span class="es2">$DEV</span> is not a valid disk !&quot;</span>
	<span class="kw3">exit</span> <span class="nu0">1</span>
<span class="kw1">fi</span>
&nbsp;
<span class="co0"># If ISO file does not exist</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="sy0">!</span> <span class="re5">-f</span> <span class="st0">&quot;<span class="es2">$ISO</span>&quot;</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
	<span class="kw3">echo</span> <span class="st0">&quot;Error : <span class="es2">$ISO</span> ISO file does not exist !&quot;</span>
	<span class="kw3">exit</span> <span class="nu0">2</span>
<span class="kw1">fi</span>
&nbsp;
<span class="co0"># Infos about selected device</span>
<span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;<span class="es1">\n</span><span class="es3">${C_yellow}</span>Block device of <span class="es3">${C_blue}</span><span class="es2">$DEV</span><span class="es3">${C_NC}</span> :&quot;</span>
<span class="re2">RES</span>=<span class="sy0">`</span>lsblk <span class="re5">-o</span> NAME,TYPE,FSTYPE,LABEL,SIZE,MOUNTPOINT <span class="sy0">|</span><span class="kw2">sed</span> <span class="st0">&quot;1p;/<span class="es2">$DISK</span>/!d&quot;</span><span class="sy0">`</span>
<span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;<span class="es3">${C_green}</span><span class="es2">$RES</span><span class="es3">${C_NC}</span>&quot;</span>
&nbsp;
<span class="kw2">mkdir</span> <span class="re5">-p</span> <span class="re1">$LUC_MNT</span>
&nbsp;
<span class="co0"># For each partition we display the partial content</span>
<span class="kw1">for</span> X <span class="kw1">in</span> <span class="sy0">`</span><span class="kw3">echo</span> <span class="re1">$DEV</span><span class="sy0">`*</span>
<span class="kw1">do</span>
	<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re1">$X</span> <span class="sy0">!</span>= <span class="re1">$DEV</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
		<span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;<span class="es1">\n</span><span class="es3">${C_yellow}</span>Partial content of <span class="es3">${C_blue}</span><span class="es2">$X</span><span class="es3">${C_NC}</span> :&quot;</span>
&nbsp;
		<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es5">`mount |grep $X`</span>&quot;</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
			<span class="re2">FOLDER</span>=<span class="sy0">`</span><span class="kw2">mount</span> <span class="sy0">|</span><span class="kw2">grep</span> <span class="re1">$X</span> <span class="sy0">|</span><span class="kw2">cut</span> <span class="re5">-f</span> <span class="nu0">3</span> <span class="re5">-d</span> <span class="st0">&quot; &quot;</span><span class="sy0">`</span>
			<span class="re2">CONTENT</span>=<span class="sy0">`</span><span class="kw2">ls</span> <span class="re5">-alF</span> <span class="re1">$FOLDER</span> <span class="sy0">|</span> <span class="kw2">head</span><span class="sy0">`</span>
		<span class="kw1">else</span>
			<span class="kw2">mount</span> <span class="re1">$X</span> <span class="re1">$LUC_MNT</span>
			<span class="re2">CONTENT</span>=<span class="sy0">`</span><span class="kw2">ls</span> <span class="re5">-alF</span> <span class="re1">$LUC_MNT</span> <span class="sy0">|</span> <span class="kw2">head</span><span class="sy0">`</span>
			<span class="kw2">umount</span> <span class="re5">-l</span> <span class="re1">$LUC_MNT</span>
		<span class="kw1">fi</span>
&nbsp;
		<span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;<span class="es2">$CONTENT</span>&quot;</span>
	<span class="kw1">fi</span>
<span class="kw1">done</span>
&nbsp;
<span class="kw2">rmdir</span> <span class="re1">$LUC_MNT</span>
&nbsp;
<span class="co0"># Confirm or not : http://stackoverflow.com/a/1885534</span>
<span class="re2">MSG</span>=<span class="st0">&quot;<span class="es1">\n</span><span class="es3">${C_red}</span>You are about destroying all data from <span class="es3">${C_blue}</span><span class="es2">$DEV</span><span class="es3">${C_red}</span>&quot;</span>
<span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;<span class="es2">$MSG</span> (no return is possible) !<span class="es3">${C_NC}</span>&quot;</span>
<span class="kw2">read</span> <span class="re5">-p</span> <span class="st0">&quot;Are you sure (y/[N]) ? &quot;</span> <span class="re5">-r</span>
<span class="kw3">echo</span>
&nbsp;
<span class="kw1">if</span> <span class="br0">&#91;</span><span class="br0">&#91;</span> <span class="sy0">!</span> <span class="re1">$REPLY</span> =~ ^<span class="br0">&#91;</span>y<span class="br0">&#93;</span>$ <span class="br0">&#93;</span><span class="br0">&#93;</span>
<span class="kw1">then</span>
	<span class="kw3">exit</span> <span class="nu0">0</span>
<span class="kw1">fi</span>
&nbsp;
<span class="co0"># do dangerous stuff</span>
<span class="co0">#echo Destroy en cours...</span>
&nbsp;
&nbsp;
<span class="co0">################################ PREPARE ################################</span>
&nbsp;
<span class="co0"># LUC paths</span>
<span class="re2">LUC_PATH</span>=~<span class="sy0">/</span>luc
<span class="re2">LUC_LIVEUSB_PATH</span>=~<span class="sy0">/</span>luc<span class="sy0">/</span>liveusb
<span class="re2">LUC_ISO_PATH</span>=~<span class="sy0">/</span>luc<span class="sy0">/</span>iso
<span class="re2">LUC_SQUASHFS_PATH</span>=~<span class="sy0">/</span>luc<span class="sy0">/</span>squashfs
<span class="re2">LUC_CUSTOM_SQUASHFS_PATH</span>=~<span class="sy0">/</span>luc<span class="sy0">/</span>custom-squashfs
&nbsp;
<span class="co0"># Scripts and other stuff paths</span>
<span class="re2">SCRIPTS_PATH</span>=<span class="re1">$LUC_LIVEUSB_PATH</span><span class="sy0">/</span>scripts
<span class="re2">RUNME1ST_ROOT_PATH</span>=scripts<span class="sy0">/</span>runme1st_from_ext.sh
<span class="re2">RUNME1ST_EXT_PATH</span>=<span class="sy0">/</span>cdrom<span class="sy0">/</span><span class="re1">$RUNME1ST_ROOT_PATH</span>
<span class="re2">SYSLINUX_EXT_PATH</span>=<span class="sy0">/</span>cdrom<span class="sy0">/</span>syslinux<span class="sy0">/</span>syslinux.cfg
<span class="re2">RESET_ROOT_PATH</span>=scripts<span class="sy0">/</span>reset.sh
<span class="re2">RESET_EXT_PATH</span>=<span class="sy0">/</span>cdrom<span class="sy0">/</span><span class="re1">$RESET_ROOT_PATH</span>
<span class="re2">RUNMELAST_PATH</span>=<span class="sy0">/</span>home<span class="sy0">/</span>runmelast.sh
&nbsp;
<span class="co0"># Escaped string path</span>
<span class="re2">RUNME1ST_EXT_PATH_ESC</span>=<span class="co1">${RUNME1ST_EXT_PATH//\//\\\/}</span>
<span class="re2">RUNMELAST_PATH_ESC</span>=<span class="co1">${RUNMELAST_PATH//\//\\\/}</span>
&nbsp;
<span class="co0"># debug : Start / End / exit to let start here and move end and exit</span>
<span class="co0">#:&lt;&lt;COM</span>
<span class="co0">#COM</span>
<span class="co0">#exit</span>
&nbsp;
echof <span class="st0">&quot;=== PREPARE LIVE USB ===&quot;</span>
&nbsp;
echof <span class="st0">&quot;PREPARE &gt; Download dependencies&quot;</span> 
<span class="kw2">apt-get install</span> <span class="re5">-y</span> syslinux mtools parted squashfs-tools
&nbsp;
echof <span class="st0">&quot;PREPARE &gt; Unmount all&quot;</span> 
<span class="kw2">umount</span> <span class="re1">$DEV</span><span class="sy0">*</span>
<span class="kw2">umount</span> <span class="re1">$LUC_ISO_PATH</span>
<span class="kw2">umount</span> <span class="re1">$LUC_LIVEUSB_PATH</span>
<span class="kw2">umount</span> <span class="re1">$LUC_SQUASHFS_PATH</span>
<span class="kw2">rm</span> <span class="re5">-rf</span> <span class="re1">$LUC_PATH</span>
&nbsp;
echof <span class="st0">&quot;PREPARE &gt; MBR + partitions&quot;</span>
<span class="co0"># man parted : http://linux.die.net/man/8/parted</span>
<span class="co0"># sample : http://stackoverflow.com/questions/10519486/valid-arguments-for-parted</span>
<span class="co0"># 100% remaining space http://forums.gentoo.org/viewtopic-t-586478-start-0.html</span>
echof <span class="st0">&quot;PREPARE &gt; MBR MS-DOS (force to change)&quot;</span>
parted <span class="st0">&quot;<span class="es2">$DEV</span>&quot;</span> mklabel <span class="re5">-s</span> <span class="st0">&quot;msdos&quot;</span>
<span class="re2">msg</span>=<span class="st0">&quot;PREPARE &gt; part1 FAT32, <span class="es2">$USB_PART1_SIZE</span>, format FAT32, label <span class="es2">$USB_LABEL</span>,&quot;</span>
echof <span class="st0">&quot;<span class="es2">$msg</span> flag boot + lba&quot;</span>
parted <span class="re5">-a</span> cylinder <span class="st0">&quot;<span class="es2">$DEV</span>&quot;</span> mkpart primary fat32 <span class="nu0">1</span> <span class="re1">$USB_PART1_SIZE</span>
mkfs.vfat <span class="re5">-n</span> <span class="st0">&quot;<span class="es2">$USB_LABEL</span>&quot;</span> <span class="re5">-I</span> <span class="st0">&quot;<span class="es2">$DEV</span>&quot;</span><span class="nu0">1</span> <span class="re5">-F</span> <span class="nu0">32</span>
parted <span class="st0">&quot;<span class="es2">$DEV</span>&quot;</span> <span class="kw1">set</span> <span class="nu0">1</span> boot on
parted <span class="st0">&quot;<span class="es2">$DEV</span>&quot;</span> <span class="kw1">set</span> <span class="nu0">1</span> lba on
<span class="re2">msg</span>=<span class="st0">&quot;PREPARE &gt; part2 EXT4, <span class="es2">$USB_PART2_SIZE</span> remaining space, format EXT4,&quot;</span>
echof <span class="st0">&quot;<span class="es2">$msg</span> label 'casper-rw'&quot;</span>
parted <span class="re5">-a</span> cylinder <span class="st0">&quot;<span class="es2">$DEV</span>&quot;</span> mkpart primary ext4 <span class="re1">$USB_PART1_SIZE</span> <span class="re1">$USB_PART2_SIZE</span>
mkfs.ext4 <span class="re5">-L</span> <span class="st_h">'casper-rw'</span> <span class="st0">&quot;<span class="es2">$DEV</span>&quot;</span><span class="nu0">2</span>
&nbsp;
echof <span class="st0">&quot;PREPARE &gt; Live USB Building&quot;</span>
&nbsp;
echof <span class="st0">&quot;PREPARE &gt; Live USB Building &gt; Prepare working dir skeleton&quot;</span>
<span class="kw2">rm</span> <span class="re5">-rf</span> <span class="re1">$LUC_PATH</span>
<span class="kw2">mkdir</span> <span class="re1">$LUC_PATH</span>
<span class="kw2">mkdir</span> <span class="re1">$LUC_LIVEUSB_PATH</span>
<span class="kw2">mkdir</span> <span class="re1">$LUC_ISO_PATH</span>
<span class="kw2">mkdir</span> <span class="re1">$LUC_SQUASHFS_PATH</span>
<span class="kw2">mkdir</span> <span class="re1">$LUC_CUSTOM_SQUASHFS_PATH</span>
&nbsp;
echof <span class="st0">&quot;PREPARE &gt; Live USB Building &gt; Mount of USB device&quot;</span>
<span class="kw2">mount</span> <span class="st0">&quot;<span class="es2">$DEV</span>&quot;</span><span class="nu0">1</span> <span class="re1">$LUC_LIVEUSB_PATH</span> 
&nbsp;
echof <span class="st0">&quot;PREPARE &gt; Live USB Building &gt; Mount of ISO file&quot;</span>
<span class="kw2">mount</span> <span class="re5">-o</span> loop <span class="re1">$ISO</span> <span class="re1">$LUC_ISO_PATH</span>
&nbsp;
echof <span class="st0">&quot;PREPARE &gt; Live USB Building &gt; Copy all file from ISO&quot;</span>
<span class="co0"># 2 errors of symlink will occur, because we can not copy symlink in FAT32 FS</span>
rsync <span class="re5">-aPv</span> <span class="re5">--exclude</span> <span class="st_h">'filesystem.squashfs'</span> <span class="re1">$LUC_ISO_PATH</span><span class="sy0">/</span> <span class="re1">$LUC_LIVEUSB_PATH</span><span class="sy0">/</span>
&nbsp;
echof <span class="st0">&quot;PREPARE &gt; Live USB Building &gt; Copy of squashfs filesystem&quot;</span>
rsync <span class="re5">-aPv</span> <span class="re1">$LUC_ISO_PATH</span><span class="sy0">/</span>casper<span class="sy0">/</span>filesystem.squashfs <span class="re1">$LUC_PATH</span><span class="sy0">/</span>
&nbsp;
<span class="co0"># Rename isolinux folder is mandatory because SYSLINUX searches in /syslinux folder (http://www.syslinux.org/wiki/index.php/SYSLINUX#How_do_I_Configure_SYSLINUX.3F)</span>
<span class="kw2">mv</span> <span class="re1">$LUC_LIVEUSB_PATH</span><span class="sy0">/</span>isolinux<span class="sy0">/</span> <span class="re1">$LUC_LIVEUSB_PATH</span><span class="sy0">/</span>syslinux
&nbsp;
echof <span class="st0">&quot;PREPARE &gt; Live USB Building &gt; Create boot configuration&quot;</span>
<span class="kw2">cat</span> <span class="sy0">&gt;</span> <span class="st0">&quot;<span class="es2">$LUC_LIVEUSB_PATH</span>/syslinux/syslinux.cfg&quot;</span> <span class="sy0">&lt;&lt;</span>EOT 
DEFAULT live
LABEL live
  SAY <span class="re1">$LIVE_USB_BOOT_MESSAGE</span>
  KERNEL <span class="sy0">/</span>casper<span class="sy0">/</span>vmlinuz
  <span class="co0">## casper config : http://manpages.ubuntu.com/manpages/trusty/man7/casper.7.html</span>
  <span class="co0">## - NETWORK_MANAGER_ACTIVE : indicate whether NM or ifup is used to manage network</span>
  <span class="co0">##   	[default : ip=frommedia]</span>
  <span class="co0">## - persistent : make persistent the &quot;casper-rw&quot; partition</span>
  <span class="co0">## - LIVE_USB_BOOT_QUIET : display or not Lubuntu splash no verbose</span>
  <span class="co0">##   	[default : quiet splash]</span>
  <span class="co0">## - LOCALE : embed locale for keyboard, live session boot and other stuff</span>
  <span class="co0">##   	[locale=fr_FR.UTF-8 console-setup/layoutcode=fr]</span>
  APPEND noprompt <span class="re1">$NETWORK_MANAGER_ACTIVE</span> \
   persistent <span class="re2">boot</span>=casper <span class="re2">initrd</span>=<span class="sy0">/</span>casper<span class="sy0">/</span>initrd.lz \
   <span class="re1">$LIVE_USB_BOOT_QUIET</span> <span class="re1">$LOCALE</span>
EOT
&nbsp;
<span class="co0"># Files not used</span>
<span class="kw2">rm</span> <span class="re1">$LUC_LIVEUSB_PATH</span><span class="sy0">/</span>syslinux<span class="sy0">/</span>isolinux.cfg
&nbsp;
echof <span class="st0">&quot;PREPARE &gt; Live USB Building &gt; Make <span class="es5">`echo $DEV`</span>1 bootable&quot;</span>
&nbsp;
<span class="co0"># We must use gfxboot.c32 file's host (https://bugs.launchpad.net/ubuntu/+source/usb-creator/+bug/1325801/comments/11)</span>
rsync <span class="re5">-aPv</span> <span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>syslinux<span class="sy0">/</span>gfxboot.c32 <span class="re1">$LUC_LIVEUSB_PATH</span><span class="sy0">/</span>syslinux<span class="sy0">/</span>
&nbsp;
<span class="co0"># Last step to make the USB bootable (`syslinux -i dev` run too)</span>
syslinux <span class="st0">&quot;<span class="es2">$DEV</span>&quot;</span><span class="nu0">1</span>
&nbsp;
<span class="co0">################################ CUSTOMIZE ################################</span>
&nbsp;
echof <span class="st0">&quot;=== CUSTOMIZE LIVE USB ===&quot;</span>
&nbsp;
echof <span class="st0">&quot;CUSTOMIZE &gt; Extract SQUASHFS filesystem&quot;</span>
<span class="kw2">mount</span> <span class="re5">-t</span> squashfs <span class="re5">-o</span> loop <span class="re1">$LUC_PATH</span><span class="sy0">/</span>filesystem.squashfs <span class="re1">$LUC_SQUASHFS_PATH</span>
rsync <span class="re5">-aPv</span> <span class="re1">$LUC_SQUASHFS_PATH</span><span class="sy0">/</span> <span class="re1">$LUC_CUSTOM_SQUASHFS_PATH</span><span class="sy0">/</span>
&nbsp;
echof <span class="st0">&quot;CUSTOMIZE &gt; Adding auto-trigger script on reboot&quot;</span>
<span class="co0"># Entry point to execute an external script and following the execution in a terminal</span>
<span class="kw3">echo</span> <span class="kw2">sudo</span> lxterminal <span class="re5">-t</span> <span class="st0">&quot;'&quot;</span><span class="re1">$WAITING_REBOOT_TITLE</span><span class="st0">&quot;'&quot;</span> \
	<span class="re5">-e</span> <span class="st0">&quot;bash -c <span class="es1">\&quot;</span><span class="es2">$RUNME1ST_EXT_PATH</span><span class="es1">\&quot;</span> &amp;&quot;</span> \
	<span class="sy0">&gt;&gt;</span> <span class="re1">$LUC_CUSTOM_SQUASHFS_PATH</span><span class="sy0">/</span>etc<span class="sy0">/</span>profile
&nbsp;
<span class="co0"># Folder in which we are storing external scripts of live system</span>
<span class="kw2">mkdir</span> <span class="re1">$SCRIPTS_PATH</span>
&nbsp;
echof <span class="st0">&quot;CUSTOMIZE &gt; Building off auto triggered script&quot;</span>
<span class="kw2">bash</span> <span class="re5">-c</span> <span class="st0">&quot;cat &gt; <span class="es2">$LUC_LIVEUSB_PATH</span>/<span class="es2">$RUNME1ST_ROOT_PATH</span>&quot;</span> <span class="co2">&lt;&lt;EOF1
#!/bin/bash
## Hint : alter this file in Live USB context only
&nbsp;
## PRE-CONFIGURED SWITCH VARS FROM PARENT
EMBED_VNC=$EMBED_VNC
UPDATE_OS=$UPDATE_OS
INSTALL_APP_LANG=$INSTALL_APP_LANG
&nbsp;
## Modifying network configuration, auto-start in boot and apply changes
## nota : due to Network Manager removing, network will not auto-start
bash -c &quot;cat &gt; /etc/network/interfaces&quot; &lt;&lt;EOF1_1
auto lo
iface lo inet loopback
&nbsp;
iface eth0 inet static
        address $NET_ADDRESS
        netmask $NET_NETMASK
        gateway $NET_GATEWAY
        dns-nameservers $NET_DNS
EOF1</span>_1
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="st0">&quot;:a;N;s/<span class="es1">\n</span>exit 0/<span class="es1">\n</span># Start network<span class="es1">\n</span>ifup eth0<span class="es1">\n</span>&amp;/;Ta&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>rc.local
<span class="kw2">ifdown</span> eth0
<span class="kw2">ifup</span> eth0
&nbsp;
<span class="co0"># Update is asked</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> \<span class="re1">$UPDATE_OS</span> <span class="re5">-eq</span> <span class="nu0">1</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
	<span class="kw2">apt-get</span> <span class="re5">-y</span> update
<span class="kw1">fi</span>
&nbsp;
<span class="co0">## Install SSH and other asked packets</span>
<span class="kw2">apt-get</span> <span class="re5">-y</span> <span class="kw2">install</span> <span class="re1">$EMBED_PACKETS</span>
&nbsp;
<span class="co0">## All apps with LANGUAGE_SUPPORT is asked</span>
<span class="co0">## http://askubuntu.com/questions/149876/how-can-i-install-one-language-by-command-line</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> \<span class="re1">$INSTALL_APP_LANG</span> <span class="re5">-eq</span> <span class="nu0">1</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
	<span class="kw2">apt-get</span> <span class="re5">-y</span> <span class="kw2">install</span> \<span class="sy0">`</span>check-language-support <span class="re5">-l</span> <span class="re1">$LANGUAGE_SUPPORT</span>\<span class="sy0">`</span>
<span class="kw1">fi</span>
&nbsp;
<span class="co0">## Date &amp; Time Zone</span>
timedatectl set-timezone <span class="re1">$DATE_TIME_ZONE</span>
&nbsp;
<span class="co0">## Add ME, join SUDOERS, AUTO LOGON and set DEFAULT PASSWORD</span>
addgroup <span class="re1">$ME</span>
adduser <span class="re5">--ingroup</span> <span class="re1">$ME</span> <span class="re5">--home</span> <span class="sy0">/</span>home<span class="sy0">/</span><span class="re1">$ME</span> <span class="re5">--disabled-password</span> <span class="re5">-gecos</span> <span class="st0">&quot;<span class="es2">$ME_FULL</span>&quot;</span> <span class="re1">$ME</span>
adduser <span class="re1">$ME</span> <span class="kw2">sudo</span>
<span class="co0">## Auto-logon : http://doc.ubuntu-fr.org/lightdm#connexion_automatique</span>
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="st0">&quot;s/^\(autologin-user=\)<span class="es2">$DEFAULT_LIVE_USB_USER</span>$/\1<span class="es2">$ME</span>/g&quot;</span> \
	<span class="sy0">/</span>etc<span class="sy0">/</span>lightdm<span class="sy0">/</span>lightdm.conf
<span class="kw2">bash</span> <span class="re5">-c</span> <span class="st0">&quot;echo <span class="es2">$ME</span>:<span class="es2">$ME_DEFAULT_PASSWORD</span> | /usr/sbin/chpasswd&quot;</span>
&nbsp;
<span class="co0"># Embed VNC stuff</span>
<span class="kw1">if</span> <span class="br0">&#91;</span> \<span class="re1">$EMBED_VNC</span> <span class="re5">-eq</span> <span class="nu0">1</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
&nbsp;
	<span class="co0"># VNC : auto enable server desktop sharing</span>
	<span class="co0"># http://askubuntu.com/a/530196</span>
	gsettings <span class="kw1">set</span> org.gnome.Vino enabled <span class="kw2">true</span>
	gsettings <span class="kw1">set</span> org.gnome.Vino prompt-enabled <span class="kw2">false</span>
	gsettings <span class="kw1">set</span> org.gnome.Vino require-encryption <span class="kw2">false</span>
&nbsp;
<span class="kw2">bash</span> <span class="re5">-c</span> <span class="st0">&quot;cat &gt;&gt; /home/<span class="es2">$ME</span>/.profile&quot;</span> <span class="sy0">&lt;&lt;</span>EOF1_2
&nbsp;
<span class="co0"># VNC : Activate distant desktop sharing</span>
<span class="co0"># src : http://adept1formatique.unblog.fr/2013/08/12/bureau-a-distance-avec-lubuntu/</span>
<span class="co0"># nota : x11vnc indicates that running without password is dangerous ;</span>
<span class="co0"># so it recommends to creating a password file (x11vnc -storepasswd)</span>
<span class="co0"># repeat : allow repetitive keys</span>
<span class="co0"># remind too : ending '&amp;' will run this command detached from process</span>
x11vnc <span class="re5">-rfbauth</span> ~<span class="sy0">/</span>.vnc<span class="sy0">/</span><span class="kw2">passwd</span> <span class="re5">-forever</span> <span class="re5">-repeat</span> <span class="re5">-display</span> :<span class="nu0">0</span> <span class="sy0">&amp;</span>
EOF1_2
&nbsp;
<span class="kw1">fi</span>
&nbsp;
<span class="co0">## Useful aliases</span>
<span class="kw2">bash</span> <span class="re5">-c</span> <span class="st0">&quot;cat &gt;&gt; /home/<span class="es2">$ME</span>/.bashrc&quot;</span> <span class="sy0">&lt;&lt;</span>EOF1_3
&nbsp;
<span class="kw3">alias</span> <span class="re2">luc_edit_runme1st</span>=<span class="st0">&quot;sudo nano <span class="es2">$RUNME1ST_EXT_PATH</span>&quot;</span>
<span class="kw3">alias</span> <span class="re2">luc_edit_syslinux</span>=<span class="st0">&quot;sudo nano <span class="es2">$SYSLINUX_EXT_PATH</span>&quot;</span>
<span class="kw3">alias</span> <span class="re2">luc_reset</span>=<span class="st0">&quot;sudo <span class="es2">$RESET_EXT_PATH</span>&quot;</span>
EOF1_3
&nbsp;
<span class="co0">## Delete first trigger</span>
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="st0">&quot;/^sudo lxterminal -t/d&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>profile
&nbsp;
<span class="co0">## Adding last trigger</span>
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="st0">&quot;:a;N;s/<span class="es1">\n</span>exit 0/<span class="es1">\n</span><span class="es2">$RUNMELAST_PATH_ESC</span>&amp;/;Ta&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>rc.local
&nbsp;
<span class="co0">## Last actions in session ME</span>
<span class="co0">## warning : this script auto delete itself in the end</span>
<span class="kw2">bash</span> <span class="re5">-c</span> <span class="st0">&quot;cat &gt; <span class="es2">$RUNMELAST_PATH</span>&quot;</span> <span class="sy0">&lt;&lt;</span>EOF1_4
<span class="co0">#!/bin/bash</span>
<span class="co0">### Hint : alter this file in Live USB context only</span>
&nbsp;
<span class="co0">### Definitively remove $DEFAULT_LIVE_USB_USER user/group/home/sudoers/persistance</span>
<span class="co0">### nota : usermod -g ... temporarily move user into my group, so I can remove it</span>
deluser <span class="re1">$DEFAULT_LIVE_USB_USER</span>
usermod <span class="re5">-g</span> <span class="re1">$ME</span> <span class="re1">$DEFAULT_LIVE_USB_USER</span>
delgroup <span class="re1">$DEFAULT_LIVE_USB_USER</span>
<span class="kw2">rm</span> <span class="re5">-rf</span> <span class="sy0">/</span>home<span class="sy0">/</span><span class="re1">$DEFAULT_LIVE_USB_USER</span>
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="st0">&quot;s/^<span class="es2">$DEFAULT_LIVE_USB_USER</span>/<span class="es2">$ME</span>/g&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>sudoers.d<span class="sy0">/</span>casper
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="st0">&quot;/^<span class="es2">$DEFAULT_LIVE_USB_USER</span>:/d&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span><span class="kw2">passwd</span>
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="st0">&quot;/^<span class="es2">$DEFAULT_LIVE_USB_USER</span>:/d&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>shadow
&nbsp;
<span class="co0">### Delete my RUNMELAST trigger</span>
<span class="kw2">sed</span> <span class="re5">-i</span> <span class="st0">&quot;/^<span class="es2">$RUNMELAST_PATH_ESC</span>/d&quot;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>rc.local
&nbsp;
<span class="co0">### Delete me</span>
<span class="kw2">rm</span> <span class="re5">-f</span> \\\<span class="re4">$0</span>
EOF1_4
&nbsp;
<span class="kw2">chmod</span> +x <span class="re1">$RUNMELAST_PATH</span>
&nbsp;
reboot
EOF1
&nbsp;
<span class="kw2">chmod</span> +x <span class="re1">$LUC_LIVEUSB_PATH</span><span class="sy0">/</span><span class="re1">$RUNME1ST_ROOT_PATH</span>
&nbsp;
echof <span class="st0">&quot;CUSTOMIZE &gt; Building of 'reset all' script&quot;</span>
<span class="kw2">bash</span> <span class="re5">-c</span> <span class="st0">&quot;cat &gt; <span class="es2">$LUC_LIVEUSB_PATH</span>/<span class="es2">$RESET_ROOT_PATH</span>&quot;</span> <span class="co2">&lt;&lt;EOF4
#!/bin/bash
## Empty casper-rw partition (impossible to retrieve data)
CASPER_RW_PATH=\`mount |grep casper-rw |cut -f 3 -d &quot; &quot;\`
rm -rf \$CASPER_RW_PATH/*
echo &quot;System has been reset !&quot;
echo &quot;Warning : the system is now incomplete, &quot;\
&quot;you must reboot to resolve the problem&quot;
echo &quot;To reboot : sudo reboot + give password&quot;
EOF4</span>
&nbsp;
<span class="kw2">chmod</span> +x <span class="re1">$LUC_LIVEUSB_PATH</span><span class="sy0">/</span><span class="re1">$RESET_ROOT_PATH</span>
&nbsp;
echof <span class="st0">&quot;CUSTOMIZE &gt; Restore SQUASHFS filesystem&quot;</span>
mksquashfs <span class="re1">$LUC_CUSTOM_SQUASHFS_PATH</span> \
	<span class="re1">$LUC_LIVEUSB_PATH</span><span class="sy0">/</span>casper<span class="sy0">/</span>filesystem.squashfs <span class="re5">-info</span>
&nbsp;
&nbsp;
<span class="co0">################################ FINALIZE ################################</span>
&nbsp;
echof <span class="st0">&quot;=== FINALIZE LIVE USB ===&quot;</span>
&nbsp;
echof <span class="st0">&quot;FINALIZE &gt; Unmount and cleaning&quot;</span>
<span class="kw2">umount</span> <span class="re1">$LUC_SQUASHFS_PATH</span>
<span class="kw2">umount</span> <span class="re1">$LUC_LIVEUSB_PATH</span>
<span class="kw2">umount</span> <span class="re1">$LUC_ISO_PATH</span>
<span class="kw2">rm</span> <span class="re5">-rf</span> <span class="re1">$LUC_PATH</span>
echof <span class="st0">&quot;~~~ SUCCESS ! YOUR LIVE USB IS READY TO RUN ! ~~~&quot;</span> <span class="re1">$C_green</span>
<span class="kw3">unset</span> <span class="re5">-f</span> echof</pre>
</dd></dl>

</div>
<div class='secedit editbutton_section editbutton_24'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Le code] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="le_code" /><input type="hidden" name="codeblockOffset" value="22" /><input type="hidden" name="range" value="42073-59486" /><button type="submit" title="Le code" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit25 page-header" id="mini_how-to">Mini How-To</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_25'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Mini How-To] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="mini_how-to" /><input type="hidden" name="codeblockOffset" value="23" /><input type="hidden" name="range" value="59487-59511" /><button type="submit" title="Mini How-To" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit26" id="avant_l_installation">Avant l&#039;installation</h3>
<div class="level3">

<p>
Dans le script OneTouch, si je veux :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Changer la taille des partitions : voir les paramètres pré-configurés <strong><abbr title="Universal Serial Bus">USB</abbr>_PART*_SIZE</strong></div>
</li>
<li class="level1"><div class="li"> Ajouter d&#039;autres partitions : ne pas donner 100% de la taille restante à <strong><abbr title="Universal Serial Bus">USB</abbr>_PART2_SIZE</strong> et utiliser un outil de partition tel GParted</div>
</li>
<li class="level1"><div class="li"> Ajouter automatiquement des nouveaux logiciels : voir le paramètre pré-configuré <strong>EMBED_PACKETS</strong> et séparer les packets par une espace</div>
</li>
<li class="level1"><div class="li"> Avoir tous les messages au démarrage : voir le paramètre pré-configuré <strong>LIVE_<abbr title="Universal Serial Bus">USB</abbr>_BOOT_QUIET</strong></div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_26'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Avant l&#039;installation] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="avant_l_installation" /><input type="hidden" name="codeblockOffset" value="23" /><input type="hidden" name="range" value="59512-60068" /><button type="submit" title="Avant l&#039;installation" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit27" id="apres_l_installation">Après l&#039;installation</h3>
<div class="level3">

<p>
Si je veux :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Avoir ou pas tous les messages au démarrage : supprimer / ajouter les paramètres &quot;quiet splash&quot; dans le fichier <strong>{/cdrom|&lt;racine_live_usb&gt;}/syslinux/syslinux.cfg</strong> (selon si le Live <abbr title="Universal Serial Bus">USB</abbr> est démarré ou non) ; (re)démarrer pour prendre en compte.</div>
</li>
<li class="level1"><div class="li"> Utiliser ou pas le Network Manager au lieu de ifup : supprimer / ajouter le paramètre <strong>&quot;ip=frommedia&quot;</strong> dans le fichier <strong>{/cdrom|&lt;racine_live_usb&gt;}/syslinux/syslinux.cfg</strong> (selon si le Live <abbr title="Universal Serial Bus">USB</abbr> est démarré ou non) ; (re)démarrer pour prendre en compte.</div>
</li>
<li class="level1"><div class="li"> Modifier le script d&#039;installation du PC-LIVE : modifier le fichier <strong>{/cdrom|&lt;racine_live_usb&gt;}/scripts/runme1st_from_ext.sh</strong> (selon si le Live <abbr title="Universal Serial Bus">USB</abbr> est démarré ou non) ; ne pas oublier de réinitialiser (par défaut le script n&#039;est plus déclenché après la première installation) et à (re)démarrer.</div>
</li>
<li class="level1"><div class="li"> Réinitialiser (attention : contenu de la persistance perdu) : Live <abbr title="Universal Serial Bus">USB</abbr> éteint il suffit de monter et de supprimer le contenu de la partition <strong>casper-rw</strong>, si le Live <abbr title="Universal Serial Bus">USB</abbr> est démarré et a été construit avec L.U.C., il suffit d&#039;exécuter le script <strong>sudo /cdrom/scripts/reset.sh</strong> (redémarrage nécessaire avec le mot de passe configuré dans <strong>ME_DEFAULT_PASSWORD</strong>)</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_27'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Après l&#039;installation] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="apres_l_installation" /><input type="hidden" name="codeblockOffset" value="23" /><input type="hidden" name="range" value="60069-61321" /><button type="submit" title="Après l&#039;installation" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit28 page-header" id="les_autres_os">Les autres OS ?</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_28'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Les autres OS ?] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="les_autres_os" /><input type="hidden" name="codeblockOffset" value="23" /><input type="hidden" name="range" value="61322-61350" /><button type="submit" title="Les autres OS ?" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit29" id="live_usb_64_bits">Live USB 64 bits</h3>
<div class="level3">

<p>
Je n&#039;ai pas pu installer un Lubuntu 64 bits car je n&#039;ai pas de processeur 64 bits à disposition.
</p>

<p>
Si quelqu&#039;un le teste, ce serait bien qu&#039;il fasse un retour !
</p>

</div>
<div class='secedit editbutton_section editbutton_29'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Live USB 64 bits] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="live_usb_64_bits" /><input type="hidden" name="codeblockOffset" value="23" /><input type="hidden" name="range" value="61351-61539" /><button type="submit" title="Live USB 64 bits" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit30" id="live_usb_autres_distros">Live USB autres distros</h3>
<div class="level3">

<p>
Donc, là je n&#039;ai testé que Lubuntu. Il faudra vérifier / adapter les scripts runme1st_from_ext.sh et reset.sh qui sont dédiés à Lubuntu.
</p>

</div>
<div class='secedit editbutton_section editbutton_30'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Live USB autres distros] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="live_usb_autres_distros" /><input type="hidden" name="codeblockOffset" value="23" /><input type="hidden" name="range" value="61540-61717" /><button type="submit" title="Live USB autres distros" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit31" id="pc-builder_autre_que_ubuntu">PC-BUILDER autre que Ubuntu</h3>
<div class="level3">

<p>
Si PC-BUILDER n&#039;est par Debian like, je pense qu&#039;il faudra tout adapter. En particulier, toutes les commandes apt-get.
</p>

</div>
<div class='secedit editbutton_section editbutton_31'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[PC-BUILDER autre que Ubuntu] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="pc-builder_autre_que_ubuntu" /><input type="hidden" name="codeblockOffset" value="23" /><input type="hidden" name="range" value="61718-61875" /><button type="submit" title="PC-BUILDER autre que Ubuntu" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit32" id="pc-builder_sous_windows">PC-BUILDER sous Windows</h3>
<div class="level3">

<p>
Alors là tout est à faire <img src="/lib/images/smileys/icon_biggrin.gif" class="icon" alt=":-D" />, mais peut être qu&#039;en Power Shell ce n&#039;est pas si compliqué et ça permettrait de tout scripter.
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Créer une clé bootable avec système Live Linux (<a href="http://forum.ubuntu-fr.org/viewtopic.php?id=270322" class="urlextern" title="http://forum.ubuntu-fr.org/viewtopic.php?id=270322" rel="nofollow">exemple</a>)</div>
</li>
<li class="level1"><div class="li"> Gestion MBR et partitions par script (<a href="http://blogs.msdn.com/b/san/archive/2012/07/03/managing-storage-with-windows-powershell-on-windows-server-2012.aspx" class="urlextern" title="http://blogs.msdn.com/b/san/archive/2012/07/03/managing-storage-with-windows-powershell-on-windows-server-2012.aspx" rel="nofollow">point d&#039;entrée</a>)</div>
</li>
</ul>

<p>
Par contre pour les fonctionnalités squashfs, je ne suis pas sûr qu&#039;un Windows puisse (peut être avec émulation)
</p>

<p>
Bref ! A voir !
</p>

</div>
<div class='secedit editbutton_section editbutton_32'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[PC-BUILDER sous Windows] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="pc-builder_sous_windows" /><input type="hidden" name="codeblockOffset" value="23" /><input type="hidden" name="range" value="61876-62475" /><button type="submit" title="PC-BUILDER sous Windows" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit33 page-header" id="todo">TODO</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_33'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[TODO] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="todo" /><input type="hidden" name="codeblockOffset" value="23" /><input type="hidden" name="range" value="62476-62493" /><button type="submit" title="TODO" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit34" id="ou_vais-je">Où vais-je ?</h3>
<div class="level3">

<p>
Je suis à 99 % satisfait du résultat.
</p>

<p>
Seul un (tout ch&#039;ti) petit bémol : ce n&#039;est pas pratique de trimbaler un HDD externe (je pense à l&#039;utilisation dans le train par exemple).
</p>

<p>
Donc ce problème reste à résoudre (en même temps c&#039;était un peu l&#039;objectif du post <img src="/lib/images/smileys/icon_wink.gif" class="icon" alt=";-)" /> ).
</p>

<p>
J&#039;ai deux pistes :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> les clés <abbr title="Universal Serial Bus">USB</abbr> avec technologie SSD (très onéreuses <img src="/lib/images/smileys/icon_eek.gif" class="icon" alt="8-o" /> )</div>
</li>
<li class="level1"><div class="li"> les clés <abbr title="Universal Serial Bus">USB</abbr> standard avec gestions différentes (comme par exemple <a href="http://www.wefightcensorship.org/fr/article/tails-systeme-dexploitation-live-taille-lanonymathtml.html" class="urlextern" title="http://www.wefightcensorship.org/fr/article/tails-systeme-dexploitation-live-taille-lanonymathtml.html" rel="nofollow">tails</a>)</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_34'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Où vais-je ?] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="ou_vais-je" /><input type="hidden" name="codeblockOffset" value="23" /><input type="hidden" name="range" value="62494-63066" /><button type="submit" title="Où vais-je ?" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit35" id="pistes_a_suivre_ou_pas">Pistes à suivre (ou pas :) ) ?</h3>
<div class="level3">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Résoudre les problèmes connus</div>
</li>
<li class="level1"><div class="li"> Etudier le processus de boot du système Live ou système normal</div>
</li>
<li class="level1"><div class="li"> Comprendre pourquoi il faut copier gfxboot.c32 de PC-BUILDER</div>
</li>
<li class="level1"><div class="li"> Epurer tous les fichiers dont on n&#039;a pas besoin pour le boot, pour créér un système minimal</div>
</li>
<li class="level1"><div class="li"> Que se passe-t-il lors d&#039;une mise à jour du système ? Du noyau ?</div>
</li>
<li class="level1"><div class="li"> Gestion des disques avec GPT (pour UEFI)</div>
</li>
<li class="level1"><div class="li"> Historiser tous les affichages en plus de l&#039;écran pendant la construction du Live <abbr title="Universal Serial Bus">USB</abbr></div>
</li>
<li class="level1"><div class="li"> Gérer la wifi par script</div>
</li>
<li class="level1"><div class="li"> Modifier filesystem.squashfs de manière à lui intégrer les applis et autres AVANT le 1er démarrage (chroot sur le système) : pas forcément pertinent car 1) la taille de partition 1 va grossir et donc il faudra le gérer, 2) on peut modifier in situ le script runme1st_from_ext.sh (on a déjà la rolls quoi !)</div>
</li>
<li class="level1"><div class="li"> Multi boot ?</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_35'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Pistes à suivre (ou pas :) ) ?] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="pistes_a_suivre_ou_pas" /><input type="hidden" name="codeblockOffset" value="23" /><input type="hidden" name="range" value="63067-63952" /><button type="submit" title="Pistes à suivre (ou pas :) ) ?" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit36 page-header" id="problemes_connus">Problèmes connus</h2>
<div class="level2">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> A l&#039;ouverture de session par SSH, la sortie standard de <abbr title="Virtual Network Computing">VNC</abbr> (stdout) est redirigée vers le terminal</div>
</li>
<li class="level1"><div class="li"> Si on enlève la prise en charge ifup dans /syslinux/syslinux.cfg, la remettre ne réactivera par ifup et ce sera toujours le Network Manager qui aura le contrôle (à corriger)</div>
</li>
<li class="level1"><div class="li"> Parfois sous Lubuntu, le bouton power n&#039;ouvre pas la fenêtre pour éteindre / redémarrer / fermer la session</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_36'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Problèmes connus] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="problemes_connus" /><input type="hidden" name="codeblockOffset" value="23" /><input type="hidden" name="range" value="63953-64385" /><button type="submit" title="Problèmes connus" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit37 page-header" id="le_mot_de_la_fin">Le mot de la fin</h2>
<div class="level2">

<p>
Je tiens à remercier les nombreuses personnes qui n&#039;ont pas hésité à passer du temps pour nous transmettre leur travail, leur passion, leurs tests, leurs découvertes, leur savoir. Je référence une partie de ces personnes en indiquant le lien source. Enfin, je remercie tout particulièrement <a href="http://poloastucien.free.fr/mbr_fat_secteurs_boot_h.html" class="urlextern" title="http://poloastucien.free.fr/mbr_fat_secteurs_boot_h.html" rel="nofollow">Polo Astucien</a> pour son étude très précise sur les mécanismes de boot d&#039;un support. J&#039;ai découvert que le boot est un monde en soi. Comme le disait un de mes anciens profs : &quot;En informatique, on ouvre une porte et il y en a dix autres à explorer…&quot;
</p>

<p>
Toute cette documentation a été élaborée en à partir de l&#039;outil d&#039;aperçu de <a href="https://doc.ubuntu-fr.org" class="urlextern" title="https://doc.ubuntu-fr.org" rel="nofollow">https://doc.ubuntu-fr.org</a>.
</p>

<p>
Voilou, merci de m&#039;avoir lu et j&#039;espère que mon travail vous sera utile.
</p>

</div>
<div class='secedit editbutton_section editbutton_37'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Le mot de la fin] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="le_mot_de_la_fin" /><input type="hidden" name="codeblockOffset" value="23" /><input type="hidden" name="range" value="64386-65215" /><button type="submit" title="Le mot de la fin" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit38 page-header" id="historique">Historique</h2>
<div class="level2">
<ul class=" fix-media-list-overlap">
<li class="level1 node"><div class="li"> v_1_2 (22/04/15) :</div>
<ul class=" fix-media-list-overlap">
<li class="level2"><div class="li"> modifications mineures</div>
</li>
</ul>
</li>
<li class="level1 node"><div class="li"> v_1_1 (17/04/15) :</div>
<ul class=" fix-media-list-overlap">
<li class="level2"><div class="li"> modifications mineures, </div>
</li>
<li class="level2"><div class="li"> test actualisé Ubuntu 14.04 LTS 64 bits, </div>
</li>
<li class="level2"><div class="li"> ajout de la rubrique &quot;Systèmes supportés&quot;</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> v_1_0 (14/04/15) : début de l&#039;aventure <img src="/lib/images/smileys/icon_wink.gif" class="icon" alt=";-)" /></div>
</li>
</ul>
<hr />

<p>
<em>Contributeurs principaux : <a href="/utilisateurs/lenainjaune" class="wikilink2" title="utilisateurs:lenainjaune" rel="nofollow">lenainjaune</a>.</em>
</p>

<p>
Version : 1.2
</p>

<p>
Date de version : 22/04/15
</p>

</div>
<div class='secedit editbutton_section editbutton_38'><form class="button btn_secedit form-inline" method="post" action="/tutoriel/lubuntu_usb_creator"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614242151" /><input type="hidden" name="summary" value="[Historique] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="historique" /><input type="hidden" name="codeblockOffset" value="23" /><input type="hidden" name="range" value="65216-" /><button type="submit" title="Historique" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="tutoriel/lubuntu_usb_creator.txt">tutoriel/lubuntu_usb_creator.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 25/02/2021, 09:35">Le 25/02/2021, 09:35</span></li><li class="text-muted">par lenainjaune</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=tutoriel%3Alubuntu_usb_creator&amp;1635532290" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
