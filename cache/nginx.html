<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>nginx [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="serveur"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/nginx?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns="/>
<link rel="edit" title="Modifier cette page" href="/nginx?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/nginx"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/nginx"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/nginx"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"nginx","namespace":"","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="nginx">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/nginx?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/nginx?do=media&amp;ns="  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/nginx?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/nginx?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/nginx?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/nginx?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/nginx?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">nginx</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/nginx?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/nginx?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/nginx?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#installation","title":"Installation","level":1},{"link":"#configuration","title":"Configuration","level":1},{"link":"#configuration_de_nginx","title":"Configuration de Nginx","level":2},{"link":"#le_nginxconf_par_defaut","title":"Le nginx.conf par d\u00e9faut","level":2},{"link":"#nginx_et_les_hotes_virtuels","title":"Nginx et les h\u00f4tes virtuels","level":2},{"link":"#configuration_du_reverse_proxy_et_du_cache_web","title":"Configuration  du reverse proxy et du cache Web","level":1},{"link":"#configuration_d_un_reverse_proxy_et_du_cache_avec_nginx","title":"Configuration d'un reverse proxy et du cache avec Nginx","level":2},{"link":"#pre-requis","title":"Pr\u00e9-requis","level":2},{"link":"#configuration1","title":"Configuration","level":2},{"link":"#parametrage_des_fonctions_reverse_proxy_et_cache","title":"Param\u00e9trage des fonctions reverse proxy et cache","level":2},{"link":"#exemple_de_configuration_d_un_serveur_web_arriere","title":"Exemple de configuration d'un serveur web arri\u00e8re","level":2},{"link":"#load_balancing","title":"Load balancing","level":2},{"link":"#autres_configurations_de_nginx","title":"Autres configurations de Nginx","level":1},{"link":"#voir_aussi","title":"Voir aussi","level":1}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level1"><a href="#installation">Installation</a></li>
<li class="level1"><a href="#configuration">Configuration</a>
<ul class="nav toc">
<li class="level2"><a href="#configuration_de_nginx">Configuration de Nginx</a></li>
<li class="level2"><a href="#le_nginxconf_par_defaut">Le nginx.conf par défaut</a></li>
<li class="level2"><a href="#nginx_et_les_hotes_virtuels">Nginx et les hôtes virtuels</a></li>
</ul>
</li>
<li class="level1"><a href="#configuration_du_reverse_proxy_et_du_cache_web">Configuration  du reverse proxy et du cache Web</a>
<ul class="nav toc">
<li class="level2"><a href="#configuration_d_un_reverse_proxy_et_du_cache_avec_nginx">Configuration d&#039;un reverse proxy et du cache avec Nginx</a></li>
<li class="level2"><a href="#pre-requis">Pré-requis</a></li>
<li class="level2"><a href="#configuration1">Configuration</a></li>
<li class="level2"><a href="#parametrage_des_fonctions_reverse_proxy_et_cache">Paramétrage des fonctions reverse proxy et cache</a></li>
<li class="level2"><a href="#exemple_de_configuration_d_un_serveur_web_arriere">Exemple de configuration d&#039;un serveur web arrière</a></li>
<li class="level2"><a href="#load_balancing">Load balancing</a></li>
</ul>
</li>
<li class="level1"><a href="#autres_configurations_de_nginx">Autres configurations de Nginx</a></li>
<li class="level1"><a href="#voir_aussi">Voir aussi</a></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content"><div class="tags"><span>
	<a href="/serveur" class="wikilink1" title="serveur" rel="tag">serveur</a>
</span></div>
<hr />

<p>
<img src="/_media/serveur/nginx-logo.png?w=128&amp;tok=de6f8b" class="mediaright img-responsive" alt="" width="128" />
</p>

<h1 class="sectionedit1 page-header" id="nginxserveur_web_asynchrone">Nginx : serveur Web asynchrone</h1>
<div class="level1">

<p>
<strong>Nginx</strong> (Engine X, prononcez [n-gèn-x]) est un serveur Web asynchrone écrit par Igor Sysoev pour les besoins d&#039;un site russe à très fort trafic. Il peut être configuré pour faire office de serveur reverse proxy Web et de serveur proxy de messagerie électronique (IMAP/POP3). Une partie de la documentation a été traduite du russe vers l&#039;anglais puis vers le français. Ses sources sont disponibles sous une licence de type <abbr title="Berkeley Software Distribution">BSD</abbr>.
</p>
<hr />

</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/nginx"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1598992506" /><input type="hidden" name="summary" value="[Nginx : serveur Web asynchrone] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="nginxserveur_web_asynchrone" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="65-556" /><button type="submit" title="Nginx : serveur Web asynchrone" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit2 page-header" id="installation">Installation</h2>
<div class="level2">

<p>
<a href="http://wiki.nginx.org/Install#Ubuntu_PPA" class="urlextern" title="http://wiki.nginx.org/Install#Ubuntu_PPA" rel="nofollow">Deux dépôts</a> proposent les installateurs du serveur Nginx: le dépôt <strong>stable</strong> et le dépôt <strong> développement</strong>. Le dépôt <strong>stable</strong> est fourni par défaut ; les versions les plus récentes n&#039;y sont pas proposées mais leur stabilité est éprouvée. Le dépôt de développement propose des versions plus récentes. Elles sont loin d&#039;êtres instables mais les tests effectués sont moins poussés et doivent donc être évitées pour des usages de production. Vous devrez <a href="/ppa" class="wikilink1" title="ppa">ajouter</a> ce dépôt (<strong>ppa:nginx/development</strong>) si vous souhaitez utiliser ces versions.
</p>

<p>
Vous pouvez aussi choisir le packaging de votre Nginx. En effet, Nginx est proposé en 3 packagings offrants des lots de fonctionnalités différents. Dans le doute, choisissez le paquet <strong>Nginx</strong>.
</p>
<div class="table-responsive"><table class="inline table table-striped table-condensed">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> 																</th><th class="col1 leftalign"> nginx-extras	</th><th class="col2 leftalign"> nginx-full	</th><th class="col3 leftalign"> nginx-light	</th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> Core, Access, Auth Basic, Auto Index, Charset, Empty GIF, FastCGI, Gzip, Headers, Index, Log, Map, Proxy, Rewrite, Upstream	</td><td class="col1 centeralign"> 	X	</td><td class="col2 centeralign">	X	</td><td class="col3 centeralign">	X	</td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> User ID, UWSGI, Browser, Geo, Limit Requests, Limit Zone, Memcached, Referer, SCGI, Split Clients, SSI			</td><td class="col1 centeralign"> 	X	</td><td class="col2 centeralign">	X	</td><td class="col3 leftalign">		</td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> Gzip Precompression, IPv6, SSL, Stub Status											</td><td class="col1 centeralign">  	X	</td><td class="col2 centeralign">	X	</td><td class="col3 centeralign">	X	</td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> Substitution, WebDAV, XSLT, Addition, Debug, GeoIP, Image Filter, Real IP							</td><td class="col1 centeralign">  	X	</td><td class="col2 centeralign">	X	</td><td class="col3 leftalign">		</td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> HTTP Sub															</td><td class="col1 leftalign">  		</td><td class="col2 centeralign">	X	</td><td class="col3 leftalign">		</td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> Embedded Perl, FLV, MP4, Random Index, Secure Link										</td><td class="col1 centeralign">  	X	</td><td class="col2 leftalign">		</td><td class="col3 leftalign">		</td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> Mail Core, IMAP, POP3, SMTP, SSL												</td><td class="col1 centeralign">  	X	</td><td class="col2 centeralign">	X	</td><td class="col3 leftalign">		</td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign"> Echo																</td><td class="col1 centeralign">  	X	</td><td class="col2 centeralign">	X	</td><td class="col3 centeralign">	X	</td>
	</tr>
	<tr class="row9">
		<td class="col0 leftalign"> Upstream Fair Queue, Auth PAM, DAV Ext											</td><td class="col1 centeralign">  	X	</td><td class="col2 centeralign">	X	</td><td class="col3 leftalign">		</td>
	</tr>
	<tr class="row10">
		<td class="col0 leftalign"> Embedded Lua, HttpHeadersMore, http push, Nginx Development Kit, Upload module, Upload Progress, Chunkin			</td><td class="col1 centeralign">  	X	</td><td class="col2 leftalign">		</td><td class="col3 leftalign">		</td>
	</tr>
</table></div>
<div class="noteclassic">Une fois votre choix fait, vous devez <a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer le paquet</a> qui vous convient.
</div><hr />

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/nginx"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1598992506" /><input type="hidden" name="summary" value="[Installation] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="557-2437" /><button type="submit" title="Installation" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit4 page-header" id="configuration">Configuration</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit form-inline" method="post" action="/nginx"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1598992506" /><input type="hidden" name="summary" value="[Configuration] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="2438-2464" /><button type="submit" title="Configuration" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit5" id="configuration_de_nginx">Configuration de Nginx</h3>
<div class="level3">

<p>
La configuration de Nginx est modularisée en plusieurs fichiers de configuration <a href="/tutoriel/comment_modifier_un_fichier" class="wikilink1" title="tutoriel:comment_modifier_un_fichier">textuel</a> que vous trouverez dans le dossier <em>/etc/nginx</em>:
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <strong>nginx.conf:</strong> Le fichier de configuration globale du <strong>serveur</strong>. Les paramètres qui s&#039;y trouvent doivent impacter l&#039;ensemble du serveur ; vous n&#039;y toucherez normalement pas.</div>
</li>
<li class="level1"><div class="li"> <strong>mime.types:</strong> La liste des types MIME résolus par les extensions de fichiers. Cette liste indique la nature des fichiers renvoyés par le serveur (ex: ceci est une page web ou ceci est une vidéo ogg).</div>
</li>
<li class="level1"><div class="li"> <strong>sites-available:</strong> Contient les fichiers de configurations de vos sites ou services (un fichier par pré-occupation/site/service). Ce dossier est un <em>dépôt</em> ; les fichiers de configuration qui y sont ne sont pas pris en compte.</div>
</li>
<li class="level1"><div class="li"> <strong>sites-enabled:</strong> Doit contenir des <a href="/lien_physique_et_symbolique#exemple_de_lien_symbolique" class="wikilink1" title="lien_physique_et_symbolique">liens symboliques</a> vers les fichiers de <strong>site-available</strong> que vous souhaitez activer.</div>
</li>
<li class="level1"><div class="li"> <strong>conf.d:</strong>  Emplacement pour appliquer les paramètres communs à tous les sites. Peut également servir de la même façon que <strong>site-available</strong> (renommer ses fichiers &quot;.conf&quot; en &quot;.disabled&quot; pour désactiver les sites).</div>
</li>
</ul>
<hr />

</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit form-inline" method="post" action="/nginx"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1598992506" /><input type="hidden" name="summary" value="[Configuration de Nginx] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration_de_nginx" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="2465-3729" /><button type="submit" title="Configuration de Nginx" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit6" id="le_nginxconf_par_defaut">Le nginx.conf par défaut</h3>
<div class="level3">

<p>
Le fichier <strong>nginx.conf</strong> est l&#039;élément névralgique de votre serveur Nginx. Nous allons voir à quoi ressemble un fichier <strong>nginx.conf</strong> par défaut sous Ubuntu (avec une petite traduction en Français).
</p>

<p>
<img src="/lib/images/smileys/fixme.gif" class="icon" alt="FIXME" /> EN COURS — <em><a href="/utilisateurs/beaver" class="wikilink1" title="utilisateurs:beaver">beaver</a> Le 11/08/2015, 15:30</em>.
</p>
<div class="table-responsive"><table class="inline table table-striped table-condensed">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> Les modules	</th><th class="col1 leftalign"> Les explications	</th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"><pre class="code">user www-data; ##**Syntaxe:** **user** **user** **[group]**;</pre>
</td><td class="col1"> Définit l&#039;utilisateur et le groupe avec lequel le daemon Nginx sera lancé. Si le groupe est omis, un groupe dont le nom correspond à celui de l&#039;utilisateur sera utilisé. </td>
	</tr>
	<tr class="row2">
		<td class="col0"><pre class="code">worker_processes 4; ##**Syntaxe:** worker_processes **nombre**  **auto**; </pre>
</td><td class="col1"> La valeur optimale dépend de nombreux facteurs.. y compris (mais non limité à) au nombre de CPU que vous disposez; le nombre de disques durs.. etc <img src="/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />. Si vous avez un doute sur la valeur à indiquer, veuillez prendre comme référence le nombre de CPU que vous disposez, vous pouvez aussi utiliser <strong>auto</strong>. </td>
	</tr>
	<tr class="row3">
		<td class="col0"><pre class="code">pid /run/nginx.pid;##**Syntaxe:** pid **fichier.pid**;</pre>
</td><td class="col1"> Le fichier stockera le <a href="https://fr.wikipedia.org/wiki/Identifiant_de_processus" class="urlextern" title="https://fr.wikipedia.org/wiki/Identifiant_de_processus" rel="nofollow">PID</a> de votre processus. </td>
	</tr>
	<tr class="row4">
		<td class="col0"><pre class="code">events { worker_connections 768; ##**Syntaxe:** worker_connections **nombre**;</pre>
</td><td class="col1"> Définir le nombre maximal de connexions simultanées ouvertes par le processus. </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <pre class="code">multi_accept on;} ##**Syntaxe:** multi_accept **on**  **off**;</pre>
</td><td class="col1"> Si <strong>multi_accept</strong> est désactivé, le processus acceptera une nouvelle connexion à la fois, dans le cas contraire, le processus acceptera toutes les nouvelles connexions en même temps. </td>
	</tr>
	<tr class="row6">
		<td class="col0"><pre class="code">http { sendfile on; ##**Syntaxe;** sendfile **on** **off**;</pre>
</td><td class="col1"> Nous allons dire que nous avons un <strong>index  index.php;</strong> dans notre virtual host, Sendfile permettra de se délester de PHP pour l’envoi des fichiers aux navigateurs. Il est fortement recommandé d’utiliser ce module pour alléger les process sur le serveur. </td>
	</tr>
	<tr class="row7">
		<td class="col0"><pre class="code">tcp_nopush on; ##**Syntaxe:** tcp_nopush **on**  **off**</pre>
</td><td class="col1"> Le module <strong>tcp_nopush</strong> fait le contraire de <strong>tcp_nodelay</strong> : au lieu d’optimiser les délais d’envoi des informations, il optimise la quantité d’informations envoyée. <strong>tcp_nopush</strong> et <strong>sendfile</strong> sont indissociable<sup><a href="#fn__1" id="fnt__1" class="fn_top">1)</a></sup>. </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <pre class="code">tcp_nodelay on; ##**Syntaxe:** tcp_nodelay **on**  **off**;</pre>
</td><td class="col1"> Activer  ou désactiver l&#039;algorithme de <a href="https://fr.wikipedia.org/wiki/Algorithme_de_Nagle" class="urlextern" title="https://fr.wikipedia.org/wiki/Algorithme_de_Nagle" rel="nofollow">Nagle</a><sup><a href="#fn__2" id="fnt__2" class="fn_top">2)</a></sup>. </td>
	</tr>
	<tr class="row9">
		<td class="col0"><pre class="code">keepalive_timeout 65; ##**Syntaxe:** keepalive_timeout **timeout** **[header_timeout]**;</pre>
</td><td class="col1"> <strong>Le premier paramètre est obligatoire</strong> définit un délai pendant lequel une connexion cliente KeepAlive restera ouverte côté serveur. La valeur 0 désactive les connexions clientes KeepAlive. <strong>Le deuxième paramètre quand à lui est facultatif</strong> définit la valeur de délai de l&#039;<a href="https://fr.wikipedia.org/wiki/Header" class="urlextern" title="https://fr.wikipedia.org/wiki/Header" rel="nofollow">entête // header</a>. </td>
	</tr>
	<tr class="row10">
		<td class="col0"><pre class="code">types_hash_max_size 2048; ##**Syntaxe:** types_hash_max_size **taille**;</pre>
</td><td class="col1"> Définit la taille maximale des types de <a href="https://fr.wikipedia.org/wiki/Table_de_hachage" class="urlextern" title="https://fr.wikipedia.org/wiki/Table_de_hachage" rel="nofollow">tables de hachage</a>. Les détails de la mise en place des tables de hachage sont fournis dans un document <a href="http://nginx.org/en/docs/hash.html" class="urlextern" title="http://nginx.org/en/docs/hash.html" rel="nofollow">distinct</a>. Pour traiter rapidement des ensembles de données statiques tels que le nom de votre serveur, les directions <a href="http://nginx.org/en/docs/http/ngx_http_map_module.html#map" class="urlextern" title="http://nginx.org/en/docs/http/ngx_http_map_module.html#map" rel="nofollow">map</a>, les <a href="https://fr.wikipedia.org/wiki/Type_MIME" class="urlextern" title="https://fr.wikipedia.org/wiki/Type_MIME" rel="nofollow">Types MIME</a>, etc … Nginx utilise les tables de hachage. </td>
	</tr>
	<tr class="row11">
		<td class="col0"> <pre class="code">server_tokens off; ##**Syntaxe:** server_tokens **on**  **off**;</pre>
</td><td class="col1"> Active ou désactive l&#039;émission de votre <a href="https://ubuntu-fr.org/.ht" class="urlextern" title="https://ubuntu-fr.org/.ht" rel="nofollow">version</a> Nginx. Dans notre exemple, nous voyons bien que le site ubuntu-fr.org cache sa version Nginx <img src="/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />.</td>
	</tr>
	<tr class="row12">
		<td class="col0"><pre class="code">server_names_hash_bucket_size 64; ##**Syntaxe:****server_names_hash_bucket_size** **taille**;</pre>
</td><td class="col1">Si vous avez un nom de domaine de plus de 64 chars, vous aurez besoin de ce module. Par défaut, sa valeur est de 64. Notez que si vous avez un domaine de 80 chars par exemple, vous ne réglerez pas la valeur à &quot;80&quot;, vous utiliserez plutôt un multiple de 2 → 128<sup><a href="#fn__3" id="fnt__3" class="fn_top">3)</a></sup>.</td>
	</tr>
	<tr class="row13">
		<td class="col0"><pre class="code">server_name_in_redirect off; ##**Syntaxe:** server_name_in_redirect **on**  **off**;</pre>
</td><td class="col1"> Quand le module <strong>name_server</strong> n&#039;est pas définit dans votre virtual host, le contenu de <strong>Host</strong> dans le header est utilisé. Si ce champ n&#039;est pas présent, l&#039;adresse IP du serveur est utilisée, si vous avez pas d&#039;adresse IP … → <img src="/lib/images/smileys/facepalm.gif" class="icon" alt="m(" />. GET <strong>/</strong> ← Le chemin absolu ou se trouve le fichier index.html.  <strong>HTTP/1.1</strong>  ← La version http utilisée est 1.1, donc le <strong>host</strong><sup><a href="#fn__4" id="fnt__4" class="fn_top">4)</a></sup> est obligatoire. <strong>Host: ubuntu-fr.org</strong> ← Le nom de domaine, c&#039;est cette partie que tentera de récupérer le module <strong>server_name_in_redirect</strong> si il est actif<sup><a href="#fn__5" id="fnt__5" class="fn_top">5)</a></sup>. </td>
	</tr>
	<tr class="row14">
		<td class="col0"><pre class="code">include /etc/nginx/mime.types; ##La liste des types MIME résolu par les extensions de fichiers.</pre>
</td><td class="col1"> Cette liste indique la nature des fichiers renvoyées par le serveur (ex: ceci est une page web <a href="http://votrendd.tld/hello.html" class="urlextern" title="http://votrendd.tld/hello.html" rel="nofollow">http://votrendd.tld/hello.html</a> ou ceci est une vidéo ogg ..  <a href="http://votrendd.tld/mavideo.ogg" class="urlextern" title="http://votrendd.tld/mavideo.ogg" rel="nofollow">http://votrendd.tld/mavideo.ogg</a> pour que Nginx &quot;comprenne&quot; que c&#039;est un format <strong>.html</strong> ou un format <strong>.ogg</strong> il lui faut un fichier mime.types).</td>
	</tr>
	<tr class="row15">
		<td class="col0"><pre class="code">default_type application/octet-stream; ##**Syntaxe:** default_type **mime-type**;</pre>
</td><td class="col1"> Définit le <a href="https://fr.wikipedia.org/wiki/Type_MIME" class="urlextern" title="https://fr.wikipedia.org/wiki/Type_MIME" rel="nofollow">Type MIME</a>  par défaut d&#039;une requête ACK. Un mappage sur l&#039;extension de <a href="https://fr.wikipedia.org/wiki/Type_MIME" class="urlextern" title="https://fr.wikipedia.org/wiki/Type_MIME" rel="nofollow">Type MIME</a> peut être configuré avec le module <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#types" class="urlextern" title="http://nginx.org/en/docs/http/ngx_http_core_module.html#types" rel="nofollow">type</a>. </td>
	</tr>
	<tr class="row16">
		<td class="col0"><pre class="code">access_log /var/log/nginx/access.log;</pre>
</td><td class="col1"> Vous retrouverez dans votre fichier <strong>access.log</strong> les <strong>GET&#039;S/POST&#039;S</strong> de chaque visiteur visitant votre site.</td>
	</tr>
	<tr class="row17">
		<td class="col0"><pre class="code">error_log /var/log/nginx/error.log;</pre>
</td><td class="col1"> Ici à contrario vous retrouverez dans votre fichier <strong>error.log</strong> les erreurs <strong>403, 404, 500, 503</strong>, venant de vos visiteurs (par exemple)<img src="/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />.</td>
	</tr>
	<tr class="row18">
		<td class="col0"><pre class="code">gzip on; ##**Syntaxe:**gzip **on** | **off**;</pre>
</td><td class="col1"><strong>ngx_http_gzip_module</strong> est un filtre qui compresse les requêtes de type ACK à l&#039;aide de la méthode « gzip ». Souvent, ça permet de réduire la taille des données transmises.  Nous pouvons via ce module, réduire de moitié les données transmises, voir même plus <img src="/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />. </td>
	</tr>
	<tr class="row19">
		<td class="col0"><pre class="code">gzip_disable &quot;msie6&quot;; ##**Syntaxe:** gzip_disable **regex** ...;</pre>
</td><td class="col1"> Désactive via une regexp gzip. Le module utilisera encore une fois le header<sup><a href="#fn__6" id="fnt__6" class="fn_top">6)</a></sup> pour récupérer l&#039;<strong>User-Agent</strong> de votre visiteur. Vous noterez qu&#039;il existe une exception à la règle concernant les regexp → <a href="https://fr.wikipedia.org/wiki/Internet_Explorer_6" class="urlextern" title="https://fr.wikipedia.org/wiki/Internet_Explorer_6" rel="nofollow">msie6</a> <img src="/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />, si cette exception ne serait pas d&#039;actualité, nous aurions utilisé cette regexp: <pre class="code">MSIE [4-6]\.</pre>

<p>
.
</p>
</td>
	</tr>
	<tr class="row20">
		<td class="col0"> <pre class="code">gzip_vary on; ##**Syntaxe:** gzip_vary **on** | **off**;</pre>
</td><td class="col1"> Active ou désactive l&#039;insertion de <strong>Vary: Accept-Encoding</strong> dans le header de votre requête ACK. Seulement si un des modules <strong>gzip</strong>, gzip_static ou gunzip sont actif. Dans le cas du site ubuntu-fr.org le module <strong>gzip_vary</strong> est sur <strong>off</strong><sup><a href="#fn__7" id="fnt__7" class="fn_top">7)</a></sup>, la compression de notre header<sup><a href="#fn__8" id="fnt__8" class="fn_top">8)</a></sup> ne semble donc pas active.. .</td>
	</tr>
	<tr class="row21">
		<td class="col0"><pre class="code">gzip_proxied any; ##**Syntaxe:** gzip_proxied off | expired | **no-cache**</pre>
<pre class="code">| no-store | private | no_last_modified | no_etag | auth | any;</pre>
</td><td class="col1"> Active ou désactive la compression gzip pour les proxys. gzip_proxied vérifie le header<sup><a href="#fn__9" id="fnt__9" class="fn_top">9)</a></sup> de votre connexion ACK  (la partie <strong>Cache-Control</strong>). Nous voyons bien que le site active la compression pour les connexions ACK, seulement si le header comporte le paramètre <strong>no-cache</strong> dans le <strong>Cache-Control</strong>.</td>
	</tr>
	<tr class="row22">
		<td class="col0"><pre class="code">gzip_comp_level 6; ##**Syntaxe:** ?</pre>
</td><td class="col1"> En cours </td>
	</tr>
	<tr class="row23">
		<td class="col0"><pre class="code">gzip_buffers 16 8k; ##**Syntaxe:** ?</pre>
</td><td class="col1"> En cours </td>
	</tr>
	<tr class="row24">
		<td class="col0"><pre class="code">gzip_http_version 1.1; ##**Syntaxe:** ?</pre>
</td><td class="col1"> En cours </td>
	</tr>
	<tr class="row25">
		<td class="col0"><pre class="code">gzip_types text/plain text/css application/json application/x-javascript text/xml</pre>
<pre class="code">application/xml application/xml+rss text/javascript; ##**Syntaxe:** ?</pre>
</td><td class="col1"> En cours </td>
	</tr>
	<tr class="row26">
		<td class="col0"><pre class="code">nginx-naxsi config ##**Syntaxe:** ?</pre>
</td><td class="col1"> En cours </td>
	</tr>
	<tr class="row27">
		<td class="col0"><pre class="code">include /etc/nginx/naxsi_core.rules; ##**Syntaxe:** ?</pre>
</td><td class="col1"> En cours </td>
	</tr>
	<tr class="row28">
		<td class="col0"><pre class="code">nginx-passenger config;##**Syntaxe:** ?</pre>
</td><td class="col1"> En cours </td>
	</tr>
	<tr class="row29">
		<td class="col0"><pre class="code">passenger_root /usr; ##**Syntaxe:** ?</pre>
</td><td class="col1"> En cours </td>
	</tr>
	<tr class="row30">
		<td class="col0"><pre class="code">passenger_ruby /usr/bin/ruby; ##**Syntaxe:** ?</pre>
</td><td class="col1"> En cours </td>
	</tr>
	<tr class="row31">
		<td class="col0"><pre class="code">include /etc/nginx/conf.d/*.conf;</pre>
</td><td class="col1"> En bash, le métacaractère <strong> * </strong> correspond à aucun caractère, n&#039;importe quel caractère ou un ensemble de caractères, via ce métacaractère vous allez pouvoir charger tous vos fichiers <strong>.conf</strong> sans devoir en définir le nom au préalable. </td>
	</tr>
	<tr class="row32">
		<td class="col0"> <pre class="code">include /etc/nginx/sites-enabled/*;}</pre>
</td><td class="col1"> En bash, le métacaractère <strong> * </strong> correspond à aucun caractère, n&#039;importe quel caractère ou un ensemble de caractères, via ce métacaractère vous allez pouvoir charger tous vos fichiers <strong>*.</strong>*. Cette partie contiendra vos sites internet actifs, à savoir que vous devez au préalable utiliser <strong>/etc/nginx/sites-available/</strong> <img src="/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />. </td>
	</tr>
	<tr class="row33">
		<td class="col0"><pre class="code">mail { auth_http localhost/auth.php; ##**Syntaxe:** ?</pre>
</td><td class="col1"> En cours </td>
	</tr>
	<tr class="row34">
		<td class="col0"><pre class="code">pop3_capabilities &quot;TOP&quot; &quot;USER&quot;; ##**Syntaxe:** ?</pre>
</td><td class="col1"> En cours </td>
	</tr>
	<tr class="row35">
		<td class="col0"><pre class="code">imap_capabilities &quot;IMAP4rev1&quot; &quot;UIDPLUS&quot;; ##**Syntaxe:** ?</pre>
</td><td class="col1"> En cours </td>
	</tr>
	<tr class="row36">
		<td class="col0"><pre class="code">server { listen     localhost:110; ##**Syntaxe:** ?</pre>
</td><td class="col1"> En cours </td>
	</tr>
	<tr class="row37">
		<td class="col0"><pre class="code">protocol   pop3; ##**Syntaxe:** ?</pre>
</td><td class="col1"> En cours </td>
	</tr>
	<tr class="row38">
		<td class="col0"><pre class="code">proxy      on; ##**Syntaxe:**?</pre>
</td><td class="col1"> En cours </td>
	</tr>
	<tr class="row39">
		<td class="col0"><pre class="code">server { listen     localhost:143; ##**Syntaxe:** ?</pre>
</td><td class="col1"> En cours </td>
	</tr>
	<tr class="row40">
		<td class="col0"><pre class="code">protocol   imap; ##**Syntaxe:**?</pre>
</td><td class="col1"> En cours </td>
	</tr>
	<tr class="row41">
		<td class="col0"><pre class="code">proxy      on;}} ##**Syntaxe:**?</pre>
</td><td class="col1"> En cours </td>
	</tr>
</table></div>
<hr />

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit form-inline" method="post" action="/nginx"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1598992506" /><input type="hidden" name="summary" value="[Le nginx.conf par défaut] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="le_nginxconf_par_defaut" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="3730-14967" /><button type="submit" title="Le nginx.conf par défaut" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit8" id="nginx_et_les_hotes_virtuels">Nginx et les hôtes virtuels</h3>
<div class="level3">

<p>
Nginx inclut un exemple de configuration d&#039;un hôte virtuel<sup><a href="#fn__10" id="fnt__10" class="fn_top">10)</a></sup> que vous pouvez trouver dans « /etc/nginx/sites-available/default ».
</p>

<p>
Si vous souhaitez le modifier, <a href="/tutoriel/comment_modifier_un_fichier" class="wikilink1" title="tutoriel:comment_modifier_un_fichier">ouvrez (avec les droits administrateur) le fichier</a> <strong>/etc/nginx/sites-available/default</strong>.
</p>

<p>
Pour configurer votre nom de domaine (vhost), vous pouvez copier la configuration par défaut du vhost « default » puis y apporter vos modifications. Exemple :
</p>
<pre class="code">sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/mondomaine.tld</pre>

<p>
Puis, modifier la configuration de votre nom de domaine mondomaine.tld en <a href="/tutoriel/comment_modifier_un_fichier" class="wikilink1" title="tutoriel:comment_modifier_un_fichier">modifiant le fichier</a> <strong>/etc/nginx/sites-available/mondomaine.tld</strong>.
</p>

<p>
Le sous-répertoire « sites-available » stocke les vhosts mais pour que Nginx les prenne en considération, vous devez les activer en créant un lien symbolique dans « /etc/nginx/sites-enabled ». Par exemple :
</p>
<pre class="code">sudo ln -s /etc/nginx/sites-available/mondomaine.tld /etc/nginx/sites-enabled/mondomaine.tld</pre>

<p>
Il ne reste qu&#039;à redémarrer Nginx :
</p>
<pre class="code">sudo /etc/init.d/nginx restart</pre>
<hr />

</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit form-inline" method="post" action="/nginx"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1598992506" /><input type="hidden" name="summary" value="[Nginx et les hôtes virtuels] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="nginx_et_les_hotes_virtuels" /><input type="hidden" name="codeblockOffset" value="44" /><input type="hidden" name="range" value="14968-16181" /><button type="submit" title="Nginx et les hôtes virtuels" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit9 page-header" id="configuration_du_reverse_proxy_et_du_cache_web">Configuration  du reverse proxy et du cache Web</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_9'><form class="button btn_secedit form-inline" method="post" action="/nginx"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1598992506" /><input type="hidden" name="summary" value="[Configuration  du reverse proxy et du cache Web] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration_du_reverse_proxy_et_du_cache_web" /><input type="hidden" name="codeblockOffset" value="44" /><input type="hidden" name="range" value="16182-16243" /><button type="submit" title="Configuration  du reverse proxy et du cache Web" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit10" id="configuration_d_un_reverse_proxy_et_du_cache_avec_nginx">Configuration d&#039;un reverse proxy et du cache avec Nginx</h3>
<div class="level3">

<p>
Ce tutoriel montre la configuration de nginx en tant que reverse proxy cache.
</p>

<p>
Cette configuration contiendra les éléments suivants:
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Cache au niveau du reverse proxy </div>
</li>
<li class="level1"><div class="li"> Activation des champs expires dans la requête http</div>
</li>
<li class="level1"><div class="li"> Compression entre le client et le reverse proxy </div>
</li>
<li class="level1"><div class="li"> Limitation des connexions entre le client et le reverse proxy (nombre et temps)</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_10'><form class="button btn_secedit form-inline" method="post" action="/nginx"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1598992506" /><input type="hidden" name="summary" value="[Configuration d&#039;un reverse proxy et du cache avec Nginx] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration_d_un_reverse_proxy_et_du_cache_avec_nginx" /><input type="hidden" name="codeblockOffset" value="44" /><input type="hidden" name="range" value="16244-16681" /><button type="submit" title="Configuration d&#039;un reverse proxy et du cache avec Nginx" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit11" id="pre-requis">Pré-requis</h3>
<div class="level3">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Avoir lu la page de documentation sur <a href="/nginx" class="wikilink1 curid" title="nginx" data-curid="true">Nginx : serveur Web asynchrone</a>.</div>
</li>
<li class="level1"><div class="li"> Comprendre la fonction d&#039;un reverse proxy ou un proxy inverse <a href="http://fr.wikipedia.org/wiki/Reverse_proxy" class="urlextern" title="http://fr.wikipedia.org/wiki/Reverse_proxy" rel="nofollow">Article wikipedia</a>.</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_11'><form class="button btn_secedit form-inline" method="post" action="/nginx"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1598992506" /><input type="hidden" name="summary" value="[Pré-requis] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="pre-requis" /><input type="hidden" name="codeblockOffset" value="44" /><input type="hidden" name="range" value="16682-16922" /><button type="submit" title="Pré-requis" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit12" id="configuration1">Configuration</h3>
<div class="level3">
<div class="noteimportant">Certains termes présents dans cet article ne sont pas très &quot;académiques&quot; n&#039;hésitez pas à les modifier si vous les connaissez.

</div>
<p>
La configuration qui va suivre se décomposera en trois parties : 
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Le paramétrage global du serveur nginx.</div>
</li>
<li class="level1"><div class="li"> Le paramétrage des fonctions de reverse proxy et de cache.</div>
</li>
<li class="level1"><div class="li"> Un exemple de configuration du serveur web se trouvant derrière le reverse proxy. </div>
</li>
</ul>

<p>
Les fichiers et les dossiers de configuration utilisés seront :
</p>
<pre class="code">/etc/nginx/nginx.conf
/etc/nginx/conf.d/proxy.conf
/etc/nginx/sites-enabled/
/etc/nginx/sites-available/</pre>

<p>
Cette séparation a pour but d&#039;ajouter de la clarté dans la configuration car tous les fichiers de configuration sont inclus dans le fichier nginx.conf.
</p>

</div>

<h4 id="configuration_du_nginxconf_avec_proxy">Configuration du nginx.conf avec proxy</h4>
<div class="level4">

<p>
La configuration se fait dans le fichier /etc/nginx/nginx.conf
</p>

<p>
Contenu du fichier 
</p>
<pre class="code">user www-data;
worker_processes  1;
error_log  /var/log/nginx/error.log;
pid        /var/run/nginx.pid;
events {
	worker_connections  1024;
}
http {
    include       /etc/nginx/mime.types;
    default_type application/octet-stream;
    access_log  /var/log/nginx/access.log;
    sendfile        on;
    #tcp_nopush     on;
    #keepalive_timeout  0;
    keepalive_timeout  65;
    tcp_nodelay        on;
    # envoi moins d&#039;information sur le serveur
    server_tokens off;

     # taille des buffers et taille max des requêtes normales
    client_body_buffer_size 1k;
    client_max_body_size    8m;
    large_client_header_buffers 1 1K;
    ignore_invalid_headers on;
    
    
    # définition des différents timeout
    client_body_timeout 5;
    client_header_timeout 5;
    keepalive_timeout 5 5;
    send_timeout 5;
    ignore_invalid_headers on;
    server_name_in_redirect off;
    
    
    # active la compression des pages sauf pour les navigateurs pourris
    gzip  on;
    gzip_comp_level 6;
    gzip_proxied any;
    gzip_vary on;
    gzip_types  text/plain text/css application/x-javascript;
    gzip_disable &quot;MSIE [1-6]\.(?!.*SV1)&quot;;
    
    # limitation du nombre de connexion par client
    limit_zone gulag $binary_remote_addr 1m;
    limit_conn gulag 50;

    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*;
}</pre>
<div class="table-responsive"><table class="inline table table-striped table-condensed">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> options                  </th><th class="col1 leftalign"> explications          </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> user www-data; ##<strong>Syntaxe:</strong> <strong>user</strong> <strong>user</strong> <strong>[group]</strong>    </td><td class="col1"> Définit l&#039;utilisateur et le groupe avec lequel le daemon Nginx sera lancé. Si le groupe est omis, un groupe dont le nom correspond à celui de l&#039;utilisateur sera utilisé. </td>
	</tr>
	<tr class="row2">
		<td class="col0"> worker_processes 1; ##<strong>Syntaxe:</strong> worker_processes <strong>nombre</strong> <strong>auto</strong>; </td><td class="col1"> La valeur optimale dépend de nombreux facteurs.. y compris (mais non limité à) au nombre de CPU que vous disposez; le nombre de disques durs.. etc <img src="/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />. Si vous avez un doute sur la valeur à indiquer, veuillez prendre comme référence le nombre de CPU que vous disposez, vous pouvez aussi utiliser <strong>auto</strong>. </td>
	</tr>
	<tr class="row3">
		<td class="col0"> worker_connections; ##<strong>Syntaxe:</strong> ? </td><td class="col1 leftalign"> fixer ce paramètre en fonction du calcul ci dessous (valable que sur un reverse proxy)    max_clients = worker_processes * worker_connections/4         </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign">access_log  </td><td class="col1"> Vous retrouverez dans votre fichier <strong>access.log</strong> les <strong>GET&#039;S/POST&#039;S</strong> de chaque visiteur visitant votre site.</td>
	</tr>
	<tr class="row5">
		<td class="col0">error_log </td><td class="col1"> Ici à contrario vous retrouverez dans votre fichier <strong>error.log</strong> les erreurs <strong>403, 404, 500, 503</strong>, venant de vos visiteurs (par exemple)<img src="/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />. </td>
	</tr>
	<tr class="row6">
		<td class="col0"> default_type application/octet-stream; ##<strong>Syntaxe:</strong> default_type <strong>mime-type</strong>; </td><td class="col1"> Définit le <a href="https://fr.wikipedia.org/wiki/Type_MIME" class="urlextern" title="https://fr.wikipedia.org/wiki/Type_MIME" rel="nofollow">Type MIME</a>  par défaut d&#039;une requête ACK. Un mappage sur l&#039;extension de <a href="https://fr.wikipedia.org/wiki/Type_MIME" class="urlextern" title="https://fr.wikipedia.org/wiki/Type_MIME" rel="nofollow">Type MIME</a> peut être configuré avec le module <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#types" class="urlextern" title="http://nginx.org/en/docs/http/ngx_http_core_module.html#types" rel="nofollow">type</a>. </td>
	</tr>
	<tr class="row7">
		<td class="col0">server_tokens off; ##<strong>Syntaxe:</strong> server_tokens <strong>on</strong> <strong>off</strong> </td><td class="col1"> Active ou désactive l&#039;émission de votre <a href="https://ubuntu-fr.org/.ht" class="urlextern" title="https://ubuntu-fr.org/.ht" rel="nofollow">version</a> Nginx.</td>
	</tr>
	<tr class="row8">
		<td class="col0">client_body_buffer_size ##<strong>Syntaxe:</strong> ? </td><td class="col1"> définit la taille au delà de laquelle la requête sera enregistrée dans un fichier </td>
	</tr>
	<tr class="row9">
		<td class="col0">client_max_body_size ##<strong>Syntaxe:</strong> ? </td><td class="col1 leftalign"> taille max des données envoyées par un client  </td>
	</tr>
	<tr class="row10">
		<td class="col0"> large_client_header_buffers ##<strong>Syntaxe:</strong> ?</td><td class="col1"> définit le nombre de buffer ainsi que leurs tailles, la taille max de la requête <abbr title="Uniform Resource Identifier">URI</abbr> est donc la multiplication de ces deux chiffres </td>
	</tr>
	<tr class="row11">
		<td class="col0"> client_body_timeout ##<strong>Syntaxe:</strong> ? </td><td class="col1"> si le client n&#039;envoie pas la totalité de sa requête en 5 sec c&#039;est mort ! </td>
	</tr>
	<tr class="row12">
		<td class="col0"> client_header_timeout  ##<strong>Syntaxe:</strong> ? </td><td class="col1"> si le client n&#039;envoie pas l&#039;entête de sa requête même traitement</td>
	</tr>
	<tr class="row13">
		<td class="col0"> keepalive_timeout 5 5 ##<strong>Syntaxe:</strong> ?</td><td class="col1"> premier chiffre temps max d&#039;une connexion keepalive, deuxième chiffre indication de cette valeur dans le champ timeout de l&#039;entête de la réponse </td>
	</tr>
	<tr class="row14">
		<td class="col0"> keepalive_requests 100  ##<strong>Syntaxe:</strong> ? </td><td class="col1"> nombre de requêtes keepalive sur une connexion </td>
	</tr>
	<tr class="row15">
		<td class="col0"> send_timeout ##<strong>Syntaxe:</strong> ? </td><td class="col1"> temps maximum de latence lors d&#039;un envoi </td>
	</tr>
	<tr class="row16">
		<td class="col0"> ignore_invalid_headers ##<strong>Syntaxe:</strong> ?</td><td class="col1"> supprime les requêtes malformées </td>
	</tr>
	<tr class="row17">
		<td class="col0"> server_name_in_redirect  ##<strong>Syntaxe:</strong> ?</td><td class="col1"> désactive la réécriture du nom de serveur, protection contre les scans </td>
	</tr>
	<tr class="row18">
		<td class="col0"> gzip &quot;&quot;; ##<strong>Syntaxe:</strong>gzip <strong>on</strong> <strong>off</strong>;</td><td class="col1"> <strong>ngx_http_gzip_module</strong> est un filtre qui compresse les requêtes de type ACK à l&#039;aide de la méthode « gzip ». Souvent, ça permet de réduire la taille des données transmises.  Nous pouvons via ce module, réduire de moitié les données transmises, voir même plus <img src="/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />. </td>
	</tr>
	<tr class="row19">
		<td class="col0 leftalign">gzip_comp_level ##<strong>Syntaxe:</strong> ?  </td><td class="col1"> niveau de compression (peut aller jusqu&#039;à 9) </td>
	</tr>
	<tr class="row20">
		<td class="col0 leftalign"> gzip_proxied any ##<strong>Syntaxe:</strong> ?  </td><td class="col1"> activer la compression pour la réponse du serveur web derrière le reverse proxy </td>
	</tr>
	<tr class="row21">
		<td class="col0"> gzip_vary on; ##<strong>Syntaxe:</strong> gzip_vary <strong>on</strong>  <strong>off</strong>; </td><td class="col1 leftalign"> Active ou désactive l&#039;insertion de <strong>Vary: Accept-Encoding</strong> dans le header de votre requête ACK. Seulement si un des modules <strong>gzip</strong>, gzip_static ou gunzip sont actif. Dans le cas du site ubuntu-fr.org le module <strong>gzip_vary</strong> est sur <strong>off</strong><sup><a href="#fn__11" id="fnt__11" class="fn_top">11)</a></sup>, la compression de notre header ne semble donc pas active.. .<sup><a href="#fn__12" id="fnt__12" class="fn_top">12)</a></sup>  </td>
	</tr>
	<tr class="row22">
		<td class="col0 leftalign"> gzip_types ##<strong>Syntaxe:</strong> ?  </td><td class="col1"> les types de fichier qui seront compréssés </td>
	</tr>
	<tr class="row23">
		<td class="col0"> gzip_disable &quot;msie6&quot;; ##<strong>Syntaxe:</strong> gzip_disable <strong>regex</strong> …; </td><td class="col1"> Désactive via une regexp gzipping. Le module utilisera encore une fois le header<sup><a href="#fn__13" id="fnt__13" class="fn_top">13)</a></sup> pour récupérer l&#039;<strong>User-Agent</strong> de votre visiteur. Vous noterez qu&#039;il existe une exception à la règle concernant les regexp → <a href="https://fr.wikipedia.org/wiki/Internet_Explorer_6" class="urlextern" title="https://fr.wikipedia.org/wiki/Internet_Explorer_6" rel="nofollow">msie6</a> <img src="/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />, si cette exception ne serait pas d&#039;actualité, nous aurions utilisé cette regexp: <pre class="code">MSIE [4-6]\.</pre>
</td>
	</tr>
	<tr class="row24">
		<td class="col0">limit_zone gulag $binary_remote_addr 1m ##<strong>Syntaxe:</strong> ? </td><td class="col1"> crée une zone de stockage nommée « gulag » utilisant  moins de 1 mo de RAM, contenant l&#039;état des connexions classé par adresse ip </td>
	</tr>
	<tr class="row25">
		<td class="col0"> limit_conn gulag 50 ##<strong>Syntaxe:</strong> ? </td><td class="col1"> limite le nombre de demande de connexions parallèles à 50 par client </td>
	</tr>
	<tr class="row26">
		<td class="col0"> include /etc/nginx/mime.types; ##La liste des types MIME résolu par les extensions de fichiers. </td><td class="col1"> Cette liste indique la nature des fichiers renvoyées par le serveur (ex: ceci est une page web <a href="http://votrendd.tld/hello.html" class="urlextern" title="http://votrendd.tld/hello.html" rel="nofollow">http://votrendd.tld/hello.html</a> ou ceci est une vidéo ogg ..  <a href="http://votrendd.tld/mavideo.ogg" class="urlextern" title="http://votrendd.tld/mavideo.ogg" rel="nofollow">http://votrendd.tld/mavideo.ogg</a> pour que Nginx &quot;comprenne&quot; que c&#039;est un format <strong>.html</strong> ou un format <strong>.ogg</strong> il lui faut un fichier mime.types). </td>
	</tr>
</table></div>

</div>
<div class='secedit editbutton_section editbutton_12'><form class="button btn_secedit form-inline" method="post" action="/nginx"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1598992506" /><input type="hidden" name="summary" value="[Configuration] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration1" /><input type="hidden" name="codeblockOffset" value="44" /><input type="hidden" name="range" value="16923-24941" /><button type="submit" title="Configuration" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit14" id="parametrage_des_fonctions_reverse_proxy_et_cache">Paramétrage des fonctions reverse proxy et cache</h3>
<div class="level3">

<p>
Les paramètres du reverse proxy et du cache seront consignés dans le fichier /etc/nginx/conf.d/proxy.conf pour plus de clarté.
</p>

<p>
Si vous voulez plus d&#039;informations sur la configuration du proxy, allez voir la section de la documentation officielle <a href="http://wiki.nginx.org/NginxHttpProxyModule" class="urlextern" title="http://wiki.nginx.org/NginxHttpProxyModule" rel="nofollow">ici</a>.
</p>

<p>
Contenu du fichier  
</p>
<pre class="code">proxy_redirect          off;
proxy_set_header        Host            $host;
proxy_set_header        X-Real-IP       $remote_addr;
proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_hide_header       X-Powered-By;
proxy_intercept_errors on;
proxy_buffering on;


proxy_cache_key &quot;$scheme://$host$request_uri&quot;;
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=cache:10m inactive=7d max_size=700m;</pre>
<div class="table-responsive"><table class="inline table table-striped table-condensed">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> options                  </th><th class="col1 leftalign"> explications          </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> proxy_redirect          off </td><td class="col1"> permet une réécriture de l&#039;adresse, inutile quand le serveur web ne se trouve pas sur la même machine physique </td>
	</tr>
	<tr class="row2">
		<td class="col0"> proxy_set_header </td><td class="col1 leftalign"> permet de modifier les entêtes  </td>
	</tr>
	<tr class="row3">
		<td class="col0"> proxy_hide_header </td><td class="col1"> permet de cacher certains entêtes </td>
	</tr>
	<tr class="row4">
		<td class="col0"> proxy_intercept_errors on </td><td class="col1"> permet de contrôler les retours de code d&#039;erreur du serveur web et de les modifier à la volé</td>
	</tr>
	<tr class="row5">
		<td class="col0"> proxy_buffering on </td><td class="col1"> Si l&#039;on désactive cette option le serveur arrière doit attendre que les données soient envoyées au client pour fermer sa connexion avec nginx </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> proxy_cache_min_uses       3   </td><td class="col1"> La ressource devra être demandée 3 fois avant d&#039;être mise en cache </td>
	</tr>
	<tr class="row7">
		<td class="col0"> proxy_cache_key </td><td class="col1"> clé permettant de stocker des fichiers de plusieurs sites différents dans le même cache. Les noms de fichiers seront le md5 de cette combinaison </td>
	</tr>
	<tr class="row8">
		<td class="col0"> proxy_cache_path </td><td class="col1"> indique le chemin vers le dossier de cache, organisation des dossiers  ( Si quelqu&#039;un a plus d&#039;information sur cette directive, sa participation est la bienvenue) <br/>
level 1:2 indique l&#039;organisation des dossiers,<br/>
keys_zone définit le nom de cette zone, inactive définit le temps de conservation maximum d&#039;un élément sans qu&#039;il soit demandé par un client. Si le temps imparti est épuisé l&#039;élément est supprimé, <br/>
max_size indique la taille maximale du cache</td>
	</tr>
</table></div>

</div>
<div class='secedit editbutton_section editbutton_14'><form class="button btn_secedit form-inline" method="post" action="/nginx"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1598992506" /><input type="hidden" name="summary" value="[Paramétrage des fonctions reverse proxy et cache] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="parametrage_des_fonctions_reverse_proxy_et_cache" /><input type="hidden" name="codeblockOffset" value="46" /><input type="hidden" name="range" value="24942-27153" /><button type="submit" title="Paramétrage des fonctions reverse proxy et cache" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit16" id="exemple_de_configuration_d_un_serveur_web_arriere">Exemple de configuration d&#039;un serveur web arrière</h3>
<div class="level3">

<p>
Nous allons créer le fichier trucbidule dans le répertoire /etc/nginx/sites-available/.
</p>

<p>
Les éléments de la configuration :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> les requêtes arrivant sur le port 80 et ayant pour nom de domaine de destination trucbidul.fr seront redirigées vers le serveur web ayant l&#039;adresse 192.168.0.100 </div>
</li>
<li class="level2"><div class="li"> seules les méthodes GET,HEAD et POST seront acceptées</div>
</li>
<li class="level2"><div class="li"> tous les fichiers seront mis en cache minimum 12 heures</div>
</li>
<li class="level2"><div class="li"> les fichiers statiques seront mis en cache 2 jours</div>
</li>
<li class="level2"><div class="li"> pas de mise en cache pour la section administration du site</div>
</li>
<li class="level2"><div class="li"> le champs expires de la requête http seront remplis</div>
</li>
<li class="level2"><div class="li"> les codes d&#039;erreurs seront interceptés et une page sera renvoyée</div>
</li>
</ul>

<p>
Contenu du fichier trucbidule:
</p>
<pre class="code">server {

    listen 80;
    server_name www.trucbidule.fr trucbidule.fr;

    # Ici on désactive les access_log pour ne pas faire doublon avec Apache
    access_log off;
    #access_log /var/log/nginx/default.access.log;

if ($request_method !~ ^(GET|HEAD|POST)$ ) {
return 444;
}


location / {
    proxy_pass http://192.168.0.100:80/;
    proxy_cache cache;
    proxy_cache_valid 12h;
    expires 12h;
    proxy_cache_use_stale error timeout invalid_header updating;
}


location ~*^.+(swf|jpg|jpeg|gif|png|ico|css|zip|tgz|gz|rar|bz2|doc|xls|exe|pdf|ppt|txt|tar|mid|midi|wav|bmp|rtf|js)$ {
    proxy_pass http://192.168.0.100:80;
    proxy_cache cache;
    proxy_cache_valid 2d;
    expires max;
}


location ^~ (^/admin|^/identification) {
    proxy_pass http://192.168.0.100:80;
}

error_page 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 500 501 502 503 504 505 506 507 /error.html;

location = /error.html {
    root /var/www/nginx-default;
}
}</pre>
<div class="table-responsive"><table class="inline table table-striped table-condensed">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> options                  </th><th class="col1 leftalign"> explications          </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> listen   ##<strong>Syntaxe:</strong> ?      </td><td class="col1"> adresse et port d&#039;écoute, ici il écoute sur toutes les adresses </td>
	</tr>
	<tr class="row2">
		<td class="col0"> server_name ##<strong>Syntaxe:</strong> ?</td><td class="col1"> nom de domaine du serveur arrière, possibilité d&#039;en spécifier plusieurs</td>
	</tr>
	<tr class="row3">
		<td class="col0"> error_page ##<strong>Syntaxe:</strong> ? </td><td class="col1"> redirection des erreurs suivantes vers le chemin indiqué </td>
	</tr>
	<tr class="row4">
		<td class="col0"> proxy_pass  ##<strong>Syntaxe:</strong> ?</td><td class="col1"> indique l&#039;adresse du serveur web arrière </td>
	</tr>
	<tr class="row5">
		<td class="col0"> proxy_cache_valid 12h ##<strong>Syntaxe:</strong> ? </td><td class="col1"> toutes les pages retournant avec un code 200 301 et 302 seront stockées en cache pendant 12 heures. Il est possible de spécifier les codes html pour lesquels les fichiers doivent être mis en cache</td>
	</tr>
	<tr class="row6">
		<td class="col0"> proxy_cache ##<strong>Syntaxe:</strong> ? </td><td class="col1"> indique la zone de stockage pour le cache </td>
	</tr>
	<tr class="row7">
		<td class="col0"> proxy_cache_use_stale ##<strong>Syntaxe:</strong> ? </td><td class="col1"> Si le serveur arrière renvoi ces erreurs error timeout invalid_header updating nginx servira les fichiers qu&#039;il possède en cache</td>
	</tr>
	<tr class="row8">
		<td class="col0"> expires max ##<strong>Syntaxe:</strong> ?</td><td class="col1"> donne une date d&#039;expiration maximale pour que le client puisse mettre les fichiers statiques en cache</td>
	</tr>
</table></div>

<p>
Quelque explications sur notre configuration. Comme vous l&#039;avez vu toutes les requêtes ne sont pas traitées de la même manière. Différentes règles ont été créées pour séparer les contenus.
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Si l&#039;adresse commence par un / (c&#039;est à dire tout le temps) les éléments sont mis en cache pendant 12 h.</div>
</li>
<li class="level1"><div class="li"> Si l&#039;adresse se termine par une des extensions de fichiers listées, alors les éléments sont mis en cache pendant 2 jours.</div>
</li>
<li class="level1"><div class="li"> Si l&#039;adresse commence par /admin ou /administration il n&#039;y a pas de mise en cache.</div>
</li>
<li class="level1"><div class="li"> Si l&#039;adresse correspond à /error.html alors un fichier local est servit.</div>
</li>
</ul>

<p>
Comme vous pouvez vous rendre compte dans certains cas plusieurs règles sont remplies. Il y a donc une hiérarchie parmi ces règles. La documentation officielle traite de ce sujet <a href="http://wiki.nginx.org/NginxHttpCoreModule#location" class="urlextern" title="http://wiki.nginx.org/NginxHttpCoreModule#location" rel="nofollow">ici</a>.
</p>

<p>
Pour résumer, voici la hiérarchie :
</p>
<ol class=" fix-media-list-overlap">
<li class="level1"><div class="li"> =  Lorsque l&#039;adresse est exactement la même la condition est remplie et les autres règles ne sont pas vérifiées.</div>
</li>
<li class="level1"><div class="li"> ^~ Lorsque l&#039;adresse commence par l&#039;expression les autres règles ne sont pas vérifiées.</div>
</li>
<li class="level1"><div class="li"> ~  Les expressions régulières sont analysées dans leur ordre d&#039;apparition dans le fichier.</div>
</li>
<li class="level1"><div class="li"> Finalement la règle location / correspondant à tous les cas est appliquée dans le cas où l&#039;adresse ne remplie pas les conditions des règles précédentes.</div>
</li>
</ol>

<p>
Vous avez peut-être remarqué dans le fichier de configuration une petite étoile après la vague ~* . Cela indique que la règle n&#039;est pas sensible a la casse.
</p>

<p>
Il suffit, pour activer ce serveur, de créer un lien symbolique pointant vers le fichier précédent dans le répertoire :
</p>
<pre class="code">sudo ln -s /etc/nginx/sites-available/trucbidule /etc/nginx/sites-enabled/trucbidule</pre>

</div>
<div class='secedit editbutton_section editbutton_16'><form class="button btn_secedit form-inline" method="post" action="/nginx"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1598992506" /><input type="hidden" name="summary" value="[Exemple de configuration d&#039;un serveur web arrière] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="exemple_de_configuration_d_un_serveur_web_arriere" /><input type="hidden" name="codeblockOffset" value="47" /><input type="hidden" name="range" value="27154-31745" /><button type="submit" title="Exemple de configuration d&#039;un serveur web arrière" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit18" id="load_balancing">Load balancing</h3>
<div class="level3">

<p>
Il est possible de faire du load balancing avec nginx d&#039;une manière assez simple. Il suffit de déclarer un groupe de serveurs et d&#039;envoyer les requêtes vers ce groupe d&#039;hôtes avec la directive <em>proxy_pass</em>. La documentation officielle détaillant la procédure ainsi que toutes les options possibles est disponible <a href="http://wiki.nginx.org/NginxHttpUpstreamModule" class="urlextern" title="http://wiki.nginx.org/NginxHttpUpstreamModule" rel="nofollow">ici</a>.
</p>

<p>
Voici l&#039;exemple de la documentation officielle :
</p>
<pre class="code">upstream backend  {
  server backend1.example.com weight=5;
  server backend2.example.com:8080;
  server unix:/tmp/backend3;
}
 
server {
  location / {
    proxy_pass  http://backend;
  }
}</pre>
<hr />

</div>
<div class='secedit editbutton_section editbutton_18'><form class="button btn_secedit form-inline" method="post" action="/nginx"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1598992506" /><input type="hidden" name="summary" value="[Load balancing] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="load_balancing" /><input type="hidden" name="codeblockOffset" value="48" /><input type="hidden" name="range" value="31746-32412" /><button type="submit" title="Load balancing" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit19 page-header" id="autres_configurations_de_nginx">Autres configurations de Nginx</h2>
<div class="level2">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <a href="http://www.howtoforge.com/installing-php-5.3-nginx-and-php-fpm-on-ubuntu-debian" class="urlextern" title="http://www.howtoforge.com/installing-php-5.3-nginx-and-php-fpm-on-ubuntu-debian" rel="nofollow">Installation de Nginx et PHP-FPM sur Debian/Ubuntu</a> via HowToForge</div>
</li>
<li class="level1"><div class="li"> <a href="http://www.howtoforge.net/installing-nginx-with-php-5.3-and-php-fpm-on-ubuntu-lucid-lynx-10.04" class="urlextern" title="http://www.howtoforge.net/installing-nginx-with-php-5.3-and-php-fpm-on-ubuntu-lucid-lynx-10.04" rel="nofollow">Installation de Nginx et PHP-FPM sur Ubuntu 10.04</a></div>
</li>
<li class="level1"><div class="li"> Nginx et PHP tournant en FastCGI : <img src="/lib/images/smileys/fixme.gif" class="icon" alt="FIXME" /> à compléter</div>
</li>
</ul>
<hr />

</div>
<div class='secedit editbutton_section editbutton_19'><form class="button btn_secedit form-inline" method="post" action="/nginx"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1598992506" /><input type="hidden" name="summary" value="[Autres configurations de Nginx] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="autres_configurations_de_nginx" /><input type="hidden" name="codeblockOffset" value="49" /><input type="hidden" name="range" value="32413-32829" /><button type="submit" title="Autres configurations de Nginx" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit20 page-header" id="voir_aussi">Voir aussi</h2>
<div class="level2">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <a href="https://nginx.org/" class="urlextern" title="https://nginx.org/" rel="nofollow">Site officiel de Nginx</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://en.wikipedia.org/wiki/fr:Nginx" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/fr:Nginx">Nginx sur Wikipédia</a></div>
</li>
</ul>
<hr />

<p>
<em>Contributeur principaux : <a href="/utilisateurs/butterflyoffire" class="wikilink1" title="utilisateurs:butterflyoffire">ButterflyOfFire</a>, <a href="/utilisateurs/lildadou" class="wikilink1" title="utilisateurs:lildadou">lildadou</a>, <a href="/utilisateurs/accueil#ubuntu-fr" class="wikilink2" title="utilisateurs:accueil" rel="nofollow">#ubuntu-fr</a>, <a href="/utilisateurs/miam_miam" class="wikilink1" title="utilisateurs:miam_miam">Miam Miam</a> (Tutoriel Reverse Proxy Nginx), <a href="/utilisateurs/beaver" class="wikilink1" title="utilisateurs:beaver">BeAvEr</a> (Refonte de l&#039;intégralité du tutoriel).</em>
</p>

</div>
<div class='secedit editbutton_section editbutton_20'><form class="button btn_secedit form-inline" method="post" action="/nginx"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1598992506" /><input type="hidden" name="summary" value="[Voir aussi] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="voir_aussi" /><input type="hidden" name="codeblockOffset" value="49" /><input type="hidden" name="range" value="32830-" /><button type="submit" title="Voir aussi" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div><hr/><div class="footnotes">
<div class="fn"><sup><a href="#fnt__1" id="fn__1" class="fn_bot">1)</a></sup> 
<div class="content">comprendre qu&#039;il faut absolument que sendfile soit actif.. .</div></div>
<div class="fn"><sup><a href="#fnt__2" id="fn__2" class="fn_bot">2)</a></sup> 
<div class="content">utilisé uniquement si une connexion est passée en état (persistant)((keep <abbr title="Transmission Control Protocol">TCP</abbr> alive → (KeepAlive) → (maintenir <abbr title="Transmission Control Protocol">TCP</abbr> en vie) → c&#039;est à dire conserver la connexion <abbr title="Transmission Control Protocol">TCP</abbr> </div></div>
<div class="fn"><sup><a href="#fnt__3" id="fn__3" class="fn_bot">3)</a></sup> 
<div class="content">64*2 == 128</div></div>
<div class="fn"><sup><a href="#fnt__4" id="fn__4" class="fn_bot">4)</a></sup> 
<div class="content"><a href="https://www.ietf.org/rfc/rfc2616.txt" class="urlextern" title="https://www.ietf.org/rfc/rfc2616.txt" rel="nofollow">https://www.ietf.org/rfc/rfc2616.txt</a></div></div>
<div class="fn"><sup><a href="#fnt__5" id="fn__5" class="fn_bot">5)</a></sup> 
<div class="content"> GET <strong>/</strong> <strong>HTTP/1.1</strong> User-Agent: curl/7.35.0 <strong>Host: ubuntu-fr.org</strong> Accept: */*</div></div>
<div class="fn"><sup><a href="#fnt__6" id="fn__6" class="fn_bot">6)</a></sup> 
<div class="content">GET / HTTP/1.1 <strong>User-Agent:</strong> curl/7.35.0 Host: ubuntu-fr.org Accept: */*</div></div>
<div class="fn"><sup><a href="#fnt__7" id="fn__7" class="fn_bot">7)</a></sup> 
, <sup><a href="#fnt__11" id="fn__11" class="fn_bot">11)</a></sup> 
<div class="content"><a href="http://stackoverflow.com/questions/7848796/what-does-varyaccept-encoding-mean" class="urlextern" title="http://stackoverflow.com/questions/7848796/what-does-varyaccept-encoding-mean" rel="nofollow">http://stackoverflow.com/questions/7848796/what-does-varyaccept-encoding-mean</a></div></div>
<div class="fn"><sup><a href="#fnt__8" id="fn__8" class="fn_bot">8)</a></sup> 
<div class="content">HTTP/1.1 200 OK Server: nginxContent-Type: text/html; charset=utf-8 Expires: Sun, 19 Nov 1978 05:00:00 GMT Last-Modified: Wed, 12 Aug 2015 21:43:15 +0000 ETag: &quot;1439415795&quot; Content-Language: en X-Generator: Drupal 7 (<a href="http://drupal.org" class="urlextern" title="http://drupal.org" rel="nofollow">http://drupal.org</a>) Link: &lt;/intro&gt;; rel=&quot;canonical&quot;,&lt;/node/17&gt;; rel=&quot;shortlink&quot; <strong>Content-Encoding: gzip</strong></div></div>
<div class="fn"><sup><a href="#fnt__9" id="fn__9" class="fn_bot">9)</a></sup> 
<div class="content">&gt; GET / HTTP/1.1 User-Agent: curl/7.35.0 Host: ubuntu-fr.org Accept: */* HTTP/1.1 200 OK Server nginx is not blacklisted Server: nginx Content-Type: text/html; charset=utf-8 Expires: Sun, 19 Nov 1978 05:00:00 GMT Last-Modified: Wed, 12 Aug 2015 16:41:34 +0000 ETag: &quot;1439397694&quot; Content-Language: en X-Generator: Drupal 7 (<a href="http://drupal.org" class="urlextern" title="http://drupal.org" rel="nofollow">http://drupal.org</a>) Link: &lt;/intro&gt;; rel=&quot;canonical&quot;,&lt;/node/17&gt;; rel=&quot;shortlink&quot; Content-Length: 15956 Accept-Ranges: bytes Date: Wed, 12 Aug 2015 16:41:34 GMT Age: 0 Connection: keep-alive <strong>Cache-Control</strong>: <strong>no-cache</strong>, must-revalidate, max-age=0</div></div>
<div class="fn"><sup><a href="#fnt__10" id="fn__10" class="fn_bot">10)</a></sup> 
<div class="content">aussi appelé <em>virtual host</em> ou <em>vhost</em></div></div>
<div class="fn"><sup><a href="#fnt__12" id="fn__12" class="fn_bot">12)</a></sup> 
<div class="content">
HTTP/1.1 200 OK
Server: nginx
Content-Type: text/html; charset=utf-8
Expires: Sun, 19 Nov 1978 05:00:00 GMT
Last-Modified: Wed, 12 Aug 2015 21:43:15 +0000
ETag: &quot;1439415795&quot;
Content-Language: en
X-Generator: Drupal 7 (<a href="http://drupal.org" class="urlextern" title="http://drupal.org" rel="nofollow">http://drupal.org</a>)
Link: &lt;/intro&gt;; rel=&quot;canonical&quot;,&lt;/node/17&gt;; rel=&quot;shortlink&quot;
<strong>Content-Encoding: gzip</strong>
Accept-Ranges: bytes
Date: Wed, 12 Aug 2015 21:43:15 GMT
Age: 0
Connection: keep-alive
Cache-Control: no-cache, must-revalidate, max-age=0
Pragma: no-cache</div></div>
<div class="fn"><sup><a href="#fnt__13" id="fn__13" class="fn_bot">13)</a></sup> 
<div class="content"> GET / HTTP/1.1
<strong>User-Agent:</strong> curl/7.35.0
Host: ubuntu-fr.org
Accept: */*</div></div>
</div>

</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="nginx.txt">nginx.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 01/09/2020, 22:35">Le 01/09/2020, 22:35</span></li><li class="text-muted">par spnux</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=nginx&amp;1635558839" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
