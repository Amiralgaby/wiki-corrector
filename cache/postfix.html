<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>postfix [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="xenial,serveur,courriel,brouillon"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/postfix?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns="/>
<link rel="edit" title="Modifier cette page" href="/postfix?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/postfix"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/postfix"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/postfix"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"postfix","namespace":"","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="postfix">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/postfix?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/postfix?do=media&amp;ns="  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/postfix?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/postfix?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/postfix?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/postfix?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/postfix?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">postfix</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/postfix?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/postfix?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/postfix?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#pre-requis","title":"Pr\u00e9-requis","level":1},{"link":"#installation","title":"Installation","level":1},{"link":"#configuration","title":"Configuration","level":1},{"link":"#authentification","title":"Authentification","level":1},{"link":"#les_tests","title":"Les tests","level":1},{"link":"#envoi_d_un_email","title":"Envoi d'un email","level":2},{"link":"#pour_aller_plus_loin","title":"Pour aller plus loin","level":1},{"link":"#bridage_smtp","title":"Bridage SMTP","level":1},{"link":"#etat_de_la_queue_des_messages","title":"\u00c9tat de la queue des messages","level":1},{"link":"#voir_aussi","title":"Voir aussi","level":1}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level1"><a href="#pre-requis">Pré-requis</a></li>
<li class="level1"><a href="#installation">Installation</a></li>
<li class="level1"><a href="#configuration">Configuration</a></li>
<li class="level1"><a href="#authentification">Authentification</a></li>
<li class="level1"><a href="#les_tests">Les tests</a>
<ul class="nav toc">
<li class="level2"><a href="#envoi_d_un_email">Envoi d&#039;un email</a></li>
</ul>
</li>
<li class="level1"><a href="#pour_aller_plus_loin">Pour aller plus loin</a></li>
<li class="level1"><a href="#bridage_smtp">Bridage SMTP</a></li>
<li class="level1"><a href="#etat_de_la_queue_des_messages">État de la queue des messages</a></li>
<li class="level1"><a href="#voir_aussi">Voir aussi</a></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content"><div class="notetag">Cette page est en cours de rédaction.<br />
<a href="/wiki/participer_wiki">Apportez votre aide…</a>
</div>
<div class="tags"><span>
	<a href="/xenial" class="wikilink1" title="xenial" rel="tag">Xenial</a>,
	<a href="/serveur" class="wikilink1" title="serveur" rel="tag">serveur</a>,
	<a href="/courriel" class="wikilink1" title="courriel" rel="tag">courriel</a>,
	<a href="/brouillon" class="wikilink1" title="brouillon" rel="tag">BROUILLON</a>
</span></div>
<hr />

<p>
Voir <a href="/comment_configurer_sa_distribution_de_courriels_systemes_mta" class="wikilink1" title="comment_configurer_sa_distribution_de_courriels_systemes_mta">Comment configurer sa distribution de courriels systèmes MTA ?</a> qui se propose de reprendre cette partie pour postfix…
</p>

<h1 class="sectionedit1 page-header" id="postfixagent_de_transfert_de_courriel_smtp">Postfix : agent de transfert de courriel (SMTP)</h1>
<div class="level1">

<p>
<strong>Postfix</strong> est l&#039;agent de transfert de courriel (MTA) par défaut d&#039;Ubuntu.
</p>

<p>
Il est dans les dépôts <em>main</em>, donc il reçoit les mises à jour de sécurité.
</p>

<p>
Cette page décrit son installation et sa configuration pour en faire un serveur SMTP utilisant une connexion sécurisée.
</p>
<div class="notewarning">La commande <code>sudo</code> ne prend pas en charge l&#039;intégralité des variables d&#039;environnement et est donc fortement déconseillée sur les machines. &quot;root&quot; en revanche vous accorde tous les droits systèmes mais une faute de frappe peut engendrer la perte du système. Si vous êtes novice, je vous conseille d&#039;utiliser root avec grande prudence, le forum est là en cas de problème.
</div>
</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/postfix"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1620035015" /><input type="hidden" name="summary" value="[Postfix : agent de transfert de courriel (SMTP)] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="postfixagent_de_transfert_de_courriel_smtp" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="244-995" /><button type="submit" title="Postfix : agent de transfert de courriel (SMTP)" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit2 page-header" id="pre-requis">Pré-requis</h2>
<div class="level2">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Disposer des <a href="/sudo" class="wikilink1" title="sudo">droits d&#039;administration</a>.</div>
</li>
<li class="level1"><div class="li"> Disposer d&#039;une connexion à Internet configurée et activée.</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/postfix"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1620035015" /><input type="hidden" name="summary" value="[Pré-requis] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="pre-requis" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="996-1140" /><button type="submit" title="Pré-requis" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit3 page-header" id="installation">Installation</h2>
<div class="level2">

<p>
Nous allons configurer Postfix pour être utilisé avec SASL, qui va assurer l&#039;authentification SMTP (pour éviter que des spammeurs utilisent votre serveur pour envoyer du spam), ainsi qu&#039;un chiffrement via SSL/<abbr title="Transport Layer Security">TLS</abbr>.
</p>

<p>
Pour installer Postfix avec SMTP-AUTH et <abbr title="Transport Layer Security">TLS</abbr>  :
</p>

<p>
<a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">Installez les paquets</a> <strong><a href="apt://libdb5.1,postfix,procmail,sasl2-bin" class="interwiki iw_apt" title="apt://libdb5.1,postfix,procmail,sasl2-bin">libdb5.1 postfix procmail sasl2-bin</a></strong>.
</p>

</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit form-inline" method="post" action="/postfix"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1620035015" /><input type="hidden" name="summary" value="[Installation] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="1141-1584" /><button type="submit" title="Installation" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit4 page-header" id="configuration">Configuration</h2>
<div class="level2">

<p>
postfix doit être membre du groupe sasl. Pour ajouter l&#039;utilisateur postfix au groupe sasl, tapez dans un <a href="/terminal" class="wikilink1" title="terminal">terminal</a> :
</p>
<pre class="code">sudo adduser postfix sasl</pre>

<p>
Pour configurer postfix, tapez :
</p>
<pre class="code">sudo dpkg-reconfigure postfix</pre>

<p>
Lorsqu&#039;on vous les demande, entrez les détails suivants (remplacez server1.exemple.com par votre nom de domaine) :
</p>
<pre class="code"> Internet Site
 NONE
 server1.exemple.com
 server1.exemple.com, localhost.exemple.com, localhost
 No
 127.0.0.0/8
 0
 +</pre>

<p>
Ensuite entrez les commandes suivantes :
</p>
<pre class="code">sudo postconf -e &#039;smtpd_sasl_local_domain =&#039;
sudo  postconf -e &#039;smtpd_sasl_auth_enable = yes&#039;
sudo  postconf -e &#039;smtpd_sasl_security_options = noanonymous&#039;
sudo  postconf -e &#039;broken_sasl_auth_clients = yes&#039;
sudo   postconf -e &#039;smtpd_recipient_restrictions = permit_sasl_authenticated,permit_mynetworks,reject_unauth_destination&#039;
sudo  postconf -e &#039;inet_interfaces = all&#039;</pre>
<pre class="code">sudo  touch /etc/postfix/sasl/smtpd.conf
sudo su
echo &#039;pwcheck_method: saslauthd&#039; &gt;&gt; /etc/postfix/sasl/smtpd.conf
echo &#039;mech_list: plain login&#039; &gt;&gt; /etc/postfix/sasl/smtpd.conf 
exit
sudo mkdir /etc/postfix/ssl
cd /etc/postfix/ssl/
sudo openssl genrsa -des3 -rand /dev/urandom -out smtpd.key 2048
sudo openssl req -new -key smtpd.key -out smtpd.csr
sudo  openssl x509 -req -days 3650 -in smtpd.csr -signkey smtpd.key -out smtpd.crt
sudo openssl rsa -in smtpd.key -out smtpd.key.unencrypted
sudo mv -f smtpd.key.unencrypted smtpd.key
sudo chmod 600 smtpd.key
sudo openssl req -new -x509 -extensions v3_ca -keyout cakey.pem -out cacert.pem -days 3650 

sudo postconf -e &#039;smtpd_tls_auth_only = no&#039;
sudo postconf -e &#039;smtp_use_tls = yes&#039;
sudo postconf -e &#039;smtpd_use_tls = yes&#039;
sudo postconf -e &#039;smtp_tls_note_starttls_offer = yes&#039;
sudo postconf -e &#039;smtpd_tls_key_file = /etc/postfix/ssl/smtpd.key&#039;
sudo postconf -e &#039;smtpd_tls_cert_file = /etc/postfix/ssl/smtpd.crt&#039;
sudo postconf -e &#039;smtpd_tls_CAfile = /etc/postfix/ssl/cacert.pem&#039;
sudo postconf -e &#039;smtpd_tls_loglevel = 1&#039;
sudo postconf -e &#039;smtpd_tls_received_header = yes&#039;
sudo postconf -e &#039;smtpd_tls_session_cache_timeout = 3600s&#039;
sudo postconf -e &#039;tls_random_source = dev:/dev/urandom&#039;
sudo postconf -e &#039;myhostname = server1.example.com&#039; </pre>

<p>
<a href="/tutoriel/comment_modifier_un_fichier" class="wikilink1" title="tutoriel:comment_modifier_un_fichier">Éditez le fichier</a> <em class="u">/etc/postfix/main.cf</em> qui doit ressembler à ceci :
</p>
<pre class="file"># See /usr/share/postfix/main.cf.dist for a commented, more complete version

smtpd_banner = $myhostname ESMTP $mail_name (Ubuntu)
biff = no

# appending .domain is the MUA&#039;s job.
append_dot_mydomain = no

# Uncomment the next line to generate &quot;delayed mail&quot; warnings
#delay_warning_time = 4h

myhostname = server1.example.com
alias_maps = hash:/etc/aliases
alias_database = hash:/etc/aliases
myorigin = /etc/mailname
mydestination = server1.example.com, localhost.example.com, localhost
relayhost =
mynetworks = 127.0.0.0/8
mailbox_size_limit = 0
recipient_delimiter = +
inet_interfaces = all
smtpd_sasl_local_domain =
smtpd_sasl_auth_enable = yes
smtpd_sasl_security_options = noanonymous
broken_sasl_auth_clients = yes
smtpd_recipient_restrictions = permit_sasl_authenticated,permit_mynetworks,reject_unauth_destination
smtpd_tls_auth_only = no
smtp_use_tls = yes
smtpd_use_tls = yes
smtp_tls_note_starttls_offer = yes
smtpd_tls_key_file = /etc/postfix/ssl/smtpd.key
smtpd_tls_cert_file = /etc/postfix/ssl/smtpd.crt
smtpd_tls_CAfile = /etc/postfix/ssl/cacert.pem
smtpd_tls_loglevel = 1
smtpd_tls_received_header = yes
smtpd_tls_session_cache_timeout = 3600s
tls_random_source = dev:/dev/urandom</pre>

<p>
N&#039;oubliez pas de donner un mydestination correct. Les serveurs destinataires vont en effet tester ce paramètre. Ils vérifieront dans les serveurs <abbr title="Domain Name System">DNS</abbr> si cette adresse existe bien !
</p>

<p>
D&#039;autre part, vérifiez aussi que votre ligne internet accepte les connexions smtp sortantes !
</p>

<p>
Puis redémarrez le serveur Postfix :
</p>
<pre class="code">sudo /etc/init.d/postfix restart</pre>

<p>
ou 
</p>
<pre class="code">sudo service postfix restart</pre>

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit form-inline" method="post" action="/postfix"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1620035015" /><input type="hidden" name="summary" value="[Configuration] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="1585-5578" /><button type="submit" title="Configuration" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit5 page-header" id="authentification">Authentification</h2>
<div class="level2">

<p>
L&#039;authentification utilise <strong>saslauthd</strong>.
</p>

<p>
NB: Pour installer <strong>saslauthd</strong> utiliser la commande suivante :        
</p>
<pre class="code">sudo apt-get install libsasl2-modules libsasl2-modules-sql libgsasl7 libauthen-sasl-cyrus-perl sasl2-bin libpam-mysql</pre>

<p>
Il est possible de changer quelques détails pour le faire fonctionner proprement. Postfix exécutant &quot;chroot&quot; dans <em class="u">/var/spool/postfix</em> nous devons faire :
</p>
<pre class="code">mkdir -p /var/spool/postfix/var/run/saslauthd
rm -fr /var/run/saslauthd
ln -s /var/spool/postfix/var/run/saslauthd /var/run/saslauthd
chown -R root:sasl /var/spool/postfix/var/
chmod 710 /var/spool/postfix/var/run/saslauthd
adduser postfix sasl</pre>

<p>
(problème de syntaxe sur l&#039;instruction précédente)
Maintenant <a href="/tutoriel/comment_modifier_un_fichier" class="wikilink1" title="tutoriel:comment_modifier_un_fichier">éditez le fichier</a>  <em class="u">/etc/default/saslauthd</em> pour y activer saslauthd.
</p>

<p>
Pour ce faire décommentez la ligne 
</p>
<pre class="code">START=yes</pre>

<p>
 et modifiez la derniere ligne 
</p>
<pre class="code">OPTIONS=&quot;-c -m /var/run/saslauthd&quot;</pre>

<p>
 comme cela: 
</p>
<pre class="code">OPTIONS=&quot;-m /var/spool/postfix/var/run/saslauthd&quot;</pre>

<p>
Ce qui donne :
</p>
<pre class="file"># This needs to be uncommented before saslauthd will be run automatically
START=yes

[...]

# You must specify the authentication mechanisms you wish to use.
# This defaults to &quot;pam&quot; for PAM support, but may also include
# &quot;shadow&quot; or &quot;sasldb&quot;, like this:
# MECHANISMS=&quot;pam shadow&quot;

MECHANISMS=&quot;pam&quot;

[...]

# Example for postfix users: &quot;-c -m /var/spool/postfix/var/run/saslauthd&quot;
OPTIONS=&quot;-m /var/spool/postfix/var/run/saslauthd&quot;</pre>
<div class="notetip">Si vous préférez, vous pouvez utiliser <strong>shadow</strong> au lieu de <strong>pam</strong>.
Ceci utilisera <strong>MD5</strong> au lieu de <strong>password</strong> et le rendra parfaitement sécurisé. Le nom d&#039;utilisateur et le mot de passe requis pour l&#039;authentification sera le même que pour les utilisateurs de votre système. Dans ce cas, vous pourrez ajouter votre utilisateur avec la commande adduser
</div>
</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit form-inline" method="post" action="/postfix"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1620035015" /><input type="hidden" name="summary" value="[Authentification] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="authentification" /><input type="hidden" name="codeblockOffset" value="1" /><input type="hidden" name="range" value="5579-7519" /><button type="submit" title="Authentification" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit6 page-header" id="les_tests">Les tests</h2>
<div class="level2">

<p>
Démarrez <em>saslauthd</em> :<br/>

</p>
<pre class="code">sudo /etc/init.d/saslauthd start</pre>

<p>
ou
</p>
<pre class="code">sudo service saslauthd start</pre>

<p>
Afin de vérifier que SMTP-AUTH et <abbr title="Transport Layer Security">TLS</abbr> fonctionnent correctement, tapez :<br/>

</p>
<pre class="code">telnet localhost 25</pre>

<p>
Ensuite après avoir établi la connexion avec postfix tapez :
</p>
<pre class="code">EHLO somename.tld</pre>

<p>
Si vous voyez ces lignes
</p>
<pre class="code">250-STARTTLS
250-AUTH</pre>

<p>
Ça fonctionne !
</p>

<p>
Pour retourner à l&#039;invite de commande, tapez :
</p>
<pre class="code">quit</pre>

<p>
Vous pouvez également tester l&#039;auhtentification sasl avec la commande testsalsauthd
</p>
<pre class="code">testsaslauthd -u utilisateur -p password</pre>

<p>
En cas de bon fonctionnement, vous obtiendrez 
</p>
<pre class="code">0: OK &quot;Success.&quot;</pre>

<p>
Sinon :
 0: NO &quot;authentication failed&quot;
</p>
<div class="noteclassic">Sur Ubuntu 18.04, l&#039;erreur <em>connect() : Permission denied</em> a ete resolu en tapant la commande:
<em>sudo dpkg-statoverride –force –update –add root sasl 755 /var/spool/postfix/var/run/saslauthd</em>
Puis un restart du service
</div>
</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit form-inline" method="post" action="/postfix"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1620035015" /><input type="hidden" name="summary" value="[Les tests] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="les_tests" /><input type="hidden" name="codeblockOffset" value="6" /><input type="hidden" name="range" value="7520-8426" /><button type="submit" title="Les tests" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit7" id="envoi_d_un_email">Envoi d&#039;un email</h3>
<div class="level3">

<p>
En ligne de commande sur le serveur:<br/>

Il faut évidemment remplacer <em>listes.mon_domaine.fr</em> par votre <em>nom de domaine</em>, <em>mon_email_expediteur@mon_fai.fr</em> et <em>email_destinataire@fai.fr</em>.<br/>

Pour plus de clarté, j&#039;ai laissé les retours que j&#039;ai fait précéder de <em>&gt;</em>
</p>
<pre class="code">telnet localhost 25
&gt; Trying ::1...
&gt; Connected to localhost.
&gt; Escape character is &#039;^]&#039;.
&gt; 220 listes.mon_domaine.fr ESMTP Postfix (Debian/GNU)
EHLO
&gt; 501 Syntax: EHLO hostname
MAIL FROM: mon_email_expediteur@mon_fai.fr
&gt; 250 2.1.0 Ok
RCPT TO: email_destinataire@fai.fr
&gt; 250 2.1.5 Ok
DATA
&gt; 354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
test envoi email
.
&gt; 250 2.0.0 Ok: queued as 941E5440B91
quit
&gt; 221 2.0.0 Bye
&gt; Connection closed by foreign host.</pre>

<p>
Il ne reste plus qu&#039;à relever votre boîte de messagerie <em>email_destinataire@fai.fr</em> afin de vérifier si le mail a été renvoyé.
</p>

</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit form-inline" method="post" action="/postfix"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1620035015" /><input type="hidden" name="summary" value="[Envoi d&#039;un email] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="envoi_d_un_email" /><input type="hidden" name="codeblockOffset" value="6" /><input type="hidden" name="range" value="8427-9325" /><button type="submit" title="Envoi d&#039;un email" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit8 page-header" id="pour_aller_plus_loin">Pour aller plus loin</h2>
<div class="level2">

<p>
Si vous avez envie d&#039;installer un serveur IMAP, la configuration avec <strong>procmail</strong> est un peu ardue. Vous pouvez <a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer</a> et utiliser <strong><a href="apt://maildrop" class="interwiki iw_apt" title="apt://maildrop">maildrop</a></strong> à la place.
</p>

<p>
Dans <code>main.cf</code>, il faudra alors modifier la ligne
</p>
<pre class="code">mailbox_command = procmail -a &quot;$EXTENSION&quot;</pre>

<p>
en
</p>
<pre class="code">mailbox_command = maildrop</pre>

<p>
N&#039;oubliez pas de créer un dossier Maildir pour chaque utilisateur :
</p>
<pre class="code">maildirmake.courier = ~/Maildir</pre>

<p>
Et d&#039;activer l&#039;option dans <em class="u">/etc/maildroprc</em>
</p>

</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit form-inline" method="post" action="/postfix"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1620035015" /><input type="hidden" name="summary" value="[Pour aller plus loin] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="pour_aller_plus_loin" /><input type="hidden" name="codeblockOffset" value="7" /><input type="hidden" name="range" value="9326-9861" /><button type="submit" title="Pour aller plus loin" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit9 page-header" id="bridage_smtp">Bridage SMTP</h2>
<div class="level2">

<p>
Pour lutter contre le SPAM engendré par les machines zombies (machines infectées par des virus servant de relais aux spammeurs), la plupart des <abbr title="Fournisseur d&#039;Accès à Internet">FAI</abbr> ont décidé de bloquer le port 25 en sortie (dans le sens &quot;Abonné → Internet&quot;), utilisé par défaut par le protocole SMTP. Dans ce cas, le port 25 n&#039;est ouvert que pour le serveur SMTP de votre <abbr title="Fournisseur d&#039;Accès à Internet">FAI</abbr> ( du type smtp.monprovider.com).
Ceci empêche la mise en place d&#039;un serveur SMTP chez soi (en tous cas pour l&#039;envoi vers Internet sans passer par le relais SMTP du provider).
Ceci empêche également l&#039;envoi depuis votre ligne <abbr title="Asymetric Digital Subscriber Line">ADSL</abbr> vers votre serveur hébergé sur Internet (de type Dedibox, OVH, etc.)
</p>

<p>
Si vous êtes abonnés Free avec une Freebox, vous pouvez débloquer l&#039;envoi par le port 25 dans l&#039;interface de gestion :
<em>Fonctionnalités optionnelles de la Freebox → Autres fonctions → Blocage SMTP sortant</em>.
</p>

<p>
Chez Neuf, ce filtrage est aussi actif. Pour changer les paramètres, allez dans l&#039;interface de gestion de votre Neuf Box, Puis dans <em>Réseau → Filtrage</em>, décochez la case <em>Autoriser l&#039;envoi de courriels uniquement par l&#039;intermédiaire des serveurs mail du groupe SFR</em>.
</p>

<p>
D&#039;une manière générale, regardez les options de votre Box pour désactiver ce filtrage. Chez certains fournisseurs d&#039;accès à internet, la fonctionnalité n&#039;est pas « débridable ». Une solution autre que de passer par le smtp de votre provider, est de ne pas passer par le port 25 pour contourner le filtrage mais ceci vous oblige donc a passer par un relais sous votre controle…
</p>

<p>
Pour modifier le port d&#039;Émission de votre serveur, dans /etc/postfix/main.cf, modifier RELAYHOST comme ceci:
<code>relayhost = [serveursmtp]:port</code>
( EX : <code>relayhost = [smtp.orange-business.com]:587</code>)
</p>

<p>
Il est également possible d&#039;utiliser le port 587 en lieu et place du port 25, pour cela, éditer le fichier /etc/postfix/master.cf et ajoutez 
</p>
<pre class="code">587     inet    n       -       y       -       -       smtpd
      -o smtpd_proxy_ehlo=no
      -o content_filter=dksign:[127.0.0.1]:12028</pre>

<p>
juste en dessous de votre ligne smtp
</p>
<pre class="code">smtp      inet  n       -       -       -       -       smtpd
      -o smtpd_proxy_ehlo=no
      -o content_filter=dksign:[127.0.0.1]:12028</pre>

</div>
<div class='secedit editbutton_section editbutton_9'><form class="button btn_secedit form-inline" method="post" action="/postfix"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1620035015" /><input type="hidden" name="summary" value="[Bridage SMTP] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="bridage_smtp" /><input type="hidden" name="codeblockOffset" value="7" /><input type="hidden" name="range" value="9862-12110" /><button type="submit" title="Bridage SMTP" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit10 page-header" id="etat_de_la_queue_des_messages">État de la queue des messages</h2>
<div class="level2">

<p>
La commande suivante permet de connaître le status des messages :
</p>
<pre class="code">/usr/bin/mailq</pre>

<p>
Pour plus de détails, on peut également consulter le fichier <strong>/var/log/mail.log</strong>
</p>

<p>
Pour supprimer un message de la queue :
</p>
<pre class="code">postsuper -d queue_id</pre>

<p>
où queue_id doit être remplacé par l&#039;identifiant correspondant au message.
</p>

<p>
Pour supprimer tous les messages de la queue :
</p>
<pre class="code">postsuper -d ALL</pre>

</div>
<div class='secedit editbutton_section editbutton_10'><form class="button btn_secedit form-inline" method="post" action="/postfix"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1620035015" /><input type="hidden" name="summary" value="[État de la queue des messages] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="etat_de_la_queue_des_messages" /><input type="hidden" name="codeblockOffset" value="7" /><input type="hidden" name="range" value="12111-12568" /><button type="submit" title="État de la queue des messages" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit11 page-header" id="voir_aussi">Voir aussi</h2>
<div class="level2">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <a href="http://www.postfix.org/" class="urlextern" title="http://www.postfix.org/" rel="nofollow">Site officiel</a>.</div>
</li>
<li class="level1"><div class="li"> <a href="http://postfix.traduc.org/" class="urlextern" title="http://postfix.traduc.org/" rel="nofollow">Documentation de Postfix en français (non maintenue!)</a>.</div>
</li>
<li class="level1"><div class="li"> Basé sur <a href="http://wiki.ubuntu.com/Postfix" class="urlextern" title="http://wiki.ubuntu.com/Postfix" rel="nofollow">http://wiki.ubuntu.com/Postfix</a>.</div>
</li>
<li class="level1"><div class="li"> <a href="/tutoriel/comment_soumettre_un_probleme_postfix_sur_le_forum" class="wikilink1" title="tutoriel:comment_soumettre_un_probleme_postfix_sur_le_forum">Comment soumettre un problème Postfix sur le forum</a>.</div>
</li>
<li class="level1"><div class="li"> <a href="/postfix_systeme_satellite" class="wikilink1" title="postfix_systeme_satellite"> Système satellite pour Postfix</a></div>
</li>
</ul>

<p>
—-
</p>

<p>
<em>Contributeurs principaux : <a href="/utilisateurs/phetu" class="wikilink1" title="utilisateurs:phetu">Phetu</a>, <a href="/utilisateurs/stephaneguedon" class="wikilink1" title="utilisateurs:stephaneguedon">Stéphane Guedon</a>.</em>
</p>

</div>
<div class='secedit editbutton_section editbutton_11'><form class="button btn_secedit form-inline" method="post" action="/postfix"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1620035015" /><input type="hidden" name="summary" value="[Voir aussi] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="voir_aussi" /><input type="hidden" name="codeblockOffset" value="10" /><input type="hidden" name="range" value="12569-" /><button type="submit" title="Voir aussi" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="postfix.txt">postfix.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 03/05/2021, 11:43">Le 03/05/2021, 11:43</span></li><li class="text-muted">par 89.251.63.194</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=postfix&amp;1635560980" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
