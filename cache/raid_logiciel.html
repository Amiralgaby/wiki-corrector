<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>raid_logiciel [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="bionic,focal,sauvegarde,securite,systeme,raid"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/raid_logiciel?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns="/>
<link rel="edit" title="Modifier cette page" href="/raid_logiciel?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/raid_logiciel"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/raid_logiciel"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/raid_logiciel"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"raid_logiciel","namespace":"","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="raid_logiciel">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/raid_logiciel?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/raid_logiciel?do=media&amp;ns="  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/raid_logiciel?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/raid_logiciel?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/raid_logiciel?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/raid_logiciel?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/raid_logiciel?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">raid_logiciel</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/raid_logiciel?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/raid_logiciel?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/raid_logiciel?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#introduction_-_qu_est-il_possible_de_faire","title":"Introduction - Qu'est-il possible de faire ?","level":1},{"link":"#ce_que_raid_n_est_pas","title":"Ce que RAID n'est pas","level":2},{"link":"#les_types_de_raid","title":"Les types de RAID","level":2},{"link":"#mise_en_\u0153uvre","title":"Mise en \u0153uvre","level":1},{"link":"#pre-requis","title":"Pr\u00e9-requis","level":1},{"link":"#installation","title":"Installation","level":1},{"link":"#installation_de_mdadm","title":"Installation de mdadm","level":2},{"link":"#configuration_des_disques_durs","title":"Configuration des disques durs","level":2},{"link":"#construction_du_volume_raid","title":"Construction du volume RAID","level":2},{"link":"#finalisation","title":"Finalisation","level":2},{"link":"#utilisationconfiguration","title":"Utilisation\/Configuration","level":1},{"link":"#que_faire_pour_agrandir_l_array_-_ajouter_un_disque","title":"Que faire pour agrandir l'array ? - Ajouter un disque","level":2},{"link":"#que_faire_pour_agrandir_l_array_-_remplacer_les_disques","title":"Que faire pour agrandir l'array ? - Remplacer les disques","level":2},{"link":"#que_faire_lorsqu_un_des_composants_de_l_array_vient_a_defaillir","title":"Que faire lorsqu'un des composants de l'Array vient \u00e0 d\u00e9faillir ?","level":2},{"link":"#que_faire_pour_diminuer_l_array_-_supprimer_un_disque","title":"Que faire pour diminuer l'array ? - Supprimer un disque?","level":2},{"link":"#comment_migrer_les_donnees_vers_une_nouvelle_machine","title":"Comment migrer les donn\u00e9es vers une nouvelle machine ?","level":2},{"link":"#problemes_solutions_courantes","title":"Probl\u00e8mes & solutions courantes","level":1},{"link":"#que_faire_si_je_n_arrive_plus_a_acceder_a_mon_raid","title":"Que faire si je n'arrive plus \u00e0 acc\u00e9der \u00e0 mon raid","level":2},{"link":"#probleme_de_taille_de_block_superblock","title":"Probl\u00e8me de taille de block & superblock","level":2},{"link":"#device_or_ressource_busy","title":"Device or ressource busy ...","level":2},{"link":"#md127","title":"md127","level":2},{"link":"#droits_d_ecriture","title":"Droits d'\u00e9criture","level":2},{"link":"#des_idees_pour_aller_plus_loin","title":"Des id\u00e9es pour aller plus loin","level":1},{"link":"#decoupage_du_volume_avec_lvm","title":"D\u00e9coupage du volume avec LVM","level":2},{"link":"#la_combinaison_des_niveaux_de_raid","title":"La combinaison des niveaux de RAID","level":2},{"link":"#un_disque_de_sparevotre_roue_de_secours_en_cas_de_defaillance","title":"Un disque de spare : votre roue de secours en cas de d\u00e9faillance","level":2},{"link":"#test","title":"Test","level":2},{"link":"#supervision_du_raid","title":"Supervision du RAID","level":2},{"link":"#creation_d_un_raid_sans_avoir_tous_les_disques","title":"Cr\u00e9ation d'un RAID sans avoir tous les disques","level":2},{"link":"#creation_d_un_raid1_sans_avoir_tous_les_disques_et_sans_copie","title":"Cr\u00e9ation d'un RAID1 sans avoir tous les disques et sans copie","level":2},{"link":"#un_peu_de_reference","title":"Un peu de r\u00e9f\u00e9rence","level":1}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level1"><a href="#introduction_-_qu_est-il_possible_de_faire">Introduction - Qu&#039;est-il possible de faire ?</a>
<ul class="nav toc">
<li class="level2"><a href="#ce_que_raid_n_est_pas">Ce que RAID n&#039;est pas</a></li>
<li class="level2"><a href="#les_types_de_raid">Les types de RAID</a></li>
</ul>
</li>
<li class="level1"><a href="#mise_en_œuvre">Mise en œuvre</a></li>
<li class="level1"><a href="#pre-requis">Pré-requis</a></li>
<li class="level1"><a href="#installation">Installation</a>
<ul class="nav toc">
<li class="level2"><a href="#installation_de_mdadm">Installation de mdadm</a></li>
<li class="level2"><a href="#configuration_des_disques_durs">Configuration des disques durs</a></li>
<li class="level2"><a href="#construction_du_volume_raid">Construction du volume RAID</a></li>
<li class="level2"><a href="#finalisation">Finalisation</a></li>
</ul>
</li>
<li class="level1"><a href="#utilisationconfiguration">Utilisation/Configuration</a>
<ul class="nav toc">
<li class="level2"><a href="#que_faire_pour_agrandir_l_array_-_ajouter_un_disque">Que faire pour agrandir l&#039;array ? - Ajouter un disque</a></li>
<li class="level2"><a href="#que_faire_pour_agrandir_l_array_-_remplacer_les_disques">Que faire pour agrandir l&#039;array ? - Remplacer les disques</a></li>
<li class="level2"><a href="#que_faire_lorsqu_un_des_composants_de_l_array_vient_a_defaillir">Que faire lorsqu&#039;un des composants de l&#039;Array vient à défaillir ?</a></li>
<li class="level2"><a href="#que_faire_pour_diminuer_l_array_-_supprimer_un_disque">Que faire pour diminuer l&#039;array ? - Supprimer un disque?</a></li>
<li class="level2"><a href="#comment_migrer_les_donnees_vers_une_nouvelle_machine">Comment migrer les données vers une nouvelle machine ?</a></li>
</ul>
</li>
<li class="level1"><a href="#problemes_solutions_courantes">Problèmes &amp; solutions courantes</a>
<ul class="nav toc">
<li class="level2"><a href="#que_faire_si_je_n_arrive_plus_a_acceder_a_mon_raid">Que faire si je n&#039;arrive plus à accéder à mon raid</a></li>
<li class="level2"><a href="#probleme_de_taille_de_block_superblock">Problème de taille de block &amp; superblock</a></li>
<li class="level2"><a href="#device_or_ressource_busy">Device or ressource busy ...</a></li>
<li class="level2"><a href="#md127">md127</a></li>
<li class="level2"><a href="#droits_d_ecriture">Droits d&#039;écriture</a></li>
</ul>
</li>
<li class="level1"><a href="#des_idees_pour_aller_plus_loin">Des idées pour aller plus loin</a>
<ul class="nav toc">
<li class="level2"><a href="#decoupage_du_volume_avec_lvm">Découpage du volume avec LVM</a></li>
<li class="level2"><a href="#la_combinaison_des_niveaux_de_raid">La combinaison des niveaux de RAID</a></li>
<li class="level2"><a href="#un_disque_de_sparevotre_roue_de_secours_en_cas_de_defaillance">Un disque de spare : votre roue de secours en cas de défaillance</a></li>
<li class="level2"><a href="#test">Test</a></li>
<li class="level2"><a href="#supervision_du_raid">Supervision du RAID</a></li>
<li class="level2"><a href="#creation_d_un_raid_sans_avoir_tous_les_disques">Création d&#039;un RAID sans avoir tous les disques</a></li>
<li class="level2"><a href="#creation_d_un_raid1_sans_avoir_tous_les_disques_et_sans_copie">Création d&#039;un RAID1 sans avoir tous les disques et sans copie</a></li>
</ul>
</li>
<li class="level1"><a href="#un_peu_de_reference">Un peu de référence</a></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content"><div class="tags"><span>
	<a href="/bionic" class="wikilink1" title="bionic" rel="tag">bionic</a>,
	<a href="/focal" class="wikilink1" title="focal" rel="tag">focal</a>,
	<a href="/sauvegarde" class="wikilink1" title="sauvegarde" rel="tag">sauvegarde</a>,
	<a href="/securite" class="wikilink1" title="securite" rel="tag">sécurité</a>,
	<a href="/systeme" class="wikilink1" title="systeme" rel="tag">système</a>,
	<a href="/raid" class="wikilink1" title="raid" rel="tag">raid</a>
</span></div>
<hr />

<h1 class="sectionedit1 page-header" id="raid_logiciel_avec_mdadm">RAID logiciel avec mdadm</h1>
<div class="level1">

</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[RAID logiciel avec mdadm] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="raid_logiciel_avec_mdadm" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="65-104" /><button type="submit" title="RAID logiciel avec mdadm" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit2 page-header" id="introduction_-_qu_est-il_possible_de_faire">Introduction - Qu&#039;est-il possible de faire ?</h2>
<div class="level2">

<p>
Vous venez de terminer une installation d&#039;Ubuntu et voulez protéger vos données ou améliorer les performances en utilisant un système RAID (1, 5 et 6 pour la sécurité des donnés + perfs; 0 pour les perfs brutes au prix d&#039;un risque accru de perte de donnés). <br/>

Le RAID utilise une logique très simple. Pour sauvegarder efficacement les données, il suffit de les copier à plusieurs endroits. <br/>

Le RAID permet donc d&#039;utiliser les performances de plusieurs disques de manière optimale tout en diminuant les risques de perte de données au prix d&#039;une légère perte d&#039;espace disque (pour les RAID 5 et 6)
</p>

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Introduction - Qu&#039;est-il possible de faire ?] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="introduction_-_qu_est-il_possible_de_faire" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="105-778" /><button type="submit" title="Introduction - Qu&#039;est-il possible de faire ?" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit3" id="ce_que_raid_n_est_pas">Ce que RAID n&#039;est pas</h3>
<div class="level3">

<p>
Le RAID n&#039;est pas une solution de sauvegarde, il s&#039;agit d&#039;une solution qui permet un rétablissement rapide de la situation lors d&#039;un cas de figure favorable.
Les deux (ou plus) disques utilisés étant souvent de la même époque, de la même marque, et même de la même série, il se peut que vous n&#039;ayez pas de chance et que plus d&#039;un disque grille à la fois, dans ce cas, il est possible que vous ne puissiez pas récupérer la moindre bribe de données …
Lors d&#039;un événement qui conduirait à des dégâts électriques tous les composants de votre PC peuvent griller en même temps … Ce genre de dégâts est fréquent si votre alimentation est dite &quot;NONAME&quot; c&#039;est-à-dire une alimentation souvent vendue avec les ordinateurs pré-assemblés. La remplacer par une Alim de marque reconnue permet de baisser ce risque énormément à tel point qu&#039;il en devient négligeable. Malgré tout une sauvegarde externe reste très vivement conseillée.
</p>

<p>
Dans le cas d&#039;un RAID 0, il ne s&#039;agit aucunement d&#039;une solution de sauvegarde, bien au contraire, le fait d&#039;étaler les données sur plusieurs disques augmente certes les performances, mais il en résulte une plus grande chance de panne. En effet si un seul des disques d&#039;un groupe RAID 0 grille, l&#039;intégralité des données devient illisible !
Ce type de RAID est donc utile seulement dans les cas où les données sont non cruciales mais dont les besoins de performances de lecture/écriture sont importants. (Partition système ou partition dite &quot;Scratch area&quot; c&#039;est-à-dire endroit où est fait le travail courant avant d&#039;être stocké plus en sécurité)
</p>

</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Ce que RAID n&#039;est pas] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="ce_que_raid_n_est_pas" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="779-2430" /><button type="submit" title="Ce que RAID n&#039;est pas" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit4" id="les_types_de_raid">Les types de RAID</h3>
<div class="level3">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> RAID 0: 2 disques minimum - &quot;Taille du plus petit disque&quot; x &quot;nombre de disques&quot; - Ce type de RAID ne protège pas du tout vos données, mais obtient les performances maximales de vos disques. Ce mode permet en effet de combiner plusieurs disques en un seul. Les données seront distribuées entre chaque disque (le nombre de disques utilisables est illimité, mais les risques de pannes augmentent, en toute logique, proportionnellement) ce qui permet de presque doubler les performances avec deux disques, presque tripler avec 3, etc … (&quot;Vitesse du disque le plus lent&quot; x &quot;nombre de disques&quot;)</div>
</li>
<li class="level1"><div class="li"> RAID 1: 2 disques minimum - Taille du plus petit disque - En RAID 1 vos données sont copiées sur deux disques ou plus. C&#039;est-à-dire que chaque disque sera l&#039;exacte copie du premier. Si l&#039;un d&#039;eux grille, il suffit de le remplacer pour créer une nouvelle copie sur ce nouveau disque. Côté performances, en écriture, elles seront les mêmes qu&#039;avec un seul disque (le plus lent du groupe). En lecture les performances sur la copie d&#039;un seul fichier devraient être proches de la vitesse d&#039;un seul disque, mais vous pourrez lire à pleine vitesse autant de fichiers qu&#039;il y a de disques en miroir (Exemple: Avec 3 disques identiques vous pouvez lire un fichier à 120 mo/s tout comme 3 fichiers à la fois, toujours à 120 mo/s par fichier)</div>
</li>
<li class="level1"><div class="li"> RAID 5: 3 disques minimum - &quot;Taille du plus petit disque&quot; x (&quot;Nombre de disques&quot; - 1) - Le RAID 5 est un mélange de RAID 0 et de RAID 1. Les fichiers sont à la fois coupés en plusieurs disques pour optimiser les performances et à la fois clonés de telle manière à ce qu&#039;ils soient récupérables lors de la perte d&#039;un disque. La vitesse est d&#039;environ celle de <em>&quot;vitesse du pire disque&quot; x (&quot;Nombre de disques&quot; - 1)</em> que ce soit en lecture ou écriture, même si les performances en écriture peuvent être limitées par la puissance du CPU quand le nombre de disques est élevé (+ de 6 sur un PC actuel haut de gamme). Vous pouvez ajouter autant de disques que vous le souhaitez, mais le nombre de disques pouvant tomber en panne avant la perte totale des données du groupe restera toujours de 1.</div>
</li>
<li class="level1"><div class="li"> RAID 6: 4 disques minimum - &quot;Taille du plus petit disque&quot; x (&quot;Nombre de disques&quot; - 2) - Même chose que le RAID 5 sauf que 2 disques peuvent griller avant de perdre toutes les données contenues. Cette version du RAID est faite pour ceux utilisant un grand nombre de disques (5 ou plus) en RAID 5</div>
</li>
<li class="level1"><div class="li"> RAID 10: 4 disques minimum (par paire) - 2 x &quot;Taille du plus petit disque&quot; -  Le RAID 10 ou RAID 1+0 est le fait de créer deux (ou plus) RAID 1 que vous combinez ensuite en un RAID 0. Cette technique est automatisée par le mode RAID 10 qui fait le travail pour vous. Les performances en lecture sont du niveau d&#039;un RAID 0 de deux (ou plus) disques mais deux fichiers peuvent êtres accédés à pleine vitesse en même temps. En écriture les performances sont celles de deux disques. Ce mode est recommandé pour des performances optimales tout en ayant une copie de sauvegarde. Malgré tout sa complexité n&#039;en fait pas un mode recommandé ni pour les débutants, ni pour les particuliers en général. Beaucoup préféreront le mode RAID 5 avec le même nombre de disques, qui malgré des performances légèrement moindres vous offre plus d&#039;espace utilisable.</div>
</li>
</ul>

<p>
Pour plus de détails, Wikipédia est bien fourni : <br/>

<a href="https://fr.wikipedia.org/wiki/RAID_(informatique)" class="interwiki iw_wpfr" title="https://fr.wikipedia.org/wiki/RAID_(informatique)">Les différents types de RAID</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Les types de RAID] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="les_types_de_raid" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="2431-5907" /><button type="submit" title="Les types de RAID" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit5 page-header" id="mise_en_œuvre">Mise en œuvre</h2>
<div class="level2">

<p>
Tout ce qui suit fonctionne aussi bien avec la version serveur que la version Desktop d&#039;Ubuntu. <br/>

L&#039;exemple utilisé est un montage RAID 5 <strong>logiciel</strong>, mais la méthode pour les autres types de RAID logiciel est la même.<br/>

L&#039;avantage est que vous ne vous ruinez pas dans l&#039;achat d&#039;une carte fille supportant le RAID  5 et en quelques lignes de commandes vous avez l&#039;équivalent pour uniquement le prix des disques ! <br/>

Mdadm remplace aussi avantageusement l&#039;utilisation d&#039;un <a href="/tutoriel/comment_utiliser_le_raid_onboard" class="wikilink1" title="tutoriel:comment_utiliser_le_raid_onboard">fake-raid</a> qui n&#039;offre généralement pas d&#039;aussi bonnes performances.<br/>

L&#039;utilisation de disques durs <abbr title="Serial Advanced Technology Attachment">SATA</abbr>, est plus que recommandée, car ils permettent une extraction à chaud (Hot Plug) pour un prix abordable. 
</p>

<p>
Le logiciel qui va nous permettre de remplir notre objectif s&#039;appelle <strong>mdadm</strong>.
</p>
<div class="noteclassic">Si vous avez besoin de la prise en charge du RAID logiciel dès l&#039;installation de votre système, vous pouvez vous tourner vers
une iso <a href="/installation_alternate#obtenir_une_iso_alternate" class="wikilink1" title="installation_alternate">alternate</a> ou une iso serveur.

</div>
</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Mise en œuvre] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="mise_en_œuvre" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="5908-7000" /><button type="submit" title="Mise en œuvre" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit6 page-header" id="pre-requis">Pré-requis</h2>
<div class="level2">
<ol class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Il faut les droits root/administrateur</div>
</li>
<li class="level1"><div class="li"> Il faut un noyau supérieur à 2.6 (ne devrait pas être difficile à atteindre)</div>
</li>
<li class="level1"><div class="li"> Connexion Internet configurée et activée (utilisez le <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>, si possible, cela évite de se casser la tête). </div>
</li>
<li class="level1"><div class="li"> Configurez votre fichier /etc/apt/sources.list pour qu&#039;Ubuntu aille tout chercher sur Internet. (déjà fait par défaut à priori)</div>
</li>
<li class="level1"><div class="li"> Ayez au moins 2 disques durs (cas du RAID 0 ou 1) ou 3 disques durs (cas du RAID 5) ou 4 disques durs (cas du RAID 6 et RAID 10)</div>
</li>
<li class="level1"><div class="li"> … branchés sur des contrôleurs <abbr title="Integrated Development Environment">IDE</abbr> Sata/P-ata/SCSI reconnus par Ubuntu (C&#039;est à dire la quasi totalité)</div>
</li>
<li class="level1"><div class="li"> Il est recommandé que les disques soient de même taille, mais ce n&#039;est pas indispensable, vous pouvez partitionner vos disques de telle manière que chaque disque ait une partition de la taille du disque le plus petit, le restant des disques pourra être utilisé en mode conventionnel &quot;NON-RAID&quot;</div>
</li>
</ol>

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Pré-requis] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="pre-requis" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="7001-7956" /><button type="submit" title="Pré-requis" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit7 page-header" id="installation">Installation</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Installation] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="7957-7982" /><button type="submit" title="Installation" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit8" id="installation_de_mdadm">Installation de mdadm</h3>
<div class="level3">

<p>
Il suffit d&#039;<a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer le paquet</a> <strong><a href="apt://mdadm" class="interwiki iw_apt" title="apt://mdadm">mdadm</a></strong>.
</p>

<p>
Un boot est nécessaire pour permettre la découverte des structures RAIDS pré-existantes dans le cas d&#039;une nouvelle installation de l&#039;<abbr title="Operating System">OS</abbr> en plus (ou à la place) d&#039;une installation existante utilisant des RAIIDS.
</p>

</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Installation de mdadm] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation_de_mdadm" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="7983-8333" /><button type="submit" title="Installation de mdadm" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit9" id="configuration_des_disques_durs">Configuration des disques durs</h3>
<div class="level3">

<p>
Comme indiqué ci-dessus dans les pré-requis, il faut au moins 3 disques durs pour faire du RAID 5. Dans cet exemple j&#039;ai pris 4 disques, mais l&#039;opération est la même si vous en utilisez plus ou moins que moi.
</p>

<p>
Il faut partitionner les disques durs que nous allons utiliser grâce à l&#039;utilitaire fdisk. Ici je vous guide pour un disque, à vous de le faire autant de fois que vous voulez utiliser de disques. Vous pouvez aussi utiliser <a href="/gparted" class="wikilink1" title="gparted">Gparted</a>
</p>
<pre class="code">sudo fdisk /dev/sdX</pre>

<p>
Il faut comprendre que le `sdX` représente votre disque dur et que `X` représente sa lettre. Par exemple `sda`, `sdb`, `sdc`, etc… (vous pouvez utiliser <a href="/gnome-disk-utility" class="wikilink1" title="gnome-disk-utility">Gnome-disk-utility</a> pour connaître le &quot;nom&quot; de votre disque.)
</p>

<p>
Info : Pour des partitions de plus de 2.2To, <del>il faut</del> utiliser &quot;gdisk&quot;, de la même manière (fdisk semble gérer les tables de partition GPT à ce jour)
</p>
<pre class="code">sudo gdisk /dev/sdX</pre>

<p>
Choisir un type de table de partition &quot;GPT&quot;, puis suivre a nouveau ce tuto
</p>

<p>
Vous obtiendrez (grâce à l&#039;option `m`) les lignes suivantes : 
</p>

<p>
<a href="/_detail/securite/menu_fdisk.gif?id=raid_logiciel" class="media" title="securite:menu_fdisk.gif"><img src="/_media/securite/menu_fdisk.gif" class="media img-responsive" alt="" /></a>
</p>

<p>
Il faut donc appliquer l&#039;option `n` comme montré ci-dessus pour créer une nouvelle partition.
</p>

<p>
fdisk vous demande alors le type de partition (p pour primaire ou e pour étendue).<br/>

Nous n&#039;allons créer qu&#039;une seule partition par disque, nous choisirons donc le type primaine : &#039;p&#039;
</p>

<p>
Vous entrez ensuite dans le processus de création de partition étendue : 
</p>

<p>
<a href="/_detail/securite/creation.1.gif?id=raid_logiciel" class="media" title="securite:creation.1.gif"><img src="/_media/securite/creation.1.gif" class="media img-responsive" alt="" /></a>
</p>

<p>
Tapez `1` comme montré ci-dessus
</p>

<p>
<a href="/_detail/securite/creation.2.gif?id=raid_logiciel" class="media" title="securite:creation.2.gif"><img src="/_media/securite/creation.2.gif" class="media img-responsive" alt="" /></a>
</p>

<p>
Tapez sur la touche `Entrée`
</p>

<p>
<a href="/_detail/securite/creation.3.gif?id=raid_logiciel" class="media" title="securite:creation.3.gif"><img src="/_media/securite/creation.3.gif" class="media img-responsive" alt="" /></a>
</p>

<p>
Tapez encore sur la touche `Entrée`
</p>

<p>
Tapez sur la touche &#039;t&#039; pour changer le type de partition.
</p>

<p>
Tapez &#039;fd&#039; (Valeur hexadécimale correspondant à &quot;Linux Raid Autodetect&quot;) puis `Entrée` afin de valider.
</p>

<p>
Enfin, validez les modifications en tapant `w` : 
</p>

<p>
<a href="/_detail/securite/validation.gif?id=raid_logiciel" class="media" title="securite:validation.gif"><img src="/_media/securite/validation.gif" class="media img-responsive" alt="" /></a>
</p>

<p>
Vous venez de créer une partition primaire sur votre disque /dev/sdX
</p>
<div class="notetip"><strong>Il est aussi possible de créer des RAID sans l&#039;utilisation des lignes de commandes via l&#039;application graphique <a href="/gnome-disk-utility" class="wikilink1" title="gnome-disk-utility">palimpsest</a> !</strong> (Il faut quand même installer mdadm et renseigner le fichier mdadm.conf avec <strong>ARRAY /dev/mdx devices=/dev/… /dev/… auto=yes</strong> sinon votre raid ne démarrera pas tout seul au boot du système) 
</div>
</div>
<div class='secedit editbutton_section editbutton_9'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Configuration des disques durs] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration_des_disques_durs" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="8334-10717" /><button type="submit" title="Configuration des disques durs" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit10" id="construction_du_volume_raid">Construction du volume RAID</h3>
<div class="level3">

<p>
Nous pouvons maintenant utiliser mdadm pour construire notre volume RAID 5 : 
</p>
<pre class="code">sudo mdadm --create /dev/md0 --level=5  --raid-devices=4 /dev/sdb1 /dev/sdc1 /dev/sdd1 /dev/sde1</pre>

<p>
<strong>sudo</strong> permet de dire que le programme que nous allons exécuter aura les droits administrateur
<strong>mdadm</strong> est le nom du programme à utiliser (oui j&#039;explique même pour ceux qui ne sont pas adeptes de la ligne de commande)
<strong>–create /dev/md0</strong> permet de donner un nom à votre RAID. Ceci est le disque dur virtuel que vous êtes en train de créer à partir de vos disques
<strong>–level=5</strong> devra être modifié par le type de RAID que vous souhaitez utiliser (0,1,5,6,10). Exemple: –level=1 <br/>

<strong>–raid-devices=4</strong> devra être modifié pour donner le nombre de disques que vous souhaitez utiliser (ici 4, vous 2 ou 3 ou 5, etc)
<strong>/dev/sdb1 /dev/sdc1 /dev/sdd1 /dev/sde1</strong> il s&#039;agit de la liste des partitions que je dois ajouter à mon RAID. À vous de les adapter à votre configuration. Aidez-vous de <a href="/gnome-disk-utility" class="wikilink1" title="gnome-disk-utility">Gnome-disk-utility</a> si trou de mémoire ^^
</p>
<div class="noteimportant">N&#039;utilisez pas l&#039;option - -assume-clean lors de la création d&#039;un nouveau volume RAID. Car vous risquez de perdre des données en cas de panne d&#039;un disque dans une grappe raid5.
<a href="https://raid.wiki.kernel.org/index.php/Initial_Array_Creation" class="urlextern" title="https://raid.wiki.kernel.org/index.php/Initial_Array_Creation" rel="nofollow">https://raid.wiki.kernel.org/index.php/Initial_Array_Creation</a>
</div><div class="noteclassic">Si cette commande échoue avec un message d&#039;erreur parlant de md0, c&#039;est parce que des modules n&#039;ont pas été ajoutés automatiquement au noyau (cela nécessite un redémarrage après installation du paquet mdadm). De ce fait, effectuer :
<pre class="code">sudo modprobe raid5
sudo modprobe md</pre>

<p>
Si l&#039;erreur persiste, faire au redémarrage suivant :
</p>
<pre class="code">sudo echo raid5 &gt;&gt; /etc/modules
sudo echo md &gt;&gt; /etc/modules</pre>

<p>
On trouvera aussi des informations intéressantes dans l&#039;article <a href="/tutoriel/raid1_software" class="wikilink1" title="tutoriel:raid1_software">raid1_software</a>.
</p>

</div>
<p>
On termine cette construction par la daemonisation du volume RAID, c&#039;est-à-dire que nous allons faire en sorte que le système charge le volume à chaque démarrage : 
</p>
<pre class="code">sudo mdadm --daemonise /dev/md0</pre>
<div class="noteclassic"> Si la commande ci-dessus renvoie un message du type :
<pre class="code">mdadm: --daemonise does not set the mode, and so cannot be the first option.</pre>

<p>
essayez la commande suivante :
</p>
<pre class="code">sudo mdadm --monitor --daemonise /dev/md0</pre>

</div>
<p>
On peut maintenant demander quelques détails à notre disque virtuel :
</p>
<pre class="code">sudo fdisk -l
sudo mdadm --detail /dev/md0</pre>

</div>
<div class='secedit editbutton_section editbutton_10'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Construction du volume RAID] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="construction_du_volume_raid" /><input type="hidden" name="codeblockOffset" value="2" /><input type="hidden" name="range" value="10718-13206" /><button type="submit" title="Construction du volume RAID" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit11" id="finalisation">Finalisation</h3>
<div class="level3">

<p>
Il reste quelques modifications à effectuer : 
</p>
<ol class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Il faut formater le volume RAID nouvellement créé  : </div>
</li>
</ol>
<pre class="code">sudo mkfs.ext4 /dev/md0</pre>

<p>
<strong>-Attention il vous est demandé de valider (y/N), il faut répondre O pour y</strong>
</p>
<ol class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Déclarez ce volume dans `fstab` pour que le système le monte au démarrage (le système de fichier, pas le volume en lui même). Pour ce faire <a href="/tutoriel/comment_modifier_un_fichier" class="wikilink1" title="tutoriel:comment_modifier_un_fichier">Editez le fichier</a> <strong>/etc/fstab</strong> et ajoutez à sa fin la ligne : </div>
</li>
</ol>
<pre class="code">/dev/md0 	/media/raid	ext4	defaults 	0	1</pre>

<p>
Cela signifie que le système montera au démarrage le contenu du volume RAID dans le dossier /media/raid.
</p>
<ol class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Il ne reste plus qu&#039;à créer le dossier /media/raid grâce à la commande mkdir : </div>
</li>
</ol>
<pre class="code">sudo mkdir /media/raid</pre>
<div class="notetip">AJOUT DU 22/06/2017.    La chose qu&#039;il est impératif de faire pour éviter des déboires :
Mettre immédiatement le raids sous monitorat avec alerte par courriel afin de recevoir une alerte lorsque l&#039;un des disques vient à flancher et simuler un incident afin d&#039;être sûr que cela fonctionne. En effet, il me semble que 100% des incidents rencontrés dans le forum de discussion sont ouverts à la suite de la panne d&#039;un second disque qui met en évidence que le premier a cessé de fonctionner depuis des mois
</div>
<p>
.
</p>

</div>
<div class='secedit editbutton_section editbutton_11'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Finalisation] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="finalisation" /><input type="hidden" name="codeblockOffset" value="9" /><input type="hidden" name="range" value="13207-14541" /><button type="submit" title="Finalisation" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit12 page-header" id="utilisationconfiguration">Utilisation/Configuration</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_12'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Utilisation/Configuration] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="utilisationconfiguration" /><input type="hidden" name="codeblockOffset" value="12" /><input type="hidden" name="range" value="14542-14580" /><button type="submit" title="Utilisation/Configuration" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit13" id="que_faire_pour_agrandir_l_array_-_ajouter_un_disque">Que faire pour agrandir l&#039;array ? - Ajouter un disque</h3>
<div class="level3">

<p>
Une fois les disques connectés et les partitions créées avec fdisk, il suffit de les ajouter :
(par défaut, les partitions sont mise en SPARE)
</p>
<pre class="code">sudo mdadm --manage /dev/md0 --add /dev/sdf1</pre>

<p>
Ensuite étendre l&#039;array sur ces nouvelles partitions :
</p>
<pre class="code">sudo mdadm --grow /dev/md0 --raid-devices=5</pre>

<p>
mdadm va partir en agrandissement (reshape) qui est une opération longue. On peut surveiller la progression avec l&#039;une des trois commandes:
</p>
<pre class="code">sudo mdadm --detail /dev/md0
cat /proc/mdstat
watch cat /proc/mdstat</pre>
<div class="noteclassic">Cette opération peut être <strong>extrêmement longue</strong>  (regardez le débit) <pre class="code bash"><span class="kw2">cat</span> <span class="sy0">/</span>proc<span class="sy0">/</span>mdstat
Personalities : <span class="br0">&#91;</span>linear<span class="br0">&#93;</span> <span class="br0">&#91;</span>multipath<span class="br0">&#93;</span> <span class="br0">&#91;</span>raid0<span class="br0">&#93;</span> <span class="br0">&#91;</span>raid1<span class="br0">&#93;</span> <span class="br0">&#91;</span>raid6<span class="br0">&#93;</span> <span class="br0">&#91;</span>raid5<span class="br0">&#93;</span> <span class="br0">&#91;</span>raid4<span class="br0">&#93;</span> <span class="br0">&#91;</span>raid10<span class="br0">&#93;</span> 
md50 : active raid5 sdd5<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span> sdd10<span class="br0">&#91;</span><span class="nu0">6</span><span class="br0">&#93;</span> sdd7<span class="br0">&#91;</span><span class="nu0">3</span><span class="br0">&#93;</span> sdd4<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span> sdd9<span class="br0">&#91;</span><span class="nu0">5</span><span class="br0">&#93;</span> sdd6<span class="br0">&#91;</span><span class="nu0">2</span><span class="br0">&#93;</span> sdd8<span class="br0">&#91;</span><span class="nu0">4</span><span class="br0">&#93;</span>
      <span class="nu0">51900416</span> blocks super <span class="nu0">1.2</span> level <span class="nu0">5</span>, 512k chunk, algorithm <span class="nu0">2</span> <span class="br0">&#91;</span><span class="nu0">7</span><span class="sy0">/</span><span class="nu0">7</span><span class="br0">&#93;</span> <span class="br0">&#91;</span>UUUUUUU<span class="br0">&#93;</span>
      <span class="br0">&#91;</span><span class="sy0">&gt;</span>....................<span class="br0">&#93;</span>  reshape =  <span class="nu0">0.3</span><span class="sy0">%</span> <span class="br0">&#40;</span><span class="nu0">99836</span><span class="sy0">/</span><span class="nu0">25950208</span><span class="br0">&#41;</span> <span class="re2">finish</span>=566.0min <span class="re2">speed</span>=760K<span class="sy0">/</span>sec</pre>

<p>
 Elle bloque quasiment l&#039;accès au disque: gparted se bloque, les applications qui accèdent  à ce raid se bloquent, un arrêt machine se bloque.  Heureusement le redémarrage se passe sans difficulté avec reprise de l&#039;opération!
</p>

</div>
<p>
Lorsque l&#039;agrandissement (reshape) est terminé, mdadm va exécuter automatiquement la synchronisation des disques   qui est une opération moins lente. 
</p>
<pre class="code bash"> <span class="kw2">cat</span> <span class="sy0">/</span>proc<span class="sy0">/</span>mdstat 
Personalities : <span class="br0">&#91;</span>linear<span class="br0">&#93;</span> <span class="br0">&#91;</span>multipath<span class="br0">&#93;</span> <span class="br0">&#91;</span>raid0<span class="br0">&#93;</span> <span class="br0">&#91;</span>raid1<span class="br0">&#93;</span> <span class="br0">&#91;</span>raid6<span class="br0">&#93;</span> <span class="br0">&#91;</span>raid5<span class="br0">&#93;</span> <span class="br0">&#91;</span>raid4<span class="br0">&#93;</span> <span class="br0">&#91;</span>raid10<span class="br0">&#93;</span> 
md50 : active raid5 sdd5<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span> sdd10<span class="br0">&#91;</span><span class="nu0">6</span><span class="br0">&#93;</span> sdd7<span class="br0">&#91;</span><span class="nu0">3</span><span class="br0">&#93;</span> sdd4<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span> sdd9<span class="br0">&#91;</span><span class="nu0">5</span><span class="br0">&#93;</span> sdd6<span class="br0">&#91;</span><span class="nu0">2</span><span class="br0">&#93;</span> sdd8<span class="br0">&#91;</span><span class="nu0">4</span><span class="br0">&#93;</span>
      <span class="nu0">155701248</span> blocks super <span class="nu0">1.2</span> level <span class="nu0">5</span>, 512k chunk, algorithm <span class="nu0">2</span> <span class="br0">&#91;</span><span class="nu0">7</span><span class="sy0">/</span><span class="nu0">7</span><span class="br0">&#93;</span> <span class="br0">&#91;</span>UUUUUUU<span class="br0">&#93;</span>
      <span class="br0">&#91;</span>==<span class="sy0">&gt;</span>..................<span class="br0">&#93;</span>  resync = <span class="nu0">10.1</span><span class="sy0">%</span> <span class="br0">&#40;</span><span class="nu0">2621812</span><span class="sy0">/</span><span class="nu0">25950208</span><span class="br0">&#41;</span> <span class="re2">finish</span>=93.5min <span class="re2">speed</span>=4157K<span class="sy0">/</span>sec </pre>

<p>
Une fois l&#039;opération  finie, il vous faudra agrandir votre partition ext4 (ou similaire) via resize2fs.
</p>
<pre class="code">sudo resize2fs /dev/md0</pre>

<p>
<a href="https://forum.ubuntu-fr.org/viewtopic.php?pid=22075419#p22075419" class="urlextern" title="https://forum.ubuntu-fr.org/viewtopic.php?pid=22075419#p22075419" rel="nofollow">Voir un exemple concret.</a>
</p>
<div class="notetip"> Il devrait être aussi possible de gérer le changement de taille du RAID avec l&#039;application GPARTED à partir de la version 20.04.0 
<pre class="code bash"><span class="kw2">sudo</span> gparted <span class="sy0">/</span>dev<span class="sy0">/</span>sda
Unit boot.mount does not exist, proceeding anyway.
GParted 1.0.0
configuration <span class="re5">--enable-libparted-dmraid</span> <span class="re5">--enable-online-resize</span>
libparted <span class="nu0">3.3</span> </pre>

<p>
<a href="/_detail/mdadm/mdadm01.png?id=raid_logiciel" class="media" title="mdadm:mdadm01.png"><img src="/_media/mdadm/mdadm01.png?w=200&amp;tok=9fb6d2" class="media img-responsive" alt="" width="200" /></a>
</p>

<p>
Quelques extraits récupérés du log.  	
</p>
<pre class="code bash">e2fsck <span class="re5">-f</span> <span class="re5">-y</span> <span class="re5">-v</span> <span class="re5">-C</span> <span class="nu0">0</span> <span class="st_h">'/dev/md50'</span>  00:01:<span class="nu0">53</span>    <span class="br0">&#40;</span> SUCCÈS <span class="br0">&#41;</span>   	
Passe <span class="nu0">1</span> : vérification des i-noeuds, des blocs et des tailles
L<span class="st_h">'arbre d'</span>extent de l<span class="st_h">'i-noeud 2752601 (au niveau 2) pourrait être plus étroit. Optimiser ? oui
&nbsp;
resize2fs -p '</span><span class="sy0">/</span>dev<span class="sy0">/</span>md50<span class="st_h">'  00:01:44    ( SUCCÈS )</span></pre>

</div>
</div>
<div class='secedit editbutton_section editbutton_13'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Que faire pour agrandir l&#039;array ? - Ajouter un disque] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="que_faire_pour_agrandir_l_array_-_ajouter_un_disque" /><input type="hidden" name="codeblockOffset" value="12" /><input type="hidden" name="range" value="14581-17369" /><button type="submit" title="Que faire pour agrandir l&#039;array ? - Ajouter un disque" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit14" id="que_faire_pour_agrandir_l_array_-_remplacer_les_disques">Que faire pour agrandir l&#039;array ? - Remplacer les disques</h3>
<div class="level3">

<p>
Ce choix n&#039;est probablement pas le premier auquel on pense. Cependant lorsque les disques initiaux sont anciens et qu&#039;ils approchent les 100000 heures de fonctionnement, il faut envisager de les remplacer par des disques de plus grande capacité. Les disques doivent être remplacés les uns après les autres. Lorsque le dernier disque aura été remplacé, il sera possible d&#039;utiliser la nouvelle capacité. La procédure proposée est la suivante:<br/>

1) Lancer l&#039;application smartctl pour tous les disques à remplacer. Consulter les retours pour trouver un ordre de changement. il y a probablement des disques en plus mauvais état que d&#039;autres.<br/>

2) Déclarer un disque inutilisable. La commande se fait en quelques secondes.
</p>
<pre class="code bash"><span class="kw2">sudo</span> mdadm <span class="re5">--manage</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md0 <span class="re5">--fail</span> <span class="sy0">/</span>dev<span class="sy0">/</span>sdb1 <span class="re5">--remove</span> <span class="sy0">/</span>dev<span class="sy0">/</span>sdb1 </pre>

<p>
3) Vérifier que le disque n&#039;a plus rien d&#039;utilisé. Il peut  posséder d&#039;autres partitions qu&#039;il faudra alors traiter.
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">fdisk</span> <span class="re5">-l</span> <span class="sy0">/</span>dev<span class="sy0">/</span>sdb</pre>

<p>
4) Démonter le disque et le remplacer par le nouveau disque. Cette opération peut nécessiter  un arrêt de la machine gérant le raids.<br/>

5) Formater le nouveau disque. Il conservera certainement le même nom. Il faut lui créer une table de partition GPT. Il faut lui remettre les &quot;autres partitions&quot; si l&#039;ancien disque en avait puis créer une partition utilisant la totalité de l&#039;espace disque restant. Il ne faut surtout pas créer une partition qui a la taille de l&#039;ancienne partition.<br/>

6) Mettre le disque dans le circuit et  regarder la remise en état se faire.  
</p>
<pre class="code bash"><span class="kw2">sudo</span> mdadm <span class="re5">--manage</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md0 <span class="re5">--add</span> <span class="sy0">/</span>dev<span class="sy0">/</span>sdb1
<span class="kw2">watch</span> <span class="re5">-n</span> <span class="nu0">60</span> <span class="kw2">cat</span> <span class="sy0">/</span>proc<span class="sy0">/</span>mdstat</pre>

<p>
7) Lorsque tous les disques opérationnels sont traités, identifier et supprimer tous les disques de secours s&#039;il en existe.
</p>
<pre class="code bash"><span class="kw2">sudo</span> mdadm <span class="re5">--detail</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md0 <span class="sy0">|</span> <span class="kw2">grep</span> spare
<span class="kw2">sudo</span> mdadm <span class="re5">--manage</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md0 <span class="re5">--remove</span> <span class="sy0">/</span>dev<span class="sy0">/</span>sdx1  <span class="sy0">/</span>dev<span class="sy0">/</span>sdy1 <span class="sy0">/</span>dev<span class="sy0">/</span>sdz1</pre>

<p>
8) Procéder à l&#039;agrandissement du RAID, du système de fichier et  regarder l&#039;agrandissement du système de fichier se réaliser.   
</p>
<pre class="code bash"><span class="kw2">sudo</span> mdadm <span class="re5">--grow</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md0 <span class="re5">--size</span>=max
<span class="kw2">sudo</span> mdadm <span class="re5">--detail</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md0 <span class="sy0">|</span> <span class="kw2">grep</span> Size     
<span class="kw2">sudo</span> resize2fs <span class="sy0">/</span>dev<span class="sy0">/</span>md0</pre>

</div>
<div class='secedit editbutton_section editbutton_14'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Que faire pour agrandir l&#039;array ? - Remplacer les disques] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="que_faire_pour_agrandir_l_array_-_remplacer_les_disques" /><input type="hidden" name="codeblockOffset" value="20" /><input type="hidden" name="range" value="17370-19599" /><button type="submit" title="Que faire pour agrandir l&#039;array ? - Remplacer les disques" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit15" id="que_faire_lorsqu_un_des_composants_de_l_array_vient_a_defaillir">Que faire lorsqu&#039;un des composants de l&#039;Array vient à défaillir ?</h3>
<div class="level3">

<p>
Ne paniquez pas ! Vous n&#039;avez pas perdu de données.
L&#039;objectif maintenant est d&#039;identifier le disque dur défaillant, même si le disque ne tombe pas en panne physiquement, il peut défaillir. (Un bon outil de diagnostic est le visualiseur de données SMART de <a href="/gnome-disk-utility" class="wikilink1" title="gnome-disk-utility">Gnome-disk-utility</a> ou smartctl dans <a href="/smartmontools" class="wikilink1" title="smartmontools">SMARTMonTools</a>)
Maintenant que vous avez identifié le disque dur défectueux, il faut le déclarer comme tel. 
</p>

<p>
1. Pour cela, on utilise mdadm :
</p>
<pre class="code">mdadm --manage /dev/md0 --set-faulty /dev/sdb1</pre>

<p>
Explication :
</p>

<p>
On utilise toujours le paramètre `--manage` de mdadm pour gérer le volume RAID.
On utilise l&#039;option `--set-faulty` pour déclarer le disque dur `/dev/sdb1` du volume RAID `/dev/md0` comme défaillant.
</p>

<p>
2. Une fois déclaré défaillant, le disque dur est écarté du volume RAID. Il faut maintenant le désactiver pour pouvoir le retirer : 
</p>
<pre class="code">mdadm --manage /dev/md0 --remove /dev/sdb1</pre>

<p>
Vous pouvez maintenant retirer le disque défaillant en toute sécurité et le remplacer par un disque sain.
</p>

<p>
3. Une fois le remplacement effectué, il faut ajouter un disque sain dans le volume RAID pour bénéficier à nouveau de la tolérance de panne (cette opération doit être précédée du partitionnement du nouveau disque, aidez-vous des descriptions faites plus haut) :
</p>
<pre class="code">mdadm --manage /dev/md0 --add /dev/sdb1</pre>

<p>
Maintenant vous devez patienter, le temps que le volume Raid se reconstruise. Pendant cette phase de reconstruction les performances peuvent être altérées. Mais la reconstruction ralentit si vous avez besoin des disques.
</p>

</div>
<div class='secedit editbutton_section editbutton_15'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Que faire lorsqu&#039;un des composants de l&#039;Array vient à défaillir ?] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="que_faire_lorsqu_un_des_composants_de_l_array_vient_a_defaillir" /><input type="hidden" name="codeblockOffset" value="25" /><input type="hidden" name="range" value="19600-21283" /><button type="submit" title="Que faire lorsqu&#039;un des composants de l&#039;Array vient à défaillir ?" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit16" id="que_faire_pour_diminuer_l_array_-_supprimer_un_disque">Que faire pour diminuer l&#039;array ? - Supprimer un disque?</h3>
<div class="level3">

<p>
Le besoin de supprimer définitivement un disque d&#039;un RAID est certainement rare.
La documentation pour cette réalisation n&#039;est pas pléthorique. Voici une proposition de mode d&#039;emploi testée en version 20.04 sur un RAID5 composé de six entités.<br/>

Cela est certainement valable pour les  RAID6.<br/>

Les essais réalisés montrent que le risque est inexistant si des arrêts accidentels ont lieu pendant l&#039;opération.<br/>

Le principe est de d&#039;abord rétrécir le contenu avant le contenant.<br/>

Il n&#039;y a pas d&#039;outil contrôlant que la taille du système de fichier  va devenir supérieure à la taille de l&#039;enveloppe RAID.<br/>

Il n&#039;y a pas d&#039;outil réalisant cette opération de façon automatique.<br/>

Si la réalisation manuelle est mal faite, les données utilisateurs sont irrémédiablement perdues.<br/>

Il faudra démonter le RAID pendant  une opération.<br/>

</p>

<p>
1) Trouver la taille que peut héberger une unité physique du RAID.  L&#039;unité de mesure est le KiB.
</p>
<pre class="code bash">        <span class="kw2">sudo</span> mdadm <span class="re5">--detail</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md55 <span class="sy0">|</span><span class="kw2">grep</span> <span class="st0">&quot;Dev Size&quot;</span>
        Used Dev Size : <span class="nu0">5237760</span> <span class="br0">&#40;</span><span class="nu0">5.00</span> GiB <span class="nu0">5.36</span> GB<span class="br0">&#41;</span> </pre>

<p>
2) Trouver la taille actuelle occupée par les données du RAID.<br/>

Supprimer d&#039;abord les répertoires et les fichiers que vous considérez inutilement stockés dans le RAID puis regarder la taille utilisée.
</p>
<pre class="code bash">        <span class="kw2">df</span> <span class="re5">-B</span> <span class="nu0">1024</span> <span class="sy0">|</span><span class="kw2">egrep</span> <span class="st0">&quot;/dev/md55|Utilisé&quot;</span>
        Sys. de fichiers blocs de 1K    Utilisé Disponible Uti<span class="sy0">%</span> Monté sur
        <span class="sy0">/</span>dev<span class="sy0">/</span>md55           <span class="nu0">15335408</span>   <span class="nu0">11207536</span>    <span class="nu0">3325832</span>  <span class="nu0">78</span><span class="sy0">%</span> <span class="sy0">/</span>media<span class="sy0">/</span>RAID55</pre>

<p>
En déduire le nombre de disques nécessaires et la taille du système de fichier.<br/>

Nombre de disques =  taille du système de fichier utilisé divisé par la taille d&#039;une unité physique arrondi à l&#039;unité supérieure et éventuellement  un de plus si le résultat de la division est très proche de l&#039;unité supérieure. <br/>

Taille du système de fichier= Nombre de disques trouvés multiplié par la taille d&#039;une unité physique.<br/>

<strong>Nombre de disques devant rester dans le RAIDS: Ajouter 1 (RAID5) ou 2 (RAID6) pour prendre en compte l&#039;existence du &quot;disque de parité.&quot;</strong><br/>

Ici dans le contexte 4 et 15713280 <br/>

3) Démonter le raids. Il ne va plus être disponible pendant les deux opérations de réduction de taille ci-dessous. C&#039;est une contrainte du logiciel de base.
</p>
<pre class="code bash">         <span class="kw2">sudo</span> <span class="kw2">umount</span> <span class="re5">-v</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md55 </pre>

<p>
4) Contrôler le système de fichier du raids. Cette opération peut être faite en utilisant gparted permettant un suivi de l&#039;opération. Sinon:
</p>
<pre class="code bash">        <span class="kw2">sudo</span> e2fsck <span class="re5">-f</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md55 </pre>

<p>
5) Rétrécir  le système de fichier du raids. Cette opération peut être faite en utilisant gparted permettant un suivi de l&#039;opération. Sinon:
</p>
<pre class="code bash">        <span class="kw2">sudo</span> resize2fs  <span class="sy0">/</span>dev<span class="sy0">/</span>md55  15713280K
        resize2fs 1.45.5 <span class="br0">&#40;</span>07-Jan-<span class="nu0">2020</span><span class="br0">&#41;</span>
        resize2fs: La nouvelle taille est plus petite que le minimum <span class="br0">&#40;</span><span class="nu0">4991762</span><span class="br0">&#41;</span></pre>

<p>
Comme on le voit dans cet exemple, on ne risque pas de diminuer plus que la taille calculée.<br/>

Si ce contexte arrive, il faut certainement revoir les opérations de calcul.<br/>

Si l&#039;incident perdure
</p>
<pre class="code bash">        <span class="kw2">sudo</span> resize2fs  <span class="sy0">/</span>dev<span class="sy0">/</span>md55  15713280K
        resize2fs 1.45.5 <span class="br0">&#40;</span>07-Jan-<span class="nu0">2020</span><span class="br0">&#41;</span>
        resize2fs: La nouvelle taille est plus petite que le minimum <span class="br0">&#40;</span><span class="nu0">4438811</span><span class="br0">&#41;</span>   </pre>

<p>
6) Itérer sur  la réduction minima, cela diminuera par petites entités.<br/>

A chaque itération, multiplier la nouvelle taille obtenue par le coefficient de taille (3 dans le contexte).<br/>

Si la valeur est enfin inférieure, il est inutile de continuer, sinon il faut continuer  jusqu&#039;au message final.       
</p>
<pre class="code bash">        <span class="kw2">sudo</span> resize2fs <span class="re5">-M</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md55  
        resize2fs 1.45.5 <span class="br0">&#40;</span>07-Jan-<span class="nu0">2020</span><span class="br0">&#41;</span>
        Le système de fichiers a déjà <span class="nu0">4434586</span> blocs <span class="br0">&#40;</span>4k<span class="br0">&#41;</span>. Rien à faire <span class="sy0">!</span> </pre>

<p>
Il est alors possible de faire le point en remontant le système de fichier puis regarder la situation.
</p>
<pre class="code bash">        <span class="kw2">df</span> <span class="re5">-B</span> <span class="nu0">1024</span> <span class="sy0">|</span><span class="kw2">egrep</span> <span class="st0">&quot;/dev/md55|Utilisé&quot;</span>
        Sys. de fichiers blocs de 1K    Utilisé Disponible Uti<span class="sy0">%</span> Monté sur
        <span class="sy0">/</span>dev<span class="sy0">/</span>md55           <span class="nu0">17327524</span>   <span class="nu0">15300236</span>    <span class="nu0">1124004</span>  <span class="nu0">94</span><span class="sy0">%</span> <span class="sy0">/</span>media<span class="sy0">/</span>RAID55</pre>

<p>
Dans ce contexte, on voit qu&#039;on ne sait pas récupérer tout l&#039;espace disponible!<br/>

Il reste  la solution de supprimer un disque en moins pour que cela tienne…<br/>

Le contexte va donc devenir: Conserver <strong>5</strong> disques avec une taille de 20954040 KiO
</p>
<pre class="code bash">        <span class="kw2">sudo</span> resize2fs  <span class="sy0">/</span>dev<span class="sy0">/</span>md55  20951040K
        resize2fs 1.45.5 <span class="br0">&#40;</span>07-Jan-<span class="nu0">2020</span><span class="br0">&#41;</span>
        En train de redimensionner le système de fichiers sur <span class="sy0">/</span>dev<span class="sy0">/</span>md55 à <span class="nu0">5237760</span> <span class="br0">&#40;</span>4k<span class="br0">&#41;</span> blocs.
        Le système de fichiers sur <span class="sy0">/</span>dev<span class="sy0">/</span>md55 a maintenant une taille de <span class="nu0">5237760</span> blocs <span class="br0">&#40;</span>4k<span class="br0">&#41;</span>.</pre>

<p>
7) Diminuer la taille de l&#039;espace disque que le RAIDS doit gérer pour être en conformité avec la nouvelle taille du système de fichier
</p>
<pre class="code bash">        <span class="kw2">sudo</span> mdadm <span class="re5">--grow</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md55 <span class="re5">--array-size</span> <span class="nu0">20951040</span></pre>

<p>
Cette commande est sans réponse. L&#039;application gparted permet de visualiser la nouvelle taille. <br/>

Si par accident, une  faute de frappe a lieu, il est possible de la relancer. <br/>

Attention: La valeur frappée ne doit pas être inférieure à la vraie valeur du système de fichier. Cela empêcherait de le monter et le rendrait inutilisable et irréparable aussitôt que le nombre de disques du RAID sera modifié.<br/>

</p>

<p>
8) Remonter éventuellement le raids s&#039;il doit être utilisé en lecture et lancer dans un autre terminal  le suivi des opérations de réorganisation du nombre de disques.
</p>
<pre class="code bash">        <span class="kw2">watch</span> <span class="re5">-n</span> <span class="nu0">60</span> <span class="kw2">cat</span> <span class="sy0">/</span>proc<span class="sy0">/</span>mdstat</pre>

<p>
9) Eventuellement, indiquer que le RAIDS peut être utilisé en écriture.
</p>
<pre class="code bash">        <span class="kw2">sudo</span> mdadm <span class="re5">--readwrite</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md55</pre>

<p>
10) Indiquer que le nombre de disques pour gérer le RAID va être diminué de un  en précisant la nouvelle valeur.
</p>
<pre class="code bash">        <span class="kw2">sudo</span> mdadm <span class="re5">--grow</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md55 <span class="re5">--</span>    raid-devices=<span class="nu0">5</span> <span class="re5">--backup-file</span> <span class="sy0">/</span>home<span class="sy0">/</span>md55  
        mdadm: Need to backup 10240K of critical section..</pre>

<p>
Il ne reste plus qu&#039;à surveiller et patienter.
</p>
<pre class="code bash">        <span class="br0">&#91;</span><span class="sy0">&gt;</span>....................<span class="br0">&#93;</span>  reshape =  <span class="nu0">3.7</span><span class="sy0">%</span> <span class="br0">&#40;</span><span class="nu0">195980</span><span class="sy0">/</span><span class="nu0">5237760</span><span class="br0">&#41;</span> <span class="re2">finish</span>=54.6min <span class="re2">speed</span>=1536K<span class="sy0">/</span>s</pre>

<p>
11) Indiquer que le disque désiré doit être supprimé. 
</p>
<pre class="code bash">        <span class="kw2">sudo</span> mdadm <span class="sy0">/</span>dev<span class="sy0">/</span>md55 <span class="re5">--fail</span> <span class="sy0">/</span>dev<span class="sy0">/</span>sdd7
        mdadm: <span class="kw1">set</span> <span class="sy0">/</span>dev<span class="sy0">/</span>sdd7 faulty <span class="kw1">in</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md55</pre>

<p>
Il ne reste plus qu&#039;à surveiller et patienter.
</p>
<pre class="code bash">        <span class="br0">&#91;</span>===<span class="sy0">&gt;</span>.................<span class="br0">&#93;</span>  recovery = <span class="nu0">18.2</span><span class="sy0">%</span> <span class="br0">&#40;</span><span class="nu0">956360</span><span class="sy0">/</span><span class="nu0">5237760</span><span class="br0">&#41;</span> <span class="re2">finish</span>=10.0min <span class="re2">speed</span>=7107K<span class="sy0">/</span>sec</pre>

<p>
Si, par chance, le disque à retirer  était un disque de sécurité, l&#039;opération est immédiate et n&#039;était pas nécessaire. <br/>

</p>

<p>
12) Enlever le disque désiré du raids.
</p>
<pre class="code bash">        <span class="kw2">sudo</span> mdadm <span class="sy0">/</span>dev<span class="sy0">/</span>md55 <span class="re5">--remove</span> <span class="sy0">/</span>dev<span class="sy0">/</span>sdd7
        mdadm: hot removed <span class="sy0">/</span>dev<span class="sy0">/</span>sdd7 from <span class="sy0">/</span>dev<span class="sy0">/</span>md55</pre>

<p>
13) Itérer sur les actions décrites aux points  10 11 et 12.<br/>

Si la commande de suppression du  disque donne ce retour
</p>
<pre class="code bash">        <span class="kw2">sudo</span> mdadm <span class="re5">--grow</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md55 <span class="re5">--raid-devices</span>=<span class="nu0">4</span> <span class="re5">--backup-file</span> <span class="sy0">/</span>home<span class="sy0">/</span>md55
        mdadm: this change will reduce the <span class="kw2">size</span> of the array.
        use <span class="re5">--grow</span> <span class="re5">--array-size</span> first to truncate array.
        e.g. mdadm <span class="re5">--grow</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md55 <span class="re5">--array-size</span> <span class="nu0">15713280</span></pre>

<p>
La tentation est grande de faire un copier/coller de la commande proposée.<br/>

Elle fonctionne très bien! La taille du RAID devient alors  nettement plus petite que le système de fichier qu&#039;il héberge.<br/>

Le système de fichier ne sera plus montable ni réparable.<br/>

Le logiciel aurait du proposer la commande suivante:
</p>
<pre class="code bash">        resize2fs  <span class="sy0">/</span>dev<span class="sy0">/</span>md55  15713280K</pre>

<p>
Mais il ne connaît absolument pas le système de fichier qu&#039;il héberge et ne peut donc pas le faire!!!<br/>

Il est nécessaire de faire la commande de resize. Si celle-ci ne fonctionne pas il n&#039;y a pas de solution mais c&#039;était très probablement une erreur de calcul dans le nombre de disques pouvant être enlevés ou une implantation de fichiers laissant des &quot;trous&quot;!
</p>

</div>
<div class='secedit editbutton_section editbutton_16'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Que faire pour diminuer l&#039;array ? - Supprimer un disque?] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="que_faire_pour_diminuer_l_array_-_supprimer_un_disque" /><input type="hidden" name="codeblockOffset" value="28" /><input type="hidden" name="range" value="21284-29176" /><button type="submit" title="Que faire pour diminuer l&#039;array ? - Supprimer un disque?" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit17" id="comment_migrer_les_donnees_vers_une_nouvelle_machine">Comment migrer les données vers une nouvelle machine ?</h3>
<div class="level3">

<p>
Cette partie va montrer comment migrer les données d&#039;un RAID à un autre RAID. Je vais considérer qu&#039;il s&#039;agit ici de la création d&#039;une nouvelle machine pour recouvrir tous les aspects du problème.
Il faut d&#039;abord créer le nouveau RAID comme décrit dans la partie précédente. Et ré-assembler le RAID existant de façon à les faire cohabiter le temps de la copie des données.
Pour cela il faut créer un nouveau fichier FIFO mais pour ne pas rentrer en conflit avec le fichier existant nous allons lui donner l&#039;identifiant 1 :
</p>
<pre class="code">mknod /dev/md1 b 9 1</pre>

<p>
Ensuite il ne reste plus qu&#039;à démarrer le vieux RAID comme suit :
</p>
<pre class="code">mdadm -A /dev/md1 --update=super-minor -m0 /dev/sd... /dev/sd...</pre>

<p>
La commande précédente demande l&#039;assemblage en mettant à jour les informations d&#039;identification. Le paramètre -m0 s&#039;assure que nous utiliserons que les disques/partitions qui avaient un identifiant 0.
</p>
<div class="noteimportant"> <pre class="code bash"><span class="kw2">sudo</span> mdadm <span class="re5">--assemble</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md2   <span class="re5">--update</span>=super-minor  <span class="sy0">/</span>dev<span class="sy0">/</span>sdc11  <span class="sy0">/</span>dev<span class="sy0">/</span>sdc12  <span class="sy0">/</span>dev<span class="sy0">/</span>sdc13  <span class="sy0">/</span>dev<span class="sy0">/</span>sdc14</pre>

<p>
mdadm: –update=super-minor not understood for 1.x metadata
</p>

</div><div class="noteclassic"><pre class="code">sudo mdadm --assemble /dev/md2  --run /dev/sdc11   /dev/sdc12  /dev/sdc13  /dev/sdc14</pre>

<p>
mdadm: /dev/md2 has been started with 3 drives (out of 4) and 1 rebuilding.
</p>

</div>
<p>
Pour s&#039;assurer que tout s&#039;est bien passé vous pouvez afficher les informations mdadm :
</p>
<pre class="code">cat /proc/mdstat</pre>

<p>
La sortie devrait ressembler à cela :
</p>
<pre class="code">md1 : active raid5 sda[0] sdb[3] sde[2] sdf[1]
      1465159488 blocks level 5, 128k chunk, algorithm 2 [4/4] [UUUU]
      
md0 : active raid5 sdc[0] sdg[2] sdd[1]
      1953524992 blocks level 5, 128k chunk, algorithm 2 [3/3] [UUU]</pre>

<p>
Si vous voulez faire persister les informations sur ce RAID vous pouvez passer la commande suivante :
</p>
<pre class="code">mdadm --daemonise /dev/md1</pre>

</div>
<div class='secedit editbutton_section editbutton_17'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Comment migrer les données vers une nouvelle machine ?] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="comment_migrer_les_donnees_vers_une_nouvelle_machine" /><input type="hidden" name="codeblockOffset" value="47" /><input type="hidden" name="range" value="29177-31134" /><button type="submit" title="Comment migrer les données vers une nouvelle machine ?" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit18 page-header" id="problemes_solutions_courantes">Problèmes &amp; solutions courantes</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_18'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Problèmes &amp; solutions courantes] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="problemes_solutions_courantes" /><input type="hidden" name="codeblockOffset" value="54" /><input type="hidden" name="range" value="31135-31179" /><button type="submit" title="Problèmes &amp; solutions courantes" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit19" id="que_faire_si_je_n_arrive_plus_a_acceder_a_mon_raid">Que faire si je n&#039;arrive plus à accéder à mon raid</h3>
<div class="level3">

<p>
Ne pas agir à la hâte !
</p>
<div class="notewarning">En particulier <strong>ne jamais utiliser</strong>
<pre class="code">mdadm --create ...</pre>

<p>
 pour réassembler une grappe existante, à moins d&#039;être guidé par un expert. 
Car c&#039;est certainement un des meilleurs moyen de rendre votre grappe raid irrécupérable. (Même si dans certains cas, et en particulier après avoir trop bidouillé, ça peut être le seul moyen de réassembler votre raid)
</p>

</div>
<p>
Essayez d&#039;abord des choses simples : 
</p>

<p>
Si une grappe raid s&#039;avère inutilisable, commencez par l&#039;arrêter avec 
</p>
<pre class="code">mdadm --stop ...</pre>

<p>
 (Souvent l&#039;activation d&#039;un grappe raid qui échoue crée un périphérique inutilisable et verrouille tous les composant de la grappe)
</p>

<p>
<br/>

Ensuite tentez de relancer l&#039;assemblage avec 
</p>
<pre class="code">mdadm --assemble ...</pre>

<p>
 Rien de mal ne peut être fait par cette commande sauf avec certaines options supplémentaires. 
</p>
<div class="notewarning"><strong>n&#039;utilisez surtout pas</strong> les options - -force ou - -update sans demander l&#039;avis d&#039;un expert. Car si pour une raison ou une autre les composants ne sont pas à leurs place (risque surtout d&#039;arriver si vous avez d&#039;abord tenté de réassembler avec mdadm - -create …) cela risque de provoquer une resynchronisation qui va remplacer des données valides par des données incorrecte)

</div>
<p>
<br/>

Vous pouvez éventuellement forcer l&#039;activation d&#039;une grappe incomplète (s&#039;il manque un seul disque sur un raid 1 ou 5) en ajoutant les options - -run - -read-only 
</p>
<pre class="code">mdadm --assemble --run --read-only ...</pre>

<p>
 Si l&#039;utilisation de l&#039;option - -run à permis l&#039;assemblage, examinez ensuite le contenu de vos systèmes de fichier, et profitez en pour faire une sauvegarde de vos données, avant de tenter de réintroduire un disque manquant.
</p>
<div class="notewarning">N&#039;utilisez pas <pre class="code">mdadm --add, --re-add, --fail, --remove, ou --replace</pre>

<p>
 pour résoudre un problème d&#039;activation et d&#039;accès à la grappe raid. Ca n&#039;a aucun sens, et ne peut que compliquer la remise en état de votre raid.
</p>

</div><div class="noteimportant">Et si vous n&#039;arrivez pas à assembler votre raid avec les recommandations ci-dessus. Copiez tout les disques de la grappe raid individuellement avant de tenter autre chose (et ceci même si vous vous faites aider par un expert !)
<p>
Et si vous êtes amené à utiliser mdadm - -create pour réassembler votre grappe, l&#039;utilisation de l&#039;option - -assume-clean <strong>est impérative</strong>
</p>

</div>
</div>
<div class='secedit editbutton_section editbutton_19'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Que faire si je n&#039;arrive plus à accéder à mon raid] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="que_faire_si_je_n_arrive_plus_a_acceder_a_mon_raid" /><input type="hidden" name="codeblockOffset" value="54" /><input type="hidden" name="range" value="31180-33638" /><button type="submit" title="Que faire si je n&#039;arrive plus à accéder à mon raid" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit20" id="probleme_de_taille_de_block_superblock">Problème de taille de block &amp; superblock</h3>
<div class="level3">

<p>
Si en faisant une vérification, vous obtenez ceci :
</p>
<pre class="code">La taille du système de fichiers (selon le superbloc) est de 7727257 blocs
La taille physique du périphérique est de 7727232 blocs
Le superbloc ou la table des partitions est peut-être corrompue !</pre>

<p>
ou ceci  (au boot par exemple):
</p>
<pre class="code">my_documents: The filesystem size (according to the superblock) is 7727257 blocks
The physical size of the device is 7727232 blocks
Either the superblock or the partition table is likely to be corrupt!

my_documents: UNEXPECTED INCONSISTENCY; RUN fsck MANUALLY.
	(i.e., without -a or -p options)</pre>

<p>
Cela provient certainement du fait que vous avez construit le raid sans recréer un système de fichier par dessus !  Dans ce cas faites ceci :
</p>
<pre class="code">e2fsck -f /dev/mdX</pre>

<p>
 (où X est la partition raid) et <strong>sans</strong> interrompre, taper &#039;n&#039; et laisser continuer (si vous n&#039;avez pas de backup faites le avant, on ne sait jamais). Une fois fini faites :
</p>
<pre class="code">resize2fs /dev/mdX</pre>

<p>
Cela va redimensionner la partition en fonction des info du superblock. pour être sûr revérifier (via e2fsck) la partition et cela devrait aller sans aucun problème !
</p>

</div>
<div class='secedit editbutton_section editbutton_20'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Problème de taille de block &amp; superblock] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="probleme_de_taille_de_block_superblock" /><input type="hidden" name="codeblockOffset" value="59" /><input type="hidden" name="range" value="33639-34859" /><button type="submit" title="Problème de taille de block &amp; superblock" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit21" id="device_or_ressource_busy">Device or ressource busy ...</h3>
<div class="level3">

<p>
Si, au démarrage, vous avec un message du genre :
</p>
<blockquote><div class="no">
fsck.ext3: Device or resource busy while trying to open /dev/sdbX<br/>
Filesystem mounted or opened exclusively by another program?</div></blockquote>

<p>
Alors que /dev/sdX est un membre du raid et n&#039;est pas lui-même présent dans fstab, cette solution peut peut-être vous aider : 
(on sauvegarde pour le cas où …)
</p>
<pre class="code">sudo mv /etc/blkid.tab /etc/blkid.tab.baktimeofday</pre>

<p>
Ensuite redémarrer cela devrait être résolu.
</p>

</div>
<div class='secedit editbutton_section editbutton_21'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Device or ressource busy ...] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="device_or_ressource_busy" /><input type="hidden" name="codeblockOffset" value="63" /><input type="hidden" name="range" value="34860-35359" /><button type="submit" title="Device or ressource busy ..." class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit22" id="md127">md127</h3>
<div class="level3">
<div class="notetip">Rien ne prouve que le changement de nom soit grave. Il est même possible que les nouveaux O.S. numérotent à partir de 127 en décroissant. Faites très attention lors de vos corrections. Commencer par vérifier que vos données sont sauvées avant de vouloir rectifier.
</div><div class="noteclassic">En changeant de système un RAID1 mdadm, la grappe peut-être reconnu comme /dev/md127
<pre class="code bash"><span class="kw2">cat</span> <span class="sy0">/</span>proc<span class="sy0">/</span>mdstat
Personalities : <span class="br0">&#91;</span>raid1<span class="br0">&#93;</span> <span class="br0">&#91;</span>linear<span class="br0">&#93;</span> <span class="br0">&#91;</span>multipath<span class="br0">&#93;</span> <span class="br0">&#91;</span>raid0<span class="br0">&#93;</span> <span class="br0">&#91;</span>raid6<span class="br0">&#93;</span> <span class="br0">&#91;</span>raid5<span class="br0">&#93;</span> <span class="br0">&#91;</span>raid4<span class="br0">&#93;</span> <span class="br0">&#91;</span>raid10<span class="br0">&#93;</span> 
md127 : active <span class="br0">&#40;</span>auto-read-only<span class="br0">&#41;</span> raid1 sda1<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span> sdb1<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span>
      <span class="nu0">488385472</span> blocks <span class="br0">&#91;</span><span class="nu0">2</span><span class="sy0">/</span><span class="nu0">2</span><span class="br0">&#93;</span> <span class="br0">&#91;</span>UU<span class="br0">&#93;</span>
&nbsp;
unused devices: <span class="sy0">&lt;</span>none<span class="sy0">&gt;</span></pre>

<p>
La méthode donnée sur ce lien a bien fonctionné avec une <a href="/xenial" class="wikilink1" title="xenial">Ubuntu 16.04</a>
</p>

<p>
<del><a href="https://www.leforuminfo.com/index.php/articles-53/34-linux/64-renomme-un-raid-md127" class="urlextern" title="https://www.leforuminfo.com/index.php/articles-53/34-linux/64-renomme-un-raid-md127" rel="nofollow">renommer-un-raid-md127</a></del>
</p>
<pre class="code bash"><span class="co0">#tout oublier et rescanner</span>
<span class="kw2">sudo</span> mdadm <span class="re5">-Ss</span> 
<span class="co0"># Assembler l' Array pré-existante (à adapter)</span>
<span class="kw2">sudo</span> mdadm <span class="re5">-A</span> <span class="sy0">/</span>dev<span class="sy0">/</span>md0 <span class="sy0">/</span>dev<span class="sy0">/</span>sd<span class="br0">&#91;</span>ab<span class="br0">&#93;</span><span class="nu0">1</span>
<span class="co0"># s'en souvenir </span>
<span class="kw2">sudo</span> mdadm <span class="re5">--detail</span> <span class="re5">--scan</span> <span class="sy0">&gt;&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>mdadm<span class="sy0">/</span>mdadm.conf
<span class="co0"># mettre à jour initrd</span>
<span class="kw2">sudo</span> update-initramfs <span class="re5">-v</span> <span class="re5">-u</span>
<span class="co0"># vous pouvez redémarrer /dev/md0 sera présent.</span>
<span class="kw2">sudo</span> reboot</pre>

</div>
<p>
Avec la version <strong>16.04.1</strong> et une ligne de création toute simple:
</p>
<pre class="code">sudo mdadm --create /dev/md0 --level=1 --raid-devices=2 --name=MesDaTaRAIDS0 /dev/sdb12 /dev/sdc17</pre>
<pre class="code">sudo mdadm --create /dev/md1 --level=1 --raid-devices=2 --name=MesDaTaRAIDS1 /dev/sdc18 /dev/sdc19</pre>
<pre class="code">sudo mdadm --create /dev/md2 --level=1 --raid-devices=2                                           /dev/sdc20 /dev/sdc20</pre>

<p>
et faire  le montage des partitions md127     md126   et md125 .    Il semble que tout fonctionne.
</p>

<p>
Avec <a href="/precise" class="wikilink1" title="precise"> Ubuntu 12.04</a>
Si votre RAID est non fonctionnel et reconnu comme /dev/md127
</p>

<p>
Cette erreur semble principalement apparaître lors d&#039;une création de volume RAID avec l’outil graphique  <a href="/gnome-disk-utility" class="wikilink1" title="gnome-disk-utility">palimpsest</a> (inclus dans gnome-disk-utility).
</p>

<p>
Il faut commencer par récupérer le numéro de UUID de votre volume RAID. Pour ce faire, il faut que votre RAID soit monté avec l&#039;outil graphique puis depuis un terminal taper la commande suivante :
</p>
<pre class="code">sudo mdadm -Es</pre>

<p>
Vous devez avoir ce type de résultat avec le numéro de UUID :
</p>
<pre class="code">ARRAY [...] level=raid1 metadata=1.2 num-devices=2 UUID=ed684f7c:0756fe74:cd2238a8:62f7ed56 [...]</pre>

<p>
Déclarer votre volume RAID dans /etc/mdadm/mdadm.conf (Toujours avec vos valeurs et pas forcement md0 s&#039;il est utilisé par un autre disque) :
</p>
<pre class="code">ARRAY /dev/md0 level=raid1 metadata=1.2 num-devices=2 UUID=UUID de votre volume RAID</pre>

<p>
Exemple extrait d&#039;un des threads ci-dessous :
</p>
<pre class="code">ARRAY /dev/md0 level=raid1 metadata=1.2 num-devices=2 UUID=ed684f7c:0756fe74:cd2238a8:62f7ed56</pre>

<p>
Éventuellement ajouter votre volume dans  /etc/fstab (pour le montage au démarrage du système) après avoir créé votre point de montage (ici →/media/VolumeRAID)  :
</p>
<pre class="code">/dev/md0	/media/VolumeRAID	ext4	defaults	0	0</pre>

<p>
Mettre à jour <a href="https://wiki.ubuntu.com/Initramfs" class="urlextern" title="https://wiki.ubuntu.com/Initramfs" rel="nofollow">initramfs</a> afin de prendre en compte votre fichier mdadm.conf au démarrage :
</p>
<pre class="code">sudo update-initramfs -u</pre>

<p>
De nombreux threads traitent de ce sujet (étonnamment toujours pas résolu !):
</p>
<div class="notetip">Ce phénomène est lié à la présence de la variable &#039;name=xxxx:0&#039; dans la ligne de configuration de mdadm.conf.
<p>
En supprimant cette variable de la ligne et après avoir mis à jour &#039;initramfs&#039;, le problème disparaît.
</p>

</div>
<p>
<a href="http://forum.ubuntu-fr.org/viewtopic.php?id=372346" class="urlextern" title="http://forum.ubuntu-fr.org/viewtopic.php?id=372346" rel="nofollow">http://forum.ubuntu-fr.org/viewtopic.php?id=372346</a>
</p>

<p>
<a href="http://ubuntuforums.org/showthread.php?t=1764861" class="urlextern" title="http://ubuntuforums.org/showthread.php?t=1764861" rel="nofollow">http://ubuntuforums.org/showthread.php?t=1764861</a>
</p>

<p>
<a href="http://ubuntuforums.org/showthread.php?t=1468064" class="urlextern" title="http://ubuntuforums.org/showthread.php?t=1468064" rel="nofollow">http://ubuntuforums.org/showthread.php?t=1468064</a>
</p>

<p>
<a href="http://ubuntuforums.org/archive/index.php/t-1883173.html" class="urlextern" title="http://ubuntuforums.org/archive/index.php/t-1883173.html" rel="nofollow">http://ubuntuforums.org/archive/index.php/t-1883173.html</a>
</p>

<p>
<a href="https://forum.ubuntu-fr.org/viewtopic.php?id=1997683" class="urlextern" title="https://forum.ubuntu-fr.org/viewtopic.php?id=1997683" rel="nofollow">https://forum.ubuntu-fr.org/viewtopic.php?id=1997683</a>
</p>

<p>
<a href="https://forum.ubuntu-fr.org/viewtopic.php?pid=22383805#p22383805" class="urlextern" title="https://forum.ubuntu-fr.org/viewtopic.php?pid=22383805#p22383805" rel="nofollow">https://forum.ubuntu-fr.org/viewtopic.php?pid=22383805#p22383805</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_22'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[md127] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="md127" /><input type="hidden" name="codeblockOffset" value="64" /><input type="hidden" name="range" value="35360-39213" /><button type="submit" title="md127" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit23" id="droits_d_ecriture">Droits d&#039;écriture</h3>
<div class="level3">

<p>
Lorsque votre RAID est activé automatiquement au boot, il se peut qu&#039;en le montant avec le gestionnaire de fichier Nautilus, vous n&#039;ayez pas les droits d&#039;écriture.
</p>

<p>
Pour corriger cela, il faut d&#039;abord localiser le point de montage et vérifier les propriétés :
</p>
<pre class="code">ls -l /media
total 8
drwxr-xr-x 2 root root 4096 juil.  7 02:03 cdrom
drwxr-xr-x 3 root disk 4096 nov.  30 15:48 my_raid</pre>

<p>
On voit que le montage est réalisé sur &#039;/media/my_raid&#039; appartient à &#039;root&#039; et a pour groupe &#039;disk&#039;, mais que seul &#039;root&#039; peut écrire.
Il faut remédier à cela en intégrant votre utilisateur dans le groupe &#039;disk&#039; et en autorisant l&#039;écriture dans le RAID pour ce groupe.
</p>
<pre class="code">sudo adduser &lt;votre_nom&gt; disk
sudo chmod -R 775 /media/my_raid</pre>

<p>
Vous aurez maintenant, en tant que membre du groupe &#039;disk&#039;, le droit d&#039;écrire.
</p>

<p>
Si cela ne résout pas le problème, une solution peut consister à déplacer le point de montage de /media/raid vers /media/user/raid. En effet, comme indiqué <a href="/montage" class="wikilink1" title="montage">ici</a> (2.3), « Depuis quelques versions (16.04 ?), il existe un point de montage dédié à ces montages ponctuels dans le répertoire /media, et il porte votre nom. Ainsi, si vous avez choisis comme nom utilisateur fred, il existe un répertoire /media/fred. Il est intéressant d&#039;utiliser ce répertoire (ou un répertoire dans votre compte utilisateur normal), car les montages qui ne sont pas faits dans votre compte /home/user ou dans /media/user ne sont pas visibles dans votre gestionnaire de fichiers (mais ils fonctionnent). »
</p>

</div>
<div class='secedit editbutton_section editbutton_23'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Droits d&#039;écriture] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="droits_d_ecriture" /><input type="hidden" name="codeblockOffset" value="75" /><input type="hidden" name="range" value="39214-40790" /><button type="submit" title="Droits d&#039;écriture" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit24 page-header" id="des_idees_pour_aller_plus_loin">Des idées pour aller plus loin</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_24'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Des idées pour aller plus loin] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="des_idees_pour_aller_plus_loin" /><input type="hidden" name="codeblockOffset" value="77" /><input type="hidden" name="range" value="40791-40836" /><button type="submit" title="Des idées pour aller plus loin" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit25" id="decoupage_du_volume_avec_lvm">Découpage du volume avec LVM</h3>
<div class="level3">

<p>
Lorsque l&#039;on crée un volume RAID, on se retrouve vite avec de capacités très importantes. Or, créer un seul système de ficher de 500 Go, voire beaucoup plus, n&#039;est pas forcement une bonne idée ! Pour pouvoir découper cet espace de stockage à volonté et pouvoir créer autant de système de fichier que nécessaire (et les redimensionner au besoin) il peut être très intéressant d&#039;utiliser, &quot;au dessus&quot; du RAID la fonctionnalité LVM :
</p>

<p>
<a href="/lvm" class="wikilink1" title="lvm">lvm</a>
</p>

<p>
Il existe aussi la possibilité de mettre du  <a href="https://raid.wiki.kernel.org/index.php/Initial_Array_Creation" class="urlextern" title="https://raid.wiki.kernel.org/index.php/Initial_Array_Creation" rel="nofollow">RAID</a>  à l&#039;intérieur d&#039;un LVM.
</p>

</div>
<div class='secedit editbutton_section editbutton_25'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Découpage du volume avec LVM] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="decoupage_du_volume_avec_lvm" /><input type="hidden" name="codeblockOffset" value="77" /><input type="hidden" name="range" value="40837-41482" /><button type="submit" title="Découpage du volume avec LVM" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit26" id="la_combinaison_des_niveaux_de_raid">La combinaison des niveaux de RAID</h3>
<div class="level3">

<p>
Vous pouvez très bien combiner les niveaux de RAID. 
La manière la moins onéreuse de créer un RAID combiné est d&#039;effectuer plusieurs RAID matériels puis de les combiner entre eux au niveau logiciel. 
</p>

<p>
On pourra prendre comme exemple le RAID 1,0 qui fonctionne très bien.
Imaginons que nous ayons 6 disques durs de 30Go, plus un disque dur système et trois cartes-filles supportant le RAID 1. Créons donc trois ensembles RAID 1 (mirroring) qui feront tous 30Go. 
Appliquons ensuite un RAID 0 au niveau logiciel. 
On possède alors un seul ensemble de 90Go (3 x 30Go) et une tolérance de panne de trois disques durs (1 par unité RAID 1).
</p>

</div>
<div class='secedit editbutton_section editbutton_26'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[La combinaison des niveaux de RAID] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="la_combinaison_des_niveaux_de_raid" /><input type="hidden" name="codeblockOffset" value="77" /><input type="hidden" name="range" value="41483-42192" /><button type="submit" title="La combinaison des niveaux de RAID" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit27" id="un_disque_de_sparevotre_roue_de_secours_en_cas_de_defaillance">Un disque de spare : votre roue de secours en cas de défaillance</h3>
<div class="level3">

<p>
Pour ceux qui sont intéressés par la commande mdadm, sachez qu&#039;elle possède d&#039;autres options. L&#039;une de ses options permet notamment d&#039;ajouter un disque de spare, c&#039;est-à-dire un disque &quot;dormant&quot;, qui prend la relève dès qu&#039;un disque tombe en panne. Cela vous permet une plus grande tolérance de panne. 
</p>

<p>
Voici l&#039;option permettant de prendre en compte un disque de spare : 
</p>
<pre class="code">mdadm --create /dev/md0 --level=1 --raid-devices=2 --spare-devices=1 /dev/sdX</pre>

<p>
Par contre, si vous avez déjà un array RAID en service, sur sda2 et sdb2, et que vous voulez ajouter le spare sdc2 (préalablement partitionné à l&#039;identique avec sfdisk par exemple) :
</p>
<div class="noteclassic">Afin de créer un disque de spare, il nous faut lui donner le même partitionnement que les autres disques du RAID. Pour cela, la commande sfdisk va nous aider.
</div>
<p>
Une fois votre disque supplémentaire connecté, il vous faut créer les mêmes partitions, pour cela tapez en root dans un terminal (sudo -i, ou sudo bash je vous le rappelle) :
</p>
<pre class="code">sfdisk -d /dev/sda &gt; sda.out
sfdisk /dev/sdc &lt; sda.out</pre>

<p>
ou sda est le disque &quot;source&quot;, et sdc le disque &quot;target&quot;
</p>
<pre class="code">mdadm --manage /dev/md0 --add /dev/sdc2</pre>

<p>
Vérifiez alors en tapant :
</p>
<pre class="code">mdadm --detail /dev/md0</pre>

<p>
Et vous verrez votre nouveau disque sdc2 comme spare disk.
</p>

</div>
<div class='secedit editbutton_section editbutton_27'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Un disque de spare : votre roue de secours en cas de défaillance] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="un_disque_de_sparevotre_roue_de_secours_en_cas_de_defaillance" /><input type="hidden" name="codeblockOffset" value="77" /><input type="hidden" name="range" value="42193-43602" /><button type="submit" title="Un disque de spare : votre roue de secours en cas de défaillance" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit28" id="test">Test</h3>
<div class="level3">

<p>
Pour tester, et être sûr que tout fonctionne, faisons un test (qui revient à débrancher un disque) :
</p>
<pre class="code">mdadm --manage /dev/md0 --set-faulty /dev/sdb
mdadm --manage /dev/md0 --remove /dev/sdb</pre>

<p>
Alors le spare disque (ou le miroir…) prend le relais automatiquement.
Si vous n&#039;avez pas de spare, remettez le disque en service :
</p>
<pre class="code">mdadm --manage /dev/md0 --add /dev/sdb</pre>

<p>
Constatez la reconstruction avec :
</p>
<pre class="code">cat /proc/mdstat</pre>

<p>
Chaque disque retiré puis remis fera une reconstruction complète. Pour un array de 40 Go, comptez 15 min pour atteindre les 100% (60 mo/s environ). Évitez de rebooter la machine pendant la progression.
</p>

<p>
Sans simuler la défaillance d&#039;un disque, voici un outil qui vous permettra de vérifier si vos disques sont bien synchronisés, le test sera long. voir <em>/usr/share/mdadm/checkarray  –help</em> pour plus d&#039;options.
</p>
<pre class="code">sudo /usr/share/mdadm/checkarray  /dev/md0</pre>

<p>
Pour ceux qui fouillent un peu, les fichiers de configurations sont
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li">  file:///etc/default/mdadm </div>
</li>
<li class="level1"><div class="li">  file:///etc/mdadm/mdadm.conf</div>
</li>
</ul>
<div class="notewarning">Si vous découvez que ces fichiers de configuration ne sont plus à jour, il est possible de les regénérer en ligne de commande <pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">bash</span> <span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>mdadm<span class="sy0">/</span>mkconf <span class="sy0">|</span> <span class="kw2">sudo</span> <span class="kw2">tee</span> <span class="sy0">/</span>etc<span class="sy0">/</span>mdadm<span class="sy0">/</span>mdadm.conf <span class="sy0">&amp;&amp;</span> <span class="kw2">sudo</span> update-initramfs <span class="re5">-u</span> </pre>



</div>
</div>
<div class='secedit editbutton_section editbutton_28'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Test] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="test" /><input type="hidden" name="codeblockOffset" value="81" /><input type="hidden" name="range" value="43603-44976" /><button type="submit" title="Test" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit29" id="supervision_du_raid">Supervision du RAID</h3>
<div class="level3">

<p>
Dans le fichier mdadm.conf ou lorsque l&#039;on utilise mdadm en mode monitoring il est possible de se faire envoyer un email lorsqu&#039;il y a un évènement qui se produit, c&#039;est bien, c&#039;est le comportement par défaut, mais si on n&#039;est pas sur un serveur (et même dans ce cas) ce n&#039;est pas toujours l&#039;idéal. Enfin, rien ne vous empêche d&#039;installer <a href="/messagerie_intranet" class="wikilink1" title="messagerie_intranet">mailx</a>
</p>

<p>
L&#039;idéal serait donc :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Des traces d&#039;évènement dans les log système</div>
</li>
<li class="level1"><div class="li"> Un script d&#039;alerte perso.</div>
</li>
</ul>

<p>
Pour les logs système, si vous utilisez la ligne de commande suivante :
</p>
<pre class="code">mdadm --monitor --syslog --delay=1800 /dev/md0
#équivalent à mdadm --monitor -y --delay=1800 /dev/md0</pre>

<p>
Ou encore, via le fichier de configuration /etc/mdadm/mdadm.conf en ajoutant :
</p>
<pre class="code"># START_DAEMON:
#   should mdadm start the MD monitoring daemon during boot?
START_DAEMON=true

# DAEMON_OPTIONS:
#   additional options to pass to the daemon.
DAEMON_OPTIONS=&quot;--syslog&quot;</pre>

<p>
Cependant, le mieux et le plus intéressant reste un script maison. Plusieurs paramètres sont fournis par mdadm :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1 node"><div class="li"> $1 : chaîne de caractères décrivant ce qui s&#039;est passé repris parmi celle-ci :</div>
<ul class=" fix-media-list-overlap">
<li class="level2"><div class="li"> SparesMissing : spare disque manquant</div>
</li>
<li class="level2"><div class="li"> Fail : un ou plusieurs disques défectueux</div>
</li>
<li class="level2"><div class="li"> RebuildStarted : un nouveau disque est présent et une reconstruction a débuté</div>
</li>
<li class="level2"><div class="li"> Rebuild20, 40, 60, 80 : reconstruction en cours à 20, 40, 60 ou 80%</div>
</li>
<li class="level2"><div class="li"> RebuildFinished : la reconstruction vient de finir</div>
</li>
<li class="level2"><div class="li"> SpareActive : disque spare vient d&#039;être ajouté à un array</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> $2 : nom du disque raid md concerné, par exemple /dev/md2</div>
</li>
<li class="level1"><div class="li"> $3 : disque concerné, par exemple /dev/sda5</div>
</li>
</ul>

<p>
Un exemple de programme se trouve localement
</p>

<p>
Pour tester son programme on peut utiliser ceci :
</p>
<pre class="code">sudo mdadm --monitor --scan --oneshot --test --program /cheminversmonprogramme</pre>

<p>
Afin de l&#039;ajouter, 2 chemins sont possibles :
ligne de commande, si vous lancez le RAID de cette manière :
</p>
<pre class="code">mdadm --monitor --alert /cheminversmonprogramme --delay=180 /dev/md0
#ou -p ou --programm
#par defaut le delay est de 60 secondes</pre>

<p>
Ou encore, via le fichier de configuration /etc/mdadm/mdadm.conf en ajoutant :
</p>
<pre class="code"># PROGRAM
# programme qui sera exécuté en cas d&#039;évènement
PROGRAM /cheminversmonprogramme</pre>

</div>
<div class='secedit editbutton_section editbutton_29'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Supervision du RAID] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="supervision_du_raid" /><input type="hidden" name="codeblockOffset" value="86" /><input type="hidden" name="range" value="44977-47346" /><button type="submit" title="Supervision du RAID" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit30" id="creation_d_un_raid_sans_avoir_tous_les_disques">Création d&#039;un RAID sans avoir tous les disques</h3>
<div class="level3">

<p>
Il est possible de créer un RAID sans avoir tous les disques au moment de la création. Pour cela au lieu de préciser /dev/sdXY on mettra missing.
Par exemple, dans le cas ci-dessous il faudra ajouter un disque plus tard :
</p>
<pre class="code">mdadm -C /dev/md0 -l1 -n2 /dev/sda1 missing</pre>

<p>
N.B.:
</p>

<p>
Pour créer un RAID 10 avec seulement deux disques, les deux autres disques, marqués comme manquants, devront être alternés avec ceux présents :
</p>
<pre class="code">mdadm --create /dev/md0 --level=10 --raid-devices=4 /dev/sda1 missing  /dev/sdb1 missing</pre>

<p>
Si l&#039;on met deux missing à la suite, cela ne fonctionne pas
</p>

<p>
Ensuite il suffit d&#039;ajouter le (ou les) disque(s) manquant(s) via :
</p>
<pre class="code">mdadm --manage /dev/md0 --add /dev/sdb1</pre>

<p>
Attention, ne pas oublier de regarder que la reconstruction du disque est finie *AVANT* de redémarrer, via 
</p>
<pre class="code">cat /proc/mdstat</pre>

</div>
<div class='secedit editbutton_section editbutton_30'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Création d&#039;un RAID sans avoir tous les disques] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="creation_d_un_raid_sans_avoir_tous_les_disques" /><input type="hidden" name="codeblockOffset" value="91" /><input type="hidden" name="range" value="47347-48274" /><button type="submit" title="Création d&#039;un RAID sans avoir tous les disques" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit31" id="creation_d_un_raid1_sans_avoir_tous_les_disques_et_sans_copie">Création d&#039;un RAID1 sans avoir tous les disques et sans copie</h3>
<div class="level3">

<p>
Dans l&#039;exemple qui suit, on va mettre la partition /dev/sda4 en mirroir avec la partition /dev/sdb4. Cette procédure ne fait pas appel au rsync pour la copie, mais utilise la recopie du mdadm. Ce qui permet une remise en service plus rapide.
</p>

<p>
L&#039;exemple est fait pour une partition en ext2/ext3/ext4. Pour le reiserfs c&#039;est aussi faisable mail il faut ajuster les commandes (resize_reiserfs au lieu de e2fsck et resize2fs)
</p>

<p>
On démonte le file system, puis on calcule la nouvelle taile du file system car le RAID1 va rajoute un bloc de contrôle :
</p>
<pre class="code">
cd &amp;&amp; umount /dev/sda4
TAILLE_INITIAL=$(fdisk -l /dev/sda4 2&gt;/dev/null|grep &quot;/dev/sda4&quot; |cut -d &quot;,&quot; -f2| cut -d &quot; &quot; -f2)
TAILLE_F=$(( $(( TAILLE_INITIAL / 1024 )) - 12 ))K
echo $TAILLE_INITIAL
echo $TAILLE_F

e2fsck -f /dev/sda4
resize2fs /dev/sda4 $TAILLE_F</pre>

<p>
Ici a partition est prete a accueillir le bloc de controle du raid.
On construit le RAID
</p>
<pre class="code">mdadm --create /dev/md0 --metadata=1.0 --level=1 --raid-devices=2 missing /dev/sda4
	mdadm: /dev/sda4 appears to contain an ext2fs file system
		size=3979656K  mtime=Fri Mar 11 20:21:34 2011
	Continue creating array? y
	mdadm: array /dev/md0 started.

e2fsck -f /dev/md0
	e2fsck 1.41.12 (17-May-2010)
	La taille du système de fichiers (selon le superbloc) est de 525013 blocs
	La taille physique du périphérique est de 524992 blocs
	Le superbloc ou la table des partitions est peut-être corrompue !
	Arrêter&lt;o&gt;? non
	
	Passe 1 : vérification des i-noeuds, des blocs et des tailles
	Passe 2 : vérification de la structure des répertoires
	Passe 3 : vérification de la connectivité des répertoires
	Passe 4 : vérification des compteurs de référence
	Passe 5 : vérification de l&#039;information du sommaire de groupe
	DATA : 12/131376 fichiers (0.0% non contigus), 156488/525012 blocs</pre>

<p>
On redimensionne le disque au cas où, mais cela ne devrait pas être utile. S&#039;il indique qu&#039;il fait une modification, c&#039;est que le calcul de TAILLE_F était insuffisant.
</p>
<pre class="code">resize2fs /dev/md0
resize2fs 1.41.12 (17-May-2010)
Le système de fichiers a déjà 525010 blocs. Rien à modifier !</pre>

<p>
On finit en marquant le disque comme étant un raid et on sauvegarde la configuration
</p>
<pre class="code">	~# sfdisk --id /dev/sda 4 fd
	
	~# cp -a /etc/mdadm/mdadm.conf /etc/mdadm/mdadm.conf.origin
	~# mdadm --misc --detail --brief /dev/md0 | tee -a /etc/mdadm/mdadm.conf</pre>

<p>
Vérification du status :
</p>
<pre class="code">	~# cat /proc/mdstat 
	Personalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] 
	md0 : active (read-only) raid1 sda4[1]
	      3979584 blocks [2/1] [_U]

	~# blkid /dev/md0
	/dev/md0: LABEL=&quot;DATA&quot; UUID=&quot;ff1521f6-e70d-4134-bb33-fb9f555ff6c5&quot; TYPE=&quot;ext4&quot;
	# le raid à bien hérité du File system et du nom

	# on vérifie qu&#039;une entrée pour le RAID existe dans le ficher de configuration
	tail /etc/mdadm/mdadm.conf</pre>

<p>
Mise en miroir : à partir du moment que le deuxième disque est disponible :
</p>
<pre class="code">
	~# mdadm --add /dev/md0 /dev/sdb4</pre>

<p>
On suit la reconstruction
</p>
<pre class="code">
	watch &quot;cat /proc/mdstat&quot;
	Personalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] 
	md0 : active raid1 sdb4[2] sda4[1]
	      3152192 blocks [2/1] [_U]
	      [&gt;....................]  recovery =  4.5% (144384/3152192) finish=0.6min speed=72192K/sec</pre>

</div>
<div class='secedit editbutton_section editbutton_31'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Création d&#039;un RAID1 sans avoir tous les disques et sans copie] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="creation_d_un_raid1_sans_avoir_tous_les_disques_et_sans_copie" /><input type="hidden" name="codeblockOffset" value="95" /><input type="hidden" name="range" value="48275-51685" /><button type="submit" title="Création d&#039;un RAID1 sans avoir tous les disques et sans copie" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit32 page-header" id="un_peu_de_reference">Un peu de référence</h2>
<div class="level2">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Comme toujours, une fois le paquet installé, de la doc est disponible localement</div>
</li>
<li class="level1"><div class="li"> <del><a href="http://svn.debian.org/wsvn/pkg-mdadm/mdadm/trunk/debian/FAQ?op=file&amp;rev=0&amp;sc=0" class="urlextern" title="http://svn.debian.org/wsvn/pkg-mdadm/mdadm/trunk/debian/FAQ?op=file&amp;rev=0&amp;sc=0" rel="nofollow">FAQ de Debian sur mdadm</a></del></div>
</li>
<li class="level1"><div class="li"> <a href="https://raid.wiki.kernel.org/index.php/Linux_Raid" class="urlextern" title="https://raid.wiki.kernel.org/index.php/Linux_Raid" rel="nofollow">Wiki de référence du raid logiciel Linux (à partir du kernel 2.6)</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://tldp.org/HOWTO/Software-RAID-HOWTO.html" class="urlextern" title="http://tldp.org/HOWTO/Software-RAID-HOWTO.html" rel="nofollow">How-TO complet sur la question du raid (kernel antérieur à 2.6)</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.noisette.ch/wiki/index.php/Mdadm" class="urlextern" title="http://www.noisette.ch/wiki/index.php/Mdadm" rel="nofollow">http://www.noisette.ch/wiki/index.php/Mdadm</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://hoper.dnsalias.net/atdc/index.php/2010/06/18/20100618quand-il-n-y-a-plus-aucun-espoir/" class="urlextern" title="https://hoper.dnsalias.net/atdc/index.php/2010/06/18/20100618quand-il-n-y-a-plus-aucun-espoir/" rel="nofollow">Deux disques RAID5 détruits au même moment</a></div>
</li>
<li class="level1"><div class="li"> <del> <a href="http://kev.coolcavemen.com/tag/mdadm/" class="urlextern" title="http://kev.coolcavemen.com/tag/mdadm/" rel="nofollow">http://kev.coolcavemen.com/tag/mdadm/</a></del></div>
</li>
<li class="level1"><div class="li"> <a href="https://forum.ubuntu-fr.org/viewtopic.php?id=2044377" class="urlextern" title="https://forum.ubuntu-fr.org/viewtopic.php?id=2044377" rel="nofollow">Récupérer un vieux RAID géré par un NAS qui lâche</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://raid.wiki.kernel.org/index.php/RAID_superblock_formats" class="urlextern" title="https://raid.wiki.kernel.org/index.php/RAID_superblock_formats" rel="nofollow">Les formats des métadata</a></div>
</li>
</ul>

<p>
—-
</p>

<p>
<em>Contributeurs : <a href="/utilisateurs/goldkey" class="wikilink2" title="utilisateurs:goldkey" rel="nofollow">goldkey</a>, <a href="/utilisateurs/deejc" class="wikilink1" title="utilisateurs:deejc">Deejc</a>, <a href="/utilisateurs/grummfy" class="wikilink1" title="utilisateurs:grummfy">Grummfy</a>, gene69.</em>
</p>

</div>
<div class='secedit editbutton_section editbutton_32'><form class="button btn_secedit form-inline" method="post" action="/raid_logiciel"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1635341521" /><input type="hidden" name="summary" value="[Un peu de référence] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="un_peu_de_reference" /><input type="hidden" name="codeblockOffset" value="102" /><input type="hidden" name="range" value="51686-" /><button type="submit" title="Un peu de référence" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="raid_logiciel.txt">raid_logiciel.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 27/10/2021, 15:32">Le 27/10/2021, 15:32</span></li><li class="text-muted">par bruno</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=raid_logiciel&amp;1635936594" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
