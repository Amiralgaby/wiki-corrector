<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>serveur_mail_avec_postfix_et_fetchmail [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="serveur,reseau,vetuste"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/serveur_mail_avec_postfix_et_fetchmail?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns="/>
<link rel="edit" title="Modifier cette page" href="/serveur_mail_avec_postfix_et_fetchmail?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/serveur_mail_avec_postfix_et_fetchmail"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/serveur_mail_avec_postfix_et_fetchmail"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/serveur_mail_avec_postfix_et_fetchmail"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"serveur_mail_avec_postfix_et_fetchmail","namespace":"","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="serveur_mail_avec_postfix_et_fetchmail">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/serveur_mail_avec_postfix_et_fetchmail?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/serveur_mail_avec_postfix_et_fetchmail?do=media&amp;ns="  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/serveur_mail_avec_postfix_et_fetchmail?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/serveur_mail_avec_postfix_et_fetchmail?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/serveur_mail_avec_postfix_et_fetchmail?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/serveur_mail_avec_postfix_et_fetchmail?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/serveur_mail_avec_postfix_et_fetchmail?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">serveur_mail_avec_postfix_et_fetchmail</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/serveur_mail_avec_postfix_et_fetchmail?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/serveur_mail_avec_postfix_et_fetchmail?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/serveur_mail_avec_postfix_et_fetchmail?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#description","title":"Description","level":1},{"link":"#configuration_de_fetchmail","title":"Configuration de fetchmail","level":1},{"link":"#configuration_de_procmail","title":"Configuration de procmail","level":1},{"link":"#verification_du_fonctionnement_du_serveur","title":"V\u00e9rification du fonctionnement du serveur","level":1},{"link":"#configuration_de_thunderbird","title":"Configuration de Thunderbird","level":1},{"link":"#configuration_de_postfix","title":"Configuration de postfix","level":1},{"link":"#conclusion","title":"Conclusion","level":1}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level1"><a href="#description">Description</a></li>
<li class="level1"><a href="#configuration_de_fetchmail">Configuration de fetchmail</a></li>
<li class="level1"><a href="#configuration_de_procmail">Configuration de procmail</a></li>
<li class="level1"><a href="#verification_du_fonctionnement_du_serveur">Vérification du fonctionnement du serveur</a></li>
<li class="level1"><a href="#configuration_de_thunderbird">Configuration de Thunderbird</a></li>
<li class="level1"><a href="#configuration_de_postfix">Configuration de postfix</a></li>
<li class="level1"><a href="#conclusion">Conclusion</a></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content"><div class="notetag">Cette page est considérée comme <a href="/vetuste">vétuste</a> et ne contient plus d'informations utiles.<br />
<a href="/wiki/participer_wiki">Apportez votre aide…</a>
</div>
<div class="tags"><span>
	<a href="/serveur" class="wikilink1" title="serveur" rel="tag">serveur</a>,
	<a href="/reseau" class="wikilink1" title="reseau" rel="tag">réseau</a>,
	<a href="/vetuste" class="wikilink1" title="vetuste" rel="tag">VÉTUSTE</a>
</span></div>
<hr />

<h1 class="sectionedit1 page-header" id="installer_un_serveur_de_courriel_avec_postfix_procmail_et_fetchmail">Installer un serveur de courriel avec postfix, procmail et fetchmail</h1>
<div class="level1">

</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/serveur_mail_avec_postfix_et_fetchmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605423" /><input type="hidden" name="summary" value="[Installer un serveur de courriel avec postfix, procmail et fetchmail] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installer_un_serveur_de_courriel_avec_postfix_procmail_et_fetchmail" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="40-123" /><button type="submit" title="Installer un serveur de courriel avec postfix, procmail et fetchmail" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit2 page-header" id="description">Description</h2>
<div class="level2">

<p>
L&#039;objectif du tutorial est l&#039;installation et l&#039;utilisation de <code>postfix</code> pour l&#039;envoi de courriels, de <code>fetchmail</code> pour la récupération et de deux courrielleurs pour la visualisation et l&#039;envoi des courriels.
</p>

<p>
<em class="u">Pourquoi utiliser deux courrielleurs ?</em><br/>

Thunderbird permet la lecture des courriels depuis son PC comme le fait tout un chacun mais <code>mutt</code> lit ses courriels en console donc depuis n&#039;importe quel PC pourvu que le serveur soit relié au net.
</p>

<p>
Pour que le tutoriel soit plus clair, je vais définir <strong>deux boites aux lettres</strong>:
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li">la boite d&#039;un <strong>fournisseur d&#039;accès</strong> comme free, laposte <strong>toto@fai.fr</strong></div>
</li>
<li class="level1"><div class="li">la boite du <strong>serveur de courriel interne toto@postfix.fr</strong></div>
</li>
</ul>

<p>
<em class="u">
Installation des paquets</em><br/>

Avant tout il faut installer un certains nombres de paquets.
Un simple
</p>
<pre class="code"> sudo apt-get install postfix fetchmail procmail mutt</pre>

<p>
suffit.
</p>

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/serveur_mail_avec_postfix_et_fetchmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605423" /><input type="hidden" name="summary" value="[Description] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="description" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="124-1005" /><button type="submit" title="Description" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit3 page-header" id="configuration_de_fetchmail">Configuration de fetchmail</h2>
<div class="level2">

<p>
Passons maintenant à la configuration de <code>fetchmail</code>. <code>fetchmail</code> est chargé de la récupération des courriels. Il faut définir un fichier dans le répertoire personnel de l&#039;utilisateur.
</p>
<pre class="code">sudo touch .fetchmailrc &amp;&amp; sudo xdg-open .fetchmailrc</pre>

<p>
Un fichier vide s&#039;ouvre, il faut ajouter :
</p>
<pre class="file">## fai : votre fournisseur d&#039;accès Internet.
poll pop.fai.fr    protocol pop3   user toto@fai.net  password    mot_de_passe_de_toto options keep</pre>

<p>
puis sauvegarder le fichier.
</p>

<p>
L&#039;option <em>keep</em> permet de faire des tests sans perdre de courriels. Je dis ça, vous êtes prévenus, ça m’est arrivé de perdre quelques courriels avant de me rendre compte de ce qu’il se passait.
</p>

<p>
A la place de <em>keep</em>, vous pouvez par la suite utiliser le paramètre <em>fetchall</em>. Il permet de récupérer tous les courriels. c&#039;est utile si on reçoit beaucoup de courriels et que l&#039;on ne veut pas encombrer le serveur du <abbr title="Fournisseur d&#039;Accès à Internet">FAI</abbr>.
</p>

<p>
<em class="u">Protection du fichier</em><br/>

Maintenant il faut protéger ce fichier qui montre en clair les mots de passe du compte. C&#039;est une étape que je n&#039;ai pas encore réalisé (par fainéantise) mais je vous livre la méthode.
</p>

<p>
On définit un utilisateur fetchmail (ça manque d’originalité, vous pouvez bien sûr l’appeler comme vous voulez) qui doit être créé.
</p>

<p>
  su adduser -g 65534 -d /répertoire_des_courriels fetchmail
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> -g ou (-gid) pour utiliser le groupe nogroup. Mettez le GID qui correspond à nogroup, ici 65534. En fait, vous mettez ce que vous voulez (100 pour users par exemple est pas mal non plus).</div>
</li>
<li class="level1"><div class="li"> -d ou (–home) pour utiliser le répertoire /home/toto/Maildir par exemple comme répertoire maison (= répertoire utilisateur).</div>
</li>
</ul>

<p>
Changez les utilisateurs/droits pour que ça aille bien :
</p>
<pre class="code">sudo chown fetchmail:nogroup /home/toto/.fetchmailrc
sudo chmod 600 /home/toto/.fetchmailrc
sudo chown -R fetchmail:nogroup /home/toto/Maildir
sudo chmod 700 /home/toto/Maildir</pre>

<p>
Reste ensuite à vérifier 2 choses :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Que le fichier /etc/default/fetchmail (sur Debian) autorise le lancement de fetchmail en démon : START_DAEMON doit être positionné à yes dans ce fichier.</div>
</li>
<li class="level1"><div class="li"> Que le script de lancement /etc/init.d/fetchmail écrive bien tout ce qu’il faut dans /home/toto/Maildir et pas ailleurs, sinon ça risque de ne pas fonctionner correctement.</div>
</li>
</ul>

<p>
Voilà. Normalement, un lancement de fetchmail.
</p>

</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit form-inline" method="post" action="/serveur_mail_avec_postfix_et_fetchmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605423" /><input type="hidden" name="summary" value="[Configuration de fetchmail] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration_de_fetchmail" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="1006-3401" /><button type="submit" title="Configuration de fetchmail" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit4 page-header" id="configuration_de_procmail">Configuration de procmail</h2>
<div class="level2">

<p>
Procmail est chargé de faire le tri de courriels à l&#039;aide de filtres appelés <strong>recettes</strong>.
créons un répertoire pour stocker les courriels dans le répertoire personnel de toto
</p>
<pre class="code">sudo apt-get install maildrop
sudo maildirmake Maildir</pre>

<p>
Ceci créera la boite de courriel Maildir/ dans votre ~, autrement dit, dans votre /home/toto.
</p>

<p>
Une fois de plus il faut rédiger un fichier dans son répertoire personnel par exemple.
</p>
<pre class="code">sudo touch .procmailrc &amp;&amp; sudo xdg-open .procmailrc</pre>

<p>
Il faut compléter la page vierge pour obtenir un fichier de ce type
</p>
<pre class="file">MAILDIR=/home/toto/Maildir
## Faites en sorte que ça existe.
LOGFILE=/home/toto/.procmaillog
LOGABSTRACT=no
#VERBOSE=on (Est utilisé uniquement pour le débogage.)
VERBOSE=off
FORMAIL=/usr/bin/formail
NL=&quot;
## Les lignes de « recipe » commencent par « :0 ».
## Ne mettez pas de commentaires dans les lignes de « recipe ».
## Désactivez un « recipe » grace au NON logique (!).
## Les conditions commencent par *, utilisez des expressions rationnelles.
## Les conditions sont associées avec un ET logique.
## Tout ce qui suit * est passé directement à egrep.
## Une ligne d&#039;action suit les conditions, ici c&#039;est un nom de BAL.

# Utilise formail pour les courriels dupliqués.
:0 Whc: .msgid.lock
| $FORMAIL -D 16384 .msgid.cache

#utilisation de spamassassin
:0 a
$MAILDIR/duplicates
:0fw
| spamassassin -P
:0:
* ^X-Spam-Status: Yes
$MAILDIR/spambox

# Pourriels à la poubelle.
:0
* ^Subject:.*(credit|cash|money|debt|sex|sale|loan)
$MAILDIR/spam

# Plus de messages HTML.
:0
* ^Content-Type:.*html
$MAILDIR/junk

# mailing list du wiki-ubuntu
:0
* ^Subject:.*(UWiki)
$MAILDIR/UWiki

#tri des courriels locaux
:0
* ^TOtoto@postfix.fr
$MAILDIR/locaux
:0
* ^TOroot@postfix.fr
$MAILDIR/locaux
  
#######################################
# Dernière règle : tout ce qui arrive #
# ici va dans la boîte par défaut.    #
#######################################
:0
* .*
Inbox</pre>

<p>
MAILDIR=/home/toto/Maildir est le répertoire où seront stockés les courriels triés.<br/>

LOGFILE=/home/toto/.procmaillog est le fichier d&#039;erreurs.
</p>

<p>
Viens ensuite les différentes recettes.
On marque le début d&#039;une recette par
<strong>:0</strong> puis on indique le critère de tri par <strong>* ^TO</strong> ou <strong>*^Subject</strong> et enfin le fichier où l&#039;on stocke les courriels. par exemple <strong>$MAILDIR/locaux</strong>
</p>

<p>
Pour plus d&#039;explications, il y a de nombreux sites parlant de la réalisation de recettes très élaborées.
Dans le fichier on a :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> une recette pour éviter les courriels dupliqués</div>
</li>
<li class="level1"><div class="li"> l&#039;utilisation de spamassassin</div>
</li>
<li class="level1"><div class="li"> un tri en fonction des listes de diffusions</div>
</li>
<li class="level1"><div class="li"> les courriels internes </div>
</li>
<li class="level1"><div class="li"> et le restant est stocké dans le fichier Inbox.</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit form-inline" method="post" action="/serveur_mail_avec_postfix_et_fetchmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605423" /><input type="hidden" name="summary" value="[Configuration de procmail] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration_de_procmail" /><input type="hidden" name="codeblockOffset" value="1" /><input type="hidden" name="range" value="3402-6123" /><button type="submit" title="Configuration de procmail" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit5 page-header" id="verification_du_fonctionnement_du_serveur">Vérification du fonctionnement du serveur</h2>
<div class="level2">

<p>
Cette étape peut être faite à partir du moment où le serveur smtp est installé.
Le plus simple est de s&#039;envoyer des messages par son courrielleur habituel.
 Ou utiliser la commande mail du paquet mailx.
Par exemple :
</p>
<pre class="code">mail -s essai toto@fai.net
Cc:&lt;enter&gt;
essai pour voir</pre>

<p>
puis ctrl+d pour envoyer un courriel avec pour sujet essai à toto@fai.net et comme texte essai pour voir. sans copie particulière.<br/>

<em class="u">comment relever ses courriels avec fetchmail.</em><br/>

il suffit de taper
</p>
<pre class="code">fetchmail -akv -m &quot;/usr/bin/procmail -d %T&quot;</pre>

<p>
Si les droits sont bien attribués, on voit fetchmail interroger le <abbr title="Fournisseur d&#039;Accès à Internet">FAI</abbr> et le voir récupérer les courriels.
</p>

<p>
Sinon il faut vous les réattribuer avec un chmod, chgrp et chown.
</p>

<p>
<em class="u">Comment vérifier le tri?</em><br/>

Il faut simplement aller dans le dossier <strong>Maildir</strong> et cliquer sur les fichiers définis dans procmail.
Tant qu&#039;un courriel n&#039;est pas trié par la recette, le fichier correspondant n’apparaît pas.
</p>

<p>
si vous ne les trouvez pas ils peuvent être stockés dans le répertoire <strong>/var/mail/toto ou root.</strong>
</p>

</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit form-inline" method="post" action="/serveur_mail_avec_postfix_et_fetchmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605423" /><input type="hidden" name="summary" value="[Vérification du fonctionnement du serveur] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="verification_du_fonctionnement_du_serveur" /><input type="hidden" name="codeblockOffset" value="2" /><input type="hidden" name="range" value="6124-7234" /><button type="submit" title="Vérification du fonctionnement du serveur" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit6 page-header" id="configuration_de_thunderbird">Configuration de Thunderbird</h2>
<div class="level2">

<p>
On définit un compte pop dans Thunderbird de façon classique. Puis on se rend dans <strong>les paramètres du compte</strong>, on change le répertoire du dossier local pour le rediriger vers le dossier Maildir crée auparavant.<br/>

<a href="/_detail/capture2.png?id=serveur_mail_avec_postfix_et_fetchmail" class="media" title="capture2.png"><img src="/_media/capture2.png" class="media img-responsive" alt="" /></a><br/>

Ici, il y a <strong>une petite subtilité importante</strong>. D&#039;autres trouveront peut-être une solution différente.<br/>

</p>

<p>
Pour que les <strong>fichiers triés par procmail</strong> apparaissent et soient gérés par Thunderbird, il faut <strong>créer des sous-dossiers dans les dossiers locaux</strong>.
</p>

<p>
Par exemple, créer un sous-dossier spambox pour récupérer les pourriels.
Ou un sous-dossier locaux pour les messages internes.
Il en faut autant que de fichier trié par procmail.
</p>

<p>
<a href="/_detail/capture-1.png?id=serveur_mail_avec_postfix_et_fetchmail" class="media" title="capture-1.png"><img src="/_media/capture-1.png" class="media img-responsive" alt="" /></a>
</p>

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit form-inline" method="post" action="/serveur_mail_avec_postfix_et_fetchmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605423" /><input type="hidden" name="summary" value="[Configuration de Thunderbird] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration_de_thunderbird" /><input type="hidden" name="codeblockOffset" value="2" /><input type="hidden" name="range" value="7235-7991" /><button type="submit" title="Configuration de Thunderbird" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit7 page-header" id="configuration_de_postfix">Configuration de postfix</h2>
<div class="level2">

<p>
Enfin on utilise postfix pour envoyer des courriels. C&#039;est une utilisation très simple de ce serveur de courriels.<br/>

En fait, on va créer un domaine mais qui n&#039;est hélas pas connu sur la toile. Il faut donc réécrire le nom de domaine lorsque l&#039;on veut envoyer un courriel vers l&#039;extérieur. Certains fournisseurs d&#039;accès empêchent l&#039;envoi de courriel lorsqu&#039;ils ne connaissent le nom de domaine.<br/>

</p>

<p>
On édite un fichier
</p>
<pre class="code">sudo xdg-open /etc/postfix/main.cf</pre>

<p>
Puis on va y modifier un certain nombre de ligne
en voici un copie
</p>
<dl class="file">
<dt><a href="/_export/code/serveur_mail_avec_postfix_et_fetchmail?codeblock=2" title="Télécharger cet extrait" class="mediafile mf_cf">main.cf</a></dt>
<dd><pre class="code file txt"># See /usr/share/postfix/main.cf.dist for a commented, more complete version
&nbsp;
smtpd_banner = $myhostname ESMTP $mail_name (Ubuntu)
biff = no
&nbsp;
# appending .domain is the MUA's job.
append_dot_mydomain = no
&nbsp;
# Uncomment the next line to generate &quot;delayed mail&quot; warnings
#delay_warning_time = 4h
&nbsp;
#nom du serveur de courriel
myhostname = postfix.fr
mydomain = ce que l'on veut
mynetworks = 127.0.0.0/8
&nbsp;
#gestion des alias
alias_maps = hash:/etc/aliases
alias_database = hash:/etc/aliases
&nbsp;
myorigin = /etc/mailname
mydestination = localhost.localdomain, postfix.fr, localhost, ubuntu,
#relayhost = smtp.fai.fr
&nbsp;
mailbox_command = procmail -a &quot;$EXTENSION&quot;
mailbox_size_limit = 0
recipient_delimiter = +
inet_interfaces = all
&nbsp;
#serveur imap renvoie sur le dossier Maildir
home_mailbox=Maildir/
&nbsp;
#ligne pour la translation d'adresse(en plus)
sender_canonical_maps = hash:/etc/postfix/canonical</pre>
</dd></dl>

<p>
Le nom de domaine<strong>(myhostname)</strong> correspond au nom de serveur de courriel interne. postfix.fr<br/>

Le nom de domaine<strong>(mydomain)</strong> correspond à un domaine comme <a href="http://www.goolge.fr" class="urlextern" title="http://www.goolge.fr" rel="nofollow">www.goolge.fr</a> ou autre.
Il existe la possibilité par exemple d&#039;associer un nom de domaine(toto) à son adresse IP(80.truc.muche). je vous invite à voir la page correspondante <a href="/dns_dynamique" class="wikilink1" title="dns_dynamique">dns_dynamique</a>.
</p>

<p>
Les alias(<strong>alias_map</strong>) servent à simplifier l&#039;écriture des en-têtes des courriers ainsi en tapant <em>toto</em> cela signifie pour le serveur de courriel <em>toto@postfix.fr.</em> On peut même rediriger le courrier de <em>root</em> vers sa propre adresse. C&#039;est relativement intéressant car certains programmes envoient des courriels internes pour prévenir des défaillances (exemple fail2ban).
Pour cela il faut ouvrir le fichier /etc/aliases, on voit apparaître le nom de l&#039;utilisateur et l&#039;adresse courriel associée.
</p>

<p>
Sur le courriel apparaît le nom du serveur qui a envoyé le mail<strong>(myorigin</strong>). Ici c&#039;est le nom de notre domaine situé dans /etc/mailname(postfix.fr). C&#039;est ce nom qu&#039;il faudra modifier pour envoyer un courriel.<br/>

<strong>mydestinations</strong> indique les autres noms possibles pour envoyer des courriels sur le réseau interne. Ainsi pour envoyer un courrier à toto, on peut écrire toto@postfix.fr mais aussi toto@localhost. Le courrier sera acheminé de la même façon.<br/>

<strong>La mailcommand</strong> permet de commander procmail par postfix pour qu&#039;il reçoivent le courrier.
</p>

<p>
(<strong>home_mailbox</strong>) Si on a installé un serveur Imap(courrier-Imap) le courrier téléchargé est stocké dans le répertoire /Maildir.
</p>

<p>
La ligne de réécriture d&#039;adresse(<strong>sender_canonical_maps</strong>) est à ajouter. On va maintenant changer lors de l&#039;envoi des courriels, l&#039;adresse de l&#039;expéditeur. On modifie toto@postfix.fr par toto@fai.fr.<br/>

Il ne faut pas oublier de créer le fichier /etc/postfix/canonical
</p>
<pre class="code">sudo touch /etc/postfix/canonical &amp;&amp; sudo xdg-open /etc/postfix/canonical</pre>

<p>
Une page vierge s&#039;ouvre, on écrit :
</p>
<pre class="file">toto@postfix.fr	   toto@fai.fr</pre>

<p>
Il faut enfin penser à charger la base de données liée à postfix par un
postmap.
</p>
<pre class="code"> postmap /etc/postfix/canonical</pre>

</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit form-inline" method="post" action="/serveur_mail_avec_postfix_et_fetchmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605423" /><input type="hidden" name="summary" value="[Configuration de postfix] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration_de_postfix" /><input type="hidden" name="codeblockOffset" value="2" /><input type="hidden" name="range" value="7992-11598" /><button type="submit" title="Configuration de postfix" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit8 page-header" id="conclusion">Conclusion</h2>
<div class="level2">

<p>
J&#039;ai décrit sur cette page l&#039;installation personnelle de mon serveur de courriels, espérant que cela puisse aider d&#039;autres personnes.<br/>

L&#039;installation de postfix n&#039;est pas une utilisation très poussée. Pour plus d&#039;explications, je vous invite à lire la documentation spécialisée.<br/>

<em class="u">webographie</em> ensemble des liens qui m&#039;ont permis d&#039;élaborer le serveur.
</p>

<p>
Pour plus d&#039;informations rendez vous sur le forum<a href="http://forum.ubuntu-fr.org/viewtopic.php?id=71599" class="urlextern" title="http://forum.ubuntu-fr.org/viewtopic.php?id=71599" rel="nofollow">http://forum.ubuntu-fr.org/viewtopic.php?id=71599</a>.
</p>
<hr />

<p>
<em>Contributeur : <a href="/utilisateurs/bidou" class="wikilink1" title="utilisateurs:bidou">bidou</a></em>
</p>

</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit form-inline" method="post" action="/serveur_mail_avec_postfix_et_fetchmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1487605423" /><input type="hidden" name="summary" value="[Conclusion] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="conclusion" /><input type="hidden" name="codeblockOffset" value="4" /><input type="hidden" name="range" value="11599-" /><button type="submit" title="Conclusion" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="serveur_mail_avec_postfix_et_fetchmail.txt">serveur_mail_avec_postfix_et_fetchmail.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 20/02/2017, 16:43">Le 20/02/2017, 16:43</span></li><li class="text-muted">par L&#039;Africain</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=serveur_mail_avec_postfix_et_fetchmail&amp;1635563356" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
