<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>postgresql [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="sgbd,serveur,reseau,brouillon"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/postgresql?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns="/>
<link rel="edit" title="Modifier cette page" href="/postgresql?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/postgresql"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/postgresql"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/postgresql"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"postgresql","namespace":"","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="postgresql">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/postgresql?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/postgresql?do=media&amp;ns="  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/postgresql?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/postgresql?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/postgresql?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/postgresql?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/postgresql?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">postgresql</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/postgresql?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/postgresql?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/postgresql?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#introduction","title":"Introduction","level":1},{"link":"#documentation","title":"Documentation","level":1},{"link":"#installation_du_serveur_postgresql","title":"Installation du serveur PostgreSQL","level":1},{"link":"#methode_recommandee","title":"M\u00e9thode recommand\u00e9e","level":2},{"link":"#installation_manuelle_avec_l_installeur_interactif_enterprisedb","title":"Installation manuelle avec l'installeur interactif EnterpriseDB","level":2},{"link":"#mise_a_jour_postgres_enterprisedb_avec_conservation_des_bases_de_donnees","title":"Mise \u00e0 jour Postgres EnterpriseDB avec conservation des Bases de Donn\u00e9es","level":2},{"link":"#desinstallation","title":"D\u00e9sinstallation","level":2},{"link":"#configuration","title":"Configuration","level":1},{"link":"#l_utilisateur_postgres_et_psql","title":"L'utilisateur postgres et psql","level":2},{"link":"#supprimer_l_utilisateur_postgres_du_greeter_sous_xubuntu_14041","title":"Supprimer l'utilisateur Postgres du greeter sous xubuntu 14.04.1","level":2},{"link":"#erreur_psql_au_premier_demarrage","title":"Erreur psql au premier d\u00e9marrage","level":2},{"link":"#encodage_utf-8","title":"encodage UTF-8","level":2},{"link":"#creer_un_utilisateur_postgresql","title":"Cr\u00e9er un utilisateur PostgreSQL","level":2},{"link":"#pour_aller_plus_loin","title":"Pour aller plus loin","level":2},{"link":"#installation_de_la_cartouche_spatiale_postgis","title":"Installation de la cartouche spatiale PostGIS","level":1},{"link":"#ce_qu_est_postgis","title":"Ce qu'est postgis","level":2},{"link":"#installation","title":"Installation","level":2},{"link":"#donner_a_une_base_la_capacite_geographique","title":"Donner \u00e0 une base la capacit\u00e9 g\u00e9ographique","level":2},{"link":"#clients_graphiques","title":"Clients graphiques","level":1},{"link":"#dbeaver","title":"DBeaver","level":2},{"link":"#le_client_pgadmin4","title":"Le client pgadmin4","level":2},{"link":"#le_client_pgadmin3","title":"Le client pgadmin3","level":2},{"link":"#le_client_phppgadmin","title":"Le client phppgadmin","level":2},{"link":"#connexions_vers_php","title":"Connexions vers PHP","level":2},{"link":"#pool_de_connexionpgbouncer","title":"Pool de connexion : PgBouncer","level":2},{"link":"#recuperation_du_contenu_d_une_base_de_donnees_apres_un_crash_serveur","title":"R\u00e9cup\u00e9ration du contenu d'une base de donn\u00e9es apr\u00e8s un crash serveur","level":1},{"link":"#formations","title":"Formations","level":1}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level1"><a href="#introduction">Introduction</a></li>
<li class="level1"><a href="#documentation">Documentation</a></li>
<li class="level1"><a href="#installation_du_serveur_postgresql">Installation du serveur PostgreSQL</a>
<ul class="nav toc">
<li class="level2"><a href="#methode_recommandee">Méthode recommandée</a></li>
<li class="level2"><a href="#installation_manuelle_avec_l_installeur_interactif_enterprisedb">Installation manuelle avec l&#039;installeur interactif EnterpriseDB</a></li>
<li class="level2"><a href="#mise_a_jour_postgres_enterprisedb_avec_conservation_des_bases_de_donnees">Mise à jour Postgres EnterpriseDB avec conservation des Bases de Données</a></li>
<li class="level2"><a href="#desinstallation">Désinstallation</a></li>
</ul>
</li>
<li class="level1"><a href="#configuration">Configuration</a>
<ul class="nav toc">
<li class="level2"><a href="#l_utilisateur_postgres_et_psql">L&#039;utilisateur postgres et psql</a></li>
<li class="level2"><a href="#supprimer_l_utilisateur_postgres_du_greeter_sous_xubuntu_14041">Supprimer l&#039;utilisateur Postgres du greeter sous xubuntu 14.04.1</a></li>
<li class="level2"><a href="#erreur_psql_au_premier_demarrage">Erreur psql au premier démarrage</a></li>
<li class="level2"><a href="#encodage_utf-8">encodage UTF-8</a></li>
<li class="level2"><a href="#creer_un_utilisateur_postgresql">Créer un utilisateur PostgreSQL</a></li>
<li class="level2"><a href="#pour_aller_plus_loin">Pour aller plus loin</a></li>
</ul>
</li>
<li class="level1"><a href="#installation_de_la_cartouche_spatiale_postgis">Installation de la cartouche spatiale PostGIS</a>
<ul class="nav toc">
<li class="level2"><a href="#ce_qu_est_postgis">Ce qu&#039;est postgis</a></li>
<li class="level2"><a href="#installation">Installation</a></li>
<li class="level2"><a href="#donner_a_une_base_la_capacite_geographique">Donner à une base la capacité géographique</a></li>
</ul>
</li>
<li class="level1"><a href="#clients_graphiques">Clients graphiques</a>
<ul class="nav toc">
<li class="level2"><a href="#dbeaver">DBeaver</a></li>
<li class="level2"><a href="#le_client_pgadmin4">Le client pgadmin4</a></li>
<li class="level2"><a href="#le_client_pgadmin3">Le client pgadmin3</a></li>
<li class="level2"><a href="#le_client_phppgadmin">Le client phppgadmin</a></li>
<li class="level2"><a href="#connexions_vers_php">Connexions vers PHP</a></li>
<li class="level2"><a href="#pool_de_connexionpgbouncer">Pool de connexion : PgBouncer</a></li>
</ul>
</li>
<li class="level1"><a href="#recuperation_du_contenu_d_une_base_de_donnees_apres_un_crash_serveur">Récupération du contenu d&#039;une base de données après un crash serveur</a></li>
<li class="level1"><a href="#formations">Formations</a></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content"><div class="notetag">Cette page est en cours de rédaction.<br />
<a href="/wiki/participer_wiki">Apportez votre aide…</a>
</div>
<div class="tags"><span>
	<a href="/sgbd" class="wikilink1" title="sgbd" rel="tag">sgbd</a>,
	<a href="/serveur" class="wikilink1" title="serveur" rel="tag">serveur</a>,
	<a href="/reseau" class="wikilink1" title="reseau" rel="tag">réseau</a>,
	<a href="/brouillon" class="wikilink1" title="brouillon" rel="tag">BROUILLON</a>
</span></div>
<hr />

<h1 class="sectionedit1 page-header" id="postgresql">PostgreSQL</h1>
<div class="level1">

</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[PostgreSQL] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="postgresql" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="48-73" /><button type="submit" title="PostgreSQL" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit2 page-header" id="introduction">Introduction</h2>
<div class="level2">

<p>
PostgreSQL est un système de gestion de bases de données (<a href="/sgbd" class="wikilink1" title="sgbd">SGBD</a>) très performant sous licence <abbr title="Berkeley Software Distribution">BSD</abbr> dont les performances sont comparables à Oracle 9.
</p>

<p>
Il propose de très nombreuses fonctionnalités, tout en respectant les standards SQL : SQL 92, 99 et en partie la norme SQL2003. En outre, il intègre plusieurs langages embarqués (Perl, Python, Java) depuis de nombreuses années. <a href="http://www.postgresql.org/about/" class="urlextern" title="http://www.postgresql.org/about/" rel="nofollow">Pour en savoir plus</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Introduction] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="introduction" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="74-548" /><button type="submit" title="Introduction" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit3 page-header" id="documentation">Documentation</h2>
<div class="level2">

<p>
La documentation ainsi que d&#039;autres informations sont disponibles sur le <a href="http://www.postgresql.org/" class="urlextern" title="http://www.postgresql.org/" rel="nofollow">site officiel de PostgreSQL</a>.
La communauté <a href="https://www.postgresql.fr/" class="urlextern" title="https://www.postgresql.fr/" rel="nofollow">postgresql francophone</a> la reprend en <a href="http://docs.postgresql.fr/" class="urlextern" title="http://docs.postgresql.fr/" rel="nofollow">français</a>.
</p>

</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Documentation] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="documentation" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="549-835" /><button type="submit" title="Documentation" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit4 page-header" id="installation_du_serveur_postgresql">Installation du serveur PostgreSQL</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Installation du serveur PostgreSQL] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation_du_serveur_postgresql" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="836-882" /><button type="submit" title="Installation du serveur PostgreSQL" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit5" id="methode_recommandee">Méthode recommandée</h3>
<div class="level3">

<p>
<a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">Installez</a> simplement le paquet <a href="apt://postgresql" class="urlextern" title="apt://postgresql" rel="nofollow">postgresql</a>, soit en ligne de commande :
</p>
<pre class="code">sudo apt install postgresql</pre>

<p>
Notez que l&#039;installation ajoute l&#039;utilisateur postgres à la liste des utilisateurs. Utilisez finger si vous souhaitez de plus amples informations sur ce nouvel utilisateur (finger est un utilitaire permettant de consulter les informations relatives aux utilisateurs système, il n&#039;est pas installé par défaut dans ubuntu)
</p>
<pre class="code">finger postgres</pre>

</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Méthode recommandée] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="methode_recommandee" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="883-1446" /><button type="submit" title="Méthode recommandée" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit6" id="installation_manuelle_avec_l_installeur_interactif_enterprisedb">Installation manuelle avec l&#039;installeur interactif EnterpriseDB</h3>
<div class="level3">

<p>
Téléchargez le dernier fichier .run sur <a href="http://www.enterprisedb.com/products-services-training/pgdownload" class="urlextern" title="http://www.enterprisedb.com/products-services-training/pgdownload" rel="nofollow">cette page</a> (elle est référencée sur <a href="https://www.postgresql.org/download/linux/ubuntu/" class="urlextern" title="https://www.postgresql.org/download/linux/ubuntu/" rel="nofollow">le site officiel</a>) - vous aurez probablement besoin de la version <em>Linux x86-64</em>.
</p>
<ol class=" fix-media-list-overlap">
<li class="level1"><div class="li"> rendez le fichier executable :</div>
</li>
</ol>
<pre class="code">sudo chmod +x postgresql-10.6-1-linux-x64.run</pre>
<ol class=" fix-media-list-overlap">
<li class="level1"><div class="li"> puis exécutez-le en tant que <a href="/sudo" class="wikilink1" title="sudo">super utilisateur</a> avec la commande :</div>
</li>
</ol>
<pre class="code">sudo ./postgresql-10.6-1-linux-x64.run</pre>

<p>
Suivez les étapes affichées par l&#039;interface graphique de l&#039;installeur.
</p>

<p>
Une fois l&#039;installation terminée, PostgreSQL devrait être installé ainsi que pgAdmin.
</p>

<p>
Cependant, l&#039;icône de pgAdmin n&#039;est pas visible dans le menu (enfin c&#039;était mon cas).
Dans ce cas, allez dans le dossier<strong> /usr/share/applications/</strong> et recherchez l&#039;icône de pgadmin.
Changer les droit en écriture (sudo chmod o+w pgadminIII), puis l&#039;ouvrir avec un éditeur de texte.
Dans mon cas, j&#039;ai dû y ajouter la ligne :<strong>Categories=Development;Engineering;</strong>
Pour le rendre visible dans mon menu sous la catégorie Développement.
</p>

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Installation manuelle avec l&#039;installeur interactif EnterpriseDB] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation_manuelle_avec_l_installeur_interactif_enterprisedb" /><input type="hidden" name="codeblockOffset" value="2" /><input type="hidden" name="range" value="1447-2645" /><button type="submit" title="Installation manuelle avec l&#039;installeur interactif EnterpriseDB" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit7" id="mise_a_jour_postgres_enterprisedb_avec_conservation_des_bases_de_donnees">Mise à jour Postgres EnterpriseDB avec conservation des Bases de Données</h3>
<div class="level3">

<p>
Supprimer l&#039;ancienne version en lançant le désinstalleur Postgres (dans le dossier Postgres):
</p>
<pre class="code">$ sudo ./uninstall-postgresql</pre>

<p>
Le dossier <strong>Datas/</strong> n&#039;est pas supprimé.<br/>
Cela permet de garder les anciennes bases de données et la configuration utilisateur postgres.<br/>

Lancer le programme d&#039;installation de postgres, après l&#039;avoir téléchargé sur le site ci-dessus.
</p>
<pre class="code">$ sudo ./postgresql-version-linux-x64.run</pre>

<p>
Lors de la pré-installation, choisir le chemin du dossier <strong>Datas/</strong> qui n&#039;a pas été supprimé.<br/>

Confirmation de l&#039;existence d&#039;un dossier <strong>Datas/</strong> déjà existant.<br/>

Lancer l&#039;installation.
</p>

</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Mise à jour Postgres EnterpriseDB avec conservation des Bases de Données] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="mise_a_jour_postgres_enterprisedb_avec_conservation_des_bases_de_donnees" /><input type="hidden" name="codeblockOffset" value="4" /><input type="hidden" name="range" value="2646-3368" /><button type="submit" title="Mise à jour Postgres EnterpriseDB avec conservation des Bases de Données" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit8" id="desinstallation">Désinstallation</h3>
<div class="level3">

<p>
Si vous souhaitez désinstaller, par exemple lors du passage à l&#039;utilisation de conteneurs <a href="/docker" class="wikilink1" title="docker">docker</a>, il faut :
</p>
<pre class="code bash"><span class="co0"># arrêtez le service s'il est lancé</span>
<span class="kw2">sudo</span> systemctl stop postgresql
<span class="co0"># lister les paquets installés liés à postgres :</span>
<span class="kw2">dpkg</span> <span class="re5">-l</span> <span class="sy0">|</span> <span class="kw2">grep</span> postgres
<span class="co0"># et les supprimer :</span>
<span class="kw2">sudo</span> apt <span class="re5">--purge</span> remove postgresql-<span class="sy0">*</span></pre>

</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Désinstallation] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="desinstallation" /><input type="hidden" name="codeblockOffset" value="6" /><input type="hidden" name="range" value="3369-3736" /><button type="submit" title="Désinstallation" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit9 page-header" id="configuration">Configuration</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_9'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Configuration] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration" /><input type="hidden" name="codeblockOffset" value="7" /><input type="hidden" name="range" value="3737-3762" /><button type="submit" title="Configuration" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit10" id="l_utilisateur_postgres_et_psql">L&#039;utilisateur postgres et psql</h3>
<div class="level3">

<p>
PostgreSQL est un serveur qui permet de se connecter à différentes bases de données. Par défaut, seul l&#039;utilisateur <em>postgres</em> peut se connecter.
</p>

<p>
Toutes les opérations d&#039;administration se font, au départ, avec l&#039;utilisateur <em>postgres</em>. À la fin de l&#039;installation, celui-ci ne possède pas de mot de passe : c&#039;est un utilisateur bloqué et le mieux est qu&#039;il le reste. La première chose à faire sera de créer un nouvel utilisateur, mais pour ce faire, il faut se connecter au moins une fois en tant qu&#039;utilisateur <em>postgres</em>. Pour devenir <em>postgres</em> et faire les opérations d&#039;administration qui suivent, utilisez sudo :
</p>
<pre class="code">$ sudo -i -u postgres 
Password: </pre>

<p>
<strong>exit</strong> permettra, à la fin de cette session d&#039;administration dans PostgreSQL, de reprendre la main en tant qu&#039;utilisateur du système.
</p>
<div class="notetip">Il se peut que cette authentification retourne une erreur liée au fait qu&#039;il est impossible pour <em>postgres</em> de lire, par exemple, le fichier ~/.bashrc (si un terminal bash est utilisé). La commande <em>chmod ug+r ~/.bashrc</em> exécutée avant la connexion postgres réglera ce problème.
</div>
<p>
Désormais, l&#039;invite de commande doit mentionner que vous êtes actif en tant que <em>postgres</em>. Pour lancer l&#039;invite de commande SQL de PostgreSQL, tapez simplement :
</p>
<pre class="code">psql</pre>

<p>
Vous devriez obtenir quelque chose comme :
</p>
<pre class="code">psql (13.1-1)
Type &quot;help&quot; for help.

postgres=# </pre>
<div class="notetip">Si vous obtenez le message suivant :
<pre class="code">psql: could not connect to server: Aucun fichier ou dossier de ce type</pre>

<p>
Reportez-vous à la section &quot;Erreur psql au premier démarrage&quot; pour résoudre le problème.
 
</p>

</div>
<p>
Notez que vous avez une interface en ligne de commande, et que vous êtes connecté en tant que &quot;root&quot;, comme l&#039;indique le <code>#</code> en bout de ligne.
</p>

<p>
Cette ligne de commande sera bien sûr utilisée pour exécuter des requêtes SQL, et aussi des commandes internes à postgreSQL (elles commencent toutes par un antislash)
</p>

<p>
Petit guide de survie pour le client <strong>psql</strong> (# et le texte qui suit sont des commentaires)
</p>
<pre class="code">        \h # pour l&#039;aide-mémoire des commandes SQL
        \? # pour l&#039;aide-mémoire des commandes psql
        \g # ou point-virgule en fin d&#039;instruction pour exécuter la requête
        \q # pour quitter
        \l # liste les bases de données existantes
        \du # liste les rôles (utilisateur ou groupe)
        \c nom_base nom_utilisateur # connecte à la base &lt;nom_base&gt; avec le rôle &lt;nom_utilisateur&gt;
        \lt # liste les tables de la base courante
        set search_path to &lt;mon_schéma&gt;; # intéressant à faire avant la commande ci-dessous !-)
        \d # liste les tables du schéma courant
        \d nom_table # description de la table &lt;nom_table&gt; (colonne, type…)
        \dn # liste tout le schéma de la base courante
        \h ALTER TABLE # affiche l&#039;aide pour la commande ALTER TABLE</pre>

</div>
<div class='secedit editbutton_section editbutton_10'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[L&#039;utilisateur postgres et psql] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="l_utilisateur_postgres_et_psql" /><input type="hidden" name="codeblockOffset" value="7" /><input type="hidden" name="range" value="3763-6721" /><button type="submit" title="L&#039;utilisateur postgres et psql" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit11" id="supprimer_l_utilisateur_postgres_du_greeter_sous_xubuntu_14041">Supprimer l&#039;utilisateur Postgres du greeter sous xubuntu 14.04.1</h3>
<div class="level3">

<p>
La suppression de l&#039;utilisateur postgres dans le cas d&#039;un greeter lightdm-webkit-greeter.<br/>

Aller dans le répertoire <strong>/var/lib/AccountsService/users/</strong> .<br/>

Créer un fichier text puis nommez-le <strong>postgres</strong> (nom de l&#039;utilisateur postgres).<br/>

Puis y ajouter le contenu suivant :
</p>
<pre class="code">[User]
XSession=xubuntu
SystemAccount=true</pre>

<p>
Sauvegarder et re-démarrer le greeter.
</p>

</div>
<div class='secedit editbutton_section editbutton_11'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Supprimer l&#039;utilisateur Postgres du greeter sous xubuntu 14.04.1] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="supprimer_l_utilisateur_postgres_du_greeter_sous_xubuntu_14041" /><input type="hidden" name="codeblockOffset" value="12" /><input type="hidden" name="range" value="6722-7173" /><button type="submit" title="Supprimer l&#039;utilisateur Postgres du greeter sous xubuntu 14.04.1" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit12" id="erreur_psql_au_premier_demarrage">Erreur psql au premier démarrage</h3>
<div class="level3">

<p>
Si vous obtenez une erreur du type :
</p>
<pre class="code">psql: could not connect to server: Aucun fichier ou dossier de ce type
Is the server running locally and accepting connections on Unix domain socket &quot;/var/run/postgresql/.s.PGSQL.5432&quot;?</pre>

<p>
Déconnectez-vous du compte postgres :
</p>
<pre class="code">logout</pre>

<p>
Puis vérifiez que le dossier de configuration PostgreSQL existe :
</p>
<pre class="code">stat /etc/postgresql</pre>

<p>
Si la réponse est du type :
</p>
<pre class="code">  File: ‘/etc/postgresql’
  Size: 4096      	Blocks: 8          IO Block: 4096   directory
Device: fd01h/64769d	Inode: 131535      Links: 3
Access: (0755/drwxr-xr-x)  Uid: (    0/    root)   Gid: (    0/    root)
Access: 2015-10-29 20:15:04.091560419 +0100
Modify: 2015-10-29 20:15:04.091560419 +0100
Change: 2015-10-29 20:15:04.091560419 +0100
 Birth: -</pre>

<p>
Il peut s&#039;agir d&#039;une mauvaise configuration du port.
<a href="/tutoriel/comment_modifier_un_fichier" class="wikilink1" title="tutoriel:comment_modifier_un_fichier">Modifiez le fichier</a> <strong>/etc/postgresql/9.4/main/postgresql.conf</strong>
</p>
<pre class="code">...
port = 5432
...</pre>

<p>
Puis redémarrez le serveur PostgreSQL: 
</p>
<pre class="code">$ sudo service postgresql restart</pre>

<p>
<strong>Sinon</strong>, si la réponse de <code>stat</code> est du type :
</p>
<pre class="code">stat: cannot stat ‘/etc/postgresql’: No such file or directory</pre>

<p>
Il faut construire le cluster PostgreSQL avant de pouvoir le démarrer. Affichez la version installée de psql avec la comande suivante :
</p>
<pre class="code">psql --version</pre>

<p>
Puis reportez les 2 premiers nombres du numéro de version dans la commande suivante : <code>sudo pg_createcluster X.Y main</code>. Par exemple si le résultat de <code>psql –version</code> est <code>psql (PostgreSQL) 9.3.10</code>, entrez la commande suivante :
</p>
<pre class="code">sudo pg_createcluster 9.3 main</pre>

<p>
Puis redémarrez le serveur PostgreSQL: 
</p>
<pre class="code">$ sudo service postgresql restart</pre>

<p>
Vous pouvez maintenant reprendre le tutoriel au début de la section &quot;L&#039;utilisateur postgres&quot;.
</p>

</div>
<div class='secedit editbutton_section editbutton_12'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Erreur psql au premier démarrage] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="erreur_psql_au_premier_demarrage" /><input type="hidden" name="codeblockOffset" value="13" /><input type="hidden" name="range" value="7174-9077" /><button type="submit" title="Erreur psql au premier démarrage" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit13" id="encodage_utf-8">encodage UTF-8</h3>
<div class="level3">
<div class="noteclassic"> Ce paragraphe est optionnel 
</div>
<p>
<img src="/lib/images/smileys/fixme.gif" class="icon" alt="FIXME" /> En version PostgreSQL 9.1.5, l&#039;installateur semble avoir directement créé avec le bon codage. Cette opération semble donc être devenue inutile.
</p>

<p>
L&#039;installateur initialise le cluster postgresql avec le support de jeux de caractères SQL_<abbr title="American Standard Code for Information Interchange">ASCII</abbr>
</p>

<p>
Pour ceux qui souhaitent privilégier l&#039;encodage <strong>UTF-8</strong> / locale <strong>FR-fr</strong>, il faut supprimer le cluster et le recréer.
</p>

</div>

<h4 id="jeux_de_caracteres_par_defaut">jeux de caractères par défaut</h4>
<div class="level4">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Connexion en tant qu&#039;utilisateur postgres </div>
</li>
</ul>
<pre class="code">sudo -i -u postgres</pre>
<pre class="code">psql -l
                           List of databases
  Name    |  Owner   | Encoding  | Collate | Ctype |   Access privileges   
----------+----------+-----------+---------+-------+-----------------------
postgres  | postgres | SQL_ASCII | C       | C     | 
template0 | postgres | SQL_ASCII | C       | C     | =c/postgres          +
          |          |           |         |       | postgres=CTc/postgres
template1 | postgres | SQL_ASCII | C       | C     | =c/postgres          +
          |          |           |         |       | postgres=CTc/postgres</pre>

</div>

<h4 id="supprimer_le_cluster_et_le_recreer">supprimer le cluster et le recréer</h4>
<div class="level4">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Identifier la version et le nom de votre cluster</div>
</li>
</ul>
<pre class="code">$ pg_lsclusters 
  Version Cluster   Port Status Owner    Data directory                     Log file
  9.1     main      5432 online postgres /var/lib/postgresql/9.1/main       /var/log/postgresql/postgresql-9.1-main.log</pre>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Supprimer le cluster</div>
</li>
</ul>
<pre class="code">pg_dropcluster 9.1 main --stop</pre>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Créer le cluster</div>
</li>
</ul>
<pre class="code">pg_createcluster --locale fr_FR.UTF-8 9.1 main</pre>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Démarrage</div>
</li>
</ul>
<pre class="code">pg_ctlcluster 9.1 main start</pre>

<p>
Les bases systèmes seront alors conformes aux locales système
</p>
<pre class="code">$ psql -l
                                  List of databases
    Name    |  Owner   | Encoding |   Collate   |    Ctype    |   Access privileges   
  ----------+----------+----------+-------------+-------------+-----------------------
  postgres  | postgres | UTF8     | fr_FR.UTF-8 | fr_FR.UTF-8 | 
  template0 | postgres | UTF8     | fr_FR.UTF-8 | fr_FR.UTF-8 | =c/postgres          +
            |          |          |             |             | postgres=CTc/postgres
  template1 | postgres | UTF8     | fr_FR.UTF-8 | fr_FR.UTF-8 | =c/postgres          +
            |          |          |             |             | postgres=CTc/postgres</pre>

</div>
<div class='secedit editbutton_section editbutton_13'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[encodage UTF-8] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="encodage_utf-8" /><input type="hidden" name="codeblockOffset" value="23" /><input type="hidden" name="range" value="9078-11464" /><button type="submit" title="encodage UTF-8" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit14" id="creer_un_utilisateur_postgresql">Créer un utilisateur PostgreSQL</h3>
<div class="level3">

</div>

<h4 id="methode_rapide_non_securisee_-_privilegier_la_methode_decrite_dans_le_chapitre_suivant">Méthode rapide, non sécurisée (-&gt; privilégier la méthode décrite dans le chapitre suivant)</h4>
<div class="level4">

<p>
<code>postgres</code> est à psql ce que <code>root</code> est à Ubuntu. Il ne faut l&#039;utiliser que pour les tâches d&#039;administration, en aucun cas s&#039;en servir pour un applicatif, sinon vous allez créer une faille de sécurité.
</p>

<p>
Par facilité, nous allons assimiler les utilisateurs du système à ceux qui se connecteront avec psql, mais ce n&#039;est nullement obligatoire. Par la suite, nous supposerons que votre login système est <code>nom_utilisateur</code>.
</p>

<p>
Commencez par créer un nouvel utilisateur, qui portera par exemple le même nom que vous. Dans la ligne de commande ci-dessous, tapez (rappel : la partie « postgres=# » est l&#039;invite de commande, il ne faut pas la retaper ! Ainsi, la commande ci-dessous requiert de taper « CREATE ROLE &lt;nom_utilisateur&gt;; », en remplaçant &lt;nom_utilisateur&gt; par un identifiant bien choisi) :
</p>
<pre class="code">postgres=# CREATE ROLE &lt;nom_utilisateur&gt; LOGIN;</pre>

<p>
N&#039;oubliez pas le point-virgule à la fin…
</p>

<p>
Par défaut, votre nouvel utilisateur n&#039;a aucun droit.
Donnez-lui la possibilité de créer de nouvelles bases de données :
</p>
<pre class="code">postgres=# ALTER ROLE &lt;nom_utilisateur&gt; CREATEDB;</pre>

<p>
Ensuite, créez une base de données pour votre utilisateur. Par exemple, vous pouvez prendre comme nom : <code>nom_utilisateur</code>. Ainsi, la connexion sera automatique.
</p>
<div class="notetip">si une base de données possède le même nom que l&#039;utilisateur avec lequel on se connecte alors le client psql se connecte par défaut à cette base.

</div><pre class="code">postgres=# CREATE DATABASE &lt;nom_base_de_donnee&gt; OWNER &lt;nom_utilisateur&gt;;</pre>

<p>
Attribuer un mot de passe à l&#039;utilisateur pour qu&#039;il puisse se connecter à la base (le ENCRYPTED permet l&#039;utilisation de md5 dans le pg_hba.conf) :
</p>
<pre class="code">postgres=# ALTER ROLE &lt;nom_utilisateur&gt; WITH ENCRYPTED PASSWORD &#039;mon_mot_de_passe&#039;;</pre>

<p>
Vous pouvez maintenant quitter, &quot;redevenir vous-même&quot; et relancer psql directement, en étant cette fois connecté sous votre propre nom :
</p>
<pre class="code">postgres=# \q
postgres@ubuntu:~$ psql nom_base_de_donnee</pre>

<p>
La ligne de commande est devenue : 
</p>
<pre class="code">nom_base_de_donnee=&gt;</pre>

<p>
Notez la transformation du # en &gt; : vous n&#039;êtes plus superutilisateur…
</p>
<div class="notetip">Il peut être plus simple pour commencer d&#039;utiliser la commande <strong>createuser –interactive &lt;nom-utilisateur&gt;</strong> en ligne de commande (hors psql) qui est interactive et vous demande les autorisations à y associer (LOGIN, SUPERUSER, CREATEDB, CREATEROLE…)
</div>
</div>
<div class='secedit editbutton_section editbutton_14'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Créer un utilisateur PostgreSQL] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="creer_un_utilisateur_postgresql" /><input type="hidden" name="codeblockOffset" value="25" /><input type="hidden" name="range" value="11465-14040" /><button type="submit" title="Créer un utilisateur PostgreSQL" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit15" id="pour_aller_plus_loin">Pour aller plus loin</h3>
<div class="level3">

</div>

<h4 id="methode_alternative_pour_creer_un_utilisateur">Méthode alternative pour créer un utilisateur</h4>
<div class="level4">

<p>
Vous pouvez aussi créer vos utilisateurs directement en ligne de commande, depuis le terminal standard. Pour cela, vous allez d&#039;abord autoriser les connexions avec mot de passe chiffré, puis vous vous connecterez en tant que postgres (l&#039;administrateur par défaut de Postgres) et créerez un nouvel utilisateur.
</p>

<p>
Cette méthode est beaucoup plus sûre que la précédente.
Tous les utilisateurs auront des mots de passe chiffrés.
(Ce qui n&#039;est pas le cas lorsque l&#039;on emploie la méthode précédente)
</p>

<p>
Il faut d&#039;abord modifier le fichier de configuration pour autoriser les connexions via mot de passe chiffré (sur les versions récentes, au moins la 12, ça ne semble pas nécessaires) :
</p>
<pre class="code">sudo nano /etc/postgresql/x.x/main/pg_hba.conf </pre>

<p>
Remplacez &quot;x.x&quot; par le numéro de version de PostgreSQl installée sur votre ordinateur (exemple : 9.1).
</p>

<p>
Les utilisateurs &quot;avancés&quot; noteront que le fichier est amplement commenté.
Voir la <a href="http://www.postgresql.org/docs/8.2/static/index.html" class="urlextern" title="http://www.postgresql.org/docs/8.2/static/index.html" rel="nofollow">documentation</a> pour plus d&#039;informations.
</p>
<div class="noteimportant">Si vous modifiez les paramètres de la sécurité, avant de relancer postgresql pensez à donner un mot de passe à l&#039;utilisateur postgres (voir plus bas)
</div>
<p>
Modifier le fichier en remplaçant <strong>ident sameuser</strong> par <strong>md5</strong> afin d&#039;obtenir les lignes suivantes : 
</p>
<pre class="code">...
# Database administrative login by Unix domain socket
local   all             postgres                                peer

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# &quot;local&quot; is for Unix domain socket connections only
local   all             all                                     md5
# IPv4 local connections:
host    all             all             127.0.0.1/32            md5
# IPv6 local connections:
host    all             all             ::1/128                 md5
...</pre>

<p>
La modification des paramètres de connexion au serveur nécessite son redémarrage pour que ces derniers soient pris en compte.
</p>
<pre class="code">$ sudo service postgresql restart</pre>

<p>
ou
</p>
<pre class="code">$ sudo pg_ctlcluster 9.5 main restart</pre>

<p>
On peut ensuite créer notre utilisateur :
</p>
<pre class="code">$ sudo -i -u postgres
$ createuser -P --interactive &lt;nom_utilisateur&gt;
Enter password for new role: 
Enter it again: 
Shall the new role be a superuser? (y/n) n
Shall the new role be allowed to create databases? (y/n) y
Shall the new role be allowed to create more new roles? (y/n) y</pre>

<p>
Puis, on lui crée une base de données dédiée :
</p>
<pre class="code">$ createdb -O &lt;nom_utilisateur&gt; -E UTF8 &lt;ma_database&gt;</pre>
<div class="noteclassic">Si vous avez recréé le groupe de bases de de données (cluster) avec les locales UTF8, il ne sera pas nécessaire de préciser l&#039;option <em>-E UTF8</em> car la base modèle par défaut (<em>template1</em>) présente déjà cet encodage
<p>
L&#039;option <em>-O &lt;nom_utilisateur&gt;</em>  est là pour préciser l&#039;identité du propriétaire de la base &lt;ma_database&gt;.
</p>

</div>
<p>
Ensuite, on peut se connecter via :
</p>
<pre class="code">$ psql -U &lt;nom_utilisateur&gt;
Mot de passe pour l&#039;utilisateur &lt;nom_utilisateur&gt; : </pre>

<p>
ou, si le nom de la base de l&#039;utilisateur n&#039;est pas le même que celui de l&#039;utilisateur : 
</p>
<pre class="code">$ psql -U &lt;nom_utilisateur&gt; &lt;nom_database_de_l_utilisateur&gt;
Mot de passe pour l&#039;utilisateur &lt;nom_utilisateur&gt; : </pre>

</div>

<h4 id="commodites_d_usage">Commodités d&#039;usage</h4>
<div class="level4">

<p>
Le fichier pg_hba.conf tel que défini ci-avant exige qu&#039;un mot de passe soit fourni pour autoriser la connexion d&#039;un rôle postgresql (dans notre cas &lt;nom_utilisateur&gt;). Si vous administrez une base de données et que vous êtes amenés à effectuer fréquemment des opérations, il peut être intéressant de se faciliter les connexions.
</p>

</div>

<h5 id="les_variables_d_environnement">Les variables d&#039;environnement</h5>
<div class="level5">

<p>
Les <a href="http://docs.postgresqlfr.org/9.0/libpq-envars.html" class="urlextern" title="http://docs.postgresqlfr.org/9.0/libpq-envars.html" rel="nofollow">variables  d&#039;environnement</a> sont utilisées pour sélectionner des valeurs par défaut pour les paramètres de connexion.
Les plus intéressantes à utiliser son PGUSER et PGHOST (notamment pour cette dernière si vous administrez une base qui n&#039;est pas sur un serveur <em>localhost</em>).
</p>

<p>
Pour que ces variables soient systématiquement disponibles dans votre shell de commandes, il faut les ajouter dans le fichier ~/.profile correspondant à votre utilisateur.
Les lignes à ajouter sont (à vous de défionir les variables à ajouter):
</p>
<pre class="code">export PGHOST=&lt;nom_hôte&gt;
export PGUSER=&lt;nom_utilisateur&gt;
 ...
 </pre>

<p>
 La variable PGUSER étant ainsi définie, votre connexion peut alors se résumer à 
</p>
<pre class="code">psql &lt;nom_database&gt;</pre>

<p>
et si vous définissez PGDATABASE, votre connexion express sera simplement
</p>
<pre class="code">psql</pre>
<div class="noteclassic">il faut toujours saisir le mot de passe correspondant à l&#039;utilisateur. Une variable PGPASSWORD existe, mais pour des raisons de sécurité, il est vivement recommandé de ne pas en faire usage.

</div>
</div>

<h5 id="le_fichier_pgpass">Le fichier .pgpass</h5>
<div class="level5">

<p>
Une autre manière, ou une manière complémentaire, de se simplifier les connexions est possible avec la définition du fichier <a href="http://docs.postgresqlfr.org/9.0/libpq-pgpass.html" class="urlextern" title="http://docs.postgresqlfr.org/9.0/libpq-pgpass.html" rel="nofollow">~/.pgpass</a>.
Ce fichier n&#039;existe pas par défaut, il vous faut donc le créer.
</p>
<pre class="code">nano ~/.pgpass</pre>

<p>
Son contenu est simplement défini par les chaînes de connexions à utiliser. 
</p>
<pre class="code">localhost:5432:*:nomutilisateur:motdepasse </pre>

<p>
Ceci indiquera à votre client psql que l&#039;utilisateur <em>nomutilisateur</em> accompagné du mot de passe <em>modepasse</em> est à utiliser pour la connexion à toutes <em>*</em> les bases de données de votre serveur <em>localhost</em> sur le port <em>5432</em> (port standard postgresql).
Ce fichier étant défini, la saisie du mot de passe n&#039;est plus effectuées par l&#039;utilisateur car il est directement fourni par les paramètres contenu dans ce fichier.
</p>

<p>
Et la sécurité ?
si vous tentez une connexion
</p>
<pre class="code">psql &lt;nom_database&gt;
WARNING: password file &quot;/home/&lt;user&gt;/.pgpass&quot; has group or world access; permissions should be u=rw (0600) or less</pre>

<p>
La limitation des droits d&#039;accès à ce fichier est recommandée
</p>
<pre class="code">chmod 0600 ~/.pgpass.</pre>

</div>

<h4 id="personnalisation">Personnalisation</h4>
<div class="level4">

<p>
Le tuning d&#039;un serveur postgreSQL se fait grâce au fichier <strong>postgresql.conf</strong> généralement positionné dans <strong>/etc/postgresql/X.x/main/</strong>, X.x étant la version utilisée de postgreSQL.
</p>

<p>
Plusieurs paramètres sont faciles à modifier et peuvent apporter un gain de performance important:
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <strong>shared_buffers</strong> = peut être positionné à 25% de la RAM pour un serveur dédié. Attention de ne pas trop monter ce paramètre tout de même car il faut laisser de la RAM au noyau pour gérer son cache</div>
</li>
<li class="level1"><div class="li"> <strong>wal_buffers</strong> = il est raisonnable de la passer à 8MB</div>
</li>
<li class="level1"><div class="li"> <strong>work_mem</strong> = à ajuster en fonction du nombre de connexion à la base, valeur entre 10MB et 100MB</div>
</li>
<li class="level1"><div class="li"> <strong>maintenance_work_mem</strong> = mémoire allouée aux actions de maintenance. Dépend de la taille des bases et de la RAM dispo. Perso, je l&#039;a met à 25% de la RAM</div>
</li>
<li class="level1"><div class="li"> <strong>checkpoint_segments</strong> = mettre au moins 10</div>
</li>
<li class="level1"><div class="li"> <strong>effective_cache_size</strong> = pour un serveur dédié compter 2/3 de la RAM</div>
</li>
</ul>

<p>
Ces quelques paramètres doivent suffire dans la majorité des cas. Si vous souhaitez aller plus loin dans le tuning de PostgreSQL, je vous conseille d&#039;aller voir là <a href="http://docs.postgresqlfr.org" class="urlextern" title="http://docs.postgresqlfr.org" rel="nofollow">documentation PostgreSQL</a> (qui existe en français)
</p>

</div>

<h4 id="roles_et_droits">Rôles et droits</h4>
<div class="level4">

<p>
Cette notion a été effleurée car les utilisateurs dont il a été question dans les lignes ci-avant sont des rôles au sens de postgresql.
Les droits affectés à ces rôles permet une gestion fine des autorisations d&#039;accès aux différents objets de la base de données (tables, vues, fonctions, champs…)
</p>

<p>
La  <a href="http://docs.postgresql.fr/9.1/user-manag.html" class="urlextern" title="http://docs.postgresql.fr/9.1/user-manag.html" rel="nofollow">documentation postgresql</a> est explicite à ce sujet, le mieux est de la consulter !
</p>

</div>

<h4 id="gestion_des_connexions">Gestion des connexions</h4>
<div class="level4">

<p>
Postgresql permet en amont des droits attribués aux rôles sur la base de données, une gestion des connexions. Celle ci est définie dans les fichiers de configuration <em>/etc/postgresql/x.x/main/pg_hba.conf </em> et <em>/etc/postgresql/x.x/main/postgresql.conf</em> dans le chapitre <em># CONNECTIONS AND AUTHENTICATION</em>
</p>

<p>
La documentation complète est disponible à ces adresses
</p>

<p>
<em><a href="http://docs.postgresql.fr/9.1/runtime-config-connection.html" class="urlextern" title="http://docs.postgresql.fr/9.1/runtime-config-connection.html" rel="nofollow">/etc/postgresql/x.x/main/postgresql.conf</a></em>
</p>

<p>
<em><a href="http://docs.postgresql.fr/9.1/client-authentication.html" class="urlextern" title="http://docs.postgresql.fr/9.1/client-authentication.html" rel="nofollow">/etc/postgresql/x.x/main/pg_hba.conf</a></em>
</p>

</div>

<h4 id="ajout_de_contributions">ajout de contributions</h4>
<div class="level4">

<p>
Différentes contributions sont disponibles (cf la <a href="http://docs.postgresqlfr.org/9.1/contrib.html" class="urlextern" title="http://docs.postgresqlfr.org/9.1/contrib.html" rel="nofollow">documentation PostgreSQL</a>). Leur installation (et désinstallation) est facilitée par l&#039;existence de paquets dédiés
</p>
<pre class="code">sudo apt-get install postgresql-contrib
Les paquets supplémentaires suivants seront installés : 
  libossp-uuid16 postgresql-contrib-9.1</pre>

<p>
Les scripts permettant l&#039;application de ces extensions sont disponibles dans <strong>/usr/share/postgresql/9.1/extension/*.sql</strong>
L&#039;ajout se fait par exécution du script concerné sur la base de données souhaitée.
</p>
<pre class="code">$ psql -U &lt;nom_utilisateur&gt; &lt;nom_database&gt; -f /usr/share/postgresql/9.1/extension/&lt;nom_extension&gt;.sql</pre>

</div>

<h4 id="creer_un_utilisateur_en_lecture_seul">Créer un utilisateur en lecture seul</h4>
<div class="level4">

<p>
Pour ne permettre seulement une consultation des données par un utilisateur sans droit de modification, il faut exécuter la requête suivante:
</p>
<pre class="code">ALTER USER &lt;nom_utilisateur&gt;  set default_transaction_read_only = on;</pre>

</div>
<div class='secedit editbutton_section editbutton_15'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Pour aller plus loin] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="pour_aller_plus_loin" /><input type="hidden" name="codeblockOffset" value="31" /><input type="hidden" name="range" value="14041-23376" /><button type="submit" title="Pour aller plus loin" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit16 page-header" id="installation_de_la_cartouche_spatiale_postgis">Installation de la cartouche spatiale PostGIS</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_16'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Installation de la cartouche spatiale PostGIS] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation_de_la_cartouche_spatiale_postgis" /><input type="hidden" name="codeblockOffset" value="42" /><input type="hidden" name="range" value="23377-23434" /><button type="submit" title="Installation de la cartouche spatiale PostGIS" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit17" id="ce_qu_est_postgis">Ce qu&#039;est postgis</h3>
<div class="level3">

<p>
<a href="http://postgis.refractions.net/" class="urlextern" title="http://postgis.refractions.net/" rel="nofollow">Postgis</a> est une extension de postgresql qui permet la gestion d&#039;objets géographiques. Concrètement la cartouche spatiale postgis ajoute au serveur :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li">  la possibilité de définir le type de champ <em>geometry</em> </div>
</li>
<li class="level1"><div class="li"> l&#039;ensemble des fonctions permettant les traitements géographiques</div>
</li>
<li class="level1"><div class="li"> la base de référence des projections géographiques <em>spatial_ref_sys</em></div>
</li>
<li class="level1"><div class="li"> la base de gestion des attributs géographiques des tables <em>geometry_columns</em></div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_17'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Ce qu&#039;est postgis] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="ce_qu_est_postgis" /><input type="hidden" name="codeblockOffset" value="42" /><input type="hidden" name="range" value="23435-23944" /><button type="submit" title="Ce qu&#039;est postgis" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit18" id="installation">Installation</h3>
<div class="level3">

<p>
Installer le paquet correspondant à votre version de postgres, exemples:
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <a href="apt://postgresql-10-postgis-2.4" class="urlextern" title="apt://postgresql-10-postgis-2.4" rel="nofollow">postgresql-10-postgis-2.4</a> sous <a href="/bionic" class="wikilink1" title="bionic">bionic</a></div>
</li>
<li class="level1"><div class="li"> <a href="apt://postgresql-9.1-postgis" class="urlextern" title="apt://postgresql-9.1-postgis" rel="nofollow">postgresql-9.1-postgis</a></div>
</li>
</ul>
<pre class="code">Les paquets supplémentaires suivants seront installés : 
  libgeos-3.2.2 libgeos-c1 libproj0 postgis proj-data</pre>

<p>
Les scripts nécessaires à la capacitation géographique de postgresql sont installé dans le dossier<br/>

 <em> /usr/share/postgresql/9.1/contrib/postgis-1.5</em>/ ou<br/>

 <em> /usr/share/postgresql/10/contrib/postgis-2.4</em>/
</p>

</div>
<div class='secedit editbutton_section editbutton_18'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Installation] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation" /><input type="hidden" name="codeblockOffset" value="42" /><input type="hidden" name="range" value="23945-24529" /><button type="submit" title="Installation" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit19" id="donner_a_une_base_la_capacite_geographique">Donner à une base la capacité géographique</h3>
<div class="level3">
<div class="noteclassic">Les scripts donnés ci-après prennent pour hypothèse qu&#039;un nouvel utilisateur a été créé avec la méthode <a href="/postgresql#pour_aller_plus_loin" class="wikilink1 curid" title="postgresql" data-curid="true">recommandée</a>

</div>
<p>
Tout d&#039;abord, créer la base de données en question
</p>
<pre class="code">createdb -U &lt;nom_utilisateur&gt; &lt;nom_base_geo&gt;</pre>

<p>
Puis on utilser le rôle postgres (super user postgresql)
</p>
<pre class="code">$ sudo -i -u postgres </pre>

<p>
pour exécuter dans cet ordre les scripts suivants :
</p>
<pre class="code">psql -f /usr/share/postgresql/9.1/contrib/postgis-1.5/postgis.sql  &lt;nom_base_geo&gt;
psql -f /usr/share/postgresql/9.1/contrib/postgis-1.5/spatial_ref_sys.sql  &lt;nom_base_geo&gt;</pre>

<p>
puis on quitte le shell postgres
</p>
<pre class="code">exit</pre>
<div class="notetip">Si vous êtes amenés à créer plusieurs bases géographiques, il peut être intéressant de créer une base qui serve de modèle, par exemple <em>template_postgis</em>
Il est ensuite très facile de créer une base géographique en appelant ce modèle lors de la création d&#039;un base<pre class="code">createdb -U &lt;nom_utilisateur&gt; -T template_postgis &lt;nom_base_geo&gt;</pre>

</div>
<p>
Pour faire des imports et des exports (car la fonction sur phppgadmin est bancale) :
</p>
<pre class="code">$ sudo -i -u postgres</pre>

<p>
export :
</p>
<pre class="code">pg_dump &lt;nom_de_la_base&gt; &gt; nom_de_la_base.pgdump</pre>

<p>
import:
</p>
<pre class="code">cat  nom_de_la_base.pgdump | psql -d  nom_de_la_base</pre>

</div>
<div class='secedit editbutton_section editbutton_19'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Donner à une base la capacité géographique] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="donner_a_une_base_la_capacite_geographique" /><input type="hidden" name="codeblockOffset" value="43" /><input type="hidden" name="range" value="24530-25822" /><button type="submit" title="Donner à une base la capacité géographique" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit20 page-header" id="clients_graphiques">Clients graphiques</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_20'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Clients graphiques] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="clients_graphiques" /><input type="hidden" name="codeblockOffset" value="43" /><input type="hidden" name="range" value="25823-25854" /><button type="submit" title="Clients graphiques" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit21" id="dbeaver">DBeaver</h3>
<div class="level3">

<p>
Si vous utilisez d&#039;autres types de base de données, cette solution a l&#039;avantage de les supporter,<br/>
voir la page <a href="/dbeaver" class="wikilink1" title="dbeaver">dbeaver</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_21'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[DBeaver] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="dbeaver" /><input type="hidden" name="codeblockOffset" value="43" /><input type="hidden" name="range" value="25855-26001" /><button type="submit" title="DBeaver" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit22" id="le_client_pgadmin4">Le client pgadmin4</h3>
<div class="level3">

<p>
Outils web graphique d&#039;administration de vos bases
</p>
<pre class="code bash"><span class="kw2">sudo</span> apt <span class="kw2">install</span> postgresql-common
<span class="kw2">sudo</span> <span class="kw2">sh</span> <span class="sy0">/</span>usr<span class="sy0">/</span>share<span class="sy0">/</span>postgresql-common<span class="sy0">/</span>pgdg<span class="sy0">/</span>apt.postgresql.org.sh
<span class="kw2">sudo</span> apt update
<span class="kw2">sudo</span> apt <span class="kw2">install</span> postgresql-<span class="nu0">11</span> pgadmin4</pre>

<p>
<sup><a href="#fn__1" id="fnt__1" class="fn_top">1)</a></sup>
puis simplement lancer pgadmin4 via le lanceur qui a été ajouté ou en CLI
</p>

</div>
<div class='secedit editbutton_section editbutton_22'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Le client pgadmin4] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="le_client_pgadmin4" /><input type="hidden" name="codeblockOffset" value="43" /><input type="hidden" name="range" value="26002-26390" /><button type="submit" title="Le client pgadmin4" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit23" id="le_client_pgadmin3">Le client pgadmin3</h3>
<div class="level3">

<p>
PgAdmin III est un outil graphique d&#039;administration de votre serveur PostgreSQL. L&#039;application pgAdmin III peut être utilisé pour administrer les serveurs PostgreSQL 7.3 et les versions supérieures. PgAdmin III existe pour toutes les plateformes dont, évidemment, Ubuntu, KUbuntu, XUbuntu.
</p>

<p>
PgAdmin III a été conçu pour répondre aux besoins de tous les utilisateurs, depuis la rédaction de simple requêtes SQL au développement complexe de base de données. L&#039;interface graphique supporte toutes les fonctionnalités de PostGreSQL et permet une administration simple. L&#039;application inclut aussi un éditeur de requête avec coloration syntaxique, un éditeur de code, un agent de gestion de tâche automatique, un support pour les réplication via Slony-I et bien d&#039;autres fonctionnalités. 
</p>

</div>

<h5 id="installation_du_client_pgadmin3">Installation du client pgadmin3</h5>
<div class="level5">

<p>
On commence par <a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer</a> les paquets nécessaires : pgadmin3
</p>
<pre class="code">sudo apt-get install pgadmin3</pre>

<p>
Cela va également installer les paquets suivants :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> libpq4</div>
</li>
<li class="level1"><div class="li"> libwxbase2.6-0 </div>
</li>
<li class="level1"><div class="li"> libwxgtk2.6-0</div>
</li>
<li class="level1"><div class="li"> pgadmin3-data</div>
</li>
</ul>
<div class="table-responsive"><table class="inline table table-striped table-condensed">
	<thead>
	<tr class="row0">
		<th class="col0"> Installer en 1 clic </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <a href="apt://pgadmin3" class="media" title="apt://pgadmin3" rel="nofollow"><img src="/_media/apt.png" class="mediacenter img-responsive" title="Installer en 1 clic." alt="Installer en 1 clic." /></a> </td>
	</tr>
</table></div>

</div>

<h5 id="lancement_du_client_pgadmin3">Lancement du client pgadmin3</h5>
<div class="level5">

<p>
Sous Ubuntu, pour lancer PgAdmin III, aller dans le menu <strong>Applications</strong> ⇒ <strong>programmation</strong> ⇒ <strong>pgAdmin III</strong>
</p>
<div class="noteclassic"><strong>Remarque:</strong>
<p>
En suivant la section ci-haut &quot;Méthode rapide, non sécurisée&quot; pgadmin3 n&#039;acceptera pas la connexion aux bases de données. Il faudra definir un mot de passe à l&#039;utilisateur avant (voir la procédure sécurisée)
</p>
<pre class="code">$ psql -d template1 -c &quot;alter user &lt;nom_utilisateur&gt; with password &#039;&lt;votre_mot_de_passe&gt;&#039;&quot;</pre>

</div>
</div>

<h5 id="utilisation_du_client_pgadmin3_via_ssh">Utilisation du client pgadmin3 via ssh</h5>
<div class="level5">

<p>
La connexion à la base de donnée necessite la création d&#039;un tunnel
</p>
<pre class="code">ssh -L 5555:localhost:5432 utilisateur@adresse_du_serveur</pre>

<p>
Le port 5555 correspond au port de redirection sur le port local (vous pouvez en choisir un autre). Le port 5432 correspond au port d&#039;écoute de postgres (ne pas modifier).
</p>

<p>
Cet exemple s&#039;entend en connexion ssh sur le port standard 22.
</p>

<p>
Si vous avez modifié le port d&#039;écoute ssh (et vous devriez le faire pour des raisons de sécurité), utilisez cette commande : (1444 est un exemple, vous pouvez en chosir un autre).
</p>
<pre class="code">ssh -L 5555:localhost:5432 utilisateur@nom_du_serveur -p 1444</pre>

<p>
Le serveur vous demandera votre mot de passe. Ouvrez maintenant pgadmin3
</p>
<pre class="code">Nom : nom_de_votre_database
Hôte : localhost
Port TCP : 5555 (selon l&#039;exemple ci-dessus)</pre>

<p>
Vous devriez être maintenant connecté
</p>

</div>
<div class='secedit editbutton_section editbutton_23'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Le client pgadmin3] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="le_client_pgadmin3" /><input type="hidden" name="codeblockOffset" value="44" /><input type="hidden" name="range" value="26391-29008" /><button type="submit" title="Le client pgadmin3" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit25" id="le_client_phppgadmin">Le client phppgadmin</h3>
<div class="level3">

</div>

<h4 id="installation_du_client_phppgadmin">Installation du client phppgadmin</h4>
<div class="level4">

<p>
Il suffit d&#039;<a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer le paquet</a> <strong>phppgadmin</strong>, à condition que vous ayez un serveur Web fonctionnel et reconnaissant php.
</p>
<div class="table-responsive"><table class="inline table table-striped table-condensed">
	<thead>
	<tr class="row0">
		<th class="col0"> Le serveur Web php en un clic </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <a href="apt://apache2,apache2-doc,mysql-server,php5,libapache2-mod-php5,php5-mysql,phpmyadmin" class="media" title="apt://apache2,apache2-doc,mysql-server,php5,libapache2-mod-php5,php5-mysql,phpmyadmin" rel="nofollow"><img src="/_media/apt.png" class="mediacenter img-responsive" title="Installer en 1 clic." alt="Installer en 1 clic." /></a> </td>
	</tr>
</table></div>
<div class="table-responsive"><table class="inline table table-striped table-condensed">
	<thead>
	<tr class="row0">
		<th class="col0"> phppgadmin en un clic</th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0"> <a href="apt://phppgadmin" class="media" title="apt://phppgadmin" rel="nofollow"><img src="/_media/apt.png" class="mediacenter img-responsive" title="Installer en 1 clic." alt="Installer en 1 clic." /></a> </td>
	</tr>
</table></div>

<p>
Réaliser ensuite les opérations suivantes : <img src="/lib/images/smileys/fixme.gif" class="icon" alt="FIXME" /> (sous <a href="/bionic" class="wikilink1" title="bionic">bionic</a>, pas de fichier <em>apache.conf</em> mais <em>config.inc.php</em> !
</p>
<pre class="code">sudo ln -s /etc/phppgadmin/apache.conf /etc/apache2/conf.d/phppgadmin.conf
sudo mv /etc/apache2/conf.d/phppgadmin /etc/apache2/conf-available/phppgadmin.conf
sudo a2enconf phppgadmin
sudo service apache2 restart</pre>

</div>

<h4 id="lancement_du_client_phppgadmin">Lancement du client phppgadmin</h4>
<div class="level4">

<p>
Lance votre navigateur Web préféré à l&#039;adresse <a href="http://localhost/phppgadmin/" class="urlextern" title="http://localhost/phppgadmin/" rel="nofollow">http://localhost/phppgadmin/</a>.
</p>

</div>

<h4 id="utilisation_du_client_phppgadmin">Utilisation du client phppgadmin</h4>
<div class="level4">

<p>
<img src="/lib/images/smileys/fixme.gif" class="icon" alt="FIXME" />
</p>

</div>
<div class='secedit editbutton_section editbutton_25'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Le client phppgadmin] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="le_client_phppgadmin" /><input type="hidden" name="codeblockOffset" value="48" /><input type="hidden" name="range" value="29009-30039" /><button type="submit" title="Le client phppgadmin" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit28" id="connexions_vers_php">Connexions vers PHP</h3>
<div class="level3">

<p>
<a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer|Installer le paquet</a> <a href="apt://php-pgsql" class="urlextern" title="apt://php-pgsql" rel="nofollow">php-pgsql</a>
</p>
<div class="noteclassic">Il faut recharger Apache après avoir installé ce module : sudo service apache2 reload
</div>
<p>
Activer ce module
</p>
<pre class="code">sudo phpenmod pdo_pgsql</pre>

<p>
Redémarrer apache2
</p>

</div>
<div class='secedit editbutton_section editbutton_28'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Connexions vers PHP] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="connexions_vers_php" /><input type="hidden" name="codeblockOffset" value="49" /><input type="hidden" name="range" value="30040-30348" /><button type="submit" title="Connexions vers PHP" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit29" id="pool_de_connexionpgbouncer">Pool de connexion : PgBouncer</h3>
<div class="level3">

<p>
<a href="/pgbouncer" class="wikilink1" title="pgbouncer">PgBouncer</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_29'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Pool de connexion : PgBouncer] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="pool_de_connexionpgbouncer" /><input type="hidden" name="codeblockOffset" value="50" /><input type="hidden" name="range" value="30349-30410" /><button type="submit" title="Pool de connexion : PgBouncer" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit30 page-header" id="recuperation_du_contenu_d_une_base_de_donnees_apres_un_crash_serveur">Récupération du contenu d&#039;une base de données après un crash serveur</h2>
<div class="level2">

<p>
Supposons que vous ayez installé sous <a href="/ubuntu_server" class="wikilink1" title="ubuntu_server">ubuntu server</a> une application d&#039;entreprise s&#039;appuyant sur une base de données postgresql (cette procédure a été testée avec <a href="/redmine" class="wikilink1" title="redmine">redmine</a>), et qu&#039;un crash se produise qui rende impossible de redémarrer le serveur. Se pose alors le problème de la récupération des données. La procédure est relativement simple. Il va vous falloir:
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Monter votre ancienne installation depuis une autre installation ou via un live cd</div>
</li>
<li class="level1"><div class="li"> <a href="/chroot" class="wikilink1" title="chroot">chrooter </a>dessus</div>
</li>
<li class="level1"><div class="li"> changer d&#039;utilisateur pour l&#039;utilisateur postgres</div>
</li>
<li class="level1"><div class="li"> démarrer la base de données</div>
</li>
<li class="level1"><div class="li"> effectuer un pg_dump pour sauvegarder la base de données.</div>
</li>
</ul>

<p>
Ceci fait, après avoir réinstallé votre application d&#039;entreprise sur un nouveau serveur ubuntu neuf, il n&#039;y aura plus qu&#039;à y importer la sauvegarde. Venons en aux détails techniques.
</p>

</div>

<h4 id="montage_et_chroot_sur_votre_ancienne_installation_depuis_un_live_cd_ou_depuis_le_nouveau_serveur">Montage et chroot sur votre ancienne installation depuis un live CD ou depuis le nouveau serveur</h4>
<div class="level4">
<pre class="code">sudo fdisk -l                     # pour vous aider à trouver la bonne partition
sudo mount /dev/sdYX /mnt         # montage de celle-ci en remplaçant le Y par la lettre du volume, et le X par le bon numéro de partition
sudo mount --bind /dev /mnt/dev   # lien symbolique du dossier /dev en cours d&#039;utilisation vers le disque monté
sudo mount -t proc /proc /mnt/proc # Étape facultative?
sudo chroot /mnt                  # mise à la racine du disque monté</pre>

</div>

<h4 id="demarrage_de_la_base_de_donnees_changement_d_utilisateur_et_sauvegarde_de_son_contenu">démarrage de la base de données, changement d&#039;utilisateur, et sauvegarde de son contenu</h4>
<div class="level4">

<p>
Démarrez la base de données dans le chroot
</p>
<pre class="code">service postgresql-8.4 start      # démarre postgresql dans le chroot</pre>
<div class="notetip">Si vous avez effectué le chroot depuis une installation d&#039;Ubuntu où un serveur de base de données postgresql est déjà installé et actif, vous aurez probablement des avertissements concernant les ports non disponibles. Deux solutions existent alors, soit affecter des ports différents à l&#039;un des deux, soit interrompre temporairement le serveur actif le temps de la sauvegarde via la commande <pre class="code">service postgresql-8.4 stop</pre>



</div>
<p>
Maintenant, connectez-vous en tant que postgres, et effectuez la sauvegarde.
</p>
<pre class="code">sudo -i -u postgres                                                # change l&#039;utilisateur courant (root) pour l&#039;utilisateur postgres
pg_dump -f /chemin/de/sauvegarde/choisi/NOM_BDD.sql NOM_BDD     # effectue la sauvegarde de la base de données</pre>

</div>

<h4 id="sortie_du_chroot_en_douceur">Sortie du chroot en douceur</h4>
<div class="level4">

<p>
Au cours de ces opérations, vous avez monté des partitions et créé un chroot. Il ne faut pas oublier de les exécuter dans l&#039;ordre inverse, si possible proprement.
</p>
<pre class="code">exit                          # permet de cesser d&#039;agir en tant qu&#039;utilisateur postgres
service postgresql-8.4 stop   # permet de stopper le serveur postgresql dans le chroot
exit                          # permet de quitter le chroot
sudo umount /mnt/dev/         # désactive le lien symbolique du dossier /dev en cours d&#039;utilisation vers le disque monté
sudo umount /mnt/proc/        # désactive le lien symbolique du dossier /proc en cours d&#039;utilisation vers le disque monté
sudo umount /mnt/             # démontage final de l&#039;ancienne partition d&#039;installation du serveur</pre>
<div class="notetip">Si vous avez sauvegardé votre base de données sur la partition du chroot (ce qui est déconseillé, le volume n&#039;étant a priori pas sûr), pensez à le copier sur un support externe avant de terminer le démontage de la partition.
</div>
</div>

<h4 id="restaurer_la_sauvegarde_sur_la_nouvelle_installation">Restaurer la sauvegarde sur la nouvelle installation</h4>
<div class="level4">

<p>
La restauration de la sauvegarde est très simple : connectez-vous sur votre nouvelle installation, et changez d&#039;utilisateur pour postgres. Supprimez la base de données créée par défaut pour éviter tout conflit (une petite sauvegarde préalable de celle-ci ne fera pas de mal), recréez-la, et importez-y votre base sauvegardée :
</p>
<pre class="code">sudo -i -u postgres                  # change l&#039;utilisateur courant (root) pour l&#039;utilisateur postgres
dropdb NOM_BDD                    # efface la base de données existante
createdb --owner=NOM_APPLI --encoding=utf-8 NOM_BDD         # recréée une base de données vide
psql -f /chemin/de/sauvegarde/choisi/redmine.sql NOM_BDD    # importe la base de données sauvegardée</pre>
<div class="notetip">L&#039;option <code>–owner=NOM_APPLI</code> de la troisième commande suppose que vous avez configuré un utilisateur système pour votre application
</div>
</div>
<div class='secedit editbutton_section editbutton_30'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Récupération du contenu d&#039;une base de données après un crash serveur] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="recuperation_du_contenu_d_une_base_de_donnees_apres_un_crash_serveur" /><input type="hidden" name="codeblockOffset" value="50" /><input type="hidden" name="range" value="30411-34966" /><button type="submit" title="Récupération du contenu d&#039;une base de données après un crash serveur" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit31 page-header" id="formations">Formations</h2>
<div class="level2">

<p>
La société Dalibo mets ses support de cours à disposition (<a href="https://creativecommons.org/licenses/by-nc-sa/2.0/fr/" class="urlextern" title="https://creativecommons.org/licenses/by-nc-sa/2.0/fr/" rel="nofollow">CC BY NC SA</a>):<br/>

<a href="https://www.dalibo.com/formations" class="urlextern" title="https://www.dalibo.com/formations" rel="nofollow">https://www.dalibo.com/formations</a><br/>

sous l&#039;intitulé de chaque formation, vous trouvez les liens pour télécharger le support au format <a href="/pdf" class="wikilink1" title="pdf">PDF</a> ou <a href="/epub" class="wikilink1" title="epub">EPUB</a><br/>

exemple: lien directe au support PDF de la formation <em>DBA1 - PostgreSQL Administration</em> : <a href="https://dali.bo/dba1_pdf" class="urlextern" title="https://dali.bo/dba1_pdf" rel="nofollow">https://dali.bo/dba1_pdf</a>
</p>
<hr />

<p>
<em>Contributeurs : <a href="/utilisateurs/yannick_lm" class="wikilink1" title="utilisateurs:yannick_lm">Yannick</a>, <a href="/utilisateurs/sparky" class="wikilink1" title="utilisateurs:sparky">Sparky</a>, <a href="/utilisateurs/elemmire" class="wikilink1" title="utilisateurs:elemmire">Elemmire</a>, <a href="/utilisateurs/aldian" class="wikilink1" title="utilisateurs:aldian">Aldian</a>, <a href="/utilisateurs/fred" class="wikilink1" title="utilisateurs:fred">Fred</a>,<a href="/utilisateurs/xavierjm" class="wikilink2" title="utilisateurs:xavierjm" rel="nofollow">XAVIER_jean-marie</a>. </em>
</p>

</div>
<div class='secedit editbutton_section editbutton_31'><form class="button btn_secedit form-inline" method="post" action="/postgresql"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1631983904" /><input type="hidden" name="summary" value="[Formations] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="formations" /><input type="hidden" name="codeblockOffset" value="56" /><input type="hidden" name="range" value="34967-" /><button type="submit" title="Formations" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div><hr/><div class="footnotes">
<div class="fn"><sup><a href="#fnt__1" id="fn__1" class="fn_bot">1)</a></sup> 
<div class="content">source (EN) <a href="https://wiki.postgresql.org/wiki/Apt" class="urlextern" title="https://wiki.postgresql.org/wiki/Apt" rel="nofollow">https://wiki.postgresql.org/wiki/Apt</a></div></div>
</div>

</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="postgresql.txt">postgresql.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 18/09/2021, 18:51">Le 18/09/2021, 18:51</span></li><li class="text-muted">par 82.65.193.81</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=postgresql&amp;1635561012" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
