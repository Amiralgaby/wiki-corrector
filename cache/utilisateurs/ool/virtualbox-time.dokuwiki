
{{tag>virtualisation BROUILLON}}


====== Maintenir à l’heure une machine hôte de Virtualbox et ses machines virtuelles invitées ======
L’horloge est cruciale dans le fonctionnement quotidien d’un système. Elle rythme les processus, à la base des traitements et communications au sein et hors d’une machine.

La machine hôte de Virtualbox – celle sur laquelle Virtualbox est installée – sert de référence par défaut aux machines virtuelles (VM) invitées dans Virtualbox en termes d’horloge.

Il est ainsi important d’assurer la synchronisation de l’horloge du système hôte de Virtualbox et des systèmes invités de Virtualbox avec, par exemple, une horloge de référence externe – typiquement une horloge atomique à accès public en ligne.

=====Pré-requis=====
  * Une machine sur laquelle fonctionne [[:Virtualbox|]] (machine alors appelée //Host// ou hôte)
  * Une ou des machines virtuelles hébergées par l’hôte Virtualbox (VM ou système invité)
  * Les privilèges d’administration dans les deux systèmes (hôte et invité).

===== Mise à l’heure du Host =====
====NTP====
Utilisation de [[:ntp]], par exemple avec le [[http://www.pool.ntp.org/zone/fr|pool NTP France]].

Le protocole NTP – Network Time Protocol – permet notamment de synchroniser les horloges de deux systèmes.
==== Réglage de l’horloge du bios sur l’horloge du Host ====
Sur la machine hôte, on distingue deux horloges :
  * l’horloge matérielle ou interne, gérée par le [[wpfr>BIOS (informatique)|BIOS]] de la machine hôte ;
  * l’horloge logicielle ou système, gérée par le système d’exploitation installé sur la machine hôte.

Le principe retenu ici est de procéder en deux temps :
  - synchroniser l’horloge système à partir d’une horloge de référence externe – par exemple le pool NTP France évoqué supra ;
  - synchroniser l’horloge matérielle à partir de l’horloge système – celle-ci ayant été mise à jour à l’étape précédente.

Pour afficher l’heure du BIOS (horloge matérielle) :
<code>
sudo hwclock -r
</code>
Pour synchroniser l’horloge du BIOS avec l’horloge du système hôte :
<code>
sudo hwclock --systohc
</code>

===== Mise à l’heure d’une VM =====
Le principe repose sur la synchronisation de l’horloge système de la VM à partir de l’horloge matérielle (BIOS) de la machine hôte.

Opérations à réaliser dans le __système invité__ de la VM :
  * Ne pas installer ''ntp'' (cela ne peut être que source de conflit) ;
  * Synchroniser l’horloge système de la VM avec l’horloge matérielle :
<code>
sudo hwclock --hctosys
</code>

Dans le cas où la synchronisation précédente est insatisfaisante, une reconfiguration de la VM est possible depuis le système hôte :
  * Arrêter le système invité / éteindre la VM ;
  * Depuis le système hôte, commander le changement de configuration de la VM nommée //NomVM// :
<code>
VBoxManage modifyvm <NomVM> --biossystemtimeoffset -0
</code>
<note>
Dans la ligne de commande supra, retirer les chevrons //<// et //>// encadrant le nom //NomVM// de la VM ciblée.
</note>

===== Conclusion =====
Le redémarrage de la VM assure la synchronisation de son horloge avec celle de la machine hôte.

//Contributeurs principaux : [[:utilisateurs:Ool]]