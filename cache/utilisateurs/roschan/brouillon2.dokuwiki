{{tag>Xenial tutoriel application format paquet BROUILLON}}

<note help>Cette page a pour adresse finale [[:tutoriel/installer_application_flatpak|ceci]]</note>

----

{{ http://i.imgur.com/epoTNSU.png?100}}

====== Tutoriel : installer une application avec Flatpak ======

Le système [[:Flatpak]] permet le déploiement de logiciels, la gestion de paquets et la virtualisation d'applications sur ordinateurs personnels. Il fournit un environnement isolé du reste du système (//sandbox//), où l'utilisateur peut faire fonctionner des applications de manière mieux sécurisée.

Ce tutoriel vous expliquera comment utiliser [[:Flatpak]] pour installer des logiciels.

{{ http://i.imgur.com/Ezy1wRU.png?600 |Les logiciels Eolie, Lollypop, GNOME Recipes et Peek sont distribués au format flatpak}}

===== Pré-requis =====

Il faut installer le paquet **[[:flatpak]]** (voir la page de l'application), et d'une connexion internet fonctionnelle.

Si vous désirez disposer des logiciels en format //flatpak// dans la [[:gnome-software|logithèque]], vous pouvez aussi installer :

  * Ubuntu ou autre variante : **[[apt>gnome-software-plugin-flatpak]]**
  * Kubuntu : **[[apt>plasma-discover-flatpak-backend]]**

==== Niveaux de privilèges ====

La plupart des commandes liées à //flatpak// possèdent une option ''-​-user'', par opposition à l'option par défaut ''-​-system''.

L'option ''-​-user'' implique que la manipulation ne concerne que l'utilisateur courant. Cette option est détaillée [[#Installation pour un seul utilisateur|plus loin]], mais gardez à l'esprit que les manipulations qui suivent (ajout de dépôts, installation, désinstallation) peuvent être faites en utilisant cette option.

<note important>Les droits d'administration sont nécessaires si vous voulez ajouter des dépôts pour tout le système (c'est l'option par défaut), mais **ne tapez pas la commande ''sudo''** !

Une fenêtre s'ouvrira pour demander le mot de passe au moment où il sera nécessaire, et uniquement à ce moment là.</note>

===== Ajouter le dépôt flathub =====

Comme tous les gestionnaires de paquets, //flatpak// va chercher ce qu'il lui faut dans des dépôts, qui ne sont pas configurés par défaut, entre autres car ils sont **indépendants de la distribution**.
<note help>Le concept de dépôt flatpak est parfois désigné par le terme "remote" (ce qui signifie "à distance").</note>

Il existe divers dépôts Flatpak différents, le système ayant été pensé pour être décentralisé. La syntaxe générale de la commande est 
<code>flatpak remote-add --if-not-exists nom_du_dépôt https://adresse-du-dépôt.flatpakrepo</code>

La plupart des paquets Flatpak disponibles sont dans le dépôt **[[https://flathub.org/|flathub]]**, qui nous servira donc d'exemple :
<code>flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo</code>

<note>flathub.org est un dépôt indépendant de toute distribution et de tout environnement, il accueille des logiciels variés, venu de diverses fondations ou distributions ([[:KDE]], elementary, [[:GNOME]], [[:linux_mint|Mint]], etc.), mais aussi des logiciels indépendants.</note>

==== Autres dépôts ====

Parmi les dépôts notables et sécurisés, on peut remarquer celui des applications [[:GNOME]] :
<code>flatpak remote-add --if-not-exists gnome-apps https://sdk.gnome.org/gnome-apps.flatpakrepo</code>
et celui des applications [[:KDE]] :
<code>flatpak remote-add kdeapps --if-not-exists https://distribute.kde.org/kdeapps.flatpakrepo</code>

Les logiciels de ces environnements étant pour la plupart déjà dans les dépôts [[:apt]], et pour certains sur flathub, ces dépôts sont normalement superflus.

===== Installation de logiciels =====

==== Les runtimes ====

Pour s'exécuter, les applications qu'on installera auront besoin d'un //runtime//.

Il s'agit, en bon français, d'un **environnement d'exécution**(([[wpfr>Environnement d'exécution]])) : dans le cas d'une application "normale" (pas en flatpak ni en [[:snap]]), l'environnement d'exécution est directement votre système Ubuntu lui-même, ce qui implique un certain nombre de limitations, notamment en terme de compatibilité des versions.

Ne soyez pas donc surpris si une confirmation vous sera demandée pour l'installation d'un //runtime//.

<note important>L'installation d'une application est assez courte, mais celle d'un //runtime// peut prendre une bonne minute ; heureusement, des applications distinctes utilisent souvent le même //runtime//.</note>

=== Autres dépôts ===

Si vous voulez installer quelque chose depuis le dépôt ''gnome-apps'', il faudra peut-être au préalable ajouter le dépôt suivant :
<code>flatpak remote-add --if-not-exists gnome https://sdk.gnome.org/gnome.flatpakrepo</code>
qui contient les environnements d'exécution exigés par les applications GNOME.

Si vous voulez installer quelque chose depuis le dépôt ''kdeapps'', il faudra peut-être au préalable ajouter le dépôt suivant :
<code>flatpak remote-add kderuntime --if-not-exists http://distribute.kde.org/kderuntime.flatpakrepo</code>
qui contient les environnements d'exécution exigés par les applications KDE.

==== Nommage des logiciels ====

Dans les dépôts (tous, pas seulement //flathub//), les applications sont identifiées par un nom qui suit un format normé, assez différent de ce qui se fait avec [[:apt]] (exemples) :

^ Nom dans le dépôt ^ Application ^
| com.spotify.Client | Client de bureau [[:Spotify]] |
| org.gnome.Eolie | Navigateur web [[:Eolie]] |
| org.libretro.RetroArch | [[:emulation|Émulateurs]] RetroArch (retrogaming) |
| io.github.GnomeMpv | GNOME MPV (interface GTK+ 3  pour le lecteur multimédia [[:MPV]]) |
| com.uploadedlobster.peek | Peek (enregistreur de GIF) |
| org.gnome.Lollypop | Lecteur musical [[:Lollypop]] |
| net.sourceforge.chromium-bsu | Le jeu vidéo libre Chromium-BSU |
| net.sourceforge.TuxFootball | Le jeu vidéo 2D TuxFootball |
| org.gtk.Gtk3theme.Arc-Dark | Le [[:tutoriel/personnaliser_gnome|thème GTK+ 3]] "Arc-Dark" |
| com.valvesoftware.Steam | Plateforme de jeux vidéo [[:Steam]] |

L'auto-complétion (double appui sur tab) sera souvent utile pour trouver le nom exact.

==== Installation depuis la logithèque ====

{{ :tutoriel:flatpak-logitheque.png?400|Exemple avec l'application Pitivi. La version au format Flatpak se reconnaît grâce à l'URL de flathub.org écrite sous la description du logiciel.}}

Si vous avez suivi les prérequis, les logiciels sont disponibles depuis [[:gnome-software|la logithèque]] et s'installent donc comme n'importe quel logiciel :

~CB~

==== Installation en ligne de commande ====

Pour disposer de davantage d'options d'installation, vous préférerez peut-être passer par le [[:terminal]], où une simple ligne de commande suffira.

Exemple pour [[:Lollypop]] :
<code>flatpak install flathub org.gnome.Lollypop</code>

On peut mettre plusieurs noms d'applications dans la même commande :
<code>flatpak install flathub com.uploadedlobster.peek com.valvesoftware.Steam</code>

<note tip>Pour connaître l'identifiant de l'application avec certitude, utilisez l'auto-complétion, ou bien cherchez un mot-clé ou un nom de logiciel :
<code>flatpak search steam</code>
</note>

===== Options intéressantes =====

==== Installation depuis un fichier ====

Certains distributeurs de logiciels vont proposeront plutôt un fichier ''.flatpakref'' qui s'installe ainsi :

<code>flatpak install --from adresse/du/fichier.flatpakref</code>

L'adresse du fichier peut être le chemin du fichier parmi les documents sur votre disque, ou bien une adresse internet (URL).

Cette technique vous demandera, en cours d'installation, d'ajouter les dépôts nécessaires.

==== Installation pour un seul utilisateur ====

Ajouter l'option ''-​-user'' permet d'installer l'application uniquement pour l'utilisateur courant.

Exemple :

=== Ajouter le "remote" ===

Même quand ça a déjà été fait au niveau du système, il faut l'installer pour l'utilisateur courant :
<code>
flatpak remote-add --user --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo</code>

<note help>Vous pouvez installer tous les remotes et tous les logiciels uniquement pour l'utilisateur courant, ainsi tout sera dans votre dossier personnel. Étant donné le volume potentiel de certains environnements d'exécution, il peut être pratique d'optimiser un peu où les installer.</note>

=== Installer le logiciel ===

<code>flatpak install --user flathub org.gnome.FeedReader
</code>

Cette commande va installer "FeedReader", un agrégateur de flux RSS pour l'environnement [[:GNOME]], mais **uniquement pour l'utilisateur courant**, les fichiers relatifs à cette application étant alors stockés dans ''~/.local/share/flatpak/app/org.gnome.FeedReader'' au lieu de ''/var/lib/flatpak/app/org.gnome.FeedReader'' comme ça aurait été le cas normalement.

===== Utiliser vos logiciels =====

Pour lancez graphiquement les applications installées, faites comme indiqué **[[tutoriel:comment_lancer_application|ici]]**.

Via le [[:terminal]], la [[:commande_shell|commande]] est :
<code>flatpak run nom.du.logiciel</code>

<note help>Pas la peine de préciser ''-​-user'' pour l'exécution des applications installées ainsi.</note>

==== Mise à jour ====

N'oubliez pas de mettre régulièrement à jour vos logiciels :

<code>flatpak update</code>

===== Désinstaller les logiciels =====

La commande est :
<code>flatpak uninstall nom.du.logiciel</code>

<note>Si vous avez installé avec l'option ''-​-user'', il faudra remettre cette option à la désinstallation.</note>

Si des environnements d'exécutions ou des données restent installées, utilisez la commande

<code>flatpak uninstall --unused</code>

Si plus aucun logiciel installé n'en provient, vous pouvez retirer le dépôt avec la commande

<code>flatpak remote-delete nom-du-depot</code>

===== Problèmes connus =====

==== Thèmes ====

Si votre logiciel n'a pas le bon thème, il est alors conseillé d'installer le thème depuis //flathub//. Exemples :

<code>flatpak install flathub org.gtk.Gtk3theme.Ambiance</code>
<code>flatpak install flathub org.gtk.Gtk3theme.Communitheme</code>

==== Emplacements inaccessibles ====

Si un emplacement n'est pas accessible à partir de l'application, n'hésitez pas à le rapporter comme un bug auprès du développeur de l'application (lien dans le "À propos" de l'application).

==== Traduction ====

Les traductions sont normalement installées avec l'application. Si ce n'est pas le cas, installez le paquet ayant le nom de l'application mais avec la terminaison ".Locale" :

<code>flatpak install flathub org.gnome.Games.Locale</code>

===== Voir aussi =====

  * [[http://flatpak.org/|Site officiel flatpak.org]]
  * [[https://flathub.org/|L'accueil de flathub.org]]
  * [[:Paquet]]
  * La page dédiée à [[:Flatpak]]
  * **(en)** [[http://www.omgubuntu.co.uk/2017/07/7-flatpak-apps-can-install-right-now-flathub|article d'OMG Ubuntu à propos de l'installation de l'installation par flatpak]]
  * La "concurrence" : [[:apt, ]], [[:snap]], [[:appimage]]
  * [[http://flatpak.org/apps.html|Applications disponibles sur flatpak.org]]
  * **(en)** [[https://community.kde.org/Guidelines_and_HOWTOs/Flatpak|Tutoriel pour installer les applications KDE]]

----

//Contributeurs : [[:utilisateurs/roschan]]
, ...//