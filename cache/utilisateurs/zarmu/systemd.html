<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>utilisateurs:zarmu:systemd [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="systeme,administration,services"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/utilisateurs/zarmu/systemd?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns=utilisateurs:zarmu"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/utilisateurs/zarmu/systemd"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/utilisateurs/zarmu/systemd"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/utilisateurs/zarmu/systemd"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='utilisateurs:zarmu';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"utilisateurs:zarmu:systemd","namespace":"utilisateurs:zarmu","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="utilisateurs:zarmu:systemd">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/utilisateurs/zarmu/systemd?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/utilisateurs/zarmu/systemd?do=media&amp;ns=utilisateurs%3Azarmu"  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/utilisateurs/zarmu/systemd?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/utilisateurs/zarmu/systemd?do=edit"  class="action source" accesskey="v" rel="nofollow" title="Afficher le texte source [V]">Modifier cette page</a></li><li><a href="/utilisateurs/zarmu/systemd?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/utilisateurs/zarmu/systemd?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/utilisateurs/zarmu/systemd?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">utilisateurs:zarmu:systemd</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/utilisateurs/zarmu/systemd?do=edit"  class="action text-muted source" accesskey="v" rel="nofollow" title="Afficher le texte source [V]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/utilisateurs/zarmu/systemd?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/utilisateurs/zarmu/systemd?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#les_services","title":"Les services","level":1},{"link":"#gestion_basique_des_services","title":"Gestion basique des services","level":2},{"link":"#lister_les_services_demarres","title":"Lister les services d\u00e9marr\u00e9s","level":2},{"link":"#modifier_l_execution_d_un_service","title":"Modifier l'ex\u00e9cution d'un service","level":2},{"link":"#logiciel_graphique","title":"Logiciel graphique","level":2},{"link":"#personnaliser_un_fichier_de_configuration_systemd","title":"Personnaliser un fichier de configuration Systemd","level":2},{"link":"#les_targets","title":"Les targets","level":1},{"link":"#tableau_de_correspondance","title":"Tableau de correspondance","level":2},{"link":"#gerer_l_etat_de_votre_ordinateur","title":"G\u00e9rer l'\u00e9tat de votre ordinateur","level":2},{"link":"#infos_sur_les_targets","title":"Infos sur les targets","level":2},{"link":"#les_journaux","title":"Les journaux","level":1},{"link":"#ressources","title":"Ressources","level":1}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level1"><a href="#les_services">Les services</a>
<ul class="nav toc">
<li class="level2"><a href="#gestion_basique_des_services">Gestion basique des services</a></li>
<li class="level2"><a href="#lister_les_services_demarres">Lister les services démarrés</a></li>
<li class="level2"><a href="#modifier_l_execution_d_un_service">Modifier l&#039;exécution d&#039;un service</a></li>
<li class="level2"><a href="#logiciel_graphique">Logiciel graphique</a></li>
<li class="level2"><a href="#personnaliser_un_fichier_de_configuration_systemd">Personnaliser un fichier de configuration Systemd</a></li>
</ul>
</li>
<li class="level1"><a href="#les_targets">Les targets</a>
<ul class="nav toc">
<li class="level2"><a href="#tableau_de_correspondance">Tableau de correspondance</a></li>
<li class="level2"><a href="#gerer_l_etat_de_votre_ordinateur">Gérer l&#039;état de votre ordinateur</a></li>
<li class="level2"><a href="#infos_sur_les_targets">Infos sur les targets</a></li>
</ul>
</li>
<li class="level1"><a href="#les_journaux">Les journaux</a></li>
<li class="level1"><a href="#ressources">Ressources</a></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content"><div class="tags"><span>
	<a href="/systeme" class="wikilink1" title="systeme" rel="tag">système</a>,
	<a href="/administration" class="wikilink1" title="administration" rel="tag">administration</a>,
	<a href="/services" class="wikilink1" title="services" rel="tag">services</a>
</span></div>
<hr />

<h1 class="sectionedit1 page-header" id="systemd">Systemd</h1>
<div class="level1">

<p>
Systemd est le gestionnaire de système qui remplace <a href="/upstart" class="wikilink1" title="upstart">upstart</a> et son prédécesseur (<a href="/script_sysv" class="wikilink1" title="script_sysv">les scripts system V</a>) depuis <a href="/xenial" class="wikilink1" title="xenial">Ubuntu 16.04 LTS Xenial</a>. Le nom de ce programme vient de « system daemon » : le daemon du système<br/>

C&#039;est une pièce maîtresse de l&#039;architecture <a href="/gnu" class="wikilink1" title="gnu">GNU</a>/<a href="/linux" class="wikilink1" title="linux">Linux</a>. En effet, c&#039;est le premier programme lancé par le noyau (il a donc le PID N°1) et il se charge de lancer tous les programmes suivants en ordre jusqu&#039;à obtenir un système opérationnel pour l&#039;utilisateur, selon le mode déterminé (single user, multi-user, graphique). C&#039;est également à lui qu&#039;incombe la tache de redémarrer ou arrêter votre ordinateur proprement.
</p>
<div class="notewarning">À la la lecture de l’introduction, il apparaît très clairement que toute modification malencontreuse de l&#039;architecture des services lancés par Systemd peut avoir des conséquences dramatiques sur le fonctionnement de votre ordinateur. <br/>
Il faut être très prudent lorsque l&#039;on touche à la configuration de systemd. <br/>
<em class="u">Une mauvaise manipulation peut rendre votre système instable</em>, jusqu&#039;à le rendre totalement inutilisable.
</div><div class="notewarning">Des anciennes versions de Ubuntu propose dans les dépôts le paquet systemd et il est donc possible de l&#039;installer en remplacement de Upstart. Néanmoins, cette manipulation est complexe et extrêmement risquée. Pour cette raison, cette procédure ne sera pas décrite ici.
</div>
<p>
Il a été développé dans le but de mieux appréhender la gestion d&#039;un système multitâches, notamment en matière de dépendance entre les différents services lancés au démarrage avec pour objectif principal l&#039;optimisation des performances système.<br/>
Son rôle est plus étendu que <a href="/upstart" class="wikilink1" title="upstart">Upstart</a>, il gère également le <a href="/montage" class="wikilink1" title="montage">montage</a> des différents <a href="/systeme_de_fichiers" class="wikilink1" title="systeme_de_fichiers">systèmes de fichier</a> et introduit un nouveau système de log appelé &quot;The Journal&quot;.<br/>

</p>

<p>
Il introduit la notion d&#039;unité. Une unité représente un fichier de configuration. Entre autres, une unité peut être un service (*.service), un target (*.target), un montage (*.mount), un socket (*.socket)… <br/>

C&#039;est donc un sujet très vaste et nous allons donc nous concentrer dans ce wiki sur les aspects basiques des <a href="/services" class="wikilink1" title="services">services</a>, des targets et du journal.
</p>

</div>

<h2 class="sectionedit2 page-header" id="les_services">Les services</h2>
<div class="level2">

<p>
Un <a href="/services" class="wikilink1" title="services">service</a> ou daemon est un programme qui tourne en arrière plan et s&#039;active sous certaine condition. Par exemple, le service hddtemp surveille la température de vos disques dur et déclanche une alerte si elle dépasse un certain seuil.<br/>

</p>

</div>

<h3 class="sectionedit3" id="gestion_basique_des_services">Gestion basique des services</h3>
<div class="level3">

<p>
L&#039;outil de gestion des <a href="/services" class="wikilink1" title="services">services</a> (et des autres unités d&#039;ailleurs) dans systemd s&#039;appelle <strong>systemctl</strong>.<br/>

Il est généralement utilisé dans un <a href="/terminal" class="wikilink1" title="terminal">terminal</a>:
</p>
<pre class="code">systemctl ACTION &lt;Nom_du_service&gt;.service</pre>

<p>
Où
</p>
<ul class=" fix-media-list-overlap">
<li class="level1 node"><div class="li"> ACTION sera la commande que l&#039;on souhaite appliquer à la dite unité:</div>
<ul class=" fix-media-list-overlap">
<li class="level3"><div class="li"> <em> start </em> : démarrer le service</div>
</li>
<li class="level3"><div class="li"> <em> stop </em> : arrêter le service</div>
</li>
<li class="level3"><div class="li"> <em> restart </em> : relancer le service</div>
</li>
<li class="level3"><div class="li"> <em> reload </em> : recharger le service</div>
</li>
<li class="level3"><div class="li"> <em> status </em> : connaitre l&#039;état du service</div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> &lt;Nom_du_service&gt; est le nom du service visé.</div>
</li>
</ul>

<p>
Quelle que soit l&#039;action menée sur un service, au prochain démarrage de la machine celui-ci devrait retrouver le status qui lui a été <a href="#modifier_l_execution_d_un_service" title="utilisateurs:zarmu:systemd ↵" class="wikilink1">défini par défaut</a>. 
</p>
<div class="noteclassic">Il n&#039;est pas nécessaire d&#039;utiliser sudo devant ces commandes. Systemctl vous demandera votre mot de passe root en cas de besoin (presque à chaque fois, donc)
</div>
</div>

<h4 id="exemples">Exemples</h4>
<div class="level4">
<pre class="code">systemctl status ssh.service</pre>

<p>
donnera l&#039;état du service <a href="/ssh" class="wikilink1" title="ssh">ssh</a>, son PID et les dernières lignes de son fichier de log. 
</p>
<pre class="code">systemctl stop ufw.service</pre>

<p>
 arrêtera le service <a href="/ufw" class="wikilink1" title="ufw">ufw</a>, Uncomplicated Firewall,
</p>
<pre class="code">systemctl restart lightdm.service</pre>

<p>
 relancera le serveur graphique.<br/>

</p>
<div class="notetip">Afin de conserver une compatibilité avec les anciens <a href="/script_sysv" class="wikilink1" title="script_sysv">scripts system V</a>, des liens vers les commandes principales de systemctl sont installés par défaut. Il s&#039;agit de <em>start</em>,<em> stop</em>,<em> restart </em>et <em>status</em>.<br/>

Par exemple <strong>sudo restart lightdm</strong> est équivalent à <strong>systelctl restart lightdm.service</strong>.<br/>

L&#039;outil <strong>service</strong> est également branché sur systemctl. <strong>service automount restart</strong> est équivalent à <strong>systelctl restart automount.service</strong>
</div>
</div>

<h3 class="sectionedit4" id="lister_les_services_demarres">Lister les services démarrés</h3>
<div class="level3">

<p>
Pour obtenir la liste triée des services accompagnés de leur état, saisissez dans un <a href="/terminal" class="wikilink1" title="terminal">terminal</a> :
</p>
<pre class="code">systemctl list-unit-files | grep service | sort </pre>

<p>
Vous pouvez également obtenir la liste des services lancés au démarrage, triés selon leur temps d’exécution :
</p>
<pre class="code">systemd-analyze blame</pre>

<p>
Cela peut-être pratique pour trouver le service qui ralenti votre démarrage.
</p>

</div>

<h3 class="sectionedit5" id="modifier_l_execution_d_un_service">Modifier l&#039;exécution d&#039;un service</h3>
<div class="level3">

<p>
Pour desactiver un service, il faut taper :
</p>
<pre class="code">systemctl disable &lt;Nom_du_service&gt;.service</pre>

<p>
Ainsi, au prochain redemarrage du système, le service correspondant ne sera plus lancé.<br/>

</p>

<p>
Pour activer un service ou relire sont fichier de configuration, il faut taper:
</p>
<pre class="code">systemctl enable &lt;Nom_du_service&gt;.service</pre>

<p>
Néanmoins si vous souhaitez modifier l&#039;état d&#039;un service selon certaines conditions, vous devrez <a href="/tutoriel/comment_modifier_un_fichier" class="wikilink1" title="tutoriel:comment_modifier_un_fichier">modifier ou créer le fichier</a> <strong>/etc/systemd/system/&lt;nom_du_service&gt;.service</strong>. Les fichiers de configuration par défaut se trouvent dans <strong>/lib/systemd/system/</strong><br/>

</p>

</div>

<h4 id="exemples1">Exemples</h4>
<div class="level4">

<p>
Si vous souhaitez désactiver la <a href="/synchronisation" class="wikilink1" title="synchronisation">synchronisation</a> des fichiers <a href="/syncthing" class="wikilink1" title="syncthing">syncthing</a> de l&#039;utilisateur toto, dans un <a href="/terminal" class="wikilink1" title="terminal">terminal</a> saisissez:
</p>
<pre class="code">systemctl disable syncthing@toto.service</pre>

<p>
Pour réactiver le service, il faudra faire la manipulation inverse:
</p>
<pre class="code">systemctl enable syncthing@toto.service</pre>

</div>

<h3 class="sectionedit6" id="logiciel_graphique">Logiciel graphique</h3>
<div class="level3">

<p>
Il existe un utilitaire graphique qui se nomme <strong>systemadm</strong> pour gérer systemd.<br/>

<a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">Installez les paquets</a> <strong><a href="apt://systemd-ui" class="interwiki iw_apt" title="apt://systemd-ui">systemd-ui</a></strong>
</p>

</div>

<h3 class="sectionedit7" id="personnaliser_un_fichier_de_configuration_systemd">Personnaliser un fichier de configuration Systemd</h3>
<div class="level3">

<p>
Comme <a href="/upstart" class="wikilink1" title="upstart">Upstart</a>, systemd utilise des fichiers de configuration correspondant aux différents services à manipuler.<br/>

Ces fichiers de configuration se trouvent dans <strong>/etc/systemd/system/</strong> et permettent d&#039;indiquer les conditions d&#039;activation ou désactivation d&#039;un service, leur propriétaire, etc.
</p>
<div class="noteimportant">Ce dossier étant essentiel au bon fonctionnement de votre système, il est conseillé d&#039;en faire une sauvegarde avant toute modification de fichier.<br/>

Dans un <a href="/terminal" class="wikilink1" title="terminal">terminal</a> saisissez:
<pre class="code">sudo cp -r /etc/systemd/system /etc/systemd/system.save$(date +%Y%m%d)</pre>

</div>
<p>
Systemd defini differents types de services :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li">  Un service de type <strong>simple</strong> (type par défaut) lance un processus principal. Dans le cas où ce processus offre une fonctionnalité à d&#039;autre processus sur le système, ses canaux de communication doivent être installés avant que le processus principal soit démarré. Ce qui est rendu possible par l&#039;activation des sockets, et autres canaux de communication. Ainsi, systemd peut traiter les autres unités sans se préoccuper de la fin du lancement d&#039;une unité de type &quot;simple&quot;.</div>
</li>
<li class="level1"><div class="li"> Un service de type <strong>forking</strong>, lance un processus père qui créera un processus fils dans le cadre de son démarrage. Le processus parent est prévu pour s’arrêter une fois le démarrage complet et que tous les canaux de communication sont mis en place. Le processus fils continue à fonctionner en tant que le processus principal du service. systemd poursuit le traitement des autres unités une fois que le processus père se termine. <strong>Ce type de service correspond aux services UNIX traditionnels.</strong></div>
</li>
<li class="level1"><div class="li"> Un service de type <strong>oneshot</strong> est similaire à un service de type <strong>simple</strong>. Cependant, systemd attend que le processus se termine avant de continuer ses traitements. <strong>Ce type de service est typiquement utilisé comme équivalent aux commandes lancées au démarrage via les scripts d&#039;init system V</strong>. Cela permet à systemd de remplacer ce mécanisme. De ce fait, avec systemd des nouveaux services apparaissent, alors qu&#039;ils auraient été simplement des scripts d&#039;init avec SysVinit.</div>
</li>
<li class="level1"><div class="li"> Un service de type <strong>dbus</strong> est similaire à un service de type <strong>simple</strong>. Cependant, le processus du service doit obtenir un nom via D-Bus. systemd pourra alors traiter les autres unités.</div>
</li>
<li class="level1"><div class="li"> Un service de type <strong>notify</strong> est similaire à un service de type <strong>simple</strong>. Cependant, c&#039;est le processus du service qui avertira systemd (via la fonction sd_notfy(3)) qu&#039;il peut traiter les autres unités.</div>
</li>
</ul>

</div>

<h4 id="exemple_de_service_de_type_oneshot">Exemple de service de type &quot;oneshot&quot;</h4>
<div class="level4">

<p>
Un exemple est le service iptables. Voici un extrait de son fichier de configuration :
</p>
<pre class="file">[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/usr/libexec/iptables.init start
ExecStop=/usr/libexec/iptables.init stop </pre>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <code>ExecStart</code> permet d&#039;indiquer la commande à exécuter au lancement du service. Ce paramètre est obligatoire pour tout les types de service.</div>
</li>
<li class="level1"><div class="li"> <code>ExecStop</code> permet d&#039;indiquer une commande a exécuter pour arrêter le service. Ce paramètre est facultatif.</div>
</li>
<li class="level1"><div class="li"> <code>RemainAfterExit</code> à la valeur &quot;yes&quot; permet d&#039;indiquer que quand la commande de lancement (ExecStart) est terminée, le service est considéré comme toujours lancé. Ce paramètre est très utile pour les services de type &quot;oneshot&quot; qui exécutent une commande à leur lancement (ExecStart) sans qu&#039;il y ait un processus spécifique qui reste en exécution.</div>
</li>
</ul>

<p>
<br/>

</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li">  A son lancement, la commande /usr/libexec/iptables.init start est exécutée. Cette commande va permettre de charger des modules iptables et les règles iptables que le modules netfilter du noyau linux va prendre en compte.</div>
</li>
<li class="level1"><div class="li"> A son arrêt, la commande /usr/libexec/iptables.init stop est exécutée. Cette commande va permettre de remettre en place la politique de traitements iptables par défaut et de décharger les modules iptables.</div>
</li>
<li class="level1"><div class="li"> Le service iptables continuera d&#039;apparaitre comme actif après la fin de la commande /usr/libexec/iptables.init start et jusqu’à ce qu&#039;il soit explicitement arrêté.</div>
</li>
</ul>

</div>

<h4 id="exemple_de_service_de_type_simple">Exemple de service de type &quot;simple&quot;</h4>
<div class="level4">

<p>
Un exemple est le service deluged qui permet de lancer le service correspondant à la version deamon du client bit-torrent <a href="/deluge" class="wikilink1" title="deluge">deluge</a>.
</p>
<dl class="file">
<dt><a href="/_export/code/utilisateurs/zarmu/systemd?codeblock=12" title="Télécharger cet extrait" class="mediafile mf_service">/etc/systemd/system/deluged.service</a></dt>
<dd><pre class="code file txt">[Unit]
Description=Deluge Bittorrent Client Daemon
After=network-online.target
&nbsp;
[Service]
Type=simple
&nbsp;
User=deluge
Group=deluge
UMask=007
&nbsp;
ExecStart=/usr/bin/deluged -d
&nbsp;
Restart=on-failure
&nbsp;
# Configures the time to wait before service is stopped forcefully.
TimeoutStopSec=300
&nbsp;
[Install]
WantedBy=multi-user.target</pre>
</dd></dl>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <code>Description</code> permet de donner une description du service qui apparaîtra lors de l&#039;utilisation de la commande <code>systemctl status &lt;nom_du_service&gt;</code></div>
</li>
<li class="level1"><div class="li"> <code>After</code> permet d&#039;indiquer quel pré-requis est nécessaire pour le fonctionnement du service. Ici, on indique qu&#039;il faut attendre que l&#039;ordinateur ait accès à Internet pour lancer le daemon. <img src="/lib/images/smileys/fixme.gif" class="icon" alt="FIXME" /> <strong>à vérifier :</strong> Si l&#039;accès à Internet est perdu, le service est arrêté automatiquement.<br/>
</div>
</li>
<li class="level1"><div class="li"> <code>Type</code> permet de specifier le type de service</div>
</li>
<li class="level1"><div class="li"> <code>User</code>, <code>Group</code> et <code>Umask</code> permet d&#039;identifier qui est le propriaitaire du processus et donc les attributs des fichiers téléchargés. Ici, les fichiers téléchargés seront accessibles en Lecture/Ecriture à l&#039;utilisateur <code>Deluge</code> et aux membres du groupe <code>Deluge</code> et invisibles aux autres utilisateurs du système.</div>
</li>
<li class="level1"><div class="li"> <code>Restart</code> permet de relancer le service automatiquement en cas de plantage.</div>
</li>
<li class="level1"><div class="li"> <code>WantedBy</code> permet de spécifier dans quel Target doit être actif le service. Ici, en spécifiant <code>multi-user.target</code>, le service est actif dans les Runlevels 2, 3, 4 et 5</div>
</li>
</ul>

<p>
<br/>

</p>

</div>

<h4 id="exemple_de_service_modele">Exemple de service modèle</h4>
<div class="level4">

<p>
Il est possible de creer plusieurs services à partir d&#039;un même modèle. Par exemple, la gestion des consoles est gérée par un seul modèle <code>getty@.service</code> qui est décliné en <code>getty@tty1.service</code>, <code>getty@tty2.service</code>, etc pour chacune des consoles tty de votre machine. On peut aussi imaginer des services où chaque instance correspond à un utilisateur de la machine. Par exemple, on peut lancer le service syncthing@.service pour synchroniser en parallèle avec <a href="/syncthing" class="wikilink1" title="syncthing">syncthing</a> les fichiers de Toto, Gerard et Milou :
</p>
<dl class="file">
<dt><a href="/_export/code/utilisateurs/zarmu/systemd?codeblock=13" title="Télécharger cet extrait" class="mediafile mf_service">syncthing@.service</a></dt>
<dd><pre class="code file txt">[Unit]
Description=Syncthing - Open Source Continuous File Synchronization for %I
Documentation=man:syncthing(1)
After=network.target
Wants=syncthing-inotify@.service
&nbsp;
[Service]
User=%i
ExecStart=/usr/bin/syncthing -no-browser -no-restart -logflags=0
Restart=on-failure
SuccessExitStatus=3 4
RestartForceExitStatus=3 4
UMask=0002
&nbsp;
[Install]
WantedBy=multi-user.target</pre>
</dd></dl>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <code>Wants</code> permet de spécifier une dépendance. Pour connaître les dépendances d&#039;une unité, tapez dans un <a href="/terminal" class="wikilink1" title="terminal">terminal</a>:</div>
</li>
</ul>
<pre class="code">systemctl list-dependencies [&lt;unit&gt;] </pre>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Ici, le <code>User</code> est <code>%i</code>, soit l&#039;argument qui est passé lors de l&#039;activation du service. Pour créer toute les instances du service pour Toto, Gerard et Milou, il faudra avoir tapé une fois :</div>
</li>
</ul>
<pre class="code">systemctl enable syncthing@Toto.service
systemctl enable syncthing@Gerard.service
systemctl enable syncthing@Milou.service</pre>

</div>

<h2 class="sectionedit8 page-header" id="les_targets">Les targets</h2>
<div class="level2">

<p>
Systemd introduit la notion de target au sein de ses unités. Une target permet de regrouper dans un seul paquet plusieurs autres unités et de retrouver la notion de runlevel (<a href="/script_sysv" class="wikilink1" title="script_sysv">des scripts system V</a>).<br/>

</p>

</div>

<h3 class="sectionedit9" id="tableau_de_correspondance">Tableau de correspondance</h3>
<div class="level3">
<div class="table-responsive"><table class="inline table table-striped table-condensed">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> Runlevel 	</th><th class="col1 leftalign"> Systemd Target 								</th><th class="col2 leftalign"> Notes 										</th>
	</tr>
	</thead>
	<tr class="row1">
		<th class="col0 centeralign">       0		</th><td class="col1 leftalign"> runlevel0.target, poweroff.target 					</td><td class="col2 leftalign"> Arrête le système 								</td>
	</tr>
	<tr class="row2">
		<th class="col0 centeralign"> 	1 		</th><td class="col1 leftalign"> runlevel1.target, rescue.target 					</td><td class="col2 leftalign"> Mode single user 								</td>
	</tr>
	<tr class="row3">
		<th class="col0 centeralign"> 	3 		</th><td class="col1 leftalign"> runlevel3.target, multi-user.target 					</td><td class="col2 leftalign"> Mode multi-utilisateur, non graphique				</td>
	</tr>
	<tr class="row4">
		<th class="col0 centeralign"> 	2, 4 		</th><td class="col1 leftalign"> runlevel2.target, runlevel4.target, multi-user.target 	</td><td class="col2 leftalign"> Mode défini par l&#039;utilisateur, identique au 3 par défaut.	</td>
	</tr>
	<tr class="row5">
		<th class="col0 centeralign"> 	5 		</th><td class="col1 leftalign"> runlevel5.target, graphical.target 					</td><td class="col2 leftalign"> Mode graphique multi-utilisateur 					</td>
	</tr>
	<tr class="row6">
		<th class="col0 centeralign"> 	6 		</th><td class="col1 leftalign"> runlevel6.target, reboot.target 					</td><td class="col2 leftalign"> Redémarre									</td>
	</tr>
	<tr class="row7">
		<th class="col0 centeralign">  emergency 	</th><td class="col1 leftalign"> emergency.target 								</td><td class="col2 leftalign"> Shell d&#039;urgence 								</td>
	</tr>
</table></div>

</div>

<h3 class="sectionedit11" id="gerer_l_etat_de_votre_ordinateur">Gérer l&#039;état de votre ordinateur</h3>
<div class="level3">

<p>
Pour changer de target, on utilise la commande <strong>isolate</strong> de <strong>systemctl</strong>. Par exemple, pour passer en mode multi-utilisateur non graphique, il faut taper dans un <a href="/terminal" class="wikilink1" title="terminal">terminal</a>:
</p>
<pre class="code">systemctl isolate multi-user.target</pre>

<p>
ou son équivalent selon le tableau ci-dessus :
</p>
<pre class="code">systemctl isolate runlevel3.target</pre>

<p>
ou son equivalent dans le <a href="/script_sysv" class="wikilink1" title="script_sysv">system V</a>
</p>
<pre class="code">telinit 3</pre>

<p>
C&#039;est donc systemd qui gère le démarrage, l’arrêt ou encore le redémarrage de l&#039;ordinateur. En fait, lorsque vous tapez dans un <a href="/terminal" class="wikilink1" title="terminal">terminal</a> :
</p>
<pre class="code">sudo reboot</pre>

<p>
Vous appelez la commande:
</p>
<pre class="code">sudo systemctl reboot</pre>

<p>
Vous pouvez utilisez d&#039;autre commande pour gérer l&#039;état de votre ordinateur (dans l&#039;ordre, éteindre / mettre en veille / hiberner) :
</p>
<pre class="code">systemctl poweroff
systemctl suspend
systemctl hibernate</pre>

<p>
Enfin, vous pouvez définir le target par défaut au démarrage en tapant :
</p>
<pre class="code">systemctl set-default -f multi-user.target</pre>

<p>
Votre ordinateur démarrera désormais en mode multi-utilisateur sans mode graphique.<br/>

</p>

</div>

<h3 class="sectionedit12" id="infos_sur_les_targets">Infos sur les targets</h3>
<div class="level3">

<p>
Pour connaitre la liste des targets configurés sur votre ordinateur, tapez dans un <a href="/terminal" class="wikilink1" title="terminal">terminal</a> :
</p>
<pre class="code">systemctl list-unit-files | grep target </pre>

<p>
Pour savoir quelles unités sont regroupés au sein d&#039;une target, tapez :
</p>
<pre class="code">systemctl show -p Wants -p Requires &lt;target&gt;</pre>

</div>

<h2 class="sectionedit13 page-header" id="les_journaux">Les journaux</h2>
<div class="level2">

<p>
systemd possède son propre mécanisme de journalisation, appelé &quot;The Journal&quot;.
</p>

<p>
Pour accéder au log, tapez dans un <a href="/terminal" class="wikilink1" title="terminal">terminal</a> :
</p>
<pre class="code">journalctl</pre>

<p>
Pour une gestion plus fine, vous pouvez consulter les messages d&#039;un seul service par son <em>nom</em>, son <em>PID</em> ou même son <em>exécutable</em> :
</p>
<pre class="code">journalctl -u wicd
journalctl _PID=1
journalctl /usr/sbin/dhcpcd</pre>
<div class="notetip">Lorsque vous consultez le <code>status</code> d&#039;un service avec la commande <code>systemctl status &lt;nom_du_service&gt;</code>, systemd vous affiches quelques lignes des logs les plus recents
</div>
<p>
journalctl permet aussi de filtrer par le niveau de log (tel que défini par syslog). Pour n&#039;afficher que les erreurs :
</p>
<pre class="code">journalctl -p err</pre>

<p>
Il existe un logiciel graphique nommé <strong>Gnome-logs</strong> pour lire les fichiers de log generés par systemd.
 <a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">Installez les paquets</a> <strong><a href="apt://gnome-logs" class="interwiki iw_apt" title="apt://gnome-logs">gnome-logs</a></strong>
</p>

</div>

<h2 class="sectionedit14 page-header" id="ressources">Ressources</h2>
<div class="level2">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <a href="https://fr.wikipedia.org/wiki/ https://fr.wikipedia.org/wiki/Systemd" class="interwiki iw_wpfr" title="https://fr.wikipedia.org/wiki/ https://fr.wikipedia.org/wiki/Systemd">systemd</a> sur Wikipedia en français</div>
</li>
<li class="level1"><div class="li"> <a href="http://casteyde.christian.free.fr/system/linux/guide/index.html" class="urlextern" title="http://casteyde.christian.free.fr/system/linux/guide/index.html" rel="nofollow">YAGIL</a> Yet Another « Guide d&#039;installation de Linux » de Christian Casteyde. Pour tout savoir sur le fonctionnement de <a href="/gnu" class="wikilink1" title="gnu">GNU</a> / <a href="/linux" class="wikilink1" title="linux">Linux</a>.</div>
</li>
<li class="level1"><div class="li"> <a href="https://wiki.archlinux.fr/Systemd" class="urlextern" title="https://wiki.archlinux.fr/Systemd" rel="nofollow">https://wiki.archlinux.fr/Systemd</a> Systemd sur le wiki de Archlinux</div>
</li>
<li class="level1"><div class="li"> <a href="http://doc.fedora-fr.org/wiki/Systemd" class="urlextern" title="http://doc.fedora-fr.org/wiki/Systemd" rel="nofollow">http://doc.fedora-fr.org/wiki/Systemd</a> Systemd sur le wiki de Fedora</div>
</li>
<li class="level1"><div class="li"> <a href="https://docs.syncthing.net/users/autostart.html#using-systemd" class="urlextern" title="https://docs.syncthing.net/users/autostart.html#using-systemd" rel="nofollow">https://docs.syncthing.net/users/autostart.html#using-systemd</a> Créer un service systemd pour lancer Syncthing au démarrage (en anglais)</div>
</li>
<li class="level1"><div class="li"> <a href="http://dev.deluge-torrent.org/wiki/UserGuide/Service/systemd" class="urlextern" title="http://dev.deluge-torrent.org/wiki/UserGuide/Service/systemd" rel="nofollow">http://dev.deluge-torrent.org/wiki/UserGuide/Service/systemd</a> Créer un service systemd pour lancer Deluge au démarrage (en anglais)</div>
</li>
</ul>
<hr />

<p>
<em>Contributeurs: <a href="/utilisateurs/zarmu" class="wikilink1" title="utilisateurs:zarmu">zarmu</a>,</em>
</p>

</div>

</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="utilisateurs/zarmu/systemd.txt">utilisateurs/zarmu/systemd.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 28/09/2016, 06:53">Le 28/09/2016, 06:53</span></li><li class="text-muted">par zarmu</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=utilisateurs%3Azarmu%3Asystemd&amp;1635535926" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
