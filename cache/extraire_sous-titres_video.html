<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>extraire_sous-titres_video [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="video,ffmpeg,srt,sous-titrage,vobsub2srt,mkvtoolnix"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/extraire_sous-titres_video?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns="/>
<link rel="edit" title="Modifier cette page" href="/extraire_sous-titres_video?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/extraire_sous-titres_video"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/extraire_sous-titres_video"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/extraire_sous-titres_video"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"extraire_sous-titres_video","namespace":"","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="extraire_sous-titres_video">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/extraire_sous-titres_video?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/extraire_sous-titres_video?do=media&amp;ns="  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/extraire_sous-titres_video?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/extraire_sous-titres_video?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/extraire_sous-titres_video?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/extraire_sous-titres_video?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/extraire_sous-titres_video?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">extraire_sous-titres_video</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/extraire_sous-titres_video?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/extraire_sous-titres_video?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/extraire_sous-titres_video?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#algorithme","title":"Algorithme","level":1},{"link":"#script_bash_correspondant_a_l_algorithme","title":"Script bash correspondant \u00e0 l'algorithme","level":2},{"link":"#ancien_exemple_de_sequence_bash_correspondant_a_l_algorithme","title":"Ancien Exemple de s\u00e9quence bash correspondant \u00e0 l'algorithme","level":2},{"link":"#exemple_de_conversion_de_fichier_ts_en_mkv_avec_ffmpeg","title":"Exemple de conversion de fichier TS en MKV avec FFMPEG","level":2},{"link":"#dependances_a_installer","title":"d\u00e9pendances \u00e0 installer","level":1},{"link":"#script_ts2srt","title":"Script ts2srt","level":1},{"link":"#contributeurs","title":"Contributeurs","level":1}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level1"><a href="#algorithme">Algorithme</a>
<ul class="nav toc">
<li class="level2"><a href="#script_bash_correspondant_a_l_algorithme">Script bash correspondant à l&#039;algorithme</a></li>
<li class="level2"><a href="#ancien_exemple_de_sequence_bash_correspondant_a_l_algorithme">Ancien Exemple de séquence bash correspondant à l&#039;algorithme</a></li>
<li class="level2"><a href="#exemple_de_conversion_de_fichier_ts_en_mkv_avec_ffmpeg">Exemple de conversion de fichier TS en MKV avec FFMPEG</a></li>
</ul>
</li>
<li class="level1"><a href="#dependances_a_installer">dépendances à installer</a></li>
<li class="level1"><a href="#script_ts2srt">Script ts2srt</a></li>
<li class="level1"><a href="#contributeurs">Contributeurs</a></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content"><div class="tags"><span>
	<a href="/video" class="wikilink1" title="video" rel="tag">vidéo</a>
</span></div>
<div class="tags"><span>
	<a href="/ffmpeg" class="wikilink1" title="ffmpeg" rel="tag">ffmpeg</a>
</span></div>
<div class="tags"><span>
	<a href="/srt?do=showtag&amp;tag=srt" class="wikilink1" title="srt" rel="tag">srt</a>
</span></div>
<div class="tags"><span>
	<a href="/sous-titrage" class="wikilink1" title="sous-titrage" rel="tag">Sous-titrage</a>
</span></div>
<div class="tags"><span>
	<a href="/vobsub2srt?do=showtag&amp;tag=vobsub2srt" class="wikilink1" title="vobsub2srt" rel="tag">vobsub2srt</a>
</span></div>
<div class="tags"><span>
	<a href="/mkvtoolnix" class="wikilink1" title="mkvtoolnix" rel="tag">mkvtoolnix</a>
</span></div>

<h1 class="sectionedit1 page-header" id="extraction_des_sous-titres_d_une_video">Extraction des sous-titres d&#039;une vidéo</h1>
<div class="level1">

<p>
Scripts bash permettant de convertir plusieurs pistes de sous-titre vobsub d&#039;une vidéo enregistrer sur la TNT par exemple et de les convertir en sous-titres texte .srt.
</p>
<div class="noteclassic"> L&#039;extraction de sous-titres d&#039;une vidéo multicanal demande d&#039;identifier les canaux sous-titres puis d&#039;effectuer une reconnaissance de caractère pour les transformer en fichiers srt (texte) moins volumineux et plus faciles à inclure dans un fichier vidéo mkv Matroska.

</div>
</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/extraire_sous-titres_video"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1608644986" /><input type="hidden" name="summary" value="[Extraction des sous-titres d&#039;une vidéo] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="extraction_des_sous-titres_d_une_video" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="104-618" /><button type="submit" title="Extraction des sous-titres d&#039;une vidéo" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit2 page-header" id="algorithme">Algorithme</h2>
<div class="level2">

<p>
Inspiré de l&#039;algorithme  : <a href="/tutoriel/vobsub_srt" class="wikilink1" title="tutoriel:vobsub_srt">Conversion de sous-titres VobSub en SRT</a>
</p>
<div class="notewarning">Les 3 dernières étapes peuvent être réalisées avec vobsub2srt
</div><ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Repérer les canaux de sous-titres d&#039;un fichier vidéo avec ffmpeg</div>
</li>
<li class="level1"><div class="li"> extraire sous-titres vobsub dans une vidéos mastroika</div>
</li>
<li class="level1"><div class="li"> extraire les sous-titres des vidéos mastroïka avec mkvextract</div>
</li>
<li class="level1"><div class="li"> convertir fichier .sub et .idx en tiff;</div>
</li>
<li class="level1"><div class="li"> reconnaissance de caractère de chaque tiff avec cunéiform</div>
</li>
<li class="level1"><div class="li"> création d&#039;un fichier srt </div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/extraire_sous-titres_video"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1608644986" /><input type="hidden" name="summary" value="[Algorithme] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="algorithme" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="619-1164" /><button type="submit" title="Algorithme" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit3" id="script_bash_correspondant_a_l_algorithme">Script bash correspondant à l&#039;algorithme</h3>
<div class="level3">

<p>
<a href="https://raw.githubusercontent.com/albanmartel/dvsub2srt.bash/main/dvsub2srt.bash" class="urlextern" title="https://raw.githubusercontent.com/albanmartel/dvsub2srt.bash/main/dvsub2srt.bash" rel="nofollow"> dvsub2srt.bash</a>
</p>
<pre class="code file bash"><span class="co0"># !/bin/bash</span>
<span class="co0"># OUTPUT-COLORING</span>
<span class="re2">red</span>=$<span class="br0">&#40;</span> tput setaf <span class="nu0">1</span> <span class="br0">&#41;</span>
<span class="re2">green</span>=$<span class="br0">&#40;</span> tput setaf <span class="nu0">2</span> <span class="br0">&#41;</span>
<span class="re2">NC</span>=$<span class="br0">&#40;</span> tput sgr0 <span class="br0">&#41;</span>      <span class="co0"># or perhaps: tput sgr0</span>
<span class="co0">#NC=$( tput setaf 0 )      # or perhaps: tput sgr0</span>
&nbsp;
<span class="co0"># Dépendances : ffmpeg,  mkvtoolnix, vobsub2srt</span>
<span class="co0"># Signale quel programme l'on exécute </span>
<span class="co0"># puis la composition du répertoire où le script s'exécute</span>
<span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;programme pour extraire des canaux de sous-titres d'une vidéo<span class="es1">\n</span>
Composition du répertoire courant :<span class="es1">\n</span>
<span class="es4">$(ls)</span>&quot;</span>
&nbsp;
<span class="co0"># Invite de commande pour entrer le fichier vidéo à traiter</span>
<span class="kw3">echo</span> <span class="re5">-n</span> <span class="st0">&quot;Entrer le fichier vidéo choisi :&quot;</span>;
<span class="kw2">read</span> film_a_traiter;
&nbsp;
<span class="co0"># Message pour informer l'utilisateur de son choix</span>
<span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;Le fichier vidéo choisi est : <span class="es1">\n</span> <span class="es2">$film_a_traiter</span>&quot;</span> 
&nbsp;
<span class="co0"># Exemple film_a_traiter=&quot;RetourVersLeFutur2.mp4&quot;</span>
<span class="co0"># film_a_traiter=&quot;RetourVersLeFutur2.mp4&quot;</span>
&nbsp;
<span class="co0"># soustitres_array= (&quot;4|fra&quot; &quot;5|fra&quot;)</span>
<span class="re2">soustitres_array</span>=<span class="br0">&#40;</span>$<span class="br0">&#40;</span>ffprobe <span class="re1">$film_a_traiter</span> <span class="re5">-v</span> quiet -show_entries <span class="re2">stream</span>=index:<span class="re2">stream_tags</span>=language -select_streams s <span class="re5">-of</span> <span class="re2">compact</span>=<span class="re2">p</span>=<span class="nu0">0</span>:<span class="re2">nk</span>=<span class="nu0">1</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
&nbsp;
<span class="co0"># metadata_sub=&quot;-map 0:4 -metadata:s:s:1 language=fra -map 0:5 -metadata:s:s:2 language=fra&quot;</span>
<span class="re2">metadata_sub</span>=$<span class="br0">&#40;</span><span class="kw1">for</span> <span class="br0">&#40;</span><span class="br0">&#40;</span> <span class="re2">c</span>=<span class="nu0">0</span>; c<span class="sy0">&lt;</span><span class="co1">${#soustitres_array[@]}</span>; <span class="kw2">c++</span><span class="br0">&#41;</span><span class="br0">&#41;</span>;  <span class="kw1">do</span>  <span class="kw3">echo</span> <span class="re5">-map</span> <span class="nu0">0</span>:$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="co1">${soustitres_array[$c]}</span> <span class="sy0">|</span> <span class="kw2">cut</span> <span class="re5">-d</span> <span class="st0">&quot;|&quot;</span> -f1<span class="br0">&#41;</span> -metadata:s:s:$<span class="br0">&#40;</span><span class="br0">&#40;</span><span class="re1">$c</span> + <span class="nu0">1</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="re2">language</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="co1">${soustitres_array[$c]}</span> <span class="sy0">|</span> <span class="kw2">cut</span> <span class="re5">-d</span> <span class="st0">&quot;|&quot;</span> -f2<span class="br0">&#41;</span> ; <span class="kw1">done</span><span class="br0">&#41;</span>
&nbsp;
<span class="co0"># command1=&quot;ffmpeg -i RetourVersLeFutur2.mp4 -map 0:4 -metadata:s:s:1 language=fra -map 0:5 -metadata:s:s:2 language=fra -c:s dvdsub sous_titres_RetourVersLeFutur2.mp4.mk&quot;</span>
<span class="re2">command1</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="st0">&quot;ffmpeg -i <span class="es2">$film_a_traiter</span> <span class="es2">$metadata_sub</span> -c:s dvdsub sous_titres_<span class="es2">$film_a_traiter</span>.mkv&quot;</span><span class="br0">&#41;</span>
&nbsp;
<span class="co0"># Execution commande n°1 $command1</span>
<span class="re1">$command1</span>
&nbsp;
<span class="co0"># vobsub_piste=&quot;0:0_ 1:1_&quot;</span>
<span class="re2">vobsub_piste</span>=$<span class="br0">&#40;</span><span class="kw1">for</span> <span class="br0">&#40;</span><span class="br0">&#40;</span> <span class="re2">c</span>=<span class="nu0">0</span>; c<span class="sy0">&lt;</span><span class="co1">${#soustitres_array[@]}</span>; <span class="kw2">c++</span><span class="br0">&#41;</span><span class="br0">&#41;</span>; <span class="kw1">do</span> <span class="kw3">echo</span> <span class="re1">$c</span>:<span class="re1">$c</span><span class="st0">&quot;_&quot;</span>; <span class="kw1">done</span><span class="br0">&#41;</span>
&nbsp;
<span class="co0">#command2=&quot;mkvextract tracks sous_titres_RetourVersLeFutur2.mp4.mkv -c ISO8859-1 0:0_ 1:1_&quot;</span>
<span class="re2">command2</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="st0">&quot;mkvextract tracks sous_titres_<span class="es2">$film_a_traiter</span>.mkv -c ISO8859-1 <span class="es2">$vobsub_piste</span>&quot;</span><span class="br0">&#41;</span>
&nbsp;
<span class="co0"># Execution commande n°2 $command2</span>
<span class="re1">$command2</span>
&nbsp;
<span class="co0"># Exécution Roc des fichiers de sous-titres</span>
<span class="co0">#vobsub2srt 0_; vobsub2srt 1_;&quot;</span>
<span class="kw1">for</span> <span class="br0">&#40;</span><span class="br0">&#40;</span> <span class="re2">c</span>=<span class="nu0">0</span>; c<span class="sy0">&lt;</span><span class="co1">${#soustitres_array[@]}</span>; <span class="kw2">c++</span><span class="br0">&#41;</span><span class="br0">&#41;</span>; 
<span class="kw1">do</span>
 vobsub2srt <span class="re1">$c</span><span class="st0">&quot;_&quot;</span>;
<span class="kw1">done</span>
<span class="kw3">exit</span> <span class="nu0">0</span>;</pre>

</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit form-inline" method="post" action="/extraire_sous-titres_video"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1608644986" /><input type="hidden" name="summary" value="[Script bash correspondant à l&#039;algorithme] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="script_bash_correspondant_a_l_algorithme" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="1165-3450" /><button type="submit" title="Script bash correspondant à l&#039;algorithme" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit4" id="ancien_exemple_de_sequence_bash_correspondant_a_l_algorithme">Ancien Exemple de séquence bash correspondant à l&#039;algorithme</h3>
<div class="level3">
<pre class="code file bash"><span class="kw2">ffmpeg</span> <span class="re5">-i</span> data0003.ts <span class="nu0">2</span><span class="sy0">&gt;&amp;</span><span class="nu0">1</span> <span class="sy0">|</span> <span class="kw2">grep</span> subtitle
<span class="kw2">mkdir</span> data0003
<span class="kw2">ffmpeg</span> <span class="re5">-i</span> data0003.ts <span class="re5">-map</span> <span class="nu0">0</span>:<span class="nu0">4</span> <span class="re5">-map</span> <span class="nu0">0</span>:<span class="nu0">5</span> <span class="re5">-vn</span> <span class="re5">-an</span> <span class="re5">-scodec</span> dvdsub data0003.mkv
mkvextract tracks <span class="st0">&quot;data0003.mkv&quot;</span> <span class="re5">-c</span> ISO8859-<span class="nu0">1</span> <span class="nu0">0</span>:data0003<span class="sy0">/</span><span class="nu0">0</span>_
mkvextract tracks <span class="st0">&quot;data0003.mkv&quot;</span> <span class="re5">-c</span> ISO8859-<span class="nu0">1</span> <span class="nu0">1</span>:data0003<span class="sy0">/</span><span class="nu0">1</span>_
subp2tiff <span class="re5">--sid</span>=<span class="nu0">0</span> <span class="re5">-n</span> data0003<span class="sy0">/</span><span class="nu0">0</span>_
subp2tiff <span class="re5">--sid</span>=<span class="nu0">1</span> <span class="re5">-n</span> data0003<span class="sy0">/</span><span class="nu0">1</span>_
<span class="kw1">for</span> eachTiff <span class="kw1">in</span> data0003<span class="sy0">/*</span>.tif; <span class="kw1">do</span> cuneiform <span class="re5">-l</span> fra <span class="re5">-f</span> text <span class="re5">-o</span> <span class="re1">$eachTiff</span>.txt <span class="re1">$eachTiff</span>; <span class="kw1">done</span>
subptools <span class="re5">-s</span> <span class="re5">-w</span> <span class="re5">-t</span> srt <span class="re5">-i</span> data0003<span class="sy0">/</span><span class="nu0">0</span>_.xml <span class="re5">-o</span> <span class="nu0">0</span>_.srt
subptools <span class="re5">-s</span> <span class="re5">-w</span> <span class="re5">-t</span> srt <span class="re5">-i</span> data0003<span class="sy0">/</span><span class="nu0">1</span>_.xml <span class="re5">-o</span> <span class="nu0">1</span>_.srt</pre>

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit form-inline" method="post" action="/extraire_sous-titres_video"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1608644986" /><input type="hidden" name="summary" value="[Ancien Exemple de séquence bash correspondant à l&#039;algorithme] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="ancien_exemple_de_sequence_bash_correspondant_a_l_algorithme" /><input type="hidden" name="codeblockOffset" value="1" /><input type="hidden" name="range" value="3451-4063" /><button type="submit" title="Ancien Exemple de séquence bash correspondant à l&#039;algorithme" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit5" id="exemple_de_conversion_de_fichier_ts_en_mkv_avec_ffmpeg">Exemple de conversion de fichier TS en MKV avec FFMPEG</h3>
<div class="level3">

<p>
La commande suivante permet d&#039;obtenir l&#039;info : 
</p>
<pre class="code">ffmpeg -i &lt;vidéos étudiée&gt; </pre>

<p>
9 pistes :
</p>

<p>
0:0 vidéo
</p>

<p>
0:1 ne contenant pas de données
</p>

<p>
0:2 Audio
</p>

<p>
0:3 ne contenant pas de données
</p>

<p>
0:5 Subtite
</p>

<p>
0:6 subtitle
</p>

<p>
0:7 piste non reconnue par ffmpeg
</p>

<p>
0:8 piste non reconnue par ffmpeg
</p>
<pre class="code">ffmpeg -threads 4 -i data0003.ts -map 0:0 -map 0:2 -map 0:5 -map 0:6 -acodec copy -vcodec copy -scodec dvdsub output.mkv</pre>
<div class="noteclassic"><em>-threads</em> pour pouvoir utiliser un traitement multiprocesseurs 
<p>
-<em> map</em> pour spécifier toutes les pistes à utilisables
</p>

<p>
<em>-acodec</em> suivi de <em>copy</em>  pour le traitements des pistes audio
</p>

<p>
<em>-vcodec</em> suivi de <em>copy</em> pour le traitement de la piste vidéo  
<em>
-scodec</em> suivi de <em>dvdsub</em> pour le traitement des sous-titres 
</p>

</div>
</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit form-inline" method="post" action="/extraire_sous-titres_video"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1608644986" /><input type="hidden" name="summary" value="[Exemple de conversion de fichier TS en MKV avec FFMPEG] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="exemple_de_conversion_de_fichier_ts_en_mkv_avec_ffmpeg" /><input type="hidden" name="codeblockOffset" value="2" /><input type="hidden" name="range" value="4064-4915" /><button type="submit" title="Exemple de conversion de fichier TS en MKV avec FFMPEG" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit6 page-header" id="dependances_a_installer">dépendances à installer</h2>
<div class="level2">

<p>
<strong><a href="apt://ffmpeg" class="interwiki iw_apt" title="apt://ffmpeg">ffmpeg</a></strong> - une collection de logiciels libres destinés au traitement de flux audio ou vidéo
</p>

<p>
<strong><a href="apt://mkvtoolnix" class="interwiki iw_apt" title="apt://mkvtoolnix">mkvtoolnix</a></strong> éventuellement aussi <strong><a href="apt://mkvtoolnix-gui" class="interwiki iw_apt" title="apt://mkvtoolnix-gui">mkvtoolnix-gui</a></strong> -  un ensemble d&#039;outils permettant de créer, de modifier et d&#039;inspecter des fichiers Matroska 
</p>

<p>
<strong><a href="apt://vobsub2srt" class="interwiki iw_apt" title="apt://vobsub2srt">vobsub2srt</a></strong> - Commande de reconnaissance optique de caractères multi-langue pour extraire des sous-titres 
</p>

<p>
<strong><a href="apt://cuneiform" class="interwiki iw_apt" title="apt://cuneiform">cuneiform</a></strong> - Système de reconnaissance optique de caractères multi-langue
</p>

<p>
<strong><a href="apt://ogmrip" class="interwiki iw_apt" title="apt://ogmrip">ogmrip</a></strong> - Application pour extraire et encoder des DVDs
</p>

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit form-inline" method="post" action="/extraire_sous-titres_video"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1608644986" /><input type="hidden" name="summary" value="[dépendances à installer] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="dependances_a_installer" /><input type="hidden" name="codeblockOffset" value="4" /><input type="hidden" name="range" value="4916-5508" /><button type="submit" title="dépendances à installer" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit7 page-header" id="script_ts2srt">Script ts2srt</h2>
<div class="level2">
<div class="notewarning">Script ancien : pas de gestion des erreurs de reconnaissances optiques
</div>
<p>
<a href="https://raw.githubusercontent.com/albanmartel/ts2srt/master/ts2srt.bash" class="urlextern" title="https://raw.githubusercontent.com/albanmartel/ts2srt/master/ts2srt.bash" rel="nofollow"> ts2srt.bash</a>
</p>
<pre class="code file bash"><span class="co0"># ----------------------------------------------------</span>
<span class="co0"># Script''ts2srt''</span>
<span class="co0"># ----------------------------------------------------</span>
&nbsp;
<span class="co0"># Par ''Alban MARTEL''</span>
<span class="co0"># Courriel : albanmartel(POINT)developpeur(AT)gmail(POINT)com</span>
<span class="co0"># Utilisant comme base de travail le script de beguam</span>
<span class="co0"># http://doc.ubuntu-fr.org/tutoriel/vobsub_srt</span>
<span class="co0"># License : GNU GPL</span>
<span class="co0"># Ce script permet d'extraire les sous-titres d'une video TS et de les transformer en SRT éditable.</span>
<span class="co0">#</span>
<span class="co0"># Depends : </span>
<span class="co0"># ffmpeg est une collection de logiciels libres destinés au traitement de flux audio ou vidéo</span>
<span class="co0"># mkvToolnix (interface graphique pour mkvmerge) est un ensemble d'outils permettant de créer, de modifier et d'inspecter des fichiers Matroska </span>
<span class="co0"># cuneiform - Système de reconnaissance optique de caractères multi-langue</span>
<span class="co0"># ogmrip - Application pour extraire et encoder des DVDs</span>
<span class="co0">#</span>
<span class="co0"># Date : 26/08/2015</span>
<span class="co0"># version : 0.1</span>
<span class="co0"># Mise-à-jour : </span>
<span class="co0"># ----------------------------------------------------</span>
&nbsp;
<span class="co0"># !/bin/bash</span>
<span class="co0"># OUTPUT-COLORING</span>
<span class="re2">red</span>=$<span class="br0">&#40;</span> tput setaf <span class="nu0">1</span> <span class="br0">&#41;</span>
<span class="re2">green</span>=$<span class="br0">&#40;</span> tput setaf <span class="nu0">2</span> <span class="br0">&#41;</span>
<span class="re2">NC</span>=$<span class="br0">&#40;</span> tput sgr0 <span class="br0">&#41;</span>      <span class="co0"># or perhaps: tput sgr0</span>
<span class="co0">#NC=$( tput setaf 0 )      # or perhaps: tput sgr0</span>
&nbsp;
&nbsp;
<span class="kw1">function</span> readDirectoryPath<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
  <span class="kw3">echo</span> <span class="re5">-n</span> <span class="st0">&quot;chemin absolu du répertoire des vidéos où extraire les sous-titres : &quot;</span>
  <span class="kw2">read</span> directory;
  <span class="re2">courant_directory</span>=$<span class="br0">&#40;</span><span class="kw3">pwd</span><span class="br0">&#41;</span>;
  <span class="kw1">if</span> <span class="br0">&#91;</span><span class="br0">&#91;</span> <span class="sy0">!</span> <span class="re5">-e</span> <span class="st0">&quot;<span class="es2">$directory</span>&quot;</span> <span class="br0">&#93;</span><span class="br0">&#93;</span>; <span class="kw1">then</span>
    <span class="kw3">echo</span> <span class="st0">&quot;incorrect&quot;</span>;
    readDirectoryPath;    
  <span class="kw1">fi</span>
  <span class="kw3">cd</span> <span class="re1">$directory</span>;
  <span class="re2">directory</span>=$<span class="br0">&#40;</span><span class="kw3">pwd</span><span class="br0">&#41;</span>;
  <span class="kw3">cd</span> <span class="re1">$courant_directory</span>;
  <span class="kw3">echo</span> <span class="re1">$directory</span>;
  <span class="co0">#testIfAnyFileIsPresent=$(find . -maxdepth 1 -iname &quot;*.$extension&quot; | wc -l);</span>
<span class="br0">&#125;</span>
&nbsp;
&nbsp;
<span class="kw1">function</span> presentationOfFileDirectory<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
  <span class="re2">message</span>=$<span class="br0">&#40;</span><span class="st0">&quot;&lt;&lt;&quot;</span><span class="re1">$directory</span><span class="st0">&quot;&gt;&gt; contient les fichiers suivants :  &quot;</span><span class="br0">&#41;</span>;
  <span class="re2">files</span>=$<span class="br0">&#40;</span><span class="kw2">ls</span> <span class="re1">$directory</span><span class="sy0">/*</span>.<span class="sy0">*</span><span class="br0">&#41;</span>;
  print <span class="st0">&quot;%$<span class="es1">\n</span>&quot;</span> <span class="st0">&quot;<span class="es3">${green}</span><span class="es2">$message</span><span class="es3">${NC}</span>&quot;</span>;
  print <span class="st0">&quot;%$<span class="es1">\n</span>&quot;</span> <span class="st0">&quot;<span class="es3">${green}</span><span class="es2">$files</span><span class="es3">${NC}</span>&quot;</span>;
<span class="br0">&#125;</span>
&nbsp;
&nbsp;
<span class="kw1">function</span> readVideoExtension<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
  <span class="kw3">echo</span> <span class="re5">-n</span> <span class="st0">&quot;Extension des fichiers vidéos à traiter (&quot;</span>$<span class="br0">&#40;</span><span class="br0">&#40;</span><span class="nu0">4</span>-<span class="re1">$count</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="st0">&quot; tentatives restantes) : &quot;</span>
  <span class="kw2">read</span> extension;
  <span class="re2">testIfAnyFileIsPresent</span>=$<span class="br0">&#40;</span><span class="kw2">find</span> <span class="re1">$directory</span> <span class="re5">-maxdepth</span> <span class="nu0">1</span> <span class="re5">-iname</span> <span class="st0">&quot;*.<span class="es2">$extension</span>&quot;</span> <span class="sy0">|</span> <span class="kw2">wc</span> -l<span class="br0">&#41;</span>;
<span class="br0">&#125;</span>
&nbsp;
&nbsp;
<span class="kw1">function</span> choiseTypeOfVideo<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
  <span class="kw3">local</span> <span class="re2">tmp_videos</span>=<span class="st0">&quot;&quot;</span>
  <span class="re2">count</span>=<span class="nu0">0</span>;
  readDirectoryPath;
  presentationOfFileDirectory;
  <span class="re2">testIfAnyFileIsPresent</span>=<span class="nu0">0</span>;
  <span class="kw1">while</span> <span class="br0">&#91;</span> <span class="re1">$testIfAnyFileIsPresent</span> = <span class="nu0">0</span> <span class="br0">&#93;</span> <span class="sy0">&amp;&amp;</span> <span class="br0">&#91;</span> <span class="re1">$count</span> <span class="sy0">!</span>= <span class="nu0">3</span> <span class="br0">&#93;</span> ; <span class="kw1">do</span>
    <span class="re2">count</span>=$<span class="br0">&#40;</span><span class="br0">&#40;</span><span class="re1">$count</span>+<span class="nu0">1</span><span class="br0">&#41;</span><span class="br0">&#41;</span>;
    readVideoExtension;
  <span class="kw1">done</span>
  <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re1">$count</span> = <span class="nu0">3</span> <span class="br0">&#93;</span> ; <span class="kw1">then</span>
    print <span class="st0">&quot;%$<span class="es1">\n</span>&quot;</span> <span class="st0">&quot;<span class="es3">${red}</span>&quot;</span><span class="st0">&quot;3 mauvaises tentatives entrainent l\'arrêt du programme&quot;</span><span class="st0">&quot;<span class="es3">${NC}</span>&quot;</span>;
    print <span class="st0">&quot;%$<span class="es1">\n</span>&quot;</span> <span class="st0">&quot;<span class="es3">${red}</span>&quot;</span><span class="st0">&quot;Abandon&quot;</span><span class="st0">&quot;<span class="es3">${NC}</span>&quot;</span>;
    <span class="kw3">exit</span> <span class="nu0">100</span>;
  <span class="kw1">fi</span>
  <span class="co0">#/home/alban/Vidéos/fr3/annez.ts&quot; | sed &quot;s/\(.*\)\/\([Aa-Zz]*.$extension\)/\2/g&quot;</span>
  <span class="co0">#Example : data0001.ts data0002.ts data0003.ts</span>
  <span class="kw3">cd</span> <span class="re1">$directory</span>;
  <span class="re2">videoFiles</span>=<span class="br0">&#40;</span>$<span class="br0">&#40;</span> <span class="kw2">ls</span> <span class="sy0">*</span>.<span class="re1">$extension</span> <span class="br0">&#41;</span><span class="br0">&#41;</span>;
  <span class="kw3">cd</span> <span class="re1">$courant_directory</span>;
<span class="br0">&#125;</span>  
&nbsp;
&nbsp;
<span class="kw1">function</span> cleanVideoInformations<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw2">cat</span> <span class="re4">$1</span> <span class="sy0">|</span> <span class="kw2">grep</span> Imput <span class="sy0">&gt;</span> <span class="re4">$2</span>;
    <span class="kw2">cat</span> <span class="re4">$1</span> <span class="sy0">|</span> <span class="kw2">grep</span> Duration <span class="sy0">&gt;&gt;</span> <span class="re4">$2</span>;
    <span class="kw2">cat</span> <span class="re4">$1</span> <span class="sy0">|</span> <span class="kw2">grep</span> Stream <span class="sy0">&gt;&gt;</span> <span class="re4">$2</span>;
    <span class="kw2">rm</span> <span class="re4">$1</span>;  
<span class="br0">&#125;</span>
&nbsp;
&nbsp;
<span class="kw1">function</span> prepareCommandToObtainSubtitlesTrackNumer<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
  <span class="kw3">local</span> a;
  <span class="co0">#local j=0;</span>
  <span class="kw1">for</span> <span class="br0">&#40;</span><span class="br0">&#40;</span> <span class="re2">i</span>=<span class="nu0">0</span> ; i <span class="sy0">&lt;</span> <span class="co1">${#videoFiles[@]}</span> ; i++ <span class="br0">&#41;</span><span class="br0">&#41;</span> ; <span class="kw1">do</span>
    <span class="co0">#/home/alban/Vidéos/fr3/ENEMY/data0003.ts</span>
    data_videos_files<span class="br0">&#91;</span>i<span class="br0">&#93;</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="re1">$directory</span><span class="st0">&quot;/&quot;</span><span class="co1">${videoFiles[i]}</span><span class="br0">&#41;</span>;
    <span class="co0">#/tmp/data0001_subtitle_infos.txt</span>
    tmp_video_info<span class="br0">&#91;</span>i<span class="br0">&#93;</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="st0">&quot;/tmp/&quot;</span><span class="co1">${videoFiles[i]}</span> <span class="sy0">|</span> <span class="kw2">sed</span> <span class="st0">&quot;s/.<span class="es2">$extension</span>/_subtitle_infos.txt/g&quot;</span><span class="br0">&#41;</span>;
    <span class="co0">#/tmp/data0003.ts.info</span>
    video_info_file<span class="br0">&#91;</span>i<span class="br0">&#93;</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="sy0">/</span>tmp<span class="sy0">/</span><span class="co1">${videoFiles[i]}</span>.info<span class="br0">&#41;</span>;
    <span class="co0">#ffprobe /home/alban/Vidéos/fr3/ENEMY/data0003.ts 2&gt;&amp;1 | ffmpeg -i EnnemyMine.ts -vn -an 2&gt;&amp;1 | grep '[A-Z][a-z]\{4\}' | sed &quot;s/\(^[ ]*\)\([[:alnum:]]\)/\2/g&quot; &gt;/tmp/data0001_subtitle_infos.txt </span>
    ffprobe <span class="co1">${data_videos_files[i]}</span> <span class="nu0">2</span><span class="sy0">&gt;&amp;</span><span class="nu0">1</span> <span class="sy0">|</span> <span class="kw2">grep</span> <span class="st_h">'[A-Z][a-z]\{4\}'</span> <span class="sy0">|</span> <span class="kw2">sed</span> <span class="st0">&quot;s/\(^[ ]*\)\([[:alnum:]]\)/\2/g&quot;</span> <span class="sy0">&gt;</span><span class="co1">${tmp_video_info[i]}</span>;
    <span class="co0">#create a cleanning file  of video information</span>
    cleanVideoInformations <span class="st0">&quot;<span class="es3">${tmp_video_info[i]}</span>&quot;</span> <span class="st0">&quot;<span class="es3">${video_info_file[i]}</span>&quot;</span>;
    <span class="co0">#cat /tmp/video-info.txt | grep Subtitle | sed &quot;s/\(^.* \#\)\([0-9]:[0-9]\)(\([[:alnum:]]\{3\}\))\(.*\)/\2#\3/g&quot;</span>
    <span class="co0"># tracks_Info[1] =Stream #0:5(fra): Subtitle: dvd_subtitle (default) Stream #0:6(ger): Subtitle: dvd_subtitle Stream #0:7(fra): Subtitle: dvd_subtitle</span>
    tracks_Info<span class="br0">&#91;</span>i<span class="br0">&#93;</span>=$<span class="br0">&#40;</span><span class="kw2">cat</span> <span class="co1">${video_info_file[i]}</span> <span class="sy0">|</span> <span class="kw2">grep</span> Subtitle <span class="sy0">|</span> <span class="kw2">sed</span> <span class="st0">&quot;s/\(^.* \#\)\([0-9]:[0-9]\)(\([[:alnum:]]\{3\}\))\(.*\)/\2#\3/g&quot;</span> <span class="br0">&#41;</span>;
    <span class="kw2">rm</span> <span class="co1">${video_info_file[i]}</span>;
  <span class="kw1">done</span>
<span class="br0">&#125;</span>
&nbsp;
&nbsp;
<span class="kw1">function</span> createDirectoryIfNotExist<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
  <span class="kw1">if</span> <span class="br0">&#91;</span><span class="br0">&#91;</span> <span class="sy0">!</span> <span class="re5">-e</span> <span class="re4">$1</span> <span class="br0">&#93;</span><span class="br0">&#93;</span> ; <span class="kw1">then</span>
    <span class="kw2">mkdir</span> <span class="re4">$1</span>;
  <span class="kw1">fi</span>
&nbsp;
<span class="br0">&#125;</span>
&nbsp;
<span class="kw1">function</span> ExtractSubtitleFromVideoInMKV<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
  <span class="kw3">local</span> <span class="re2">j</span>=<span class="nu0">0</span>;
  <span class="kw3">local</span> <span class="re2">k</span>=<span class="nu0">0</span>;
  <span class="re4">$1</span>
  <span class="kw3">echo</span>  <span class="st_h">'tracks_Info: '</span><span class="co1">${tracks_Info[@]}</span>;
  <span class="kw1">for</span> <span class="br0">&#40;</span><span class="br0">&#40;</span><span class="re2">i</span>=<span class="nu0">0</span> ; i<span class="sy0">&lt;</span> <span class="co1">${#tracks_Info[@]}</span>; i++<span class="br0">&#41;</span><span class="br0">&#41;</span>; <span class="kw1">do</span>
      <span class="co0">#From : data0001.ts to: data0001</span>
      extract_work_files<span class="br0">&#91;</span>i<span class="br0">&#93;</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="co1">${videoFiles[i]}</span> <span class="sy0">|</span> <span class="kw2">sed</span> <span class="st0">&quot;s/.<span class="es2">$extension</span>//g&quot;</span><span class="br0">&#41;</span>;
      <span class="co0">#echo ${directory}/${extract_work_files[i]};</span>
      createDirectoryIfNotExist <span class="st0">&quot;<span class="es3">${directory}</span>/<span class="es3">${extract_work_files[i]}</span>&quot;</span>;
      <span class="re2">tmp</span>=<span class="br0">&#40;</span>$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="co1">${tracks_Info[i]}</span><span class="br0">&#41;</span><span class="br0">&#41;</span>;
      <span class="kw1">for</span> each <span class="kw1">in</span> <span class="co1">${tmp[@]}</span>;<span class="kw1">do</span>
	<span class="co0"># De : 0:4#fra à : 0.4 fra</span>
	<span class="co0">#0:4</span>
	<span class="re2">track_number</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="re1">$each</span> <span class="sy0">|</span> <span class="kw2">cut</span> <span class="re5">-d</span><span class="st_h">'#'</span> -f1<span class="br0">&#41;</span>;
	<span class="co0">#fra</span>
	<span class="re2">track_lang</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="re1">$each</span> <span class="sy0">|</span> <span class="kw2">cut</span> <span class="re5">-d</span><span class="st_h">'#'</span> -f2<span class="br0">&#41;</span>;
	<span class="co0">#ffmpeg -threads 4 -i /home/alban/Vidéos/fr3/ENEMY/data0001.ts -map 0:5 -vn -an -scodec dvdsub /home/alban/Vidéos/fr3/ENEMY/data0001/data0001_0_fra.mkv</span>
	<span class="kw2">ffmpeg</span> <span class="re5">-threads</span> <span class="nu0">4</span> <span class="re5">-i</span> <span class="co1">${directory}</span><span class="sy0">/</span><span class="co1">${videoFiles[i]}</span> <span class="re5">-map</span> <span class="re1">$track_number</span> <span class="re5">-vn</span> <span class="re5">-an</span> <span class="re5">-scodec</span> dvdsub <span class="co1">${directory}</span><span class="sy0">/</span><span class="co1">${extract_work_files[i]}</span><span class="sy0">/</span><span class="co1">${extract_work_files[i]}</span>\_<span class="re1">$j</span>\_<span class="re1">$track_lang</span>.mkv;	
	mkv_files<span class="br0">&#91;</span>k<span class="br0">&#93;</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="co1">${directory}</span><span class="sy0">/</span><span class="co1">${extract_work_files[i]}</span><span class="sy0">/</span><span class="co1">${extract_work_files[i]}</span>\_<span class="re1">$j</span>\_<span class="re1">$track_lang</span>.mkv<span class="br0">&#41;</span>;
	mkv_directories<span class="br0">&#91;</span>k<span class="br0">&#93;</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="co1">${directory}</span><span class="sy0">/</span><span class="co1">${extract_work_files[i]}</span><span class="br0">&#41;</span>;
	subtitle_sub_id<span class="br0">&#91;</span>k<span class="br0">&#93;</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="co1">${extract_work_files[i]}</span>\_<span class="re1">$j</span>\_<span class="re1">$track_lang</span><span class="br0">&#41;</span>;
	subtitle_lang<span class="br0">&#91;</span>k<span class="br0">&#93;</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="re1">$track_lang</span><span class="br0">&#41;</span>;
	<span class="re2">j</span>=$<span class="br0">&#40;</span><span class="br0">&#40;</span><span class="re1">$j</span> + <span class="nu0">1</span><span class="br0">&#41;</span><span class="br0">&#41;</span>;
	<span class="re2">k</span>=$<span class="br0">&#40;</span><span class="br0">&#40;</span><span class="re1">$k</span> + <span class="nu0">1</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
      <span class="kw1">done</span>
  <span class="kw1">done</span>
<span class="br0">&#125;</span>
&nbsp;
&nbsp;
&nbsp;
<span class="kw1">function</span> OpticalRecognitionCharacterOfTiff<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
  <span class="kw1">for</span> eachTiff <span class="kw1">in</span> <span class="re4">$1</span><span class="sy0">*</span>.tif; <span class="kw1">do</span> 
    cuneiform <span class="re5">-l</span> <span class="re4">$2</span> <span class="re5">-f</span> text <span class="re5">-o</span> <span class="re1">$eachTiff</span>.txt <span class="re1">$eachTiff</span>; 
  <span class="kw1">done</span> 
&nbsp;
<span class="br0">&#125;</span>
&nbsp;
&nbsp;
<span class="kw1">function</span> convertMKVSubtitleInSRT<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
  <span class="kw3">local</span> <span class="re2">j</span>=<span class="nu0">0</span>
  <span class="kw1">for</span> <span class="br0">&#40;</span><span class="br0">&#40;</span> <span class="re2">i</span>=<span class="nu0">0</span> ; i <span class="sy0">&lt;</span> <span class="co1">${#mkv_files[@]}</span>; i++ <span class="br0">&#41;</span><span class="br0">&#41;</span>; <span class="kw1">do</span> 
    <span class="co0">#mkvextract tracks /home/alban/Vidéos/fr3/EnnemyMine/EnnemyMine_0_fra.mkv -c ISO8859-1 0:/home/alban/Vidéos/fr3/EnnemyMine/EnnemyMine_0_fra</span>
    mkvextract tracks <span class="co1">${mkv_files[i]}</span> <span class="re5">-c</span> ISO8859-<span class="nu0">1</span> <span class="nu0">0</span>:<span class="co1">${mkv_directories[i]}</span><span class="sy0">/</span><span class="co1">${subtitle_sub_id[i]}</span>;
    <span class="co0"># if sub file existe and has a size equal to 0 than erase sub and idx files</span>
    <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="sy0">!</span> <span class="re5">-s</span> <span class="co1">${mkv_directories[i]}</span><span class="sy0">/</span><span class="co1">${subtitle_sub_id[i]}</span>.sub <span class="br0">&#93;</span>; <span class="kw1">then</span> 
      <span class="kw2">rm</span> <span class="co1">${mkv_directories[i]}</span><span class="sy0">/</span><span class="co1">${subtitle_sub_id[i]}</span>.sub;
      <span class="kw2">rm</span> <span class="co1">${mkv_directories[i]}</span><span class="sy0">/</span><span class="co1">${subtitle_sub_id[i]}</span>.idx;
    <span class="kw1">fi</span>
  <span class="kw1">done</span>
&nbsp;
  <span class="kw1">for</span> <span class="br0">&#40;</span><span class="br0">&#40;</span> <span class="re2">i</span>=<span class="nu0">0</span> ; i <span class="sy0">&lt;</span> <span class="co1">${#videoFiles[@]}</span> ; i++ <span class="br0">&#41;</span><span class="br0">&#41;</span> ; <span class="kw1">do</span>
    <span class="re2">work_directories</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="co1">${videoFiles[i]}</span> <span class="sy0">|</span> <span class="kw2">sed</span> <span class="st0">&quot;s/.<span class="es2">$extension</span>//g&quot;</span><span class="br0">&#41;</span> ;
    <span class="co0">#mkv_directories=$(echo $directory/work_directories  kv_directories${videoFiles[i]} | sed &quot;s/.$extension//g&quot;);</span>
    <span class="kw1">for</span> each <span class="kw1">in</span> <span class="re1">$directory</span><span class="sy0">/</span><span class="re1">$work_directories</span><span class="st0">&quot;/*.idx&quot;</span>; <span class="kw1">do</span>
      <span class="re2">subtitle_sub</span>=<span class="br0">&#40;</span>$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="re1">$each</span><span class="br0">&#41;</span><span class="br0">&#41;</span>;
      <span class="kw1">for</span> filesub <span class="kw1">in</span> <span class="co1">${subtitle_sub[@]}</span>; <span class="kw1">do</span>
	<span class="co0">#id_file=/home/alban/Vidéos/clanDesSabresVollants/de/Le_Secret_des_poignards_Volants_base/Le_Secret_des_poignards_Volants_base__fra</span>
	<span class="re2">id_file</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="re1">$filesub</span> <span class="sy0">|</span> <span class="kw2">sed</span> <span class="st0">&quot;s/.idx//g&quot;</span><span class="br0">&#41;</span>;
	subp2tiff <span class="re5">--sid</span>=<span class="nu0">0</span> <span class="re5">-n</span> <span class="re1">$id_file</span>;
	<span class="co0">#fra</span>
	<span class="re2">sub_lang</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="re1">$filesub</span> <span class="sy0">|</span> <span class="kw2">sed</span> <span class="st0">&quot;s/\(.*\)\([a-z]\{3\}\)\(.idx\)/\2/g&quot;</span><span class="br0">&#41;</span>;
	<span class="co0">#subtitle_file_name : /home/alban/Vidéos/clanDesSabresVollants/de/Le_Secret_des_poignards_Volants_base/Le_Secret_des_poignards_Volants_base__fra.srt</span>
	<span class="re2">subtitle_file_name</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="re1">$filesub</span> <span class="sy0">|</span>  <span class="kw2">sed</span> <span class="st0">&quot;s/.idx//g&quot;</span><span class="br0">&#41;</span>;
	<span class="kw3">echo</span> <span class="st0">&quot;subtitle_file_name : &quot;</span><span class="re1">$subtitle_file_name</span>;
	<span class="co0">#sub_id=$directory/$work_directories$(echo $filesub | sed &quot;s/\(.*\)\(\_[0-9]\_\)\([a-z]\{3\}\)\(.idx\)/\2\3/g&quot;);</span>
	<span class="co0">#OpticalRecognitionCharacterOfTiff &quot;$sub_id&quot; &quot;$sub_lang&quot;;</span>
	OpticalRecognitionCharacterOfTiff <span class="st0">&quot;<span class="es2">$subtitle_file_name</span>&quot;</span> <span class="st0">&quot;<span class="es2">$sub_lang</span>&quot;</span>;
	<span class="co0">#echo $directory/$(echo ${videoFiles[i]} | sed &quot;s/.$extension//g&quot;)/;</span>
	<span class="co0"># tmp= Le_Secret_des_poignards_Volants_base__fra</span>
	<span class="re2">tmp</span>=$<span class="br0">&#40;</span><span class="kw3">echo</span> <span class="re1">$filesub</span> <span class="sy0">|</span> <span class="kw2">sed</span> <span class="st0">&quot;s/\(.*\)\/\(.*\)\(.idx\)/\2/g&quot;</span> <span class="br0">&#41;</span>;
	<span class="kw3">echo</span> <span class="st0">&quot;commande subptools : subptools -s -w -t srt -i <span class="es2">$id_file</span>.xml -o <span class="es2">$directory</span>/<span class="es2">$tmp</span>.srt&quot;</span>;
	subptools <span class="re5">-s</span> <span class="re5">-w</span> <span class="re5">-t</span> srt <span class="re5">-i</span> <span class="re1">$id_file</span>.xml <span class="re5">-o</span> <span class="re1">$directory</span><span class="sy0">/</span><span class="re1">$tmp</span>.srt
      <span class="kw1">done</span>
      <span class="kw2">rm</span> <span class="re5">-rf</span> <span class="re1">$directory</span><span class="sy0">/</span><span class="re1">$work_directories</span>;
    <span class="kw1">done</span>
  <span class="kw1">done</span>
<span class="br0">&#125;</span>
&nbsp;
choiseTypeOfVideo;
prepareCommandToObtainSubtitlesTrackNumer;
ExtractSubtitleFromVideoInMKV
convertMKVSubtitleInSRT;
<span class="kw3">exit</span> <span class="nu0">0</span>;</pre>

</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit form-inline" method="post" action="/extraire_sous-titres_video"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1608644986" /><input type="hidden" name="summary" value="[Script ts2srt] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="script_ts2srt" /><input type="hidden" name="codeblockOffset" value="4" /><input type="hidden" name="range" value="5509-13743" /><button type="submit" title="Script ts2srt" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit8 page-header" id="contributeurs">Contributeurs</h2>
<div class="level2">

<p>
<a href="/utilisateurs/albanmartel" class="wikilink1" title="utilisateurs:albanmartel">albanmartel</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit form-inline" method="post" action="/extraire_sous-titres_video"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1608644986" /><input type="hidden" name="summary" value="[Contributeurs] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="contributeurs" /><input type="hidden" name="codeblockOffset" value="5" /><input type="hidden" name="range" value="13744-" /><button type="submit" title="Contributeurs" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="extraire_sous-titres_video.txt">extraire_sous-titres_video.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 22/12/2020, 14:49">Le 22/12/2020, 14:49</span></li><li class="text-muted">par alban.f.j.martel</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=extraire_sous-titres_video&amp;1635550193" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
