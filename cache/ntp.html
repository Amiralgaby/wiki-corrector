<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>ntp [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="xenial,client,serveur,reseau,brouillon"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/ntp?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns="/>
<link rel="edit" title="Modifier cette page" href="/ntp?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/ntp"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/ntp"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/ntp"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"ntp","namespace":"","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="ntp">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/ntp?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/ntp?do=media&amp;ns="  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/ntp?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/ntp?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/ntp?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/ntp?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/ntp?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">ntp</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/ntp?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/ntp?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/ntp?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#client_ntp","title":"Client NTP","level":1},{"link":"#par_requete","title":"Par requ\u00eate","level":2},{"link":"#par_ecoute_d_un_broadcastmulticast","title":"Par \u00e9coute d'un broadcast\/multicast","level":2},{"link":"#serveur_ntp","title":"Serveur NTP","level":1},{"link":"#pre-requis","title":"Pr\u00e9-requis","level":2},{"link":"#installation","title":"Installation","level":2},{"link":"#configuration","title":"Configuration","level":2},{"link":"#utilisation","title":"Utilisation","level":2},{"link":"#les_serveurs_ntp_existants","title":"Les Serveurs NTP existants","level":2},{"link":"#tests","title":"Tests","level":1},{"link":"#liens","title":"Liens","level":1}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level1"><a href="#client_ntp">Client NTP</a>
<ul class="nav toc">
<li class="level2"><a href="#par_requete">Par requête</a></li>
<li class="level2"><a href="#par_ecoute_d_un_broadcastmulticast">Par écoute d&#039;un broadcast/multicast</a></li>
</ul>
</li>
<li class="level1"><a href="#serveur_ntp">Serveur NTP</a>
<ul class="nav toc">
<li class="level2"><a href="#pre-requis">Pré-requis</a></li>
<li class="level2"><a href="#installation">Installation</a></li>
<li class="level2"><a href="#configuration">Configuration</a></li>
<li class="level2"><a href="#utilisation">Utilisation</a></li>
<li class="level2"><a href="#les_serveurs_ntp_existants">Les Serveurs NTP existants</a></li>
</ul>
</li>
<li class="level1"><a href="#tests">Tests</a></li>
<li class="level1"><a href="#liens">Liens</a></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content"><div class="notetag">Cette page est en cours de rédaction.<br />
<a href="/wiki/participer_wiki">Apportez votre aide…</a>
</div>
<div class="tags"><span>
	<a href="/xenial" class="wikilink1" title="xenial" rel="tag">Xenial</a>,
	<a href="/client?do=showtag&amp;tag=client" class="wikilink1" title="client" rel="tag">client</a>,
	<a href="/serveur" class="wikilink1" title="serveur" rel="tag">serveur</a>,
	<a href="/reseau" class="wikilink1" title="reseau" rel="tag">réseau</a>,
	<a href="/brouillon" class="wikilink1" title="brouillon" rel="tag">BROUILLON</a>
</span></div>

<h1 class="sectionedit1 page-header" id="ntp">NTP</h1>
<div class="level1">

<p>
Ubuntu  a longtemps utilisé <a href="/ntpdate" class="wikilink1" title="ntpdate">ntpdate</a> et ntpd  pour ajuster l&#039;horloge interne des systèmes d&#039;exploitation, cette tâche est désormais assurée par <a href="/timedatectl" class="wikilink1" title="timedatectl">timedatectl</a> qui est installé par défaut dans votre distribution. <abbr title="Network Time Protocol">NTP</abbr> (Network Time Protocol) est un protocole permettant de distribuer l&#039;heure sur un réseau informatique. Il se décline en deux faces : le client, <a href="/ntpdate" class="wikilink1" title="ntpdate">ntpdate</a>, et le serveur, ntpd. 
</p>

<p>
Chaque machine peut être à la fois serveur <em>et</em> client.
</p>

<p>
Chaque machine qui souhaite mettre à jour son horloge va sélectionner dans sa configuration un serveur de temps. En même temps que l&#039;heure, elle récupère un numéro de strate, n, et se déclare elle-même de strate n+1.
</p>

<p>
Un certain nombre de sources (horloges atomiques d&#039;universités, récepteurs GPS…) sont de strate 0 et connectées à des serveurs (strate 1) qui diffusent donc l&#039;heure. Ces mêmes serveurs fournissent l&#039;heure à des serveurs de strate 2, qui sont eux, généralement accessibles au public (serveurs d&#039;administrations, d&#039;universités ou de centres de recherches dont l&#039;accès est ouvert au public).
</p>

<p>
Ce fonctionnement pyramidal a pour but de fournir une heure de qualité (déviant peu par rapport aux différentes mesures du temps, temps légal, universel et autre. Ces mesures sont fonction des lois de la physique.) tout en ne surchargeant pas les machines critiques que sont les serveurs de strates 0 et 1. Plus la strate de votre serveur est haute, plus votre signal de temps peut dévier par rapport à l&#039;heure &quot;moyenne&quot;, &quot;légale&quot; ou autre. Toutefois, globalement le protocole fournit un signal de temps précis à la seconde, voire encore plus précis.
</p>

</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/ntp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614935762" /><input type="hidden" name="summary" value="[NTP] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="ntp" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="51-1729" /><button type="submit" title="NTP" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit2 page-header" id="client_ntp">Client NTP</h2>
<div class="level2">

<p>
C&#039;est l&#039;utilisateur final, il existe typiquement deux façons pour une machine cliente de se synchroniser sur un serveur :
</p>

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/ntp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614935762" /><input type="hidden" name="summary" value="[Client NTP] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="client_ntp" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="1730-1876" /><button type="submit" title="Client NTP" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit3" id="par_requete">Par requête</h3>
<div class="level3">

<p>
Le client envoie une requête à un serveur et récupère la réponse.<br/>

Par défaut<sup><a href="#fn__1" id="fnt__1" class="fn_top">1)</a></sup>, <em><a href="/timedatectl" class="wikilink1" title="timedatectl">timedatectl</a></em>  pré-installée (à partir de <a href="/xenial" class="wikilink1" title="xenial">xenial</a>), qui remplace <a href="/ntpdate" class="wikilink1" title="ntpdate">ntpdate</a>, synchronise l&#039;heure au démarrage et lors d’activations de connexion réseau. 
</p>

</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit form-inline" method="post" action="/ntp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614935762" /><input type="hidden" name="summary" value="[Par requête] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="par_requete" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="1877-2226" /><button type="submit" title="Par requête" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit4" id="par_ecoute_d_un_broadcastmulticast">Par écoute d&#039;un broadcast/multicast</h3>
<div class="level3">

<p>
Le client est à l&#039;écoute des émissions en broadcast/multicast régulière de l&#039;heure. Cette solution est optimale, elle évite les requêtes vers le serveur.<br/>

</p>

<p>
<img src="/lib/images/smileys/fixme.gif" class="icon" alt="FIXME" /> Dans les versions récentes d&#039;Ubuntu, <em>timesyncd</em> remplace la partie client de ntpd<sup><a href="#fn__2" id="fnt__2" class="fn_top">2)</a></sup>
</p>
<div class="noteimportant">Cette solution nécessite d&#039;être dans un réseau maîtrisé, typiquement un réseau d&#039;entreprise où le routeur sert de serveur <abbr title="Network Time Protocol">NTP</abbr>
</div>
<p>
Il faut <a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer le paquet</a> <strong><a href="apt://ntp" class="interwiki iw_apt" title="apt://ntp">ntp</a></strong>.
</p>
<pre class="code">sudo apt-get install ntp</pre>

<p>
puis dé-commenter les deux lignes suivante dans le fichier <strong>/etc/ntp.conf</strong> :
</p>
<dl class="file">
<dt><a href="/_export/code/ntp?codeblock=1" title="Télécharger cet extrait" class="mediafile mf_conf">/etc/ntp.conf</a></dt>
<dd><pre class="file">disable auth
broadcastclient</pre>
</dd></dl>

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit form-inline" method="post" action="/ntp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614935762" /><input type="hidden" name="summary" value="[Par écoute d&#039;un broadcast/multicast] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="par_ecoute_d_un_broadcastmulticast" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="2227-3014" /><button type="submit" title="Par écoute d&#039;un broadcast/multicast" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit5 page-header" id="serveur_ntp">Serveur NTP</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit form-inline" method="post" action="/ntp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614935762" /><input type="hidden" name="summary" value="[Serveur NTP] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="serveur_ntp" /><input type="hidden" name="codeblockOffset" value="2" /><input type="hidden" name="range" value="3015-3039" /><button type="submit" title="Serveur NTP" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit6" id="pre-requis">Pré-requis</h3>
<div class="level3">

<p>
<abbr title="Network Time Protocol">NTP</abbr> étant un protocole réseau, il vous faut une interface réseau active. Vous pouvez tout à fait diffuser un signal de temps sur un réseau <em>hors internet</em>. L&#039;horloge de référence sera celle du serveur ntp, celui-ci sera alors la strate 1 et sera uniquement serveur.
</p>

<p>
Si toutefois vous voulez disposer d&#039;une heure synchrone avec le reste du monde, votre serveur ntp devra être à la fois serveur (pour diffuser l&#039;heure) <em>et</em> client (pour mettre sa propre horloge à jour auprès de serveurs de confiance). Pour ce faire, il doit disposer d&#039;une connexion internet sortante.
</p>

<p>
De plus il faut que cette connexion sortante supporte UDP et le port 123. Ceci est rarement le cas derrière les hotspots wifi publics par exemple. Dans une telle situation ntpdate donnera uniquement un message comme &quot;no Server suitable for synchronization found&quot;.
</p>

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit form-inline" method="post" action="/ntp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614935762" /><input type="hidden" name="summary" value="[Pré-requis] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="pre-requis" /><input type="hidden" name="codeblockOffset" value="2" /><input type="hidden" name="range" value="3040-3913" /><button type="submit" title="Pré-requis" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit7" id="installation">Installation</h3>
<div class="level3">

<p>
Il vous suffit d&#039;<a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer le paquet</a> <strong><a href="apt://ntp" class="interwiki iw_apt" title="apt://ntp">ntp</a></strong>.
</p>

<p>
Il existe aussi une implémentation <abbr title="Berkeley Software Distribution">BSD</abbr> du protocole qui est disponible sur Ubuntu via le paquet <strong><a href="apt://openntpd" class="interwiki iw_apt" title="apt://openntpd">openntpd</a></strong>.
</p>

</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit form-inline" method="post" action="/ntp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614935762" /><input type="hidden" name="summary" value="[Installation] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation" /><input type="hidden" name="codeblockOffset" value="2" /><input type="hidden" name="range" value="3914-4154" /><button type="submit" title="Installation" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit8" id="configuration">Configuration</h3>
<div class="level3">

<p>
Toute la configuration du serveur se fait sur le fichier /etc/ntp.conf
</p>
<pre class="file">logfile /var/log/ntpstats/ntpd
statsdir /var/log/ntpstats/
statistics loopstats peerstats clockstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable

# Addresses to listen on (ntpd does not listen by default)
listen on *
#listen on 127.0.0.1
#listen on ::1

# sync to a single server
#server ntp.example.org

# use a random selection of 4 public stratum 2 servers
# see http://twiki.ntp.org/bin/view/Servers/NTPPoolServers
# and http://www.pool.ntp.org/
server ntp.metas.ch
server ntp.obspm.fr
server ntp2.jussieu.fr
server ntp.uvsq.fr
server ntp.u-psud.fr
server ntp1.belbone.be</pre>

<p>
Les premières lignes concernent les logs. N&#039;oubliez pas qu&#039;une des lignes <em>listen</em> doit être non-commentées ! Sinon il n&#039;attendra pas de requêtes !
Les directives réellement importantes sont les <em>server</em>. Chacun de ces serveurs est une source de temps considérée comme fiable. Il n&#039;existe pas vraiment de règle sur le nombre de serveurs à utiliser, mais globalement, plus vous en mettez, plus votre signal sera stable car en cas de défaillance ou de chute d&#039;une des sources, votre serveur aura d&#039;autres serveurs à consulter.
</p>
<div class="notetip">L&#039;auteur utilise deux types de sources : des serveurs proches de son domicile (Paris) pour battre la mesure et fournir l&#039;heure courante, et des serveurs étrangers qui permettent &quot;de s&#039;assurer que votre horloge ne s&#039;écarte pas trop du temps mondial&quot;. L&#039;auteur tient à dire que cette idée est hautement spéculative et qu&#039;il a d&#039;ailleurs du mal à la formuler. D&#039;autre part, il faut prendre gare à ce que les serveurs soient dans des pays ou des réseaux différents de façon que la chute d&#039;un réseau n&#039;affecte pas votre propre serveur, indépendamment de l&#039;état du serveur source.
</div>
<p>
Vous pouvez ajouter votre propre horloge système comme source de temps par le paramètre fudge :
</p>
<pre class="file">server 127.127.1.0
fudge 127.127.1.0 stratum 10</pre>

<p>
Vous pouvez restreindre les clients (les ordinateurs autorisés à synchroniser leur horloge sur le serveur) :
</p>
<pre class="file">restrict default kod notrap nomodify nopeer noquery
restrict 127.0.0.1 nomodify
restrict 10.8.0.0 mask 255.255.255.0 nomodify notrap
restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap</pre>

<p>
Le démon ntpd va de plus utiliser des algorithmes pour déterminer quelle source est la meilleure.
</p>

</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit form-inline" method="post" action="/ntp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614935762" /><input type="hidden" name="summary" value="[Configuration] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration" /><input type="hidden" name="codeblockOffset" value="2" /><input type="hidden" name="range" value="4155-6676" /><button type="submit" title="Configuration" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit9" id="utilisation">Utilisation</h3>
<div class="level3">

<p>
On va lister ici les commandes qui permettent un bon diagnostic de l&#039;état de votre serveur et qui sont fournies dans son paquet (ntp).
</p>

<p>
La commande <strong>ntpq -p</strong> (ntp query) va permettre d&#039;interroger votre serveur.
</p>
<pre class="code">stephane@einstein:~$ ntpq -p
     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
 metasweb01.admi 162.23.3.170     2 u   60   64    7   50.108    3.427   3.519
 syrte8.obspm.fr 195.220.94.163   2 u   58   64    7   28.572   -6.305   4.326
 horlogegps.rese 10.3.128.189     2 u   56   64    7   28.010  -10.532   4.192
 soleil.uvsq.fr  .INIT.          16 u    -   64    0    0.000    0.000   0.000
 ntp.u-psud.fr   145.238.203.14   2 u   54   64    7   27.994   -7.168   4.741
 ntp1.belbone.be 195.13.23.6      2 u   52   64    7   52.644   -4.681   4.627
 web1.euromise.c 195.113.144.201  2 u   52   64    7   52.944   -3.416  24.792
 4504ds1-vo.1.fu .INIT.          16 u    -   64    0    0.000    0.000   0.000
</pre>

<p>
Dans ce tableau, chaque ligne concerne un serveur. La première colonne indique le nom du serveur en question. La deuxième indique l&#039;adresse (ou le nom) de sa source de temps (un autre serveur de temps en général). La deuxième indique sa strate. Les colonnes suivantes concernent l&#039;algorithme d&#039;équilibrage du serveur (prise en compte de la distance de votre serveur à la source indiquée en première colonne…).
Si vous avez que des 0 au niveau des colonnes delay offset jitter alors il y a un problème , vérifiez votre configuration.
</p>
<div class="noteclassic">Il est important que les serveurs que vous sélectionnez comme sources utilisent eux même des sources différentes !
</div>
<p>
La commande ntptrace permet notamment de vous indiquer de façon certaine à quelle strate vous vous situez, ainsi que d&#039;autres, sont fournies dans le paquet. Vous êtes encouragés à décrire ici leur fonctionnement.
</p>

<p>
Pour lancer, arrêter ou redémarrer votre serveur ntp, utilisez la commande service :
</p>

<p>
lancement
</p>
<pre class="code">sudo service ntp start</pre>

<p>
arrêt
</p>
<pre class="code">sudo service ntp stop</pre>

<p>
redémarrage
</p>
<pre class="code">sudo service ntp restart</pre>

<p>
Pour utiliser votre serveur en tant que source pour les ordinateurs de votre réseau, reportez vous à l&#039;article <a href="/ntpdate" class="wikilink1" title="ntpdate">ntpdate</a> et mettez son adresse en source dans le paramètre NTPSERVERS.
</p>

</div>
<div class='secedit editbutton_section editbutton_9'><form class="button btn_secedit form-inline" method="post" action="/ntp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614935762" /><input type="hidden" name="summary" value="[Utilisation] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="utilisation" /><input type="hidden" name="codeblockOffset" value="5" /><input type="hidden" name="range" value="6677-9067" /><button type="submit" title="Utilisation" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit10" id="les_serveurs_ntp_existants">Les Serveurs NTP existants</h3>
<div class="level3">

<p>
Le Comité Réseau des Universités maintient une liste des grands serveurs ntp français <a href="http://www.cru.fr/services/ntp/serveurs_francais" class="urlextern" title="http://www.cru.fr/services/ntp/serveurs_francais" rel="nofollow">ici</a>.<br/>

Des serveurs de strate 2 sont aussi listés ici : <a href="http://support.ntp.org/bin/view/Servers/StratumTwoTimeServers" class="urlextern" title="http://support.ntp.org/bin/view/Servers/StratumTwoTimeServers" rel="nofollow">serveurs ntp</a>.<br/>

</p>

<p>
Ajoutez ici les serveurs que vous connaissez ou que vous rendez publics :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> ntp.22decembre.eu</div>
</li>
<li class="level1"><div class="li"> pool.ntp.org</div>
</li>
<li class="level1"><div class="li"> ntp.ubuntu.com</div>
</li>
</ul>

</div>

<h4 id="le_pool_ntp">le pool NTP</h4>
<div class="level4">

<p>
Le pool de serveurs ntp est un projet global qui vise à fournir un service ntp fiable tout en répartissant la charge du service sur de nombreux serveurs.
</p>

</div>

<h5 id="utiliser_le_pool">Utiliser le pool</h5>
<div class="level5">

<p>
Si vous le souhaitez, vous pouvez l&#039;utiliser dans votre liste de sources :
</p>
<dl class="file">
<dt><a href="/_export/code/ntp?codeblock=9" title="Télécharger cet extrait" class="mediafile mf_conf">/etc/ntp.conf</a></dt>
<dd><pre class="code file bash">server <span class="nu0">0</span>.fr.pool.ntp.org
server <span class="nu0">1</span>.fr.pool.ntp.org</pre>
</dd></dl>

<p>
Le service est décomposé en zones par pays : ch, de, fr … et par continent : asia, africa, europe. Enfin, vous ajoutez (ou non) les préfixes 0, 1 et 2.
En général vous pouvez utiliser <strong>pool.ntp.org</strong>
Le pool va vous renvoyer une adresse de serveur au hasard pris dans la zone considéré. Vous aurez ainsi souvent des sources près de chez vous et fiables.
</p>

</div>

<h5 id="rejoindre_le_pool">Rejoindre le pool</h5>
<div class="level5">

<p>
Si vous avez une IP fixe (et pas un client dyndns ou une ip dhcp par exemple), on vous encourage à rejoindre vous aussi le pool de serveurs ntp. La charge sur le serveur (bande passante et cpu) est très faible. Il vous suffit d&#039;avoir un serveur stable. Vous pouvez ainsi rendre un grand service à la communauté à peu de frais, y compris en tant que simple particulier.
</p>

<p>
<a href="http://www.pool.ntp.org/fr/join.html" class="urlextern" title="http://www.pool.ntp.org/fr/join.html" rel="nofollow">Rejoindre le pool</a>
</p>

<p>
Il vous faut dans ce cas rendre votre serveur public. Si vous êtes derrière un pare-feu, il vous faut ouvrir le port ntp (normalement le 123).
exemple pour <a href="/ufw" class="wikilink1" title="ufw">ufw</a> :<br/>

</p>
<pre class="code">sudo ufw allow ntp</pre>

<p>
<br/>

Si vous êtes derrière un routeur type box, il vous faut rediriger le port 123 de votre box vers le port 123 de votre serveur.
</p>

</div>
<div class='secedit editbutton_section editbutton_10'><form class="button btn_secedit form-inline" method="post" action="/ntp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614935762" /><input type="hidden" name="summary" value="[Les Serveurs NTP existants] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="les_serveurs_ntp_existants" /><input type="hidden" name="codeblockOffset" value="9" /><input type="hidden" name="range" value="9068-11043" /><button type="submit" title="Les Serveurs NTP existants" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit11 page-header" id="tests">Tests</h2>
<div class="level2">

<p>
Un moyen simple de voir s&#039;il y a un broadcast <abbr title="Network Time Protocol">NTP</abbr> dans votre réseau local (généralement le router):
</p>
<pre class="code">sudo tcpdump -n &quot;broadcast or multicast&quot; | grep NTP</pre>

<p>
Pour voir si des clients se connectent à votre serveur <abbr title="Network Time Protocol">NTP</abbr> :
</p>
<pre class="code">ntpq -c mrulist</pre>

</div>
<div class='secedit editbutton_section editbutton_11'><form class="button btn_secedit form-inline" method="post" action="/ntp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614935762" /><input type="hidden" name="summary" value="[Tests] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="tests" /><input type="hidden" name="codeblockOffset" value="11" /><input type="hidden" name="range" value="11044-11322" /><button type="submit" title="Tests" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit12 page-header" id="liens">Liens</h2>
<div class="level2">

<p>
* <a href="https://fr.wikipedia.org/wiki/Network_Time_Protocol" class="interwiki iw_wpfr" title="https://fr.wikipedia.org/wiki/Network_Time_Protocol">le protocole ntp sur wikipedia</a><br/>

</p>

<p>
* <a href="http://www.pool.ntp.org/zone/fr" class="urlextern" title="http://www.pool.ntp.org/zone/fr" rel="nofollow">le pool ntp fr</a>
</p>

<p>
* <a href="http://www.it-connect.fr/configurer-un-client-ntp-sous-linux/" class="urlextern" title="http://www.it-connect.fr/configurer-un-client-ntp-sous-linux/" rel="nofollow">Configurer un client NTP sous Linux</a>
</p>
<hr />

<p>
Contributeurs : <a href="/utilisateurs/stephaneguedon" class="wikilink1" title="utilisateurs:stephaneguedon">stephaneguedon</a> , <a href="/utilisateurs/wido" class="wikilink1" title="utilisateurs:wido">wido</a>, M4T
</p>

</div>
<div class='secedit editbutton_section editbutton_12'><form class="button btn_secedit form-inline" method="post" action="/ntp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1614935762" /><input type="hidden" name="summary" value="[Liens] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="liens" /><input type="hidden" name="codeblockOffset" value="13" /><input type="hidden" name="range" value="11323-" /><button type="submit" title="Liens" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div><hr/><div class="footnotes">
<div class="fn"><sup><a href="#fnt__1" id="fn__1" class="fn_bot">1)</a></sup> 
<div class="content">d&#039;après <a href="https://help.ubuntu.com/lts/serverguide/NTP.html" class="urlextern" title="https://help.ubuntu.com/lts/serverguide/NTP.html" rel="nofollow">https://help.ubuntu.com/lts/serverguide/NTP.html</a></div></div>
<div class="fn"><sup><a href="#fnt__2" id="fn__2" class="fn_bot">2)</a></sup> 
<div class="content"><a href="https://help.ubuntu.com/lts/serverguide/NTP.html#timesyncd" class="urlextern" title="https://help.ubuntu.com/lts/serverguide/NTP.html#timesyncd" rel="nofollow">https://help.ubuntu.com/lts/serverguide/NTP.html#timesyncd</a></div></div>
</div>

</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="ntp.txt">ntp.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 05/03/2021, 10:16">Le 05/03/2021, 10:16</span></li><li class="text-muted">par 84.14.145.170</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=ntp&amp;1635558986" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
