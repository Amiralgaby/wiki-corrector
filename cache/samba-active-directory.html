<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>samba-active-directory [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="samba,administration,windows,reseau"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/samba-active-directory?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns="/>
<link rel="edit" title="Modifier cette page" href="/samba-active-directory?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/samba-active-directory"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/samba-active-directory"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/samba-active-directory"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"samba-active-directory","namespace":"","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="samba-active-directory">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/samba-active-directory?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/samba-active-directory?do=media&amp;ns="  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/samba-active-directory?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/samba-active-directory?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/samba-active-directory?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/samba-active-directory?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/samba-active-directory?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">samba-active-directory</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/samba-active-directory?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/samba-active-directory?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/samba-active-directory?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#versions","title":"Versions","level":1},{"link":"#installation_de_samba","title":"Installation de Samba","level":1},{"link":"#parametres_generaux","title":"Param\u00e8tres g\u00e9n\u00e9raux","level":2},{"link":"#pre-requis","title":"Pr\u00e9-requis","level":2},{"link":"#installation_a_partir_des_depots","title":"Installation \u00e0 partir des d\u00e9p\u00f4ts","level":2},{"link":"#installation_a_partir_des_sources","title":"Installation \u00e0 partir des sources","level":2},{"link":"#creation_d_un_premier_dc_dans_une_nouvelle_foret","title":"Cr\u00e9ation d'un premier DC dans une nouvelle for\u00eat","level":1},{"link":"#initialisation_de_samba","title":"Initialisation de Samba","level":2},{"link":"#ajout_d_un_dc_additionnel_dans_une_foret_existante","title":"Ajout d'un DC additionnel dans une for\u00eat existante","level":1},{"link":"#parametres_specifiques","title":"Param\u00e8tres sp\u00e9cifiques","level":2},{"link":"#initialisation_de_samba1","title":"Initialisation de Samba","level":2},{"link":"#demarrer_samba_ad_dc","title":"D\u00e9marrer Samba AD DC","level":1},{"link":"#tests_de_samba_ad_dc","title":"Tests de Samba AD DC","level":1},{"link":"#test_des_acl","title":"Test des ACL","level":2},{"link":"#test_des_attributs_etendus","title":"Test des attributs \u00e9tendus","level":2},{"link":"#test_du_dns","title":"Test du DNS","level":2},{"link":"#test_de_kerberos","title":"Test de Kerberos","level":2},{"link":"#test_de_smb","title":"Test de SMB","level":2},{"link":"#gestion_de_samba_ad_dc","title":"Gestion de Samba AD DC","level":1},{"link":"#verification_de_la_synchronisation_en_plusieurs_dc","title":"V\u00e9rification de la synchronisation en plusieurs DC","level":2},{"link":"#gestion_des_roles_fsmo","title":"Gestion des r\u00f4les FSMO","level":2},{"link":"#mise_a_jour_depuis_un_domaine_samba_de_type_nt4_vers_un_ad","title":"Mise \u00e0 jour depuis un domaine Samba de type NT4 vers un AD","level":1},{"link":"#informations_optionnelles_et_complementaires","title":"Informations optionnelles et compl\u00e9mentaires","level":1},{"link":"#references","title":"R\u00e9f\u00e9rences","level":1}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level1"><a href="#versions">Versions</a></li>
<li class="level1"><a href="#installation_de_samba">Installation de Samba</a>
<ul class="nav toc">
<li class="level2"><a href="#parametres_generaux">Paramètres généraux</a></li>
<li class="level2"><a href="#pre-requis">Pré-requis</a></li>
<li class="level2"><a href="#installation_a_partir_des_depots">Installation à partir des dépôts</a></li>
<li class="level2"><a href="#installation_a_partir_des_sources">Installation à partir des sources</a></li>
</ul>
</li>
<li class="level1"><a href="#creation_d_un_premier_dc_dans_une_nouvelle_foret">Création d&#039;un premier DC dans une nouvelle forêt</a>
<ul class="nav toc">
<li class="level2"><a href="#initialisation_de_samba">Initialisation de Samba</a></li>
</ul>
</li>
<li class="level1"><a href="#ajout_d_un_dc_additionnel_dans_une_foret_existante">Ajout d&#039;un DC additionnel dans une forêt existante</a>
<ul class="nav toc">
<li class="level2"><a href="#parametres_specifiques">Paramètres spécifiques</a></li>
<li class="level2"><a href="#initialisation_de_samba1">Initialisation de Samba</a></li>
</ul>
</li>
<li class="level1"><a href="#demarrer_samba_ad_dc">Démarrer Samba AD DC</a></li>
<li class="level1"><a href="#tests_de_samba_ad_dc">Tests de Samba AD DC</a>
<ul class="nav toc">
<li class="level2"><a href="#test_des_acl">Test des ACL</a></li>
<li class="level2"><a href="#test_des_attributs_etendus">Test des attributs étendus</a></li>
<li class="level2"><a href="#test_du_dns">Test du DNS</a></li>
<li class="level2"><a href="#test_de_kerberos">Test de Kerberos</a></li>
<li class="level2"><a href="#test_de_smb">Test de SMB</a></li>
</ul>
</li>
<li class="level1"><a href="#gestion_de_samba_ad_dc">Gestion de Samba AD DC</a>
<ul class="nav toc">
<li class="level2"><a href="#verification_de_la_synchronisation_en_plusieurs_dc">Vérification de la synchronisation en plusieurs DC</a></li>
<li class="level2"><a href="#gestion_des_roles_fsmo">Gestion des rôles FSMO</a></li>
</ul>
</li>
<li class="level1"><a href="#mise_a_jour_depuis_un_domaine_samba_de_type_nt4_vers_un_ad">Mise à jour depuis un domaine Samba de type NT4 vers un AD</a></li>
<li class="level1"><a href="#informations_optionnelles_et_complementaires">Informations optionnelles et complémentaires</a></li>
<li class="level1"><a href="#references">Références</a></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content">
<p>
<a href="/_detail/icons/icon-server.png?id=samba-active-directory" class="media" title="icons:icon-server.png"><img src="/_media/icons/icon-server.png" class="media img-responsive" alt="" /></a> 
</p>
<div class="tags"><span>
	<a href="/samba" class="wikilink1" title="samba" rel="tag">samba</a>,
	<a href="/administration" class="wikilink1" title="administration" rel="tag">administration</a>,
	<a href="/windows" class="wikilink1" title="windows" rel="tag">windows</a>,
	<a href="/reseau" class="wikilink1" title="reseau" rel="tag">réseau</a>
</span></div>

<h1 class="sectionedit1 page-header" id="samba_-_active_directory_domain_controller_ad_dc">Samba - Active Directory Domain Controller (AD DC)</h1>
<div class="level1">

<p>
Le projet Samba est surtout connu pour le partage de fichiers selon le protocole SMB développé par Microsoft. La version 4 de ce logiciel apporte la fonctionnalité supplémentaire d&#039;un contrôleur de domaine Active Directory (Active Directory Domain Controller - AD DC). Cette fonctionnalité inclue en natif les services <a href="/dns" class="wikilink1" title="dns">DNS</a>, <a href="http://guide.ubuntu-fr.org/server/openldap-server.html" class="urlextern" title="http://guide.ubuntu-fr.org/server/openldap-server.html" rel="nofollow">LDAP</a>, <a href="https://fr.wikipedia.org/wiki/Kerberos_%2528protocole%2529" class="interwiki iw_wpfr" title="https://fr.wikipedia.org/wiki/Kerberos_%2528protocole%2529">Kerberos</a>, <a href="https://fr.wikipedia.org/wiki/Remote_procedure_call" class="interwiki iw_wpfr" title="https://fr.wikipedia.org/wiki/Remote_procedure_call">RPC</a> et <a href="https://fr.wikipedia.org/wiki/Server_Message_Block" class="interwiki iw_wpfr" title="https://fr.wikipedia.org/wiki/Server_Message_Block">SMB 3.0</a> ainsi que la distribution et la gestion des <a href="https://fr.wikipedia.org/wiki/Strat%25C3%25A9gies_de_groupe" class="interwiki iw_wpfr" title="https://fr.wikipedia.org/wiki/Strat%25C3%25A9gies_de_groupe">GPO</a>.
</p>
<div class="noteimportant">Une connaissance préalable de AD DC de Microsoft et des fonctionnalités et protocoles tels que <abbr title="Domain Name System">DNS</abbr>, <abbr title="Lightweight Directory Access Protocol">LDAP</abbr>, Kerberos, <abbr title="Remote Procedure Call">RPC</abbr>, GPO, SMB, … est un atout pour la bonne compréhension et mise en œuvre de Samba AD DC. Cette documentation s&#039;adresse donc principalement aux administrateurs système.
</div>
<p>
Samba AD DC permet de créer un DC compatible avec les produits Microsoft Windows Server allant de 2000 à 2012. Cependant, toutes les fonctionnalités avancées ne sont pas encore implémentées. Selon les cas, probablement au sein des PME, Samba AD DC pourrait parfaitement remplacer ces produits.
</p>

</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Samba - Active Directory Domain Controller (AD DC)] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="samba_-_active_directory_domain_controller_ad_dc" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="73-1366" /><button type="submit" title="Samba - Active Directory Domain Controller (AD DC)" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit2 page-header" id="versions">Versions</h2>
<div class="level2">

<p>
La liste des versions de Samba ainsi que leur support est disponible sur <a href="https://wiki.samba.org/index.php/Samba_Release_Planning#Samba_Release_Planning_and_Supported_Release_Lifetime" class="urlextern" title="https://wiki.samba.org/index.php/Samba_Release_Planning#Samba_Release_Planning_and_Supported_Release_Lifetime" rel="nofollow">Release Planning and Lifetime</a>. De plus, <a href="http://www.samba.org/samba/history/" class="urlextern" title="http://www.samba.org/samba/history/" rel="nofollow">l&#039;historique des versions stables</a> est également disponible.
</p>

<p>
Samba en version 4 est devenu la version de base du paquet <strong>samba</strong> à partir de <a href="/trusty" class="wikilink1" title="trusty">Trusty 14.04 LTS</a>.
</p>

<p>
La version de Samba peut légèrement évoluer avec les mises à jour de sécurité. A la sortie de <a href="/bionic" class="wikilink1" title="bionic">Bionic 18.04 LTS</a>, la version est 4.7.6. La documentation qui suit est basée sur cette dernière version. Néanmoins, elle essaye de montrer quelques différences qui peuvent exister entre cette version et les précédentes.
</p>

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Versions] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="versions" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="1367-2168" /><button type="submit" title="Versions" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit3 page-header" id="installation_de_samba">Installation de Samba</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Installation de Samba] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation_de_samba" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="2169-2201" /><button type="submit" title="Installation de Samba" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit4" id="parametres_generaux">Paramètres généraux</h3>
<div class="level3">

<p>
Avant toute installation, il est nécessaire de définir son environnement. Ainsi, il sera possible de configurer correctement son serveur. Le reste de cette documentation se basera sur les paramètres suivants <sup><a href="#fn__1" id="fnt__1" class="fn_top">1)</a></sup>:
</p>
<div class="table-responsive"><table class="inline table table-striped table-condensed">
	<tr class="row0">
		<td class="col0">Nom de domaine </td><td class="col1">example.com </td>
	</tr>
	<tr class="row1">
		<td class="col0">Royaume (realm) </td><td class="col1">EXAMPLE.COM </td>
	</tr>
	<tr class="row2">
		<td class="col0">Nom de NetBIOS </td><td class="col1">example </td>
	</tr>
	<tr class="row3">
		<td class="col0">Nom du serveur </td><td class="col1">ubndc01 </td>
	</tr>
	<tr class="row4">
		<td class="col0">Adresse IP du serveur </td><td class="col1">192.0.2.11 </td>
	</tr>
	<tr class="row5">
		<td class="col0">Rôle du serveur </td><td class="col1">DC (contrôleur de domaine) </td>
	</tr>
</table></div>

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Paramètres généraux] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="parametres_generaux" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="2202-2867" /><button type="submit" title="Paramètres généraux" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit6" id="pre-requis">Pré-requis</h3>
<div class="level3">

<p>
Afin de bénéficier de l&#039;ensemble des fonctionnalités de Samba, il est nécessaire d&#039;activer les <a href="/acl" class="wikilink1" title="acl">ACL</a> et les attributs étendus (user_xattr) sur les partitions concernées par Samba. Pour ce faire, il faut ajouter dans le fichier /etc/fstab les options <em>acl</em> et <em>user_xattr</em> aux partitions en question. L&#039;ajout de l&#039;option <em>barrier=1</em> protège les transactions tdb contre la corruption des fichiers (notamment sam.ldb) lors d&#039;une coupure d&#039;électricité ou tout autre crash système. Celle-ci est fortement recommandée sur un DC.
</p>

<p>
Exemple d&#039;une partition dans le ficher /etc/fstab
</p>
<dl class="file">
<dt><a href="/_export/code/samba-active-directory?codeblock=0" title="Télécharger cet extrait" class="mediafile mf_">/etc/fstab</a></dt>
<dd><pre class="file">UUID=8059560e-4a78-445b-a363-b3c197b4c7ea      /      ext4      defaults,acl,user_xattr,barrier=1     0     1</pre>
</dd></dl>

<p>
Après avoir modifié le fichier /etc/fstab, il faut redémarrer la machine ou remonter la partition pour que la modification soit effective. Par exemple :
</p>
<pre class="code">sudo mount -o remount /</pre>

<p>
Le noyau d&#039;Ubuntu provenant des dépôts a bien les options<sup><a href="#fn__2" id="fnt__2" class="fn_top">2)</a></sup> XATTR, SECURITY et POSIX_<abbr title="Access Control List">ACL</abbr> pour les systèmes de fichier ext3 et ext4. Toute autre situation nécessitera de vérifier que ces options aient bien été activées lors de la compilation du noyau pour le système de fichier choisi.
</p>

<p>
Afin de vérifier le bon fonctionnement des <abbr title="Access Control List">ACL</abbr> et des attributs étendus, il faut se reporter aux sections <a href="#test_des_acl" title="samba-active-directory ↵" class="wikilink1">Test des ACL</a> et <a href="#test_des_attributs_etendus" title="samba-active-directory ↵" class="wikilink1">Test des attributs étendus</a>.
</p>

<p>
Active Directory nécessite une synchronisation de temps précise entre les postes clients et le(s) DC(s). Il est vivement recommandé de mettre en œuvre le protocole <a href="/ntp" class="wikilink1" title="ntp">NTP</a> ou tout autre solution de synchronisation du temps (<a href="https://wiki.samba.org/index.php/Time_Synchronisation" class="urlextern" title="https://wiki.samba.org/index.php/Time_Synchronisation" rel="nofollow">Time Synchronisation</a>).
</p>

<p>
A titre d&#039;exemple, voici un fichier de configuration simplifiée de <em>ntp</em> qui conviendra sur le DC
</p>
<dl class="file">
<dt><a href="/_export/code/samba-active-directory?codeblock=2" title="Télécharger cet extrait" class="mediafile mf_conf">/etc/ntp.conf</a></dt>
<dd><pre class="file">driftfile      /var/lib/ntp/ntp.drift
logfile        /var/log/ntp

# Specify one or more NTP servers.
server 0.ubuntu.pool.ntp.org
server 1.ubuntu.pool.ntp.org
server 2.ubuntu.pool.ntp.org
server 3.ubuntu.pool.ntp.org

# By default, exchange time with everybody, but don&#039;t allow configuration.
restrict default kod notrap nomodify nopeer mssntp

# Local users may interrogate the ntp server more closely.
restrict 127.0.0.1</pre>
</dd></dl>

<p>
<strong>MANQUE LA CONFIGURATION DE LA CARTE RESEAU</strong>
</p>

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Pré-requis] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="pre-requis" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="2868-5317" /><button type="submit" title="Pré-requis" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit7" id="installation_a_partir_des_depots">Installation à partir des dépôts</h3>
<div class="level3">

<p>
Il faut <a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer le paquet</a> <strong><a href="apt://samba" class="interwiki iw_apt" title="apt://samba">samba</a></strong>
</p>

</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Installation à partir des dépôts] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation_a_partir_des_depots" /><input type="hidden" name="codeblockOffset" value="3" /><input type="hidden" name="range" value="5318-5451" /><button type="submit" title="Installation à partir des dépôts" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit8" id="installation_a_partir_des_sources">Installation à partir des sources</h3>
<div class="level3">

<p>
Cette solution s&#039;adresse aux personnes qui connaissent déjà bien le sujet et qui savent ce qu&#039;apporte une version plus récente que celle disponible dans les dépôts. N&#039;hésitez pas à consulter la page <a href="https://wiki.samba.org/index.php/Build_Samba" class="urlextern" title="https://wiki.samba.org/index.php/Build_Samba" rel="nofollow">Build Samba</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Installation à partir des sources] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation_a_partir_des_sources" /><input type="hidden" name="codeblockOffset" value="3" /><input type="hidden" name="range" value="5452-5764" /><button type="submit" title="Installation à partir des sources" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit9 page-header" id="creation_d_un_premier_dc_dans_une_nouvelle_foret">Création d&#039;un premier DC dans une nouvelle forêt</h2>
<div class="level2">

<p>
Ceci constitue l&#039;étape unique qui va créer le premier domaine dans la forêt. Cette étape est indispensable si vous n&#039;avez pas d&#039;autres DC (Samba ou Microsoft).
</p>

</div>
<div class='secedit editbutton_section editbutton_9'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Création d&#039;un premier DC dans une nouvelle forêt] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="creation_d_un_premier_dc_dans_une_nouvelle_foret" /><input type="hidden" name="codeblockOffset" value="3" /><input type="hidden" name="range" value="5765-5992" /><button type="submit" title="Création d&#039;un premier DC dans une nouvelle forêt" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit10" id="initialisation_de_samba">Initialisation de Samba</h3>
<div class="level3">

<p>
Préalablement à l’initialisation de Samba, il faut supprimer ou renommer le fichier smb.conf
</p>
<pre class="code">sudo mv --backup=t /etc/samba/smb.conf /etc/samba/smb.conf.old</pre>

<p>
L&#039;initialisation va créer plusieurs fichiers type base de données stockés dans /var/lib/samba/private/ ainsi que le fichier /etc/samba/smb.conf. Pour connaître, l&#039;ensemble des options relatives à l&#039;initialisation, il est recommandé d&#039;exécuter
</p>
<pre class="code">samba-tool domain provision --help </pre>

<p>
Parmi celles-ci, il est recommandé d&#039;utiliser au moins les deux options suivantes
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> L&#039;option <em>–use-rfc2307</em> active les attributs Posix et crée les informations NIS dans l&#039;AD. Ceci permet d&#039;administrer les UIDs/GIDs et autres paramètres UNIX (visibles sous l&#039;onglet &quot;Unix attributes&quot; de l&#039;<a href="http://technet.microsoft.com/en-us/library/cc754217.aspx" class="urlextern" title="http://technet.microsoft.com/en-us/library/cc754217.aspx" rel="nofollow">ADUC</a>). Il est plus simple de l&#039;activer durant l&#039;initialisation plutôt que par la suite. De plus, même si vous n&#039;en avez pas (encore) besoin, ceci n&#039;impacte pas les performances de votre installation.</div>
</li>
<li class="level1"><div class="li"> L&#039;option <em>–interactive</em> rend le processus d&#039;initialisation interactif. L&#039;utilisateur devra répondre à quelques questions pour paramétrer la création du domaine. Sans cette option, le processus d&#039;initialisation se base sur les valeurs existantes dans le fichier /etc/samba/smb.conf et sur les valeurs par défaut.</div>
</li>
</ul>
<pre class="code"> sudo samba-tool domain provision --use-rfc2307 --interactive</pre>

<p>
Si les valeurs satisfont, il ne faut alors que les valider par ENTER
</p>
<pre class="code">Realm [EXAMPLE.COM]:
Domain [EXAMPLE]:
Server Role (dc, member, standalone) [dc]:
DNS backend (SAMBA_INTERNAL, BIND9_FLATFILE, BIND9_DLZ, NONE) [SAMBA_INTERNAL]:
DNS forwarder IP address (write &#039;none&#039; to disable forwarding) [192.0.2.1]:
Administrator password:
Retype password:</pre>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Par défaut, l&#039;initialisation propose le serveur <abbr title="Domain Name System">DNS</abbr> interne de Samba (SAMBA_INTERNAL) comme serveur <abbr title="Domain Name System">DNS</abbr>. Il est possible d&#039;utiliser Bind comme serveur <abbr title="Domain Name System">DNS</abbr> d&#039;arrière-plan (backend). Si vous choisissez <a href="http://bind-dlz.sourceforge.net/" class="urlextern" title="http://bind-dlz.sourceforge.net/" rel="nofollow">BIND9_DLZ</a> lors de l&#039;initialisation, référez-vous au wiki <a href="https://wiki.samba.org/index.php/BIND9_DLZ_DNS_Back_End" class="urlextern" title="https://wiki.samba.org/index.php/BIND9_DLZ_DNS_Back_End" rel="nofollow">BIND9 DLZ DNS Back End</a>. A tout moment, il est possible de changer de serveur <abbr title="Domain Name System">DNS</abbr> d&#039;arrière-plan <sup><a href="#fn__3" id="fnt__3" class="fn_top">3)</a></sup>. Pour plus d&#039;information sur la configuration du serveur <abbr title="Domain Name System">DNS</abbr> et trouver celle qui répond à vos besoins, consultez la page <a href="https://wiki.samba.org/index.php/The_Samba_AD_DNS_Back_Ends" class="urlextern" title="https://wiki.samba.org/index.php/The_Samba_AD_DNS_Back_Ends" rel="nofollow">Samba AD DNS Back Ends</a></div>
</li>
<li class="level1"><div class="li"> Le mot de passe du compte Administrator du domaine doit respecter les règles de complexité, à savoir : au moins une majuscule, un chiffre et 8 caractères de long (par exemple : P@ssw0rd).</div>
</li>
<li class="level1"><div class="li"> Dans le cas d&#039;une ré-initialisation, en plus des mesures déjà décrites ci-dessus, il sera nécessaire de préalablement supprimer les fichiers de base de données privés de Samba</div>
</li>
</ul>
<pre class="code">rm -rf /var/lib/samba/private/*</pre>
<div class="notetip">Il est possible de changer le mot de passe du compte administrator avec les droits superutilisateur (root) avec la commande
<pre class="code">sudo samba-tool user setpassword administrator</pre>

</div>
</div>
<div class='secedit editbutton_section editbutton_10'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Initialisation de Samba] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="initialisation_de_samba" /><input type="hidden" name="codeblockOffset" value="3" /><input type="hidden" name="range" value="5993-9249" /><button type="submit" title="Initialisation de Samba" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit11 page-header" id="ajout_d_un_dc_additionnel_dans_une_foret_existante">Ajout d&#039;un DC additionnel dans une forêt existante</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_11'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Ajout d&#039;un DC additionnel dans une forêt existante] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="ajout_d_un_dc_additionnel_dans_une_foret_existante" /><input type="hidden" name="codeblockOffset" value="9" /><input type="hidden" name="range" value="9250-9313" /><button type="submit" title="Ajout d&#039;un DC additionnel dans une forêt existante" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit12" id="parametres_specifiques">Paramètres spécifiques</h3>
<div class="level3">

<p>
Pour cette documentation, les paramètres suivants seront utilisés <sup><a href="#fn__4" id="fnt__4" class="fn_top">4)</a></sup>:
</p>
<div class="table-responsive"><table class="inline table table-striped table-condensed">
	<tr class="row0">
		<td class="col0">Nom du serveur </td><td class="col1">ubndc02 </td>
	</tr>
	<tr class="row1">
		<td class="col0">Adresse IP du serveur </td><td class="col1">192.0.2.12</td>
	</tr>
	<tr class="row2">
		<td class="col0">Rôle du serveur </td><td class="col1">DC (contrôleur de domaine) </td>
	</tr>
</table></div>

</div>
<div class='secedit editbutton_section editbutton_12'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Paramètres spécifiques] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="parametres_specifiques" /><input type="hidden" name="codeblockOffset" value="9" /><input type="hidden" name="range" value="9314-9735" /><button type="submit" title="Paramètres spécifiques" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit14" id="initialisation_de_samba1">Initialisation de Samba</h3>
<div class="level3">

<p>
Préalablement à l&#039;initialisation de Samba, il faut supprimer ou renommer le fichier smb.conf
</p>
<pre class="code">sudo mv --backup=t /etc/samba/smb.conf /etc/samba/smb.conf.old</pre>

<p>
L&#039;initialisation va créer plusieurs fichiers type base de données stockés dans /var/lib/samba/private/ ainsi que le fichier /etc/samba/smb.conf
</p>
<pre class="code">sudo samba-tool domain join example.com DC -U administrator --realm=EXAMPLE.COM</pre>
<div class="noteimportant">Après cette commande, <strong>il faut vérifier</strong> si certains enregistrements dans le <abbr title="Domain Name System">DNS</abbr> sont bien présents ! L&#039;absence de ceux-ci empêchera le fonctionnement du contrôleur de domaine additionnel (cfr <a href="https://wiki.samba.org/index.php/Check_and_fix_DNS_entries_on_DC_joins" class="urlextern" title="https://wiki.samba.org/index.php/Check_and_fix_DNS_entries_on_DC_joins" rel="nofollow">Check and fix DNS entries on DC joins</a> et <a href="https://bugzilla.samba.org/show_bug.cgi?id=10928" class="urlextern" title="https://bugzilla.samba.org/show_bug.cgi?id=10928" rel="nofollow">Bug 10928</a> résolu avec Samba 4.7).
<p>
Vérification de la résolution du nom &#039;ubndc02.example.com&#039;
</p>
<pre class="code">host -t A ubndc02.example.com.
ubndc02.example.com has address 192.0.2.21</pre>

<p>
En cas d&#039;erreur, il faut ajouter ou corriger l&#039;enregistrement <abbr title="Domain Name System">DNS</abbr>
</p>
<pre class="code">samba-tool dns add ubndc01 example.com ubndc02 A 192.0.2.21 -U administrator</pre>

<p>
Vérification de la résolution de l&#039;alias du nom sur base du GUID de l&#039;objet. Cette première commande va permettre de trouver le GUID de l&#039;objet. Au besoin, il faut <a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer le paquet</a> <strong><a href="apt://ldb-tools" class="interwiki iw_apt" title="apt://ldb-tools">ldb-tools</a></strong>.
</p>
<pre class="code">sudo ldbsearch -H /var/lib/samba/private/sam.ldb &#039;(invocationId=*)&#039; --cross-ncs objectguid
# record 1
dn: CN=NTDS Settings,CN=UBNDC02,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=example,DC=com
objectGUID: df4bdd8c-abc7-4779-b01e-4dd4553ca3e9

# record 2
dn: CN=NTDS Settings,CN=UBNDC01,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=example,DC=com
objectGUID: 4a6bd92a-6612-4b15-aa8c-9ec371e8994f

# returned 2 records
# 2 entries
# 0 referrals</pre>

<p>
Vérification de la résolution de l&#039;alias du nom &#039;df4bdd8c-abc7-4779-b01e-4dd4553ca3e9._msdcs.example.com&#039;
</p>
<pre class="code">host -t CNAME df4bdd8c-abc7-4779-b01e-4dd4553ca3e9._msdcs.example.com.
df4bdd8c-abc7-4779-b01e-4dd4553ca3e9._msdcs.example.com is an alias for ubndc02.example.com.</pre>

<p>
En cas d&#039;erreur, il faut ajouter ou corriger l&#039;enregistrement <abbr title="Domain Name System">DNS</abbr>
</p>
<pre class="code">samba-tool dns add ubndc01 _msdcs.example.com df4bdd8c-abc7-4779-b01e-4dd4553ca3e9 CNAME ubndc02.example.com -U administrator</pre>

<p>
<strong>Il est possible qu&#039;il manque encore d&#039;autres enregistrements <abbr title="Domain Name System">DNS</abbr>.</strong> L&#039;administrateur devra les ajouter manuellement.
</p>

</div>
</div>
<div class='secedit editbutton_section editbutton_14'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Initialisation de Samba] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="initialisation_de_samba1" /><input type="hidden" name="codeblockOffset" value="9" /><input type="hidden" name="range" value="9736-12282" /><button type="submit" title="Initialisation de Samba" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit15 page-header" id="demarrer_samba_ad_dc">Démarrer Samba AD DC</h2>
<div class="level2">

<p>
Avant de démarrer Samba AD DC, il est important de vérifier la bonne configuration du <abbr title="Domain Name System">DNS</abbr>.
Le fichier /etc/resolv.conf devrait contenir 
</p>
<dl class="file">
<dt><a href="/_export/code/samba-active-directory?codeblock=16" title="Télécharger cet extrait" class="mediafile mf_conf">/etc/resolv.conf</a></dt>
<dd><pre class="file">search example.com
nameserver 127.0.0.1</pre>
</dd></dl>

<p>
En fonction de la configuration réseau utilisée, ces paramètres peuvent être statiques ou gérer par un autre sous-système (se référer à <a href="/tutoriel/comment_configurer_son_reseau_local" class="wikilink1" title="tutoriel:comment_configurer_son_reseau_local">Comment configurer son réseau local ?</a>, <a href="/dns#configuration_d_un_dns_alternatif" class="wikilink1" title="dns">Configuration d&#039;un DNS alternatif</a> et <a href="/utilisateurs/ool/netplan" class="wikilink1" title="utilisateurs:ool:netplan">netplan</a>)
</p>

<p>
Le service Samba se gère de préférence via <a href="/systemd" class="wikilink1" title="systemd">systemd</a> et la commande <em>systemctl</em> mais peut également se gérer via <a href="/upstart" class="wikilink1" title="upstart">Upstart</a> et la commande <em>service</em>. Avant de démarrer Samba AD DC, il faut d&#039;abord arrêter les services <em>smbd</em> et <em>nmbd</em> (<em>samba.service</em>). 
</p>
<pre class="code">sudo systemctl stop samba.service
sudo systemctl start samba-ad-dc.service</pre>

<p>
Pour connaître l&#039;ensemble des services démarrés par samba :
</p>
<pre class="code">sudo samba-tool processes
 Service:                PID 
-----------------------------
dnsupdate                959
nbt_server               933
rpc_server               932
cldap_server             942
winbind_server           949
kdc_server               943
samba                      0
dreplsrv                 948
kccsrv                   956
ldap_server              938</pre>

<p>
On y voit, dans l&#039;ordre, les services suivants <abbr title="Domain Name System">DNS</abbr>, NetBIOS, <abbr title="Remote Procedure Call">RPC</abbr>, Connection-less <abbr title="Lightweight Directory Access Protocol">LDAP</abbr> (CLDAP), WinBind, KDC (Kerberos Distribution Center), DSDB Replication (Directory Service DataBase Replication), KCC (Knowledge Consistency Checker), <abbr title="Lightweight Directory Access Protocol">LDAP</abbr>. Tous ces services sont configurés soit dans /etc/samba/smb.conf, soit dans les fichiers /var/lib/samba/private/*.
</p>

</div>
<div class='secedit editbutton_section editbutton_15'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Démarrer Samba AD DC] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="demarrer_samba_ad_dc" /><input type="hidden" name="codeblockOffset" value="16" /><input type="hidden" name="range" value="12283-14073" /><button type="submit" title="Démarrer Samba AD DC" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit16 page-header" id="tests_de_samba_ad_dc">Tests de Samba AD DC</h2>
<div class="level2">

<p>
Samba AD DC est composé de beaucoup de services différents qui interagissent. Les tests qui suivent se focaliseront sur l&#039;un ou l&#039;autre point.
</p>

</div>
<div class='secedit editbutton_section editbutton_16'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Tests de Samba AD DC] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="tests_de_samba_ad_dc" /><input type="hidden" name="codeblockOffset" value="19" /><input type="hidden" name="range" value="14074-14252" /><button type="submit" title="Tests de Samba AD DC" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit17" id="test_des_acl">Test des ACL</h3>
<div class="level3">

<p>
Pour tester les <abbr title="Access Control List">ACL</abbr>, il faut <a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer le paquet</a> <strong><a href="apt://acl" class="interwiki iw_apt" title="apt://acl">acl</a></strong>.
</p>

<p>
Le paquet <em>acl</em> va, entre autre, installer les commandes <em>setfacl</em> et <em>getfacl</em> afin de définir et lire les <abbr title="Access Control List">ACL</abbr> sur un fichier.
</p>

<p>
Pour vérifier le fonctionnement des <abbr title="Access Control List">ACL</abbr>, on peut exécuter les commandes ci-dessous sur un fichier d&#039;une partition qui a les <abbr title="Access Control List">ACL</abbr> activé.
</p>
<pre class="code">touch test.txt
setfacl -m g:adm:rwx test.txt
getfacl test.txt</pre>

<p>
Le résultat de cette dernière commande doit retourner quelque chose semblable à :
</p>
<pre class="code"># file: test.txt
# owner: user1
# group: user1
user::rw-
group::rw-
group:adm:rwx
mask::rw-
other::r--</pre>

<p>
Si aucune erreur n&#039;est retournée, les <abbr title="Access Control List">ACL</abbr> sont bien activées et utilisables.
</p>

</div>
<div class='secedit editbutton_section editbutton_17'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Test des ACL] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="test_des_acl" /><input type="hidden" name="codeblockOffset" value="19" /><input type="hidden" name="range" value="14253-15014" /><button type="submit" title="Test des ACL" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit18" id="test_des_attributs_etendus">Test des attributs étendus</h3>
<div class="level3">

<p>
Pour tester les attributs étendus, il faut installer le paquet <strong><a href="apt://attr" class="interwiki iw_apt" title="apt://attr">attr</a></strong>. Ce paquet devrait déjà être installé car il s&#039;agit d&#039;une dépendance de <em>samba</em>.
</p>
<pre class="code">sudo apt-get install attr</pre>

<p>
Le paquet <em>attr</em> va, entre autre, installer les commandes <em>setfattr</em> et <em>getfattr</em> afin de définir et lire les attributs étendu d&#039;un fichier.
</p>

<p>
Pour vérifier le fonctionnement des attributs étendus, on peut exécuter les commandes ci-dessous sur un fichier d&#039;une partition qui a les attributs étentus activé 
</p>

<p>
Pour ajouter des attributs étendus :
</p>
<pre class="code">touch test.txt
setfattr -n user.userName -v userValue test.txt
sudo setfattr -n security.secName -v secValue test.txt</pre>

<p>
Pour voir les attributs étendus d&#039;un fichier :
</p>
<pre class="code">getfattr -d test.txt</pre>
<pre class="code"># file: test.txt
user.userName=&quot;userValue&quot;</pre>
<pre class="code">getfattr -n security.secName -d test.txt</pre>
<pre class="code"># file: test.txt
security.secName=&quot;secValue&quot;</pre>

<p>
Si aucune erreur n&#039;est retournée, les attributs étendus sont bien activés et utilisables.
</p>

</div>
<div class='secedit editbutton_section editbutton_18'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Test des attributs étendus] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="test_des_attributs_etendus" /><input type="hidden" name="codeblockOffset" value="21" /><input type="hidden" name="range" value="15015-16093" /><button type="submit" title="Test des attributs étendus" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit19" id="test_du_dns">Test du DNS</h3>
<div class="level3">

<p>
Pour tester le <abbr title="Domain Name System">DNS</abbr>, il faut <a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer le paquet</a> <strong><a href="apt://dnsutils" class="interwiki iw_apt" title="apt://dnsutils">dnsutils</a></strong>. Ce paquet devrait déjà être installé car il s&#039;agit d&#039;une dépendance de <em>ubuntu-standard</em>.
</p>

<p>
Le paquet <em>dnsutils</em> va, entre autre, installer les commandes <em>dig</em>, <em>nslookup</em> et <em>nsupdate</em> afin d&#039;interroger et mettre à jour le serveur <abbr title="Domain Name System">DNS</abbr>. Ce paquet n&#039;installe pas un serveur <abbr title="Domain Name System">DNS</abbr>.
</p>

<p>
Une configuration fonctionnelle du <a href="/dns" class="wikilink1" title="dns">DNS</a> est essentielle pour assurer le bon fonctionnement de Samba et de l&#039;AD. Sans les bons paramètres, Kerberos ne fonctionnera pas, entraînant le non-fonctionnement des services de base ! Afin d&#039;éviter de perdre son temps à cause d&#039;un problème <abbr title="Domain Name System">DNS</abbr>, il faut attraper le réflexe de systématiquement vérifier le bon fonctionnement du <abbr title="Domain Name System">DNS</abbr>. La connaissance des requêtes adéquates pour identifier chaque problème est également nécessaire. Pour plus d&#039;information, consulter <a href="https://wiki.samba.org/index.php/DNS_Administration" class="urlextern" title="https://wiki.samba.org/index.php/DNS_Administration" rel="nofollow">DNS Administration </a> et <a href="https://wiki.samba.org/index.php/Samba_AD_management_from_windows" class="urlextern" title="https://wiki.samba.org/index.php/Samba_AD_management_from_windows" rel="nofollow"> administrer Samba AD depuis windows </a>.
</p>

<p>
Pour que le serveur <abbr title="Domain Name System">DNS</abbr> interne puisse fonctionner, le port 53 udp/tcp ne doit pas être utilisé par d&#039;autres programmes (tel qu&#039;un autre serveur <abbr title="Domain Name System">DNS</abbr>, Dnsmasq, etc…). Dans le cas contraire, des erreurs seront visible dans le fichier … <img src="/lib/images/smileys/fixme.gif" class="icon" alt="FIXME" />
</p>
<dl class="file">
<dt><a href="/_export/code/samba-active-directory?codeblock=27" title="Télécharger cet extrait" class="mediafile mf_">...</a></dt>
<dd><pre class="file">...
Failed to bind to 0.0.0.0:53 TCP - NT_STATUS_ADDRESS_ALREADY_ASSOCIATED
...</pre>
</dd></dl>

<p>
Pour vérifier quel programme écoute sur le port 53
</p>
<pre class="code">sudo netstat -tunpel | grep &quot;:53&quot; </pre>

<p>
Voici quelques requêtes de base permettant de tester les records du <abbr title="Domain Name System">DNS</abbr>
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Vérification du fonctionnement du service <abbr title="Domain Name System">DNS</abbr> par une résolution simple.</div>
</li>
</ul>
<pre class="code">dig ubndc01.example.com
...
ubndc01.example.com.     900     IN      A       192.0.2.11
...
;; SERVER: 127.0.0.1#53(127.0.0.1)
...</pre>

<p>
On voit sur la dernière ligne mise en évidence ici, quel serveur a répondu à la requête. Si ce n&#039;est pas le bon serveur, il faut vérifier le fichier /etc/resolv.conf.
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Résolution d&#039;une requête spécifique pour le service Kerberos</div>
</li>
</ul>
<pre class="code">dig -t SRV _kerberos._tcp.example.com
...
_kerberos._tcp.example.com. 900  IN      SRV     0 100 88 ubndc01.example.com.
...</pre>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Résolution d&#039;une requête spécifique pour le service <abbr title="Lightweight Directory Access Protocol">LDAP</abbr></div>
</li>
</ul>
<pre class="code">dig -t SRV _ldap._tcp.example.com
...
_ldap._tcp.example.com.  900     IN      SRV     0 100 389 ubndc01.example.com.
...</pre>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Résolution d&#039;une adresse externe au domaine</div>
</li>
</ul>
<pre class="code">dig doc.ubuntu-fr.org
...
doc.ubuntu-fr.org.      1276    IN      A       86.65.39.28
...</pre>

<p>
En cas d&#039;absence de réponse, il faut vérifier qu&#039;il y ait une ligne <em>dns forwarder</em> pointant vers l&#039;IP d&#039;un serveur <abbr title="Domain Name System">DNS</abbr> externe au domaine dans le fichier /etc/samba/smb.conf
</p>
<dl class="file">
<dt><a href="/_export/code/samba-active-directory?codeblock=33" title="Télécharger cet extrait" class="mediafile mf_conf">/etc/samba/smb.conf</a></dt>
<dd><pre class="code file conf">...
        dns forwarder = 192.0.2.1
...</pre>
</dd></dl>

<p>
Si tel est le cas, il faut vérifier qu&#039;il s&#039;agisse de la bonne IP et que la requête aboutisse correctement sur cet autre serveur <abbr title="Domain Name System">DNS</abbr>. Par exemple avec :
</p>
<pre class="code">dig doc.ubuntu-fr.org @192.0.2.1</pre>

</div>
<div class='secedit editbutton_section editbutton_19'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Test du DNS] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="test_du_dns" /><input type="hidden" name="codeblockOffset" value="27" /><input type="hidden" name="range" value="16094-19174" /><button type="submit" title="Test du DNS" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit20" id="test_de_kerberos">Test de Kerberos</h3>
<div class="level3">

<p>
Pour tester le Kerberos, il faut <a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer le paquet</a> <strong><a href="apt://krb5-user" class="interwiki iw_apt" title="apt://krb5-user">krb5-user</a></strong>
</p>

<p>
Le paquet <em>krb5-user</em> va, entre autre, installer les commandes <em>kinit</em> et <em>klist</em> qui permettent d&#039;interroger et tester un serveur kerberos. Ce paquet n&#039;installe pas un serveur kerberos.
</p>

<p>
Lors de l&#039;initialisation, le fichier de configuration du serveur Kerberos<sup><a href="#fn__5" id="fnt__5" class="fn_top">5)</a></sup> de Samba est automatiquement crée et se trouve sur /var/lib/samba/private/krb5.conf. Son contenu par défaut est :
</p>
<dl class="file">
<dt><a href="/_export/code/samba-active-directory?codeblock=35" title="Télécharger cet extrait" class="mediafile mf_conf">/var/lib/samba/private/krb5.conf</a></dt>
<dd><pre class="file">[libdefaults]
        default_realm = EXAMPLE.COM
        dns_lookup_realm = false
        dns_lookup_kdc = true</pre>
</dd></dl>

<p>
Les commandes fournies par le paquet <em>krb5-user</em> (<em>kinit</em>, <em>klist</em>, …) utilise le fichier de configuration /etc/krb5.conf qui a été crée lors de l&#039;installation du paquet <em>krb5-config</em>. Dans ce fichier, seule 1 partie est utile :
</p>
<dl class="file">
<dt><a href="/_export/code/samba-active-directory?codeblock=36" title="Télécharger cet extrait" class="mediafile mf_conf">/etc/krb5.conf</a></dt>
<dd><pre class="file">[libdefaults]
        default_realm = EXAMPLE.COM
...</pre>
</dd></dl>
<div class="noteimportant">Le nom du &quot;royaume&quot; (realm) s&#039;écrit toujours <strong>lettres majuscules</strong>
</div>
<p>
Voici quelques commandes permettant de tester le serveur Kerberos :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Demande d&#039;un ticket-granting ticket (TGT) pour un utilisateur avec <em>kinit</em></div>
</li>
</ul>
<pre class="code">kinit administrator@EXAMPLE.COM
password for administrator@EXAMPLE.COM:
Warning: Your password will expire in x days on ... </pre>

<p>
La même commande en omettant le @ nom du royaume doit donner le même résultat. Dans ce cas, <em>kinit</em> prend la valeur du <em>default_realm</em> inscrite dans le fichier de configuration /etc/krb5.conf
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Pour voir le TGT reçu, il faut utiliser la commande <em>klist</em></div>
</li>
</ul>
<pre class="code">klist
Ticket cache: FILE:/tmp/krb5cc_1000
Default principal: administrator@EXAMPLE.COM

Valid starting     Expires            Service principal
03/03/14 20:17:43  04/03/14 06:17:43  krbtgt/EXAMPLE.COM@EXAMPLE.COM
        renew until 04/03/14 20:17:35</pre>

</div>
<div class='secedit editbutton_section editbutton_20'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Test de Kerberos] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="test_de_kerberos" /><input type="hidden" name="codeblockOffset" value="35" /><input type="hidden" name="range" value="19175-21211" /><button type="submit" title="Test de Kerberos" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit21" id="test_de_smb">Test de SMB</h3>
<div class="level3">

<p>
Pour tester les SMB, il faut <a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer le paquet</a> <strong><a href="apt://smbclient" class="interwiki iw_apt" title="apt://smbclient">smbclient</a></strong>
</p>

<p>
Si <em>samba</em> a été installé à partir des sources, il faut veiller à avoir une <em>smbclient</em> en version 4 également.
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Lister les partages définis localement sur le DC :</div>
</li>
</ul>
<pre class="code">smbclient -L localhost -U%
Domain=[EXAMPLE] OS=[Unix] Server=[Samba 4.1.3-Ubuntu]

        Sharename       Type      Comment
        ---------       ----      -------
        netlogon        Disk      
        sysvol          Disk      
        IPC$            IPC       IPC Service (Samba 4.1.3-Ubuntu)
Domain=[EXAMPLE] OS=[Unix] Server=[Samba 4.1.3-Ubuntu]

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        WORKGROUP</pre>

<p>
Un AD DC possède toujours les partages netlogon et sysvol. Ils sont nécessaires au fonctionnement d&#039;AD. Ces partages doivent se retrouver dans le fichier de configuration de samba /etc/samba/smb.conf.
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Vérifier l&#039;authentification d&#039;un utilisateur avec la même commande mais en utilisant l&#039;utilisateur administrator.</div>
</li>
</ul>
<pre class="code">smbclient -L localhost -UAdministrator
Enter administrator&#039;s password:
...</pre>

<p>
Le résultat doit être identique au précédent si on introduit le bon mot de passe pour le compte administrator.
</p>

</div>
<div class='secedit editbutton_section editbutton_21'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Test de SMB] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="test_de_smb" /><input type="hidden" name="codeblockOffset" value="39" /><input type="hidden" name="range" value="21212-22592" /><button type="submit" title="Test de SMB" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit22 page-header" id="gestion_de_samba_ad_dc">Gestion de Samba AD DC</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_22'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Gestion de Samba AD DC] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="gestion_de_samba_ad_dc" /><input type="hidden" name="codeblockOffset" value="41" /><input type="hidden" name="range" value="22593-22627" /><button type="submit" title="Gestion de Samba AD DC" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit23" id="verification_de_la_synchronisation_en_plusieurs_dc">Vérification de la synchronisation en plusieurs DC</h3>
<div class="level3">

<p>
La commande <em>samba-tool</em> permet de voir l&#039;état de réplication.
</p>
<pre class="code">samba-tool drs showrepl</pre>

<p>
Au besoin, il faut utiliser l&#039;option <em>-U administrator</em> pour obtenir le résultat.
</p>

</div>
<div class='secedit editbutton_section editbutton_23'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Vérification de la synchronisation en plusieurs DC] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="verification_de_la_synchronisation_en_plusieurs_dc" /><input type="hidden" name="codeblockOffset" value="41" /><input type="hidden" name="range" value="22628-22878" /><button type="submit" title="Vérification de la synchronisation en plusieurs DC" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit24" id="gestion_des_roles_fsmo">Gestion des rôles FSMO</h3>
<div class="level3">

<p>
Les rôles FSMO <sup><a href="#fn__6" id="fnt__6" class="fn_top">6)</a></sup> sont, selon Microsoft <sup><a href="#fn__7" id="fnt__7" class="fn_top">7)</a></sup>, au nombre de 5 :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Schema Master: 1 par forêt</div>
</li>
<li class="level1"><div class="li"> Domain Naming Master: 1 par forêt</div>
</li>
<li class="level1"><div class="li"> Relative Identifier Master <sup><a href="#fn__8" id="fnt__8" class="fn_top">8)</a></sup> : 1 par domaine</div>
</li>
<li class="level1"><div class="li"> Primary Domain Controller Emulator <sup><a href="#fn__9" id="fnt__9" class="fn_top">9)</a></sup> : 1 par domaine</div>
</li>
<li class="level1"><div class="li"> Infrastructure Master: 1 par domaine</div>
</li>
</ul>

<p>
Le projet Samba a ajouté à ceux-ci 2 rôles supplémentaires <sup><a href="#fn__10" id="fnt__10" class="fn_top">10)</a></sup>
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Forest <abbr title="Domain Name System">DNS</abbr> Zones Master: 1 par forêt</div>
</li>
<li class="level1"><div class="li"> Domain <abbr title="Domain Name System">DNS</abbr> Zones Master: 1 par domaine</div>
</li>
</ul>

</div>

<h4 id="voir_les_proprietaires_des_roles_fsmo">Voir les propriétaires des rôles FSMO</h4>
<div class="level4">

<p>
La commande <em>samba-tool</em> permet de voir les propriétaires de chaque rôle FSMO. L&#039;exécution doit se faire sur un contrôleur de domaine.
</p>
<pre class="code">sudo samba-tool fsmo show
SchemaMasterRole owner: CN=NTDS Settings,CN=UBNDC01,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=example,DC=com 
InfrastructureMasterRole owner: CN=NTDS Settings,CN=UBNDC01,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=example,DC=com
RidAllocationMasterRole owner: CN=NTDS Settings,CN=UBNDC01,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=example,DC=com
PdcEmulationMasterRole owner: CN=NTDS Settings,CN=UBNDC01,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=example,DC=com
DomainNamingMasterRole owner: CN=NTDS Settings,CN=UBNDC01,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=example,DC=com
DomainDnsZonesMasterRole owner: CN=NTDS Settings,CN=UBNDC01,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=example,DC=com
ForestDnsZonesMasterRole owner: CN=NTDS Settings,CN=UBNDC01,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=example,DC=com</pre>

<p>
Dans l&#039;exemple ci-dessus, on voit que le contrôleur de domaine <em>ubndc01</em> possède tous les rôles.
</p>

</div>

<h4 id="transfert_des_roles_fsmo">Transfert des rôles FSMO</h4>
<div class="level4">

<p>
La commande <em>samba-tool</em> permet de transférer les rôles FSMO d&#039;un contrôleur de domaine à l&#039;autre<sup><a href="#fn__11" id="fnt__11" class="fn_top">11)</a></sup>. L&#039;exécution doit se faire sur le contrôleur de domaine qui reprend le(s) rôle(s).
</p>
<pre class="code">sudo samba-tool fsmo transfer --role=all -U administrator
FSMO transfer of &#039;rid&#039; role successful
FSMO transfer of &#039;pdc&#039; role successful
FSMO transfer of &#039;naming&#039; role successful
FSMO transfer of &#039;infrastructure&#039; role successful
FSMO transfer of &#039;schema&#039; role successful
ERROR: ...</pre>

<p>
Il est possible de transférer tous les rôles en même temps avec l&#039;argument <em>all</em> (comme dans l&#039;exemple ci-dessus) ou de transférer un rôle à la fois. Il est possible de recevoir des messages d&#039;erreurs lors de l&#039;exécution. Il faut réessayer et patienter. Après un certains temps (5 à 10 minutes, le temps d&#039;une réplication), ça devrait être en ordre et visible avec la commande <em>samba-tool fsmo show</em>.
</p>

</div>

<h4 id="retrait_d_un_controleur_de_domaine">Retrait d&#039;un contrôleur de domaine</h4>
<div class="level4">

<p>
Après avoir transférer les rôles que possédait un contrôleur de domaine (s&#039;il en possédait), l&#039;administrateur peut le retirer du domaine avec la commande <em>samba-tool</em>. L&#039;exécution doit se faire sur le contrôleur de domaine que l&#039;on retire du domaine avec un compte local (pas du domaine).
</p>
<pre class="code">sudo samba-tool domain demote -U administrator
Password for [EXAMPLE\administrator]:
Deactivating inbound replication
Asking partner server ubndc02.example.com to synchronize from us
Changing userControl and container
Demote successful</pre>

</div>
<div class='secedit editbutton_section editbutton_24'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Gestion des rôles FSMO] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="gestion_des_roles_fsmo" /><input type="hidden" name="codeblockOffset" value="42" /><input type="hidden" name="range" value="22879-26549" /><button type="submit" title="Gestion des rôles FSMO" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit25 page-header" id="mise_a_jour_depuis_un_domaine_samba_de_type_nt4_vers_un_ad">Mise à jour depuis un domaine Samba de type NT4 vers un AD</h2>
<div class="level2">

<p>
Si vous prévoyez la migration depuis un domain Samba NT4 existant vers un domaine Samba AD, reportez-vous à la page <a href="http://wiki.samba.org/index.php/Samba4/samba-tool/domain/classicupgrade/HOWTO" class="urlextern" title="http://wiki.samba.org/index.php/Samba4/samba-tool/domain/classicupgrade/HOWTO" rel="nofollow">Classic Upgrade HowTo</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_25'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Mise à jour depuis un domaine Samba de type NT4 vers un AD] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="mise_a_jour_depuis_un_domaine_samba_de_type_nt4_vers_un_ad" /><input type="hidden" name="codeblockOffset" value="45" /><input type="hidden" name="range" value="26550-26843" /><button type="submit" title="Mise à jour depuis un domaine Samba de type NT4 vers un AD" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit26 page-header" id="informations_optionnelles_et_complementaires">Informations optionnelles et complémentaires</h2>
<div class="level2">

<p>
Le wiki Samba (en anglais) met à disposition de nombreuses documentations complémentaires <br/>

</p>
<ul class=" fix-media-list-overlap">
<li class="level1 node"><div class="li"> Pour l&#039;administration de votre DC : </div>
<ul class=" fix-media-list-overlap">
<li class="level2"><div class="li"> <a href="https://wiki.samba.org/index.php/Backup_and_Recovery" class="urlextern" title="https://wiki.samba.org/index.php/Backup_and_Recovery" rel="nofollow">Sauvegarde et restauration</a></div>
</li>
<li class="level2"><div class="li"> <a href="https://wiki.samba.org/index.php/Setup_and_configure_file_shares" class="urlextern" title="https://wiki.samba.org/index.php/Setup_and_configure_file_shares" rel="nofollow">Configuration des partages de fichiers</a></div>
</li>
</ul>
</li>
</ul>
<ul class=" fix-media-list-overlap">
<li class="level1 node"><div class="li"> Pour les tâches &quot;quotidiennes&quot; :</div>
<ul class=" fix-media-list-overlap">
<li class="level2"><div class="li"> <a href="https://wiki.samba.org/index.php/Configuring_a_windows_client_for_AD" class="urlextern" title="https://wiki.samba.org/index.php/Configuring_a_windows_client_for_AD" rel="nofollow"> Configurer un client windows</a></div>
</li>
<li class="level2"><div class="li"> <a href="https://wiki.samba.org/index.php/Samba_AD_management_from_windows" class="urlextern" title="https://wiki.samba.org/index.php/Samba_AD_management_from_windows" rel="nofollow"> Gérer Samba AD depuis windows</a></div>
</li>
</ul>
</li>
</ul>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <a href="https://wiki.samba.org/index.php/Authenticating_other_services_against_AD" class="urlextern" title="https://wiki.samba.org/index.php/Authenticating_other_services_against_AD" rel="nofollow"> Authentifier d&#039;autres services avec l&#039;AD</a> notamment Apache, SSH,…</div>
</li>
</ul>

<p>
Des réflexions sur <a href="https://fr.wikipedia.org/wiki/SELinux" class="urlextern" title="https://fr.wikipedia.org/wiki/SELinux" rel="nofollow"> SELinux</a> et les permissions de contrôle d&#039;accès pouvant prévenir des connexions utilisant l&#039;AD, sont disponibles sur la page <a href="https://wiki.samba.org/index.php/Samba_AD_DC_access_control_settings" class="urlextern" title="https://wiki.samba.org/index.php/Samba_AD_DC_access_control_settings" rel="nofollow"> Paramétrages contrôle d&#039;accès Samba AD DC</a>.
</p>

<p>
Reportez-vous la <a href="https://wiki.samba.org/index.php/Samba" class="urlextern" title="https://wiki.samba.org/index.php/Samba" rel="nofollow"> documentations utilisateur du wiki samba</a> pour plus d&#039;informations et tutoriels.
</p>

</div>
<div class='secedit editbutton_section editbutton_26'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Informations optionnelles et complémentaires] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="informations_optionnelles_et_complementaires" /><input type="hidden" name="codeblockOffset" value="45" /><input type="hidden" name="range" value="26844-28104" /><button type="submit" title="Informations optionnelles et complémentaires" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit27 page-header" id="references">Références</h2>
<div class="level2">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <a href="http://wiki.samba.org/index.php/Samba" class="urlextern" title="http://wiki.samba.org/index.php/Samba" rel="nofollow">Wiki Samba</a></div>
</li>
<li class="level1"><div class="li"> Articles dans Linux Pratique n°79 de sept/oct 2013 (pages 68 à 73) et n°80 de nov/déc (pages 70 à 76)</div>
</li>
</ul>

<p>
<em>Contributeurs principaux : <a href="/utilisateurs/bcag2" class="wikilink1" title="utilisateurs:bcag2">bcag2</a>, <a href="/utilisateurs/qedinux" class="wikilink1" title="utilisateurs:qedinux">Qedinux</a></em>
</p>

</div>
<div class='secedit editbutton_section editbutton_27'><form class="button btn_secedit form-inline" method="post" action="/samba-active-directory"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1590898857" /><input type="hidden" name="summary" value="[Références] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="references" /><input type="hidden" name="codeblockOffset" value="45" /><input type="hidden" name="range" value="28105-" /><button type="submit" title="Références" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div><hr/><div class="footnotes">
<div class="fn"><sup><a href="#fnt__1" id="fn__1" class="fn_bot">1)</a></sup> 
, <sup><a href="#fnt__4" id="fn__4" class="fn_bot">4)</a></sup> 
<div class="content">Conformément aux <a href="https://tools.ietf.org/html/rfc2606" class="urlextern" title="https://tools.ietf.org/html/rfc2606" rel="nofollow">RFC 2606</a> (Reserved Top Level <abbr title="Domain Name System">DNS</abbr> Names) et <a href="https://tools.ietf.org/html/rfc5737" class="urlextern" title="https://tools.ietf.org/html/rfc5737" rel="nofollow">RFC 5737</a> (IPv4 Address Blocks Reserved for Documentation) </div></div>
<div class="fn"><sup><a href="#fnt__2" id="fn__2" class="fn_bot">2)</a></sup> 
<div class="content"><a href="/kernel#configuration_du_noyau_utilise" class="wikilink1" title="kernel">cf. configuration du noyau utilisé</a></div></div>
<div class="fn"><sup><a href="#fnt__3" id="fn__3" class="fn_bot">3)</a></sup> 
<div class="content"><a href="https://wiki.samba.org/index.php/Changing_the_DNS_Back_End_of_a_Samba_AD_DC" class="urlextern" title="https://wiki.samba.org/index.php/Changing_the_DNS_Back_End_of_a_Samba_AD_DC" rel="nofollow">Changing the DNS Back End of a Samba AD DC</a></div></div>
<div class="fn"><sup><a href="#fnt__5" id="fn__5" class="fn_bot">5)</a></sup> 
<div class="content"><a href="http://irp.nain-t.net/doku.php/320kerberos:start" class="urlextern" title="http://irp.nain-t.net/doku.php/320kerberos:start" rel="nofollow">Documentation sur Kerberos et son fonctionnement</a></div></div>
<div class="fn"><sup><a href="#fnt__6" id="fn__6" class="fn_bot">6)</a></sup> 
<div class="content">Flexible Single-Master Operations</div></div>
<div class="fn"><sup><a href="#fnt__7" id="fn__7" class="fn_bot">7)</a></sup> 
<div class="content"><a href="https://technet.microsoft.com/en-us/library/cc961939.aspx" class="urlextern" title="https://technet.microsoft.com/en-us/library/cc961939.aspx" rel="nofollow">Microsoft FSMO roles</a></div></div>
<div class="fn"><sup><a href="#fnt__8" id="fn__8" class="fn_bot">8)</a></sup> 
<div class="content">RID Master</div></div>
<div class="fn"><sup><a href="#fnt__9" id="fn__9" class="fn_bot">9)</a></sup> 
<div class="content">PDC Emulator</div></div>
<div class="fn"><sup><a href="#fnt__10" id="fn__10" class="fn_bot">10)</a></sup> 
<div class="content"><a href="https://wiki.samba.org/index.php/Flexible_Single-Master_Operations_(FSMO)_Roles" class="urlextern" title="https://wiki.samba.org/index.php/Flexible_Single-Master_Operations_(FSMO)_Roles" rel="nofollow">Samba FSMO roles</a></div></div>
<div class="fn"><sup><a href="#fnt__11" id="fn__11" class="fn_bot">11)</a></sup> 
<div class="content"><a href="https://wiki.samba.org/index.php/Transferring_and_Seizing_FSMO_Roles" class="urlextern" title="https://wiki.samba.org/index.php/Transferring_and_Seizing_FSMO_Roles" rel="nofollow">Transferring and Seizing FSMO roles</a></div></div>
</div>

</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="samba-active-directory.txt">samba-active-directory.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 31/05/2020, 06:20">Le 31/05/2020, 06:20</span></li><li class="text-muted">par dexter74</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=samba-active-directory&amp;1635562796" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
