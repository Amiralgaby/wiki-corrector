<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>syslog-ng [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="xenial,serveur"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/syslog-ng?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns="/>
<link rel="edit" title="Modifier cette page" href="/syslog-ng?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/syslog-ng"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/syslog-ng"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/syslog-ng"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"syslog-ng","namespace":"","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="syslog-ng">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/syslog-ng?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/syslog-ng?do=media&amp;ns="  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/syslog-ng?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/syslog-ng?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/syslog-ng?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/syslog-ng?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/syslog-ng?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">syslog-ng</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/syslog-ng?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/syslog-ng?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/syslog-ng?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#pre-requis","title":"Pr\u00e9-requis","level":1},{"link":"#installation","title":"Installation","level":1},{"link":"#configuration_du_client_syslog_d_une_machine","title":"Configuration du client Syslog d'une machine","level":2},{"link":"#configuration_de_php-syslog-ng","title":"Configuration de php-syslog-ng","level":2},{"link":"#configuration_de_la_rotation_des_journaux","title":"4. Configuration de la rotation des journaux","level":2},{"link":"#resolution_des_problemes","title":"5. R\u00e9solution des probl\u00e8mes","level":2}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level1"><a href="#pre-requis">Pré-requis</a></li>
<li class="level1"><a href="#installation">Installation</a>
<ul class="nav toc">
<li class="level2"><a href="#configuration_du_client_syslog_d_une_machine">Configuration du client Syslog d&#039;une machine</a></li>
<li class="level2"><a href="#configuration_de_php-syslog-ng">Configuration de php-syslog-ng</a></li>
<li class="level2"><a href="#configuration_de_la_rotation_des_journaux">4. Configuration de la rotation des journaux</a></li>
<li class="level2"><a href="#resolution_des_problemes">5. Résolution des problèmes</a></li>
</ul></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content"><div class="tags"><span>
	<a href="/xenial" class="wikilink1" title="xenial" rel="tag">Xenial</a>,
	<a href="/serveur" class="wikilink1" title="serveur" rel="tag">serveur</a>
</span></div>

<h1 class="sectionedit1 page-header" id="serveur_syslogsyslog-ng">Serveur SYSLOG : Syslog-ng</h1>
<div class="level1">

<p>
Linux et de multiples équipements réseaux effectuent une journalisation des événements qui s&#039;opèrent sur leur système. Ces journaux sont stockés localement et basés sur le protocole Syslog.
</p>

<p>
L&#039;intérêt d&#039;un serveur Syslog-ng est donc de permettre une centralisation de ces journaux d&#039;événements, permettant de repérer plus rapidement et efficacement les défaillances de machines présentes sur un réseau.
</p>

<p>
Avant même d&#039;aller plus loin, je vous invite à lire l&#039;excellent article <a href="http://okki666.free.fr/docmaster/articles/linux068.htm" class="urlextern" title="http://okki666.free.fr/docmaster/articles/linux068.htm" rel="nofollow">&quot;Syslog, maîtrisez l&#039;historique&quot;</a> de Vincent Renardias, paru dans le numéro 19 de Linux Magazine.
</p>

<p>
C&#039;est une excellente base et une approche simple de la journalisation sous Linux qui va suivre…
Syslog-ng est une solution de journalisation sous systèmes Unix et Linux depuis les années 1980.
</p>

<p>
Nous nous intéresserons ici à <a href="https://fr.wikipedia.org/wiki/syslog-ng" class="interwiki iw_wpfr" title="https://fr.wikipedia.org/wiki/syslog-ng">syslog-ng</a>, un remplaçant de <a href="https://fr.wikipedia.org/wiki/syslog" class="interwiki iw_wpfr" title="https://fr.wikipedia.org/wiki/syslog">syslog</a>. Il permet notamment de dissocier les logs entrants sur d&#039;autres critères que le &#039;facility&#039; comme par exemple : le nom ou l&#039;adresse IP de la machine qui émet le log.
</p>

<p>
Son installation n&#039;est pas très complexe, mais nécessite un peu de rigueur.
</p>

</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/syslog-ng"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1566386910" /><input type="hidden" name="summary" value="[Serveur SYSLOG : Syslog-ng] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="serveur_syslogsyslog-ng" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="25-1269" /><button type="submit" title="Serveur SYSLOG : Syslog-ng" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit2 page-header" id="pre-requis">Pré-requis</h2>
<div class="level2">
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Disposer des <a href="/sudo" class="wikilink1" title="sudo">droits d&#039;administration</a> ;</div>
</li>
<li class="level1"><div class="li"> Disposer d&#039;une connexion à Internet configurée et activée ;</div>
</li>
<li class="level1"><div class="li"> Un <a href="/lamp" class="wikilink1" title="lamp">serveur LAMP</a> (Linux Apache Mysql Php) fonctionnel si vous décidez d&#039;installer php-syslog-ng.</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/syslog-ng"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1566386910" /><input type="hidden" name="summary" value="[Pré-requis] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="pre-requis" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="1270-1528" /><button type="submit" title="Pré-requis" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit3 page-header" id="installation">Installation</h2>
<div class="level2">

<p>
 <strong>Ne pas laisser les droits de modification à n&#039;importe quel utilisateur !!</strong>
.
L&#039;installation de syslog-ng supprimera les paquets klogd et sysklogd, respectivement en charge de la journalisation des événements liés au noyau et au reste du système. Idem pour le paquet ubuntu-minimal.
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">Installez les paquets</a> suivants: <strong><a href="apt://syslog-ng,syslog-ng-core" class="interwiki iw_apt" title="apt://syslog-ng,syslog-ng-core">syslog-ng syslog-ng-core</a></strong></div>
</li>
</ul>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <a href="/tutoriel/comment_modifier_un_fichier" class="wikilink1" title="tutoriel:comment_modifier_un_fichier">Editez le fichier</a> <strong> /etc/default/syslog-ng </strong> <br/>
</div>
</li>
</ul>

<p>
  et remplacez 
 
</p>
<pre class="file">#CONSOLE_LOG_LEVEL=0 par
 CONSOLE_LOG_LEVEL=1</pre>

<p>
<img src="/lib/images/smileys/fixme.gif" class="icon" alt="FIXME" /> Pouvez-vous expliquer pourquoi la valeur par défaut ne convient pas?
</p>

<p>
Après avoir effectué ces changements, redémarrez syslog-ng avec la commande :
</p>
<pre class="code">sudo /etc/init.d/syslog-ng restart</pre>

</div>

<h4 id="configuration_de_syslog-ng">Configuration de Syslog-NG</h4>
<div class="level4">

<p>
Le fichier de configuration par défaut est situé dans /etc/syslog-ng/syslog-ng.conf
</p>

<p>
Pour que syslog-ng accepte de recevoir des messages d&#039;une machine distante, vous devez décommenter une ligne ; pour cela remplacer :
</p>
<pre class="code"># (this is equivalent to the &quot;-r&quot; syslogd flag)
# udp();</pre>

<p>
Par
</p>
<pre class="code"># (this is equivalent to the &quot;-r&quot; syslogd flag)
udp();</pre>
<div class="noteclassic">Pour ma part: J&#039;ai du laisser commenté udp() et ajouter une nouvelle source:
<img src="/lib/images/smileys/fixme.gif" class="icon" alt="FIXME" />
<pre class="code">source s_net {
        udp();
};</pre>

<p>
 sinon tous les messages venant du réseaux sont re-dirigé vers les fichiers /var/log/messages et /var/log/syslog en plus du fichier paramétré
</p>

</div><div class="notewarning">Rien de tout ça ne semble fonctionner avec Ubuntu 12.04, vu les changements dans le fichier de configuration il est possible que l&#039;authentification et le chiffrement soit nécessaire pour accepter les logs distants.
</div>
</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit form-inline" method="post" action="/syslog-ng"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1566386910" /><input type="hidden" name="summary" value="[Installation] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installation" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="1529-3305" /><button type="submit" title="Installation" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit4" id="configuration_du_client_syslog_d_une_machine">Configuration du client Syslog d&#039;une machine</h3>
<div class="level3">

<p>
Si vous souhaitez envoyer tous les messages syslog d&#039;une station ou d&#039;un serveur sur le serveur syslog qui les collectera (plutôt que localement), vous devez <a href="/tutoriel/comment_modifier_un_fichier" class="wikilink1" title="tutoriel:comment_modifier_un_fichier"> Editez le fichier</a> <strong> /etc/syslog.conf </strong> (ou <strong> /etc/rsyslog.conf </strong>) et ajouter la ligne suivante :
</p>
<pre class="code">*.*            @ip_server_syslog</pre>

<p>
exemple pour l&#039;adresse ip 192.168.0.1
</p>
<pre class="code">*.*            @192.168.0.1</pre>

<p>
Maintenant, redémarrez le client syslog de la machine :
</p>
<pre class="code">sudo /etc/init.d/syslog-ng restart</pre>

<p>
À partir de maintenant, le serveur syslog-ng est fonctionnel : les logs de la machine lui sont envoyés.
</p>

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit form-inline" method="post" action="/syslog-ng"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1566386910" /><input type="hidden" name="summary" value="[Configuration du client Syslog d&#039;une machine] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration_du_client_syslog_d_une_machine" /><input type="hidden" name="codeblockOffset" value="5" /><input type="hidden" name="range" value="3306-4017" /><button type="submit" title="Configuration du client Syslog d&#039;une machine" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit5" id="configuration_de_php-syslog-ng">Configuration de php-syslog-ng</h3>
<div class="level3">

<p>
php-syslog-ng est une interface web basée sur un script php qui permet de lire les logs qu&#039;aura stocké dans une base mysql un serveur syslog-ng. Elle n&#039;est pas indispensable mais permet d&#039;accéder aux logs plus facilement et intuitivement. Vous devez avoir un serveur LAMP de fonctionnel (Linux Apache MySQL PHP)
</p>

</div>

<h4 id="telecharger_et_installer_le_logiciel">Télécharger et installer le logiciel</h4>
<div class="level4">
<pre class="code">mkdir phpsyslogng
cd phpsyslogng
wget http://php-syslog-ng.googlecode.com/files/php-syslog-ng-2.9.8.tgz
tar -zxvf php-syslog-ng-*
cd ..
sudo mv phpsyslogng /var/www/
cd /var/www/phpsyslogng</pre>

</div>

<h4 id="configuration_de_mysql">Configuration de MySQL</h4>
<div class="level4">

<p>
Le moyen le plus rapide est d&#039;utiliser le fichier dbsetup.sql dans le répertoire &#039;scripts&#039;(/var/www/phpsyslogng/html/scripts). Éditez ce fichier et renseignez les mots de passe des 3 utilisateurs (sysloguser, syslogfeeder, syslogadmin) qui seront créés (en remplaçant PW_HERE). Le script créera une table pour les journaux et une pour l&#039;authentification des utilisateurs, et affectera des droits sensiblement différents pour chaque utilisateur.
</p>

<p>
Si vous effectuez d&#039;autres changements comme changer le nom de la base de données ou des tables, assurez-vous de faire correspondre ces changement dans le fichier config.php.
</p>

<p>
Après avoir modifié le script dbsetup.sql exécutez le simplement avec la commande :
</p>
<pre class="code">sudo mysql -u root -p &lt; dbsetup.sql</pre>

</div>

<h4 id="configuration_de_syslog-ng1">Configuration de syslog-ng</h4>
<div class="level4">

<p>
Maintenant vous devez configurer syslog-ng pour rediriger les messages dans la base MySQL. Vous devrez ajouter 2 entrées dans le fichier de configuration de syslog-ng. Le fichier de configuration est habituellement dans /etc/syslog-ng/syslog-ng.conf
</p>

<p>
Vous devez premièrement ajouter une entrée &#039;destination&#039;. Ajoutez ceci :
</p>
<pre class="code">destination d_mysql {
pipe(&quot;/var/log/mysql.pipe&quot;
template(&quot;INSERT INTO logs
(host, facility, priority, level, tag, datetime, program, msg)
VALUES ( &#039;$HOST&#039;, &#039;$FACILITY&#039;, &#039;$PRIORITY&#039;, &#039;$LEVEL&#039;, &#039;$TAG&#039;, &#039;$YEAR-$MONTH-$DAY $HOUR:$MIN:$SEC&#039;,
&#039;$PROGRAM&#039;, &#039;$MSG&#039; );\n&quot;) template-escape(yes));
};</pre>

<p>
Ceci va prendre vos logs et les formater dans une requête SQL qui pourra être exécutée pour les ajouter dans la base de données.
</p>

<p>
Vous devrez également ajouter une entrée de type &#039;log&#039; qui déterminera quels évènements faire suivre dans la base de données (fonctionnement basé sur le mode First In First Out). Vous voudrez sûrement faire suivre tous les logs dans MySQL et ils seront aussi une entrée de type &#039;source&#039; pour cela dans votre fichier syslog-ng.conf (habituellement appelés src ou s_all). Pour rattacher cette source à la destination que vous venez juste de créer, vous devez ajouter le code suivant :
</p>
<pre class="code">log {
source(s_all);
destination(d_mysql);
};</pre>

</div>

<h4 id="configurer_syslog-ng_pour_la_redirection_vers_mysql">Configurer syslog-ng pour la redirection vers MySQL</h4>
<div class="level4">

<p>
Un exemple de script qui redirige les logs vers la base MySQL est inclus dans le répertoire des scripts (/var/www/phpsyslogng/html/scripts). Le script se nomme syslog2mysql.sh
</p>
<pre class="code">#!/bin/bash

if [ ! -e /var/log/mysql.pipe ]
then
mkfifo /var/log/mysql.pipe
fi
while [ -e /var/log/mysql.pipe ]
do
mysql -u syslogfeeder --password=PASS_HERE syslog &lt; /var/log/mysql.pipe &gt;/dev/null
done</pre>

<p>
Vous devez remplacer PASS_HERE par le mot de passe que vous avez affecté à l&#039;utilisateur &#039;syslogfeeder&#039;. Vous voudrez aussi probablement que le script soit lancé automatiquement à chaque démarrage du serveur syslog-ng. Aussi, ajoutez une entrée dans inittab ou démarrez le script via init.d. Mais bien faire attention à lancer le script une fois que Mysql a démarré.
</p>

<p>
Avec un script init.d Ubuntu :
Créez un fichier syslog2mysql dans /etc/init.d/ ayant comme contenu :
</p>
<pre class="code">#! /bin/sh

# Do NOT &quot;set -e&quot;

PATH=/usr/sbin:/usr/bin:/sbin:/bin
DESC=&quot;Fetch queries from syslog-ng to mysql db&quot;
NAME=syslog2mysql
PIDFILE=/var/run/$NAME.pid
SCRIPTNAME=/etc/init.d/$NAME

# Exit if mysql client is not installed
[ -x &quot;/usr/bin/mysql&quot; ] || exit 0

# Load the VERBOSE setting and other rcS variables
[ -f /etc/default/rcS ] &amp;&amp; . /etc/default/rcS

# Define LSB log_* functions.
# Depend on lsb-base (&gt;= 3.0-6) to ensure that this file is present.
. /lib/lsb/init-functions

#
# Function that starts the daemon/service
#
do_start()
{
        [ ! -e /var/log/mysql.pipe ] &amp;&amp; echo &quot; (Creating $NAME pipe).&quot; &amp;&amp; mkfifo /var/log/mysql.pipe
        if [ -e $PIDFILE ]; then
            if ps -p $(cat $PIDFILE) &gt;/dev/null; then
                echo -n -e &quot;\nError: $NAME seems to be already running!&quot;
                return 1
            else
                rm -f $PIDFILE
            fi
        fi
        {
            while [ -e /var/log/mysql.pipe ]
            do
                mysql -u syslogfeeder --password=PASS_HERE syslog &lt; /var/log/mysql.pipe &gt;/dev/null
                sleep 1
            done
        } &amp;
        echo $! &gt; $PIDFILE
}

#
# Function that stops the daemon/service
#
do_stop()
{
        if [ -e $PIDFILE ]; then
            PID=$(cat $PIDFILE)
            if ps -p $PID &gt;/dev/null; then
                # get PID of child
                CPID=$(pgrep -P $PID)
                # kill script
                kill $PID
                # kill child
                kill $CPID
                rm -f $PIDFILE
                return 0
            else
                echo -e &quot;\nWarning: $NAME was not running.&quot;
                echo -n -e &quot;\nCleaning PID file&quot;
                rm -f $PIDFILE
                return 1
            fi
        else
            echo -n -e &quot;\nWarning: $NAME was not running&quot;
            return 1
        fi
}

case &quot;$1&quot; in
  start)
        [ &quot;$VERBOSE&quot; != no ] &amp;&amp; log_daemon_msg &quot;Starting $DESC&quot; &quot;$NAME&quot;
        do_start
        case &quot;$?&quot; in
                0|1) [ &quot;$VERBOSE&quot; != no ] &amp;&amp; log_end_msg 0 ;;
                2) [ &quot;$VERBOSE&quot; != no ] &amp;&amp; log_end_msg 1 ;;
        esac
        ;;
  stop)
        [ &quot;$VERBOSE&quot; != no ] &amp;&amp; log_daemon_msg &quot;Stopping $DESC&quot; &quot;$NAME&quot;
        do_stop
        case &quot;$?&quot; in
                0|1) [ &quot;$VERBOSE&quot; != no ] &amp;&amp; log_end_msg 0 ;;
                2) [ &quot;$VERBOSE&quot; != no ] &amp;&amp; log_end_msg 1 ;;
        esac
        ;;
  restart|force-reload)
        #
        # If the &quot;reload&quot; option is implemented then remove the
        # &#039;force-reload&#039; alias
        #
        log_daemon_msg &quot;Restarting $DESC&quot; &quot;$NAME&quot;
        do_stop
        case &quot;$?&quot; in
          0|1)
                do_start
                case &quot;$?&quot; in
                        0) log_end_msg 0 ;;
                        1) log_end_msg 1 ;; # Old process is still running
                        *) log_end_msg 1 ;; # Failed to start
                esac
                ;;
          *)
                # Failed to stop
                log_end_msg 1
                ;;
        esac
        ;;
  *)
        echo &quot;Usage: $SCRIPTNAME {start|stop|restart|force-reload}&quot; &gt;&amp;2
        exit 3
        ;;
esac

:</pre>

<p>
Pensez à modifier le pwd de syslogfeeder dedans
</p>

<p>
Créez le lien pour lancer le script au démarrage
</p>
<pre class="code">sudo update-rc.d syslog2mysql defaults</pre>

<p>
Maintenant démarrez le service syslog2mysql :
</p>
<pre class="code">sudo /etc/init.d/syslog2mysql start</pre>

<p>
ou si vous préférez ne pas utiliser init.d et utiliser directement le script :
</p>
<pre class="code">sudo ./syslog2mysql.sh &amp;</pre>

<p>
Note : ce script doit toujours s&#039;exécuter en tache de fond parce qu&#039;en l&#039;utilisant tout les messages sont redirigés dans la base de données MySQL.
</p>

<p>
Il est maintenant temps de redémarrer le démon syslog-ng et d&#039;envoyer les logs dans la base de données :
</p>
<pre class="code">sudo /etc/init.d/syslog-ng restart</pre>

</div>

<h4 id="modification_du_fichier_configphp">Modification du fichier config.php</h4>
<div class="level4">

<p>
Si vous utilisez la base de données par défaut initialisée par le fichier dbsetup.sql, tout ce que vous avez à faire est d&#039;entrer le mot de passe pour les utilisateurs sysloguser et syslogadmin, définir l&#039;hote et le port du serveur de base de données s&#039;il n&#039;est pas sur le même serveur que le serveur web, et saisir une <abbr title="Uniform Resource Locator">URL</abbr> valide.
</p>

<p>
Sinon, parcourez le fichier config.php et configurez les paramètres dont vous avez besoin. Toutes les options sont expliquées dans le fichier.
</p>
<pre class="code">sudo vi /var/www/phpsyslogng/config/config.php</pre>

<p>
php-syslog-ng est maintenant accessible à l&#039;adresse : <a href="http://votre_webserver/phpsyslogng" class="urlextern" title="http://votre_webserver/phpsyslogng" rel="nofollow">http://votre_webserver/phpsyslogng</a>
Un compte administrateur (admin) a été créé par dbsetup.sql avec le mot de passe admin
</p>

<p>
Si après la connexion vous obtenez le message &quot;Query failed: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#039;&#039; at line 1&quot;, c&#039;est parce que votre base mysql n&#039;est pas encore alimentée. Pour les plus pressés, vous pouvez créer un enregistrement factice via la requête SQL suivante :
</p>
<pre class="code">INSERT INTO `search_cache` ( `tablename` , `type` , `value` ,`updatetime` ) VALUES (&#039;logs&#039;, &#039;HOST&#039;, &#039;localhost&#039;, NOW( ) );</pre>

</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit form-inline" method="post" action="/syslog-ng"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1566386910" /><input type="hidden" name="summary" value="[Configuration de php-syslog-ng] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration_de_php-syslog-ng" /><input type="hidden" name="codeblockOffset" value="8" /><input type="hidden" name="range" value="4018-12873" /><button type="submit" title="Configuration de php-syslog-ng" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit6" id="configuration_de_la_rotation_des_journaux">4. Configuration de la rotation des journaux</h3>
<div class="level3">

<p>
La rotation permet d&#039;archiver et/ou purger les plus anciens évènements des journaux afin d&#039;éviter que leur stockage ne devienne trop volumineux
</p>

<p>
Rotation des journaux de la base MYSQL
</p>

<p>
Il est préférable d&#039;utiliser le service de rotation des logs plutôt que de supprimer les enregistrements directement dans la table principale de la base de données. Ceci évite de causer des problèmes de performance. Déplacer les logs de la table principale améliore aussi les performances car la table qui contient les anciens logs est statique et peut donc être optimisée.
</p>

<p>
Vous devez éditer le fichier logrotate.php dans le répertoire &#039;scripts&#039; pour spécifier le chemin d&#039;installation de php-syslog-ng.
</p>

<p>
Si vous choissiez d&#039;utiliser le script logrotate.php, ajoutez simplement celui-ci dans votre crontab et exécutez le aussi souvent que vous le souhaitez (le maximum est actuellement d&#039;une fois par jour).
</p>

<p>
Pour cela, éditez la crontab du superutilisateur…
</p>
<pre class="code">sudo crontab -e</pre>

<p>
… pour y ajouter une entrée :
</p>
<pre class="code">00 22 * * 0 php /var/www/phpsyslogng/scripts/logrotate.php</pre>

<p>
Ici, la rotation des logs se fera tout les lundis (0) à 22h00
</p>

<p>
Si vous activez le paramètre LOGROTATERETENTION du fichier config.php, alors les logs plus anciens que ce paramètre seront supprimés à l&#039;exécution du fichier &#039;logrotate.php&#039;. (activé par défaut à 90 jours)
</p>

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit form-inline" method="post" action="/syslog-ng"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1566386910" /><input type="hidden" name="summary" value="[4. Configuration de la rotation des journaux] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="configuration_de_la_rotation_des_journaux" /><input type="hidden" name="codeblockOffset" value="20" /><input type="hidden" name="range" value="12874-14314" /><button type="submit" title="4. Configuration de la rotation des journaux" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit7" id="resolution_des_problemes">5. Résolution des problèmes</h3>
<div class="level3">

<p>
Si vous rencontrez le messages d&#039;erreur &quot;<em>Query failed: Can&#039;t find file: &#039;all_logs&#039; (errno: 2)</em>&quot; après vous être identifié, il vous faut exécuter la commande suivante : 
</p>
<pre class="code">php /var/www/phpsyslogng/scripts/logrotate.php</pre>

<p>
<img src="/lib/images/smileys/fixme.gif" class="icon" alt="FIXME" /> La commande ne résout que temporairement le problème !
</p>
<hr />

<p>
<em>Contributeurs</em> : sidney_v
</p>

</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit form-inline" method="post" action="/syslog-ng"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1566386910" /><input type="hidden" name="summary" value="[5. Résolution des problèmes] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="resolution_des_problemes" /><input type="hidden" name="codeblockOffset" value="22" /><input type="hidden" name="range" value="14315-" /><button type="submit" title="5. Résolution des problèmes" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="syslog-ng.txt">syslog-ng.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 21/08/2019, 13:28">Le 21/08/2019, 13:28</span></li><li class="text-muted">par 83.152.209.122</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=syslog-ng&amp;1635564815" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
