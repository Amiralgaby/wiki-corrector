<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>dump [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="xenial,sauvegarde,securite,serveur"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/dump?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns="/>
<link rel="edit" title="Modifier cette page" href="/dump?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/dump"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/dump"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/dump"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"dump","namespace":"","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="dump">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/dump?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/dump?do=media&amp;ns="  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/dump?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/dump?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/dump?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/dump?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/dump?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">dump</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/dump?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/dump?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/dump?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#la_sauvegarde_sur_bandes_avec_ubuntu","title":"La sauvegarde sur bandes avec Ubuntu","level":1},{"link":"#le_materiel","title":"Le mat\u00e9riel","level":2},{"link":"#les_applicatifs","title":"Les applicatifs","level":2},{"link":"#les_scripts_utiles","title":"Les scripts utiles","level":2}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level1"><a href="#la_sauvegarde_sur_bandes_avec_ubuntu">La sauvegarde sur bandes avec Ubuntu</a>
<ul class="nav toc">
<li class="level2"><a href="#le_materiel">Le matériel</a></li>
<li class="level2"><a href="#les_applicatifs">Les applicatifs</a></li>
<li class="level2"><a href="#les_scripts_utiles">Les scripts utiles</a></li>
</ul></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content"><div class="tags"><span>
	<a href="/xenial" class="wikilink1" title="xenial" rel="tag">Xenial</a>,
	<a href="/sauvegarde" class="wikilink1" title="sauvegarde" rel="tag">sauvegarde</a>,
	<a href="/securite" class="wikilink1" title="securite" rel="tag">sécurité</a>,
	<a href="/serveur" class="wikilink1" title="serveur" rel="tag">serveur</a>
</span></div>
<hr />

<h1 class="sectionedit1 page-header" id="sauvegardes_sur_bandes_magnetiques_avec_dump">Sauvegardes sur bandes magnétiques avec Dump</h1>
<div class="level1">

<p>
L&#039;information contenue sur les disques est souvent plus importante que l&#039;ordinateur lui-même. Il est impératif de s&#039;assurer contre la perte d&#039;informations due à :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> une défaillance matérielle</div>
</li>
<li class="level1"><div class="li"> une destruction par un logiciel</div>
</li>
<li class="level1"><div class="li"> une erreur de l&#039;utilisateur</div>
</li>
<li class="level1"><div class="li"> un désastre (incendie, tremblement de terre, raz de marée, météorite, extinction de l&#039;espèce humaine, etc.)</div>
</li>
<li class="level1"><div class="li"> etc.</div>
</li>
</ul>

<p>
La stratégie de sauvegarde adoptée va dépendre de :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> la quantité, le roulement et l&#039;importance de l&#039;information</div>
</li>
<li class="level1"><div class="li"> le prix que l&#039;on est prêt à engager</div>
</li>
</ul>

<p>
L&#039;offre en terme de support de sauvegarde est abondante. On retrouve les CD, les DVD, les bandes magnétiques, les disques ZIP (ou similaires), les disques durs, etc.
</p>

<p>
Dans cet article, nous allons nous pencher sur les bandes magnétiques. Les bandes magnétiques restent une solution très intéressante pour les quantités importantes de données pour les raisons suivantes :
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> capacités disponibles jusqu&#039;à 200 Go non compressés (plus ou moins 400 Go compressés)</div>
</li>
<li class="level1"><div class="li"> prix de revient au Go intéressant</div>
</li>
<li class="level1"><div class="li"> possibilités de sortir les bandes du bâtiment de production</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/dump"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1484591314" /><input type="hidden" name="summary" value="[Sauvegardes sur bandes magnétiques avec Dump] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="sauvegardes_sur_bandes_magnetiques_avec_dump" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="54-1248" /><button type="submit" title="Sauvegardes sur bandes magnétiques avec Dump" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit2 page-header" id="la_sauvegarde_sur_bandes_avec_ubuntu">La sauvegarde sur bandes avec Ubuntu</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/dump"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1484591314" /><input type="hidden" name="summary" value="[La sauvegarde sur bandes avec Ubuntu] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="la_sauvegarde_sur_bandes_avec_ubuntu" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="1249-1298" /><button type="submit" title="La sauvegarde sur bandes avec Ubuntu" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit3" id="le_materiel">Le matériel</h3>
<div class="level3">

<p>
La plupart des lecteurs/enregistreurs de bandes magnétiques sont disponibles en SCSI. Dans mon cas, il s&#039;agit d&#039;un <em>HP StorageWorks Ultrium 215</em> que j&#039;utilise avec des bandes de 100 Go.
</p>

</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit form-inline" method="post" action="/dump"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1484591314" /><input type="hidden" name="summary" value="[Le matériel] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="le_materiel" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="1299-1513" /><button type="submit" title="Le matériel" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit4" id="les_applicatifs">Les applicatifs</h3>
<div class="level3">

<p>
Les applicatifs que je vous propose d&#039;utiliser sont des outils en mode console. Ils sont très simples d&#039;usage et permettent d&#039;automatiser une grosse partie du processus de sauvegarde à l&#039;aide de scripts.
</p>

<p>
Les outils que nous allons utiliser sont : <code>dump</code>, <code>restore</code> et <code>mt</code>.
</p>

<p>
Pour installer les applications <code>dump</code> et <code>restore</code>, vous devez <a href="/tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer le paquet</a> <strong><a href="apt://dump" class="interwiki iw_apt" title="apt://dump">dump</a></strong>. Pour installer <code>mt</code>, vous devez installer le paquet <code>mt-st</code> (dans le dépôt <em>Universe</em> également).
</p>

</div>

<h4 id="dump">dump</h4>
<div class="level4">

<p>
L&#039;application <code>dump</code> va se charger d&#039;effectuer des sauvegardes incrémentales ou non d&#039;un système de fichiers et de l&#039;écrire sur une bande magnétique. L&#039;avantage de <code>dump</code> par rapport à tous les systèmes de backup disponibles sur le marché est qu&#039;il est facilement utilisable en ligne de commande et compatibles avec n&#039;importe quel système Unix/Linux.
</p>

<p>
Voici la syntaxe générale d&#039;une commande <code>dump</code> : 
</p>
<pre class="code">sudo dump -0 -A archfile -L label -f device filestosave</pre>

<p>
Voici un exemple que j&#039;utilise sur mon système :
</p>
<pre class="code">sudo dump -0 -A /opt/tape/LU-MIDI.arch -L &quot;LU-MIDI&quot; -f /dev/st0 /srv/</pre>

<p>
Les paramètres utilisés sont les suivants :
</p>
<ol class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <code>-0</code> : indique le niveau de sauvegarde (utilisé pour les sauvegardes incrémentales). <code>-0</code> indique que l&#039;on veut tout sauvegarder.</div>
</li>
<li class="level1"><div class="li"> <code>-A</code> : indique le chemin du fichier archive à utiliser. Ce fichier va contenir un ensemble d&#039;informations comme l&#039;arborescence qui est sur la bande ainsi que les positions physiques des fichiers sur la bande. A l&#039;aide de ce fichier, on peut facilement déterminer les éléments à restaurer en cas de besoin.</div>
</li>
<li class="level1"><div class="li"> <code>-L</code> : indique le label qui sera sauvegardé sur la bande. Un label fait maximum 16 caractères suivi d&#039;un <code>\0</code> (en fait, il faut toujours indiquer le label entre guillemets (<code>&quot;label&quot;</code>).</div>
</li>
<li class="level1"><div class="li"> <code>-f</code> : indique le device sur lequel on écrit. Notez qu&#039;ici on utilise un lecteur de bande SCSI mais on peut utiliser un disque dur.</div>
</li>
<li class="level1"><div class="li"> dernier paramètre : l&#039;arborescence à sauvegarder.</div>
</li>
</ol>

<p>
Je vous invite à consulter les <em>manpages</em> pour de plus amples informations concernant l&#039;utilisation de <code>dump</code>.
</p>

</div>

<h5 id="concernant_les_sauvegardes_incrementales">Concernant les sauvegardes incrémentales…</h5>
<div class="level5">

<p>
Une sauvegarde se fait toujours à un certain <strong>niveau</strong> (de 0 à 9). Une sauvegarde de niveau <strong>i</strong> consistera à sauver tout ce qui a été modifié depuis le dernier backup à un niveau inférieur. Un backup de niveau 0 revient à tout sauvegarder.
</p>

</div>

<h4 id="restore">restore</h4>
<div class="level4">

<p>
L&#039;application <code>restore</code> se charge de restaurer un ensemble de fichiers à partir d&#039;une sauvegarde effectuée par <code>dump</code>. <code>restore</code> peut fonctionner de deux manières : soit on restaure toute la bande, soit on restaure une partie déterminée en mode interactif (ce qui est très simple, même via une console SSH).
</p>

<p>
Pour effectuer une restauration interactive, on utilise <code>restore</code> de la manière suivante :
</p>
<pre class="code">sudo restore -i -A archfile -f device</pre>

<p>
Pour restaurer une partie de la sauvegarde effectuée avec la commande <code>dump</code> de l&#039;exemple :
</p>
<pre class="code">sudo restore -i -A /opt/tape/LU-MIDI.arch -f /dev/st0</pre>

<p>
Les paramètres utilisés sont les suivants :
</p>
<ol class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <code>-i</code> : indique que l&#039;on travaille en mode interactif; nous y reviendrons tout de suite après.</div>
</li>
<li class="level1"><div class="li"> <code>-A</code> : indique le chemin du fichier archive à utiliser.</div>
</li>
<li class="level1"><div class="li"> <code>-f</code> : indique la device sur laquelle se trouve la sauvegarde.</div>
</li>
</ol>

<p>
<em>Remarque :</em> Par défaut, la restauration se passe toujours dans le répertoire courant. Dès lors, vérifiez que vous avez assez d&#039;espace disque libre avant d&#039;effectuer une grosse restauration.
</p>

</div>

<h5 id="restauration_en_mode_interactif">Restauration en mode interactif</h5>
<div class="level5">

<p>
Lorsque vous lancez une restauration en mode interactif, vous allez entrer dans une sorte de console simplifiée dans laquelle vous pouvez naviguer comme si vous aviez monté le système de fichier de la bande. Vous disposez d&#039;un nombre de commandes restreints vous permettant de choisir les fichiers ou répertoires à restaurer :
</p>
<ol class=" fix-media-list-overlap">
<li class="level1"><div class="li"> <code>ls</code> : idem que la commande <code>ls</code> du bash.</div>
</li>
<li class="level1"><div class="li"> <code>cd repertoire</code> : idem que la commande <code>cd</code> du bash.</div>
</li>
<li class="level1"><div class="li"> <code>add fichier|repertoire</code> : ajoute le fichier ou le répertoire (récursif) dans la liste des fichiers à restaurer. Il apparaîtra avec un <code>*</code> lors d&#039;un <code>ls</code>.</div>
</li>
<li class="level1"><div class="li"> <code>extract</code> : lance la restauration.</div>
</li>
<li class="level1"><div class="li"> <code>quit</code> : quitte le mode interactif.</div>
</li>
</ol>

</div>

<h5 id="restauration_complete">Restauration complète</h5>
<div class="level5">

<p>
Pour restaurer complètement les fichiers sauvegardés :
</p>
<pre class="code"> sudo restore -x -A /opt/tape/LU-MIDI.arch -f /dev/st0</pre>

<p>
<em>Remarque :</em> Il est important de préciser avec l&#039;option -A le fichier dans lequel est inscrit l&#039;arborescence des fichiers sauvegardés, sinon <code>restore</code> refusera de recréer cette arborescence.
</p>

</div>

<h5 id="verification_de_la_bande_magnetique">Vérification de la bande magnétique</h5>
<div class="level5">

<p>
Pour vérifier un système de fichier présent sur la bande par rapport au système de fichier sur disque :
</p>
<pre class="code"> sudo restore -C -D filesystem -f device</pre>

</div>

<h4 id="mt">mt</h4>
<div class="level4">

<p>
L&#039;application <code>mt</code> sert à contrôler le lecteur de bandes magnétiques à un assez bas niveau. Cette application permet d&#039;ajouter des <em>tags</em> sur la bande, éjecter la bande, rebobiner la bande et se déplacer par rapport aux <em>tags</em>.
</p>

<p>
Il est donc possible de mettre plusieurs enregistrements (sauvegardes) sur une même bande. Dans ce cas, le lecteur de bandes met des repères (<em>tags</em>) pour pouvoir retrouver les débuts des enregistrements. <strong>Cependant</strong> :
</p>
<ol class=" fix-media-list-overlap">
<li class="level1"><div class="li"> il n&#039;y a pas de table des matières.</div>
</li>
<li class="level1"><div class="li"> il n&#039;y a aucune information concernant le format du contenu (<code>tar</code>, <code>dump</code>, autre…)</div>
</li>
</ol>

<p>
C&#039;est pour cela qu&#039;il faut <strong>tout noter soigneusement</strong>. Pour se déplacer sur la bande, on ne dispose pas de beaucoup de possibilités.
</p>

<p>
! Concernant la syntaxe de la commande mt, elle peut à priori varier : l&#039;argument peut venir après le device.
</p>
<pre class="code"> ex : sudo mt -f /dev/st0 rewind</pre>

<p>
Pour rebobiner la bande (complètement) :
</p>
<pre class="code"> sudo mt rewind -f /dev/st0</pre>

<p>
Pour avancer de <code>n</code> enregistrements :
</p>
<pre class="code"> sudo mt fsf n -f /dev/st0</pre>

<p>
Nous disposons également de la commande d&#039;éjection précédée ou pas du rebobinage complet.
</p>

<p>
Pour éjecter la bande :
</p>
<pre class="code"> sudo mt off -f /dev/st0</pre>

<p>
Pour rebobiner et éjecter la bande :
</p>
<pre class="code"> sudo mt rewoffl -f /dev/st0</pre>

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit form-inline" method="post" action="/dump"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1484591314" /><input type="hidden" name="summary" value="[Les applicatifs] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="les_applicatifs" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="1514-7670" /><button type="submit" title="Les applicatifs" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit5" id="les_scripts_utiles">Les scripts utiles</h3>
<div class="level3">

<p>
Lorsque j&#039;ai mis en place la stratégie de sauvegarde de notre serveur, je me suis vite rendu compte qu&#039;une certaine <em>automatisation</em> s&#039;imposait. C&#039;est pour cette raison que j&#039;ai fait quelques scripts qui pourront sans doute vous servir.
</p>

</div>

<h4 id="affiche_le_label_de_la_bande_inseree">Affiche le label de la bande insérée</h4>
<div class="level4">
<pre class="code bash"><span class="co0">#!/bin/bash</span>
<span class="re2">BAK_TMP</span>=<span class="sy0">/</span>tmp
mt rewind <span class="re5">-f</span> <span class="sy0">/</span>dev<span class="sy0">/</span>st0
<span class="kw3">echo</span> <span class="st0">&quot;n&quot;</span> <span class="sy0">&gt;</span> <span class="re1">$BAK_TMP</span><span class="sy0">/</span>what-tape.cmd
restore <span class="re5">-t</span> <span class="re5">-h</span> <span class="re5">-f</span> <span class="sy0">/</span>dev<span class="sy0">/</span>st0 <span class="sy0">/</span>mnt <span class="sy0">&lt;</span> <span class="re1">$BAK_TMP</span><span class="sy0">/</span>what-tape.cmd <span class="sy0">&amp;&gt;</span> <span class="re1">$BAK_TMP</span><span class="sy0">/</span>what-tape.tmp
<span class="kw2">rm</span> <span class="re1">$BAK_TMP</span><span class="sy0">/</span>what-tape.cmd
mt rewind <span class="re5">-f</span> <span class="sy0">/</span>dev<span class="sy0">/</span>st0
<span class="re2">TAPE_LABEL</span>=<span class="sy0">`</span><span class="kw2">cat</span> <span class="re1">$BAK_TMP</span><span class="sy0">/</span>what-tape.tmp <span class="sy0">|</span> <span class="kw2">grep</span> Label: <span class="sy0">|</span> <span class="kw2">awk</span> <span class="st_h">'{print $2}'</span><span class="sy0">`</span>
<span class="kw2">rm</span> <span class="re1">$BAK_TMP</span><span class="sy0">/</span>what-tape.tmp
<span class="kw3">echo</span> <span class="re1">$TAPE_LABEL</span></pre>

</div>

<h4 id="formate_la_bande_en_lui_imposant_un_label">Formate la bande en lui imposant un label</h4>
<div class="level4">
<pre class="code bash"><span class="co0">#!/bin/bash</span>
<span class="co0"># Usage : tapebak_format &lt;name&gt;</span>
<span class="co0"># Exemple : tapebak_format LU-MIDI</span>
<span class="re2">BAK_NAME</span>=<span class="re4">$1</span>
<span class="co0"># Tend la bande</span>
<span class="kw2">mkdir</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>empty
mt retension <span class="re5">-f</span> <span class="sy0">/</span>dev<span class="sy0">/</span>st0
<span class="co0"># Format</span>
dump <span class="re5">-0</span> <span class="re5">-L</span> <span class="st0">&quot;<span class="es2">$BAK_NAME</span>&quot;</span> <span class="re5">-f</span> <span class="sy0">/</span>dev<span class="sy0">/</span>st0 <span class="sy0">/</span>tmp<span class="sy0">/</span>empty
<span class="co0"># Rebobinne et éjecte</span>
mt rewoffl <span class="re5">-f</span> <span class="sy0">/</span>dev<span class="sy0">/</span>st0
<span class="kw2">rm</span> <span class="re5">-Rf</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>empty</pre>

</div>

<h4 id="effectue_une_sauvegarde">Effectue une sauvegarde</h4>
<div class="level4">
<pre class="code bash"><span class="co0">#!/bin/bash</span>
<span class="co0"># Usage : tapebak_backup &lt;name&gt;</span>
<span class="co0"># Exemple : tapebak_backup LU-MIDI</span>
&nbsp;
<span class="re2">BAK_NAME</span>=<span class="re4">$1</span>
<span class="re2">BAK_LABEL</span>=<span class="sy0">`/</span>opt<span class="sy0">/</span>tapebak<span class="sy0">/</span>bin<span class="sy0">/</span>tapebak_label<span class="sy0">`</span>
<span class="re2">PATH_ARCH</span>=<span class="sy0">/</span>opt<span class="sy0">/</span>tapebak<span class="sy0">/</span>archfiles
<span class="re2">PATH_LIST</span>=<span class="sy0">/</span>opt<span class="sy0">/</span>tapebak<span class="sy0">/</span>filelists
<span class="re2">LOG</span>=<span class="sy0">/</span>tmp<span class="sy0">/</span>tapebak_backup.log
&nbsp;
<span class="co0"># Initialise la log</span>
<span class="kw3">echo</span> <span class="st0">&quot;Backup <span class="es2">$BAK_NAME</span> - <span class="es5">`date +%F\ %X`</span>&quot;</span> <span class="sy0">&gt;</span> <span class="re1">$LOG</span>
<span class="kw3">echo</span> <span class="st0">&quot;&quot;</span> <span class="sy0">&gt;&gt;</span> <span class="re1">$LOG</span>
&nbsp;
<span class="co0"># Vérifie le label de la bande</span>
<span class="kw1">if</span> <span class="kw3">test</span> <span class="re1">$BAK_NAME</span> <span class="sy0">!</span>= <span class="re1">$BAK_LABEL</span>
<span class="kw1">then</span>
        <span class="co0"># Génère une erreur</span>
        <span class="re2">ERREUR</span>=<span class="st0">&quot;Mauvaise bande ! Attendue : <span class="es2">$BAK_NAME</span>, dans le lecteur : <span class="es2">$BAK_LABEL</span>&quot;</span>
        <span class="kw3">echo</span> <span class="re1">$ERREUR</span> <span class="sy0">&gt;&gt;</span> <span class="re1">$LOG</span>
        <span class="kw3">echo</span> <span class="st0">&quot;Opération annulée&quot;</span> <span class="sy0">&gt;&gt;</span> <span class="re1">$LOG</span>
<span class="kw1">else</span>
        <span class="co0"># Commence la génération de la liste</span>
        <span class="kw2">ls</span> <span class="re5">-AlhR</span> <span class="sy0">/</span>srv<span class="sy0">/</span>files<span class="sy0">/*</span> <span class="sy0">&gt;</span> <span class="re1">$PATH_LIST</span><span class="sy0">/</span><span class="re1">$BAK_NAME</span>.txt
        <span class="co0"># Dump le tout sur la bande</span>
        dump <span class="re5">-0</span> <span class="re5">-A</span> <span class="re1">$PATH_ARCH</span><span class="sy0">/</span><span class="re1">$BAK_NAME</span>.arc <span class="re5">-L</span> <span class="st0">&quot;<span class="es2">$BAK_NAME</span>&quot;</span> <span class="re5">-f</span> <span class="sy0">/</span>dev<span class="sy0">/</span>st0 <span class="sy0">/</span>srv<span class="sy0">/</span>on_tape <span class="sy0">&gt;&gt;</span> <span class="re1">$LOG</span>
        <span class="kw3">echo</span> <span class="st0">&quot;DONE (<span class="es5">`date +%X`</span>)&quot;</span> <span class="sy0">&gt;&gt;</span> <span class="re1">$LOG</span>
        <span class="kw3">echo</span> <span class="st0">&quot;&quot;</span> <span class="sy0">&gt;&gt;</span> <span class="re1">$LOG</span>
        <span class="co0"># Rebobinage et éjection</span>
        mt rewoffl <span class="re5">-f</span> <span class="sy0">/</span>dev<span class="sy0">/</span>st0
<span class="kw1">fi</span>
<span class="kw2">cat</span> <span class="re1">$LOG</span> <span class="sy0">|</span> mail <span class="re5">-s</span> Tapebak\ <span class="re1">$BAK_NAME</span> admin<span class="sy0">@</span>ub.untu.fr</pre>

</div>

<h4 id="restaure_une_bande_en_mode_interactif">Restaure une bande en mode interactif</h4>
<div class="level4">
<pre class="code bash"><span class="co0">#!/bin/bash</span>
<span class="co0"># Usage : tapebak_restore &lt;name&gt;</span>
<span class="co0"># Exemple : tapebak_restore LU-MIDI</span>
&nbsp;
<span class="re2">BAK_NAME</span>=<span class="re4">$1</span>
<span class="re2">BAK_LABEL</span>=<span class="sy0">`/</span>opt<span class="sy0">/</span>tapebak<span class="sy0">/</span>bin<span class="sy0">/</span>tapebak_label<span class="sy0">`</span>
<span class="re2">PATH_ARCH</span>=<span class="sy0">/</span>opt<span class="sy0">/</span>tapebak<span class="sy0">/</span>archfiles
<span class="re2">PATH_LIST</span>=<span class="sy0">/</span>opt<span class="sy0">/</span>tapebak<span class="sy0">/</span>filelists
&nbsp;
<span class="co0"># Vérifie le label de la bande</span>
<span class="kw1">if</span> <span class="kw3">test</span> <span class="re1">$BAK_NAME</span> <span class="sy0">!</span>= <span class="re1">$BAK_LABEL</span>
<span class="kw1">then</span>
        <span class="co0"># Génère une erreur</span>
        <span class="re2">ERREUR</span>=<span class="st0">&quot;Mauvaise bande ! Attendue : <span class="es2">$BAK_NAME</span>, dans le lecteur : <span class="es2">$BAK_LABEL</span>&quot;</span>
        <span class="kw3">echo</span> <span class="re1">$ERREUR</span>
        <span class="kw3">exit</span> <span class="re5">-1</span>
<span class="kw1">else</span>
        <span class="co0"># Lance le système de restauration interactif</span>
        restore <span class="re5">-i</span> <span class="re5">-A</span> <span class="re1">$PATH_ARCH</span><span class="sy0">/</span><span class="re1">$BAK_NAME</span>.arc <span class="re5">-f</span> <span class="sy0">/</span>dev<span class="sy0">/</span>st0
        mt rewind <span class="re5">-f</span> <span class="sy0">/</span>dev<span class="sy0">/</span>st0
        <span class="kw3">echo</span> <span class="st0">&quot;Restauration <span class="es2">$BAK_NAME</span> finie !&quot;</span> <span class="sy0">|</span> mail <span class="re5">-s</span> Tapebak admin<span class="sy0">@</span>ub.untu.fr
<span class="kw1">fi</span></pre>
<hr />

<p>
<em>Contributeur : <a href="/utilisateurs/ostaquet" class="wikilink2" title="utilisateurs:ostaquet" rel="nofollow">ostaquet</a>.</em>
</p>

</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit form-inline" method="post" action="/dump"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1484591314" /><input type="hidden" name="summary" value="[Les scripts utiles] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="les_scripts_utiles" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="7671-" /><button type="submit" title="Les scripts utiles" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="dump.txt">dump.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 16/01/2017, 19:28">Le 16/01/2017, 19:28</span></li><li class="text-muted">par L&#039;Africain</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=dump&amp;1635549151" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
