<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr"
  lang="fr" dir="ltr" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>ipxe [Wiki ubuntu-fr]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="/_media/favicon.ico" />
<link rel="apple-touch-icon" href="/lib/tpl/bootstrap3/images/apple-touch-icon.png" />
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="bionic"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/fonts/united.fonts.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/font-awesome/css/font-awesome.min.css"/>
<link type="text/css" rel="stylesheet" href="/lib/tpl/bootstrap3/assets/bootstrap/united/bootstrap.min.css"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Wiki ubuntu-fr"/>
<link rel="start" href="/"/>
<link rel="contents" href="/ipxe?do=index" title="Plan du site"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Catégorie courante" href="/feed.php?mode=list&amp;ns="/>
<link rel="edit" title="Modifier cette page" href="/ipxe?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="/_export/xhtml/ipxe"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="/_export/raw/ipxe"/>
<link rel="canonical" href="http://doc.ubuntu-fr.org/ipxe"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='';var JSINFO = {"bootstrap3":{"mode":"show","toc":[],"config":{"collapsibleSections":0,"fixedTopNavbar":1,"showSemanticPopup":0,"sidebarOnNavbar":0,"tagsOnTop":1,"tocAffix":1,"tocCollapseOnScroll":1,"tocCollapsed":0,"tocLayout":"default","useAnchorJS":1}},"id":"ipxe","namespace":"","ACT":"show","useHeadingNavigation":0,"useHeadingContent":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=b4a19b95bb4d08daf02b6dd52d7e6abc"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/anchorjs/anchor.min.js"></script>
<script type="text/javascript" src="/lib/tpl/bootstrap3/assets/typeahead/bootstrap3-typeahead.min.js"></script>
<!--<![endif]-->
<style type="text/css">@media screen { body { margin-top: 70px; }  #dw__toc.affix { top: 60px; position: fixed !important; }  #dw__toc .nav .nav .nav { display: none; } }</style>
    <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="united dokuwiki mode_show tpl_bootstrap3 dw-page-on-panel" data-page-id="ipxe">

  <header id="dokuwiki__header" class="dokuwiki container">
    <nav id="dw__navbar" class="navbar navbar-fixed-top navbar-default" role="navigation">

  <div class="container">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/accueil"  accesskey="h" title="[H]" class="navbar-brand"><span class="uf uf-cof" id="dw__accueil" style="font-size: 35px;" ></span> <span id="dw__title" style="margin-top:-5px">Wiki ubuntu-fr<span id="dw__tagline">La Documentation francophone</span></span></a>
    </div>

    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav">
        <li>
          <a href="//ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-home"></i><span> Accueil</span></a>        </li>
        <li>
          <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-comments"></i><span> Forum</span></a>        </li>
        <li>
          <a href="//planet.ubuntu-fr.org/" ><i class="fa fa-2x fa-fw fa-globe"></i><span> Planet</span></a>        </li>
      </ul>

            
      
      <div class="navbar-right" id="dw__navbar_items">

        <form action="//forum.ubuntu-fr.org/search_ubuntufr.php" accept-charset="utf-8" class="navbar-form navbar-left search" id="dw__search" method="get" role="search"><div class="no"><input id="qsearch" autocomplete="off" type="search" placeholder="Rechercher" accesskey="f" name="q" class="form-control" title="[F]" /><button type="submit" title="Rechercher"><i class="fa fa-fw fa-search"></i></button><input type="hidden" name="do" value="search" /><input type="hidden" name="tsearch" value="wiki" /></div></form>
        
<ul class="nav navbar-nav dw-action-icon" id="dw__tools">


  <li class="dropdown">

    <a href="" class="dropdown-toggle" data-target="#" data-toggle="dropdown" title="" role="button" aria-haspopup="true" aria-expanded="false">
      <i class="fa fa-2x fa-fw fa-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">Outils</span> <span class="caret"></span>
    </a>

    <ul class="dropdown-menu tools" role="menu">
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-cubes"></i> Outils du site      </li>
      <li><a href="/ipxe?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li><li><a href="/ipxe?do=media&amp;ns="  class="action media" rel="nofollow" title="Gestionnaire Multimédia">Gestionnaire Multimédia</a></li><li><a href="/ipxe?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
            <li class="divider" role="separator"></li>
      
    
      <li class="dropdown-header">
        <i class="fa fa-fw fa-file"></i> Outils de la page      </li>
      <li><a href="/ipxe?do=edit"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li><li><a href="/ipxe?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li><li><a href="/ipxe?do=backlink"  class="action backlink" rel="nofollow" title="Liens de retour">Liens de retour</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Haut de page [T]">Haut de page</a></li>
      
        </ul>
  </li>


</ul>


        <ul class="nav navbar-nav">

          
          
                    <li>
            <span class="dw__actions dw-action-icon">
              <a href="/ipxe?do=login&amp;sectok="  class="action btn btn-default navbar-btn login" rel="nofollow" title="S&#039;identifier"><span class="">S'identifier</span></a>            </span>
          </li>
          
        </ul>

        
        

      </div>

    </div>
  </div>
</nav>
  </header>

  <div id="dokuwiki__top" class="dokuwiki container">

    <div id="dokuwiki__pageheader">

      
      
      <p class="pageId text-right small">
        <span class="label label-primary">ipxe</span>      </p>

      <div id="dw__msgarea" class="small">
              </div>

    </div>

    <main class="main row" role="main">

      
      <article id="dokuwiki__content" class="container" itemscope itemtype="http://schema.org/Article" itemref="dw__license">

        
<nav id="dw__pagetools" class="hidden-print">
  <div class="tools panel panel-default pull-right ">
    <ul class="nav nav-stacked nav-pills">
      <li><a href="/ipxe?do=edit"  class="action text-muted edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]"><i class="fa fa-fw fa-pencil-square-o"></i><span class="sr-only"> Modifier cette page</span></a></li><li><a href="/ipxe?do=revisions"  class="action text-muted revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]"><i class="fa fa-fw fa-clock-o"></i><span class="sr-only"> </span></a></li><li><a href="/ipxe?do=backlink"  class="action text-muted backlink" rel="nofollow" title="Liens de retour"><i class="fa fa-fw fa-link"></i><span class="sr-only"> Liens de retour</span></a></li>    </ul>
  </div>
</nav>

        <div class="panel panel-default" itemprop="articleBody">
          <div class="page panel-body">

            <div class="dw-content-page "><div class="dw-toc hidden-print"><script>JSINFO.bootstrap3.toc = [{"link":"#installer_et_lancer_les_serveurs_necessaires","title":"Installer et lancer les serveurs n\u00e9cessaires","level":1},{"link":"#serveur_dhcp","title":"Serveur DHCP","level":2},{"link":"#serveur_tftp","title":"Serveur TFTP","level":2},{"link":"#serveur_nfs","title":"Serveur NFS","level":2},{"link":"#serveur_lamp_basique","title":"Serveur LAMP basique","level":2},{"link":"#preparer_les_fichiers_de_demarrage_ipxe","title":"Pr\u00e9parer les fichiers de d\u00e9marrage iPXE","level":1},{"link":"#creer_le_menu_de_ipxe","title":"Cr\u00e9er le menu de iPXE","level":1},{"link":"#tester_le_fonctionnement","title":"Tester le fonctionnement","level":1},{"link":"#completer_le_menu_ipxe","title":"Compl\u00e9ter le menu ipxe","level":1},{"link":"#savoir_decompresser_une_iso","title":"Savoir d\u00e9compresser une ISO","level":2},{"link":"#demarrer_une_installation_linux_casper","title":"D\u00e9marrer une installation Linux (casper)","level":2},{"link":"#demarrer_windows","title":"D\u00e9marrer Windows","level":2},{"link":"#demarrer_les_petites_iso","title":"D\u00e9marrer les petites ISO","level":2},{"link":"#demarrer_une_installation_de_mac_os","title":"D\u00e9marrer une installation de MAC OS","level":2},{"link":"#astuces","title":"Astuces","level":1},{"link":"#si_cela_ne_fonctionne_pas","title":"Si cela ne fonctionne pas","level":2},{"link":"#creer_une_cle_usb_d_ipxe","title":"Cr\u00e9er une cl\u00e9 USB d'iPXE","level":2},{"link":"#gagner_de_la_place","title":"Gagner de la place","level":2},{"link":"#bugs_connus","title":"Bugs connus","level":2},{"link":"#voir_aussi","title":"Voir aussi","level":1}];</script>
<!-- TOC START -->
<nav id="dw__toc" role="navigation" class="toc-panel panel panel-default small">
<h6 data-toggle="collapse" data-target="#dw__toc .toc-body" title="Table des matières" class="panel-heading toc-title"><i class="fa fa-fw fa-th-list"></i> <span>Table des matières</span> <i class="caret"></i></h6>
<div class="panel-body  toc-body collapse in">

<ul class="nav toc">
<li class="level1"><a href="#installer_et_lancer_les_serveurs_necessaires">Installer et lancer les serveurs nécessaires</a>
<ul class="nav toc">
<li class="level2"><a href="#serveur_dhcp">Serveur DHCP</a></li>
<li class="level2"><a href="#serveur_tftp">Serveur TFTP</a></li>
<li class="level2"><a href="#serveur_nfs">Serveur NFS</a></li>
<li class="level2"><a href="#serveur_lamp_basique">Serveur LAMP basique</a></li>
</ul>
</li>
<li class="level1"><a href="#preparer_les_fichiers_de_demarrage_ipxe">Préparer les fichiers de démarrage iPXE</a></li>
<li class="level1"><a href="#creer_le_menu_de_ipxe">Créer le menu de iPXE</a></li>
<li class="level1"><a href="#tester_le_fonctionnement">Tester le fonctionnement</a></li>
<li class="level1"><a href="#completer_le_menu_ipxe">Compléter le menu ipxe</a>
<ul class="nav toc">
<li class="level2"><a href="#savoir_decompresser_une_iso">Savoir décompresser une ISO</a></li>
<li class="level2"><a href="#demarrer_une_installation_linux_casper">Démarrer une installation Linux (casper)</a></li>
<li class="level2"><a href="#demarrer_windows">Démarrer Windows</a></li>
<li class="level2"><a href="#demarrer_les_petites_iso">Démarrer les petites ISO</a></li>
<li class="level2"><a href="#demarrer_une_installation_de_mac_os">Démarrer une installation de MAC OS</a></li>
</ul>
</li>
<li class="level1"><a href="#astuces">Astuces</a>
<ul class="nav toc">
<li class="level2"><a href="#si_cela_ne_fonctionne_pas">Si cela ne fonctionne pas</a></li>
<li class="level2"><a href="#creer_une_cle_usb_d_ipxe">Créer une clé USB d&#039;iPXE</a></li>
<li class="level2"><a href="#gagner_de_la_place">Gagner de la place</a></li>
<li class="level2"><a href="#bugs_connus">Bugs connus</a></li>
</ul>
</li>
<li class="level1"><a href="#voir_aussi">Voir aussi</a></li>
</ul>

</div>
</nav>
<!-- TOC END -->
</div><!-- CONTENT --><div class="dw-content"><div class="tags"><span>
	<a href="/bionic" class="wikilink1" title="bionic" rel="tag">Bionic</a>
</span></div>

<h1 class="sectionedit1 page-header" id="ipxeutilisation_avec_tftp_pxe_dhcp_nfs_et_http">IPXE : utilisation avec TFTP, PXE, DHCP, NFS et HTTP</h1>
<div class="level1">

<p>
iPXE permet de mettre en place un système de démarrage PXE (réseau) afin de lancer des systèmes d’exploitation, des ISOs d’utilitaires ou des programmes d’installation. iPXE est compatible <abbr title="Basic Input-Output System">BIOS</abbr> et EFI. Le système hôte utilisé pour l’élaboration de cette documentation est Ubuntu Server 18.04.
</p>

<p>
L&#039;avantage de iPXE est qu&#039;il s&#039;adapte facilement aux interfaces <abbr title="Basic Input-Output System">BIOS</abbr> et EFI.
</p>

<p>
Il existe d’autres méthodes comme par exemple : <a href="/netboot" class="wikilink1" title="netboot">netboot</a> ou <a href="/netboot_live" class="wikilink1" title="netboot_live">netboot_live</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[IPXE : utilisation avec TFTP, PXE, DHCP, NFS et HTTP] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="ipxeutilisation_avec_tftp_pxe_dhcp_nfs_et_http" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="17-560" /><button type="submit" title="IPXE : utilisation avec TFTP, PXE, DHCP, NFS et HTTP" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit2 page-header" id="installer_et_lancer_les_serveurs_necessaires">Installer et lancer les serveurs nécessaires</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Installer et lancer les serveurs nécessaires] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="installer_et_lancer_les_serveurs_necessaires" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="561-619" /><button type="submit" title="Installer et lancer les serveurs nécessaires" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit3" id="serveur_dhcp">Serveur DHCP</h3>
<div class="level3">

<p>
Installation du serveur <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> sur le serveur.
</p>
<div class="noteimportant">Un serveur doit avoir une adresse ip fixe ! Ici, le serveur dispose de l’ip 10.0.0.200. Voir : <a href="/utilisateurs/ool/netplan" class="wikilink1" title="utilisateurs:ool:netplan">netplan</a>

</div><pre class="code">sudo apt update &amp;&amp; sudo apt install  isc-dhcp-server
sudo nano etc/dhcp/dhcpd.conf</pre>
<dl class="file">
<dt><a href="/_export/code/ipxe?codeblock=1" title="Télécharger cet extrait" class="mediafile mf_conf">/etc/dhcp/dhcpd.conf</a></dt>
<dd><pre class="file">default-lease-time 7200;
max-lease-time 7200;

allow unknown-clients;
#authoritative;
option subnet-mask 255.255.255.0;

###PXE###
option space PXE;
option PXE.mtftp-ip code 1 = ip-address;
option PXE.mtftp-cport code 2 = unsigned integer 16;
option PXE.mtftp-sport code 3 = unsigned integer 16;
option PXE.mtftp-tmout code 4 = unsigned integer 8;
option PXE.mtftp-delay code 5 = unsigned integer 8;
option arch code 93 = unsigned integer 16;

option space ipxe;
option ipxe-encap-opts code 175 = encapsulate ipxe;
option ipxe.priority code 1 = signed integer 8;
option ipxe.keep-san code 8 = unsigned integer 8;
option ipxe.skip-san-boot code 9 = unsigned integer 8;
option ipxe.syslogs code 85 = string;
option ipxe.cert code 91 = string;
option ipxe.privkey code 92 = string;
option ipxe.crosscert code 93 = string;
option ipxe.no-pxedhcp code 176 = unsigned integer 8;
option ipxe.bus-id code 177 = string;
option ipxe.san-filename code 188 = string;
option ipxe.bios-drive code 189 = unsigned integer 8;
option ipxe.username code 190 = string;
option ipxe.password code 191 = string;
option ipxe.reverse-username code 192 = string;
option ipxe.reverse-password code 193 = string;
option ipxe.version code 235 = string;
option iscsi-initiator-iqn code 203 = string;
# Feature indicators
option ipxe.pxeext code 16 = unsigned integer 8;
option ipxe.iscsi code 17 = unsigned integer 8;
option ipxe.aoe code 18 = unsigned integer 8;
option ipxe.http code 19 = unsigned integer 8;
option ipxe.https code 20 = unsigned integer 8;
option ipxe.tftp code 21 = unsigned integer 8;
option ipxe.ftp code 22 = unsigned integer 8;
option ipxe.dns code 23 = unsigned integer 8;
option ipxe.bzimage code 24 = unsigned integer 8;
option ipxe.multiboot code 25 = unsigned integer 8;
option ipxe.slam code 26 = unsigned integer 8;
option ipxe.srp code 27 = unsigned integer 8;
option ipxe.nbi code 32 = unsigned integer 8;
option ipxe.pxe code 33 = unsigned integer 8;
option ipxe.elf code 34 = unsigned integer 8;
option ipxe.comboot code 35 = unsigned integer 8;
option ipxe.efi code 36 = unsigned integer 8;
option ipxe.fcoe code 37 = unsigned integer 8;
option ipxe.vlan code 38 = unsigned integer 8;
option ipxe.menu code 39 = unsigned integer 8;
option ipxe.sdi code 40 = unsigned integer 8;
option ipxe.nfs code 41 = unsigned integer 8;

###RESEAUX###
subnet 10.0.0.0 netmask 255.255.255.0 {
        option broadcast-address 10.0.0.255;
        option routers 10.0.0.1;
        option domain-name-servers 8.8.8.8, 1.1.1.1;
        range 10.0.0.100 10.0.0.199;
        ping-check = 1;
        next-server 10.0.0.200;
#      PXE
        if option arch = 00:07 or option arch = 00:09 {
                if exists user-class and option user-class = &quot;iPXE&quot; {
                        filename &quot;http://10.0.0.200/install.ipxe&quot;;
                } else {
                        filename &quot;ipxe/ipxe.efi&quot;;
                }
        } else if option arch = 00:06 {
                if exists user-class and option user-class = &quot;iPXE&quot; {
                        filename &quot;http://10.0.0.200/install.ipxe&quot;;
                } else {
                        filename &quot;ipxe/ipxe32.efi&quot;;
                }
        } else {
         	if exists user-class and option user-class = &quot;iPXE&quot; {
                        filename &quot;http://10.0.0.200/install.ipxe&quot;;
                } else {
                        filename &quot;undionly.kpxe&quot;;
                }
        } 
}</pre>
</dd></dl>
<div class="notetip">Dans la configuration ci-dessous le réseau est configuré en 10.0.0.0/24, libre a vous de l’adapter à votre réseau actuel.

</div>
<p>
Les premières « option » permettent à isc-dhcp-server de comprendre des options <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> spécifique à ipxe.
Cela sera plus compréhensible plus tard, mais les « if » en fin de document permettent de distribuer le bon fichier en fonction du client PXE (Bios, EFI)
Pour plus d’info sur la configuration : <a href="/isc-dhcp-server" class="wikilink1" title="isc-dhcp-server">isc-dhcp-server</a>
</p>
<pre class="code">sudo service isc-dhcp-server restart</pre>
<div class="noteimportant">Avoir deux serveurs <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> sur le même réseau est souvent synonyme de conflits. Il est préférable de désactiver tous les autres serveurs <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> (de votre box ou routeur par exemple). Dans ce cas, il faut décommenter la ligne &quot;authoritative;&quot; en dessous allow unknown-clients.
<p>
Dans le cas où il n&#039;est pas possible de désactiver les autres serveur <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>, à minima, il faut régler le paramètre &quot;range&quot; sur une autre plage que celle de votre autre serveur <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>.
</p>

<p>
Une autre méthode consiste à amorcer iPXE à l&#039;aide d&#039;une clé <abbr title="Universal Serial Bus">USB</abbr> : <a href="/ipxe#creer_une_cle_usb_d_ipxe" class="wikilink1 curid" title="ipxe" data-curid="true">Créer une clé USB d&#039;iPXE</a>
</p>

</div>
</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Serveur DHCP] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="serveur_dhcp" /><input type="hidden" name="codeblockOffset" value="0" /><input type="hidden" name="range" value="620-5593" /><button type="submit" title="Serveur DHCP" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit4" id="serveur_tftp">Serveur TFTP</h3>
<div class="level3">

<p>
Le serveur TFTP est celui qui va fournir les fichiers nécessaires au démarrage réseau.
</p>
<pre class="code">sudo apt install tftpd-hpa
sudo nano /etc/default/tftpd-hpa</pre>
<dl class="file">
<dt><a href="/_export/code/ipxe?codeblock=4" title="Télécharger cet extrait" class="mediafile mf_">/etc/default/tftpd-hpa</a></dt>
<dd><pre class="file"># /etc/default/tftpd-hpa

TFTP_USERNAME=&quot;tftp&quot;
TFTP_DIRECTORY=&quot;/var/lib/tftpboot&quot;
TFTP_ADDRESS=&quot;10.0.0.200:69&quot;
TFTP_OPTIONS=&quot;--secure&quot;
RUN_DAEMON=&quot;yes&quot;</pre>
</dd></dl>

<p>
Ensuite, redémarrer le service :
</p>
<pre class="code"> sudo service tftpd-hpa restart</pre>
<div class="notetip">Si un pare-feu est activé, ouvrir le port 69

</div>
</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Serveur TFTP] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="serveur_tftp" /><input type="hidden" name="codeblockOffset" value="3" /><input type="hidden" name="range" value="5594-6122" /><button type="submit" title="Serveur TFTP" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit5" id="serveur_nfs">Serveur NFS</h3>
<div class="level3">

<p>
Le serveur <abbr title="Network File System">NFS</abbr> sera nécessaire dans certains cas, il permet de laisser à disposition des fichiers au système démarré.
</p>
<pre class="code">sudo apt install nfs-kernel-server</pre>
<div class="notetip">Si un pare-feu est activé, consultez cette page : <a href="/nfs-ufw" class="wikilink1" title="nfs-ufw">Fixer les ports pour un partage NFS</a>

</div>
</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Serveur NFS] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="serveur_nfs" /><input type="hidden" name="codeblockOffset" value="6" /><input type="hidden" name="range" value="6123-6437" /><button type="submit" title="Serveur NFS" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit6" id="serveur_lamp_basique">Serveur LAMP basique</h3>
<div class="level3">

<p>
Pour fonctionner, iPXE à besoin d’un serveur HTTP.
</p>
<pre class="code">sudo apt install apache2 php libapache2-mod-php php-mysql php-curl php-gd php-intl php-json php-mbstring php-xml php-zip</pre>

<p>
Pour plus d&#039;infos : <a href="https://doc.ubuntu-fr.org/lamp" class="urlextern" title="https://doc.ubuntu-fr.org/lamp" rel="nofollow">https://doc.ubuntu-fr.org/lamp</a>
</p>

<p>
On créer un lien symbolique de tftpboot sur le serveur LAMP :
</p>
<pre class="code">ln -s /var/lib/tftpboot /var/www/html/tftpboot</pre>

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Serveur LAMP basique] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="serveur_lamp_basique" /><input type="hidden" name="codeblockOffset" value="7" /><input type="hidden" name="range" value="6438-6837" /><button type="submit" title="Serveur LAMP basique" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit7 page-header" id="preparer_les_fichiers_de_demarrage_ipxe">Préparer les fichiers de démarrage iPXE</h2>
<div class="level2">

<p>
Ces fichiers sont téléchargeables sur le site officiel de ipxe.
</p>
<pre class="code">cd /var/lib/tftpboot
wget http://boot.ipxe.org/undionly.kpxe
wget http://boot.ipxe.org/ipxe.efi</pre>
<div class="notetip">Ici, le lien vers le serveur HTTP est effectué par le serveur <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>.
Il existe une autre méthode consistant à compiler manuellement pour simplifier le travail du serveur <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> (le lien vers le serveur HTTP est intégré au fichier).
<pre class="code">cd /tmp
git clone git://git.ipxe.org/ipxe.git
cd /tmp/ipxe/src
nano /tmp/ipxe/src/chain.ipxe</pre>
<dl class="file">
<dt><a href="/_export/code/ipxe?codeblock=11" title="Télécharger cet extrait" class="mediafile mf_ipxe">/tmp/ipxe/src/chain.ipxe</a></dt>
<dd><pre class="file">#!ipxe

dhcp
chain http://10.0.0.200/install.ipxe </pre>
</dd></dl>
<pre class="code">cd /tmp/ipxe/src
make bin-x86_64-efi/ipxe.efi EMBED=chain.ipxe
make bin-i386-efi/ipxe.efi EMBED=chain.ipxe
make undionly.kpxe EMBED=chain.ipxe

cp bin-x86_64-efi/ipxe.efi undionly.kpxe /var/lib/tftpboot/
cp bin-i386-efi/ipxe.efi /var/lib/tftpboot/ipxe32.efi</pre>

<p>
La construction nécessite les paquets suivants : <a href="apt://gcc" class="interwiki iw_apt" title="apt://gcc">gcc</a> <a href="apt://binutils" class="interwiki iw_apt" title="apt://binutils">binutils</a> <a href="apt://liblzma-dev" class="interwiki iw_apt" title="apt://liblzma-dev">liblzma-dev</a>
</p>

</div>
</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Préparer les fichiers de démarrage iPXE] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="preparer_les_fichiers_de_demarrage_ipxe" /><input type="hidden" name="codeblockOffset" value="9" /><input type="hidden" name="range" value="6838-7896" /><button type="submit" title="Préparer les fichiers de démarrage iPXE" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit8 page-header" id="creer_le_menu_de_ipxe">Créer le menu de iPXE</h2>
<div class="level2">

<p>
Le menu de iPXE doit être situé sur le serveur web. Le fichier install.ipxe doit selon le reste du tutoriel être situé à la racine du serveur <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>. Dans le cas contraire, il faut adapter la configuration de <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> ou le fichier chain.ipxe lors de la compilation.
</p>
<pre class="code">sudo nano /var/www/html/install.ipxe</pre>
<dl class="file">
<dt><a href="/_export/code/ipxe?codeblock=14" title="Télécharger cet extrait" class="mediafile mf_ipxe">/var/www/html/install.ipxe</a></dt>
<dd><pre class="file">#!ipxe

set menu-timeout 9000000
set submenu-timeout ${menu-timeout}
isset ${menu-default} || set menu-default item3
set server_ip 10.0.0.200

menu
item --gap --           -------------SÉPARATION 1----------------
item item1            	Item 1
item --gap --           -------------SÉPARATION 2----------------
item item2      	Item 2
item item3		Item 3
item shell              Shell iPXE
item exit              	Exit

choose --timeout ${menu-timeout} --default ${menu-default} target &amp;&amp; goto ${target}

:item1
#Paramètres de démarrage pour item 1

:item2
#Paramètres de démarrage pour item 2

:item3
#Paramètres de démarrage pour item 3

:shell
shell

:exit
exit</pre>
</dd></dl>
<div class="notetip">Ce menu ne sert à rien dans l’état, il est à compléter en fonction de ce que l’on a démarrer. Voir sur le chapitre <a href="/ipxe#completer_le_menu_ipxe" class="wikilink1 curid" title="ipxe" data-curid="true">Compléter le menu iPXE</a>

</div>
</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Créer le menu de iPXE] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="creer_le_menu_de_ipxe" /><input type="hidden" name="codeblockOffset" value="13" /><input type="hidden" name="range" value="7897-9166" /><button type="submit" title="Créer le menu de iPXE" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit9 page-header" id="tester_le_fonctionnement">Tester le fonctionnement</h2>
<div class="level2">

<p>
Utiliser un ordinateur ou une machine virtuelle pour tenter un démarrage PXE. Pour cela, il faut changer l&#039;ordre de boot dans le bios/uefi de votre machine pour sélectionner &quot;PXE&quot; ou &quot;réseau&quot;.
</p>

<p>
Plus d&#039;infos : <a href="/tutoriel/modifier_ordre_amorcage_du_bios#etapes_a_suivre_pour_modifier_l_ordre_d_amorcage_du_bios" class="wikilink1" title="tutoriel:modifier_ordre_amorcage_du_bios">Modifier l&#039;ordre d&#039;amorçage du BIOS</a>
</p>
<div class="notetip">Si cela ne fonctionne pas dans une machine virtuelle, tentez quand même sur un ordinateur physique. Sur les machines virtuelles, cela a parfois tendance à être capricieux !
Par exemple pour un test via VirtualBox, il faut impérativement installer les extensions packs pour ne pas avoir d&#039;erreur sur les fichier gz (utilisé pour lancer les kernel linux notamment)
Dans les paramètres VirtualBox, ajouter l&#039;extension pack correspondant à votre version. Voir cette page pour le télécharger : <a href="https://www.virtualbox.org/wiki/Download_Old_Builds" class="urlextern" title="https://www.virtualbox.org/wiki/Download_Old_Builds" rel="nofollow">https://www.virtualbox.org/wiki/Download_Old_Builds</a>

</div>
</div>
<div class='secedit editbutton_section editbutton_9'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Tester le fonctionnement] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="tester_le_fonctionnement" /><input type="hidden" name="codeblockOffset" value="15" /><input type="hidden" name="range" value="9167-10125" /><button type="submit" title="Tester le fonctionnement" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit10 page-header" id="completer_le_menu_ipxe">Compléter le menu ipxe</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_10'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Compléter le menu ipxe] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="completer_le_menu_ipxe" /><input type="hidden" name="codeblockOffset" value="15" /><input type="hidden" name="range" value="10126-10162" /><button type="submit" title="Compléter le menu ipxe" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit11" id="savoir_decompresser_une_iso">Savoir décompresser une ISO</h3>
<div class="level3">

<p>
Souvent, il sera nécessaire d&#039;extraire le contenu d&#039;une ISO pour le mettre sur le serveur TFTP/HTTP.
</p>
<pre class="code">sudo mount -o loop /chemin/vers/un_systeme.iso /mnt
sudo mkdir /var/lib/tftpboot/un_systeme
sudo cp -r /mnt/* /var/lib/tftpboot/un_systeme
sudo umount /mnt</pre>

<p>
Il faudra rétablir les bons droits :
</p>
<pre class="code">sudo chown -R root:root /var/lib/tftpboot
sudo chmod 755 /var/lib/tftpboot</pre>

<p>
Parce qu&#039;il est parfois plus simple d&#039;appeler les fichiers via http, nous allons créer un lien symbolique pour ne pas avoir à faire doublon et qu&#039;ils soient accessible via les deux protocoles.
</p>
<pre class="code">sudo ln -s /var/lib/tftpboot /var/www/html/tftpboot</pre>
<div class="noteimportant">Pour la suite du tutoriel, il faudra toujours vérifier que tous les chemins d&#039;accès aux différents fichiers correspondent à ce que vous avez fait. Les fichiers de configurations doivent être adapté à votre situation ! (Penser à respecter la casse minuscule/majuscule…)

</div>
</div>
<div class='secedit editbutton_section editbutton_11'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Savoir décompresser une ISO] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="savoir_decompresser_une_iso" /><input type="hidden" name="codeblockOffset" value="15" /><input type="hidden" name="range" value="10163-11168" /><button type="submit" title="Savoir décompresser une ISO" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit12" id="demarrer_une_installation_linux_casper">Démarrer une installation Linux (casper)</h3>
<div class="level3">

<p>
Après avoir décompressé sur le serveur tftp un <em class="u">Live CD</em> d&#039;installation d&#039;un Linux, il faudra ajouter au menu :
</p>
<dl class="file">
<dt><a href="/_export/code/ipxe?codeblock=18" title="Télécharger cet extrait" class="mediafile mf_ipxe">/var/www/html/install.ipxe</a></dt>
<dd><pre class="file">item ubuntuinstall      Ubuntu Install

# Plus bas...

:ubuntuinstall
kernel http://${server_ip}/tftpboot/ubuntuinstall/casper/vmlinuz
initrd http://${server_ip}/tftpboot/ubuntuinstall/casper/initrd
imgargs vmlinuz initrd=initrd root=/dev/nfs boot=casper netboot=nfs nfsroot=${server_ip}:/var/lib/tftpboot/ubuntuinstall ip=dhcp --
boot</pre>
</dd></dl>
<div class="notetip">Il convient évidemment d&#039;adapter les paramètres à sa situation. Les fichiers vmlinuz et initrd étant parfois accompagnés d&#039;une extensions comme .gz, il faudra l&#039;ajouter. 

</div>
<p>
Il faudra ensuite autoriser le partage dans le fichier de configuration de <abbr title="Network File System">NFS</abbr> :
</p>
<pre class="code">sudo echo &quot;/var/lib/tftpboot/ubuntuinstall *(async,no_root_squash,no_subtree_check,ro) /etc/exports&quot; &gt;&gt; /etc/exports
sudo service nfs-kernel-server restart</pre>

</div>
<div class='secedit editbutton_section editbutton_12'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Démarrer une installation Linux (casper)] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="demarrer_une_installation_linux_casper" /><input type="hidden" name="codeblockOffset" value="18" /><input type="hidden" name="range" value="11169-12164" /><button type="submit" title="Démarrer une installation Linux (casper)" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit13" id="demarrer_windows">Démarrer Windows</h3>
<div class="level3">

<p>
Pour Windows, la méthode consiste a démarrer un Windows PE, puis, ci-besoin lancer une installation depuis un serveur samba. Il sera utilisé wimboot.
</p>

</div>

<h4 id="obtenir_wimboot">Obtenir wimboot</h4>
<div class="level4">
<pre class="code">cd /tmp
wget git.ipxe.org/releases/wimboot/wimboot-latest.zip
unzip wimboot-latest.zip
cp wimboot*/wimboot /var/lib/tftpboot</pre>

</div>

<h4 id="creer_un_windows_pe">Créer un Windows PE</h4>
<div class="level4">

</div>

<h5 id="sous_linux">Sous Linux</h5>
<div class="level5">
<pre class="code">cd /tmp
wget https://download.microsoft.com/download/4/6/C/46C337E7-336A-4199-9117-4D15D6BEC67B/KB3AIK_FR.iso
mount -o loop KB3AIK_FR.iso /mnt
mkwinpeimg --iso --arch=[amd64|x86] --waik-dir=/mnt /var/lib/tftpboot/winpe.iso
umount /mnt</pre>

</div>

<h5 id="sous_windows">Sous Windows</h5>
<div class="level5">

<p>
Pré-requis : Télécharger et installer Windows ADK <a href="https://docs.microsoft.com/fr-fr/windows-hardware/get-started/adk-install#winADK" class="urlextern" title="https://docs.microsoft.com/fr-fr/windows-hardware/get-started/adk-install#winADK" rel="nofollow">WinADK</a>
</p>
<div class="noteimportant">Désactiver votre programme antivirus lors de la manipulation des images.

</div>
<p>
Dans le menu démarrer taper : &quot;Environnement de déploiement et d’outils de création d’images&quot; et l&#039;ouvrir en tant qu&#039;administrateur.
</p>

<p>
Copier WinPE 
</p>
<pre class="code">copype amd64 C:\WinPE_am64</pre>

<p>
Monter l&#039;image de démarrage :
</p>
<pre class="code">Dism /Mount-Image /ImageFile:&quot;C:\WinPE_amd64\media\sources\boot.wim&quot; /index:1 /MountDir:&quot;C:\WinPE_amd64\mount&quot;</pre>
<div class="notetip">Il est possible a ce stade de rajouter des fichiers/dossier dans C:\WinPE_amd64\mount
<p>
Il est aussi possible de modifier le script de démarrage (pour lancer des commandes automatiquement au démarrage) :
Exemple :
</p>
<dl class="file">
<dt><a href="/_export/code/ipxe?codeblock=24" title="Télécharger cet extrait" class="mediafile mf_cmd">C:\WinPE_amd64\mount\Windows\System32\Startnet.cmd</a></dt>
<dd><pre class="file">wpeinit
net use Y: \\10.0.0.200\win10_1809_custom_x64 /user:user pass
Y:\setup.exe</pre>
</dd></dl>

</div>
<p>
<em class="u">Pour ajouter des pilotes de périphériques (.inf) : </em>
</p>

<p>
Un seul à la fois :
</p>
<pre class="code">Dism /Add-Driver /Image:&quot;C:\WinPE_amd64\mount&quot; /Driver:&quot;C:\SampleDriver\driver.inf&quot;</pre>

<p>
Tout un dossier de .inf (il peut être nécessaire d&#039;utiliser /ForceUnsigned pour ajouter des pilotes non signés)
</p>
<pre class="code">Dism /Add-Driver /Image:&quot;C:\WinPE_amd64\mount&quot; /Driver:&quot;C:\SampleDriver&quot; /Recurse</pre>

<p>
Vérification :
</p>
<pre class="code">Dism /Image:&quot;C:\WinPE_amd64\mount&quot; /Get-Drivers	</pre>
<div class="notetip">D&#039;autres manipulations et modifications sont possibles : <a href="https://msdn.microsoft.com/fr-fr/library/windows/hardware/dn938390(v=vs.85).aspx" class="urlextern" title="https://msdn.microsoft.com/fr-fr/library/windows/hardware/dn938390(v=vs.85).aspx" rel="nofollow">WinPE : Monter et personnaliser</a>

</div>
<p>
Quand toutes les modifications sont terminées, il faut démonter l&#039;image :
</p>
<pre class="code">Dism /Unmount-Image /MountDir:&quot;C:\WinPE_amd64\mount&quot; /commit</pre>

<p>
Création d&#039;un image ISO :
</p>
<pre class="code">Makewinpemedia /iso C:\winpe_amd64 C:\winpe_amd64.iso</pre>

</div>

<h4 id="configuration_du_menu">Configuration du menu</h4>
<div class="level4">

<p>
Après avoir extrait l&#039;iso dans un dossier comme expliqué plus haut, les paramètres sont les suivants :
</p>
<dl class="file">
<dt><a href="/_export/code/ipxe?codeblock=30" title="Télécharger cet extrait" class="mediafile mf_ipxe">/var/www/html/install.ipxe</a></dt>
<dd><pre class="file">item winpe            Windows PE

# Plus bas....


:winpe
kernel http://${server_ip}/tftpboot/wimboot
initrd http://${server_ip}/tftpboot/winpe/Boot/BCD         BCD
initrd http://${server_ip}/tftpboot/winpe/Boot/boot.sdi    boot.sdi
initrd http://${server_ip}/tftpboot/winpe/sources/boot.wim boot.wim
boot</pre>
</dd></dl>

</div>

<h4 id="lancer_windows_pe">Lancer Windows PE</h4>
<div class="level4">

<p>
Préalablement, il faudra extraire une ISO de Windows PE comme expliqué plus haut.
</p>

</div>

<h4 id="lancer_une_installation_de_windows">Lancer une installation de Windows</h4>
<div class="level4">

</div>

<h5 id="installer_et_lancer_le_serveur_samba">Installer et lancer le serveur samba</h5>
<div class="level5">

<p>
Pour lancer des installations, un serveur samba sera nécessaire.
</p>
<pre class="code">sudo apt-get install samba samba-common-bin
sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.save # Par sécurité
sudo nano /etc/samba/smb.conf</pre>

<p>
Ajouter à la fin du fichier :
</p>
<dl class="file">
<dt><a href="/_export/code/ipxe?codeblock=32" title="Télécharger cet extrait" class="mediafile mf_conf">/etc/samba/smb.conf</a></dt>
<dd><pre class="file">[win10]
path = /var/lib/tftpboot/win10
browseable = no
writable = no
guest ok = yes
create mask = 0775
directory mask = 0775</pre>
</dd></dl>

</div>

<h5 id="lancer_setupexe">Lancer setup.exe</h5>
<div class="level5">

<p>
Une fois Windows PE de démarrer, saisir dans l&#039;invite de commande cmd : (win10 représente ce qu&#039;il y a entre parenthèses dans le fichier de configuration de samba)
</p>
<pre class="code">net use Y: \\10.0.0.200\win10 /user:user pass
Y:\setup.exe</pre>
<div class="notetip">Même si le répertoire samba est accessible anonymement (guest ok = yes), il faut parfois saisir un utilisateur et un mot de passe bidon pour que la connexion fonctionne.

</div><div class="noteclassic">Pour les deux solutions, il est possible d&#039;automatiser ces commandes en modifiant le fichier %windir%\System32\startnet.cmd lors de la création du Windows PE. Exemple :
<dl class="file">
<dt><a href="/_export/code/ipxe?codeblock=34" title="Télécharger cet extrait" class="mediafile mf_cmd">%windir%/System32/startnet.cmd</a></dt>
<dd><pre class="file">wpeinit
net use Y: \\10.0.0.200\win10 /user:user pass
Y:\setup.exe</pre>
</dd></dl>

<p>
Si ce n&#039;est pas automatiser, un seul Windows PE est suffisant pour plusieurs versions de Windows (7/8/10… x64/x86…). Il suffit de créer plusieurs partages samba.
</p>

</div>
</div>
<div class='secedit editbutton_section editbutton_13'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Démarrer Windows] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="demarrer_windows" /><input type="hidden" name="codeblockOffset" value="20" /><input type="hidden" name="range" value="12165-16759" /><button type="submit" title="Démarrer Windows" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit14" id="demarrer_les_petites_iso">Démarrer les petites ISO</h3>
<div class="level3">

<p>
Pour démarrer des petites ISO, nous allons utiliser sanboot pour sa simplicité.
</p>
<div class="noteimportant">Les démarrage via sanboot oblige l&#039;ordinateur client de télécharger complétement l&#039;ISO pour pouvoir l&#039;utiliser. C&#039;est pourquoi il faut éviter cette méthode et la réserver à des petits utilitaires comme <a href="https://www.memtest86.com/" class="urlextern" title="https://www.memtest86.com/" rel="nofollow">memtest86</a> ou <a href="https://gparted.org/" class="urlextern" title="https://gparted.org/" rel="nofollow">gparted</a> par exemple.

</div><dl class="file">
<dt><a href="/_export/code/ipxe?codeblock=35" title="Télécharger cet extrait" class="mediafile mf_ipxe">/var/www/html/install.ipxe</a></dt>
<dd><pre class="file">item memtest86        Memtest86 7.4

# Plus bas...

:memtest86
sanboot http://${server_ip}/tftpboot/Memtest86-7.4.iso</pre>
</dd></dl>

</div>
<div class='secedit editbutton_section editbutton_14'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Démarrer les petites ISO] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="demarrer_les_petites_iso" /><input type="hidden" name="codeblockOffset" value="35" /><input type="hidden" name="range" value="16760-17366" /><button type="submit" title="Démarrer les petites ISO" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit15" id="demarrer_une_installation_de_mac_os">Démarrer une installation de MAC OS</h3>
<div class="level3">

<p>
Un projet github propose une solution : <a href="https://github.com/mybesttools/macos-netboot-ipxe" class="urlextern" title="https://github.com/mybesttools/macos-netboot-ipxe" rel="nofollow">https://github.com/mybesttools/macos-netboot-ipxe</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_15'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Démarrer une installation de MAC OS] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="demarrer_une_installation_de_mac_os" /><input type="hidden" name="codeblockOffset" value="36" /><input type="hidden" name="range" value="17367-17510" /><button type="submit" title="Démarrer une installation de MAC OS" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit16 page-header" id="astuces">Astuces</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_16'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Astuces] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="astuces" /><input type="hidden" name="codeblockOffset" value="36" /><input type="hidden" name="range" value="17511-17531" /><button type="submit" title="Astuces" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit17" id="si_cela_ne_fonctionne_pas">Si cela ne fonctionne pas</h3>
<div class="level3">

<p>
<em class="u"><strong>Si je n&#039;ai pas de menu</strong></em>
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Tester avec un autre ordinateur</div>
</li>
<li class="level1"><div class="li"> Vérifier que la connexion ethernet fonctionne</div>
</li>
<li class="level1"><div class="li"> Vérifier si l&#039;ordinateur récupère une adresse IP et les paramètres auprès du serveur <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr></div>
</li>
<li class="level1"><div class="li"> Vérifier les droits du fichier menu (install.ipxe) et des fichiers de démarrage (undionly.kpxe et ipxe.efi)</div>
</li>
</ul>

<p>
<em class="u"><strong>Si j&#039;ai le menu</strong></em> (dans ce cas là, c&#039;est le système choisi qui ne démarre pas)
</p>
<ul class=" fix-media-list-overlap">
<li class="level1"><div class="li"> Vérifier que tous les fichiers pointés dans la configuration du menu sont accessibles et que les chemins sont corrects.</div>
</li>
<li class="level1"><div class="li"> Vérifier si il n&#039;y a pas un problème de droit </div>
</li>
<li class="level1"><div class="li"> Si vous êtes en EFI, vérifiez que ce que vous voulez démarrer est compatible.</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_17'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Si cela ne fonctionne pas] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="si_cela_ne_fonctionne_pas" /><input type="hidden" name="codeblockOffset" value="36" /><input type="hidden" name="range" value="17532-18252" /><button type="submit" title="Si cela ne fonctionne pas" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit18" id="creer_une_cle_usb_d_ipxe">Créer une clé USB d&#039;iPXE</h3>
<div class="level3">

<p>
Pour éviter l&#039;utilisation de dhcp par exemple, il est possible de mettre iPXE sur une clé <abbr title="Universal Serial Bus">USB</abbr> bootable. Il faut compiler ipxe.usb à partir des sources pour ensuite le transférer sur la cle usb. Le paquet suivant sera nécessaire : <a href="apt://liblzma-dev" class="interwiki iw_apt" title="apt://liblzma-dev">liblzma-dev</a>
</p>
<pre class="code">cd /tmp
git clone git://git.ipxe.org/ipxe.git
cd ipxe/src</pre>
<div class="notewarning">Manipulez la commande <a href="/dd" class="wikilink1" title="dd">dd</a> avec beaucoup de précaution !!

</div>
<p>
Pour la version bios :
</p>
<pre class="code">make bin/ipxe.usb
dd if=bin/ipxe.usb of=/dev/sdX status=progress # où sdX représente la clé USB</pre>

<p>
Pour la version efi :
</p>
<pre class="code">make bin-x86_64-efi/ipxe.usb
dd if=bin-x86_64-efi/ipxe.usb of=/dev/sdX # où sdX représente la clé USB </pre>

</div>
<div class='secedit editbutton_section editbutton_18'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Créer une clé USB d&#039;iPXE] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="creer_une_cle_usb_d_ipxe" /><input type="hidden" name="codeblockOffset" value="36" /><input type="hidden" name="range" value="18253-18985" /><button type="submit" title="Créer une clé USB d&#039;iPXE" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit19" id="gagner_de_la_place">Gagner de la place</h3>
<div class="level3">

<p>
Si vos ISO sont déjà dans un autre emplacement sur votre serveur, il est possible d&#039;effectuer des liens symbolique afin d&#039;éviter les doublons.
</p>
<pre class="code">ln -s /home/user/mon_iso.iso /var/lib/tftpboot/mon_iso.iso</pre>

<p>
Il est aussi faisable d&#039;automatiser le montage d&#039;ISO au démarrage pour les ISO qui doivent être décompressées. Il suffit d&#039;automatiser toutes les commandes &quot;mount -o loop&quot; qui sont nécessaires. Par exemple avec une tâche cron @reboot : <a href="/cron#comment_fonctionne_cron" class="wikilink1" title="cron">cron</a> (il est préférable de lancer un script contenant toutes les commandes mount)
</p>
<div class="noteimportant">Ne pas utiliser de lien symbolique à l&#039;intérieur du partage samba. Ils ne seront pas utilisable par le client ! 
<p>
Il est en revanche possible d&#039;en utiliser avant le point de montage du partage.
</p>

</div>
</div>
<div class='secedit editbutton_section editbutton_19'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Gagner de la place] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="gagner_de_la_place" /><input type="hidden" name="codeblockOffset" value="39" /><input type="hidden" name="range" value="18986-19818" /><button type="submit" title="Gagner de la place" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h3 class="sectionedit20" id="bugs_connus">Bugs connus</h3>
<div class="level3">

</div>

<h4 id="ubuntu_et_lubuntu_1804">Ubuntu et Lubuntu 18.04.*</h4>
<div class="level4">

<p>
Si Ubuntu ou Lubuntu 18.04.1 n&#039;arrive pas à se lancer (il s&#039;arrête en mode maintenance), rajoutez &quot;systemd.mask=tmp.mount&quot; entre &quot;ip=dhcp&quot; et &quot;–&quot; 
</p>

<p>
Pour Ubuntu ou Lubuntu 18.04.2, il faut rajouter en sus : &quot;systemd.mask=dev-hugepages.mount systemd.mask=dev-mqueue.mount systemd.mask=sys-fs-fuse-connections.mount systemd.mask=sys-kernel-config.mount systemd.mask=sys-kernel-debug.mount systemd.mask=tmp.mount toram&quot;
</p>

<p>
Pour Ubuntu et Lubuntu 18.04.3, il faut enlever toutes ses modifications faites pour Ubuntu Server 18.04. 1 et 2 sinon l&#039;installateur plante pendant la copie des fichiers de /media/filesystem 
</p>

<p>
Voir : <a href="https://bugs.launchpad.net/ubuntu/+source/casper/+bug/1754777#yui_3_10_3_1_1557065713426_342" class="urlextern" title="https://bugs.launchpad.net/ubuntu/+source/casper/+bug/1754777#yui_3_10_3_1_1557065713426_342" rel="nofollow">https://bugs.launchpad.net/ubuntu/+source/casper/+bug/1754777#yui_3_10_3_1_1557065713426_342</a>
</p>

</div>

<h4 id="ubuntu_2004">Ubuntu 20.04</h4>
<div class="level4">

<p>
Sur les distributions basées sur Ubuntu 20.04, un fsck des fichiers est effectué, ce qui rend le démarrage très long. Pour éviter cette étape il suffit de rajouter fsck.mode=skip après boot=casper
</p>

</div>

<h4 id="pas_de_reseau_dans_windows_pe">Pas de réseau dans Windows PE</h4>
<div class="level4">

<p>
Si le retour de la commande ipconfig ne donne rien, alors c&#039;est qu&#039;il n&#039;y a pas le pilote réseau adéquat pour votre carte réseau. Recherchez son pilote chez le constructeur de votre carte réseau, et, intégrez ce pilote lors de la construction de WinPE. (voir paragraphe : <a href="/ipxe#creer_un_windows_pe" class="wikilink1 curid" title="ipxe" data-curid="true">Créer un WinPE sous windows</a>)
</p>

</div>
<div class='secedit editbutton_section editbutton_20'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Bugs connus] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="bugs_connus" /><input type="hidden" name="codeblockOffset" value="40" /><input type="hidden" name="range" value="19819-21192" /><button type="submit" title="Bugs connus" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
<h2 class="sectionedit21 page-header" id="voir_aussi">Voir aussi</h2>
<div class="level2">

<p>
<a href="http://ipxe.org" class="urlextern" title="http://ipxe.org" rel="nofollow">Site officiel de iPXE</a>
</p>

<p>
<strong><em class="u">Contributeur</em></strong>
</p>

<p>
nicolas84
</p>

</div>
<div class='secedit editbutton_section editbutton_21'><form class="button btn_secedit form-inline" method="post" action="/ipxe"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1612368483" /><input type="hidden" name="summary" value="[Voir aussi] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="hid" value="voir_aussi" /><input type="hidden" name="codeblockOffset" value="40" /><input type="hidden" name="range" value="21193-" /><button type="submit" title="Voir aussi" class=" btn btn-default btn btn-xs btn-default">Modifier</button></div></form></div>
</div><!-- /CONTENT --></div>
          </div>
        </div>

        <div class="small text-right">

                    <span class="docInfo">
            <ul class="list-inline"><li><i class="fa fa-fw fa-file-text-o text-muted"></i> <span title="ipxe.txt">ipxe.txt</span></li><li><i class="fa fa-fw fa-calendar text-muted"></i> Dernière modification: <span title="Le 03/02/2021, 17:08">Le 03/02/2021, 17:08</span></li><li class="text-muted">par 86.213.93.155</li></ul>          </span>
          
          
        </div>

      </article>

      
    </main>

    <footer id="dw__footer" class="navbar navbar-default">
  <div class="container">

    <div class="small navbar-text">

            <div class="footer-dw-title row">
        <div class="media col-sm-4">
          <!--<div class="media-left">
            <img src="/_media/logo.png" alt="Wiki ubuntu-fr" class="media-object" style="width:32px" />
          </div> -->
          <div class="media-body">
            <h4 class="media-heading">Documentation ubuntu-fr</h4>
            <p>
              Les pages de cette documentation sont rédigées par les utilisateurs
              pour les utilisateurs. Apportez-nous votre aide pour améliorer
              le contenu de cette documentation.
            </p>
          </div>
        </div>
        <div class="col-sm-4">
          <h4>Liens utiles</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/debutant" ><i class="fa fa-fw fa-child" style="font-size: 1.3em;"></i> Débuter sur Ubuntu</a>            </li>
            <li>
              <a href="/wiki/participer_wiki" ><i class="fa fa-fw fa-edit" style="font-size: 1.3em;"></i> Participer à la documentation</a>            </li>
            <li>
              <a href="/documentation_hors_ligne" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Documentation hors ligne</a>            </li>
            <li>
              <a href="//www.ubuntu-fr.org/telechargement" ><i class="fa fa-fw fa-arrow-circle-down" style="font-size: 1.3em;"></i> Télécharger Ubuntu</a>            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h4>Obtenir de l'aide</h4>
          <ul class="list-group list-unstyled">
            <li>
              <a href="/tutoriel/comment_obtenir_une_reponse_satisfaisante" ><i class="fa fa-fw fa-info-circle" style="font-size: 1.3em;"></i> Chercher de l'aide</a>            </li>
            <li>
              <a href="//doc.ubuntu-fr.org/" ><i class="fa fa-fw fa-book" style="font-size: 1.3em;"></i> Consulter la documentation</a>            </li>
            <li>
              <a href="//forum.ubuntu-fr.org/" ><i class="fa fa-fw fa-comments" style="font-size: 1.3em;"></i> Consulter le Forum</a>            </li>
            <li>
              <a href="//guide.ubuntu-fr.org/" ><i class="fa fa-fw fa-question-circle" style="font-size: 1.3em;"></i> Lisez le guide</a>            </li>
          </ul>
        </div>
        <p>&nbsp;</p>
      </div>
      
      
      <div class="footer-license row">

        <div class="col-sm-6">
                    <p>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license"><img src="/lib/tpl/bootstrap3/images/license/cc.png" width="24" height="24" alt="cc" /> <img src="/lib/tpl/bootstrap3/images/license/by.png" width="24" height="24" alt="by" /> <img src="/lib/tpl/bootstrap3/images/license/sa.png" width="24" height="24" alt="sa" /> </a>          </p>
          <p class="small">
            Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante :<br/><a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" title="CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported" target="" itemscope itemtype="http://schema.org/CreativeWork" itemprop="license" rel="license" class="license">CC Paternité-Partage des Conditions Initiales à l'Identique 3.0 Unported</a>          </p>
                  </div>

        <div class="col-sm-6">
                    <ul id="dw__badges" class="list-inline text-right hidden-print">

  <li>
    <a href="https://www.dokuwiki.org/template:bootstrap3" title="Bootstrap template for DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/bootstrap.png" width="20" alt="Bootstrap template for DokuWiki" />
    </a>
  </li>

  <li>
    <a href="https://www.php.net" title="Powered by PHP" target="">
      <img src="/lib/tpl/bootstrap3/images/php.png" width="20" alt="Powered by PHP" />
    </a>
  </li>

  <li>
    <a href="http://validator.w3.org/check/referer" title="Valid HTML5" target="">
      <img src="/lib/tpl/bootstrap3/images/html5.png" width="20" alt="Valid HTML5" />
    </a>
  </li>

  <li>
    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" target="">
      <img src="/lib/tpl/bootstrap3/images/css3.png" width="20" alt="Valid CSS" />
    </a>
  </li>

  <li>
    <a href="https://www.dokuwiki.org/" title="Driven by DokuWiki" target="">
      <img src="/lib/tpl/bootstrap3/images/logo.png" width="20" alt="Driven by DokuWiki" />
    </a>
  </li>

</ul>
                  </div>

      </div>

    </div>

  </div>
</footer>
<img src="/lib/exe/indexer.php?id=ipxe&amp;1635554318" width="2" height="1" alt="" />
    <a href="#dokuwiki__top" class="back-to-top hidden-print btn btn-default btn-sm" title="Aller au contenu" accesskey="t"><i class="fa fa-chevron-up"></i></a>

    <div id="screen__mode">      <span class="visible-xs-block"></span>
      <span class="visible-sm-block"></span>
      <span class="visible-md-block"></span>
      <span class="visible-lg-block"></span>
    </div>

  </div>

    <!-- Piwik -->
		<script type="text/javascript">
		  var _paq = _paq || [];
		  _paq.push(["setDomains", ["*.doc.ubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.xubuntu-fr.org","*.doc.edubuntu-fr.org","*.doc.lubuntu-fr.org","*.doc.ubuntu-fr.org","*.doc.xubuntu-fr.org"]]);
		  _paq.push(['trackPageView']);
		  _paq.push(['enableLinkTracking']);
		  (function() {
		    var u="//piwik.ubuntu-fr.org/";
		    _paq.push(['setTrackerUrl', u+'piwik.php']);
		    _paq.push(['setSiteId', 3]);
		    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
		  })();
		</script>
		<noscript><p><img src="//piwik.ubuntu-fr.org/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
		<!-- End Piwik Code -->

</body>
</html>
